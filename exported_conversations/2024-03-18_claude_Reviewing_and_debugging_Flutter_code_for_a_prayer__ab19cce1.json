{
  "id": "ab19cce1-ba60-46d4-9e63-cf38d6565d1e",
  "source": "claude",
  "title": "Reviewing and debugging Flutter code for a prayer tracking app",
  "created_at": "2024-03-18T10:24:13.430808Z",
  "updated_at": "2024-03-18T11:22:11.962440Z",
  "summary": "",
  "message_count": 6,
  "messages": [
    {
      "id": "45689223-bb2d-431c-a084-17690f360a8a",
      "role": "human",
      "content": "We have udpated the code, review it step by step and identify issues. We found these issues already: Incorrect Progress Calculation, The app is not navigating to YearSelectionScreen Review the code in detail and identify any navigation or calculation issues. and fix the files which are broken. Send the file back in its entirety in one response Here is the code remember give the files back all at the same time",
      "created_at": "2024-03-18T10:26:50.806625Z",
      "sequence_order": 0,
      "metadata": {
        "content": [
          {
            "start_timestamp": "2024-03-18T10:26:50.806625Z",
            "stop_timestamp": "2024-03-18T10:26:50.806625Z",
            "flags": null,
            "type": "text",
            "text": "We have udpated the code, review it step by step and identify issues. We found these issues already: Incorrect Progress Calculation, The app is not navigating to YearSelectionScreen Review the code in detail and identify any navigation or calculation issues. and fix the files which are broken. Send the file back in its entirety in one response Here is the code remember give the files back all at the same time",
            "citations": []
          }
        ],
        "updated_at": "2024-03-18T10:26:50.806625Z",
        "attachments": [
          {
            "file_name": "paste.txt",
            "file_size": 27443,
            "file_type": "txt",
            "extracted_content": "\n\n# File: ./main.dart\n####################\n\n// main.dart\nimport 'package:flutter/material.dart';\nimport './screens/year_selection_screen.dart';\n\nvoid main() {\n  runApp(const AmanaAuditApp());\n}\n\nclass AmanaAuditApp extends StatelessWidget {\n  const AmanaAuditApp({super.key});\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      title: 'Amana Audit',\n      theme: ThemeData(\n        primarySwatch: Colors.blue,\n      ),\n      initialRoute: '/',\n      routes: {\n        '/': (context) => const YearSelectionScreen(),\n      },\n    );\n  }\n}\n\n\n\n# File: ./screens/year_selection_screen.dart\n#############################################\n\n// screens/year_selection_screen.dart\nimport 'package:flutter/material.dart';\nimport '../services/prayer_service.dart';\nimport 'home_screen.dart';\n\nclass YearSelectionScreen extends StatefulWidget {\n  const YearSelectionScreen({super.key});\n\n  @override\n  _YearSelectionScreenState createState() => _YearSelectionScreenState();\n}\n\nclass _YearSelectionScreenState extends State<YearSelectionScreen> {\n  final PrayerService _prayerService = PrayerService();\n\n  final TextEditingController _startYearController = TextEditingController();\n  final TextEditingController _endYearController = TextEditingController();\n  final TextEditingController _initialAverageGuessController =\n      TextEditingController();\n\n  Future<void> _navigateToSummary() async {\n    int startYear = int.tryParse(_startYearController.text) ?? 0;\n    int endYear = int.tryParse(_endYearController.text) ?? 0;\n    int initialAverageGuess =\n        int.tryParse(_initialAverageGuessController.text) ?? 0;\n\n    if (startYear > 0 && endYear >= startYear) {\n      await _prayerService.generatePrayerInputs(startYear, endYear);\n      _prayerService.applyUniformPercentage(initialAverageGuess);\n      _prayerService.calculateTotalPrayers(0);\n\n      Navigator.push(\n        context,\n        MaterialPageRoute(builder: (context) => const AmanaAuditHomePage()),\n      );\n    } else {\n      showDialog(\n        context: context,\n        builder: (context) => AlertDialog(\n          title: const Text('Invalid Input'),\n          content: const Text('Please enter valid start and end years.'),\n          actions: [\n            TextButton(\n              onPressed: () => Navigator.pop(context),\n              child: const Text('OK'),\n            ),\n          ],\n        ),\n      );\n    }\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Select Years'),\n      ),\n      body: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.stretch,\n          children: [\n            TextField(\n              controller: _startYearController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'Start Year',\n                hintText: 'Enter start year',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            TextField(\n              controller: _endYearController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'End Year',\n                hintText: 'Enter end year',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            TextField(\n              controller: _initialAverageGuessController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'Initial Average Guess',\n                hintText: 'Enter initial average guess percentage',\n              ),\n            ),\n            const SizedBox(height: 24.0),\n            ElevatedButton(\n              onPressed: _navigateToSummary,\n              child: const Text('Next'),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n\n\n# File: ./screens/home_screen.dart\n###################################\n\nimport 'package:flutter/material.dart';\nimport 'package:share_plus/share_plus.dart';\nimport '../services/prayer_service.dart';\nimport '../services/shared_preferences_service.dart';\nimport '../screens/year_selection_screen.dart';\nimport '../widgets/prayer_input_card.dart';\nimport '../widgets/prayer_progress_card.dart';\n\nclass AmanaAuditHomePage extends StatefulWidget {\n  const AmanaAuditHomePage({super.key});\n\n  @override\n  _AmanaAuditHomePageState createState() => _AmanaAuditHomePageState();\n}\n\nclass _AmanaAuditHomePageState extends State<AmanaAuditHomePage> {\n  final PrayerService _prayerService = PrayerService();\n  final SharedPreferencesService _preferencesService =\n      SharedPreferencesService();\n  String _state = 'input';\n\n  final TextEditingController _startYearController = TextEditingController();\n  final TextEditingController _endYearController = TextEditingController();\n  final TextEditingController _uniformPercentageController =\n      TextEditingController();\n  final TextEditingController _taqwaBufferController =\n      TextEditingController(text: '0');\n\n  @override\n  void initState() {\n    super.initState();\n    _loadSavedData();\n  }\n\n  Future<void> _loadSavedData() async {\n    await _prayerService.loadSavedData();\n    if (_prayerService.hasPrayerData()) {\n      setState(() {\n        _state = 'result';\n      });\n    }\n  }\n\n  Future<void> _generatePrayerInputs() async {\n    int startYear = int.tryParse(_startYearController.text) ?? 0;\n    int endYear = int.tryParse(_endYearController.text) ?? 0;\n    if (startYear > 0 && endYear >= startYear) {\n      await _prayerService.generatePrayerInputs(startYear, endYear);\n      setState(() {});\n    } else {\n      showDialog(\n        context: context,\n        builder: (context) => AlertDialog(\n          title: const Text('Invalid Input'),\n          content: const Text('Please enter valid start and end years.'),\n          actions: [\n            TextButton(\n              onPressed: () => Navigator.pop(context),\n              child: const Text('OK'),\n            ),\n          ],\n        ),\n      );\n    }\n  }\n\n  void _applyUniformPercentage() {\n    int percentage = int.tryParse(_uniformPercentageController.text) ?? 0;\n    _prayerService.applyUniformPercentage(percentage);\n    setState(() {});\n  }\n\n  void _calculateTotalPrayers() {\n    int taqwaBuffer = int.tryParse(_taqwaBufferController.text) ?? 0;\n    _prayerService.calculateTotalPrayers(taqwaBuffer);\n    _prayerService.savePrayerData();\n    setState(() {\n      _state = 'result';\n    });\n  }\n\n  void _decrementPrayer(String prayer) {\n    _prayerService.decrementPrayer(prayer);\n    _prayerService.savePrayerData();\n    setState(() {});\n  }\n\n  void _resetApplication() {\n    _prayerService.resetApplication();\n    setState(() {\n      _state = 'input';\n    });\n  }\n\n  void _sharePrayerData() {\n    _prayerService.sharePrayerData();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Amana Audit'),\n      ),\n      body: _buildBody(),\n    );\n  }\n\n  Widget _buildBody() {\n    switch (_state) {\n      case 'input':\n        return SingleChildScrollView(\n          child: Padding(\n            padding: const EdgeInsets.all(16.0),\n            child: _buildInputSection(),\n          ),\n        );\n      case 'result':\n        return SingleChildScrollView(\n          child: Padding(\n            padding: const EdgeInsets.all(16.0),\n            child: _buildResultSection(),\n          ),\n        );\n      default:\n        return Container();\n    }\n  }\n\n  Widget _buildInputSection() {\n    return Column(\n      crossAxisAlignment: CrossAxisAlignment.stretch,\n      children: [\n        TextField(\n          controller: _startYearController,\n          keyboardType: TextInputType.number,\n          decoration: const InputDecoration(\n            labelText: 'Start Year',\n            hintText: 'Enter start year',\n          ),\n        ),\n        const SizedBox(height: 16.0),\n        TextField(\n          controller: _endYearController,\n          keyboardType: TextInputType.number,\n          decoration: const InputDecoration(\n            labelText: 'End Year',\n            hintText: 'Enter end year',\n          ),\n        ),\n        const SizedBox(height: 16.0),\n        Row(\n          children: [\n            Expanded(\n              child: TextField(\n                controller: _uniformPercentageController,\n                keyboardType: TextInputType.number,\n                decoration: const InputDecoration(\n                  labelText: 'Average Percentage of Missed Prayers',\n                  hintText: 'Enter average percentage',\n                ),\n              ),\n            ),\n            IconButton(\n              icon: const Icon(Icons.info),\n              onPressed: () {\n                showDialog(\n                  context: context,\n                  builder: (context) => AlertDialog(\n                    title: const Text('Average Percentage of Missed Prayers'),\n                    content: const Text(\n                        'Enter the average percentage of prayers you estimate you missed in those years.'),\n                    actions: [\n                      TextButton(\n                        onPressed: () => Navigator.pop(context),\n                        child: const Text('OK'),\n                      ),\n                    ],\n                  ),\n                );\n              },\n            ),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        ElevatedButton(\n          onPressed: () async {\n            await _generatePrayerInputs();\n            _applyUniformPercentage();\n          },\n          child: const Text('Generate Prayer Inputs'),\n        ),\n        const SizedBox(height: 16.0),\n        ExpansionTile(\n          title: Row(\n            children: [\n              const Text('Add Details'),\n              IconButton(\n                icon: const Icon(Icons.info),\n                onPressed: () {\n                  showDialog(\n                    context: context,\n                    builder: (context) => AlertDialog(\n                      title: const Text('Detailed Prayer Calendar'),\n                      content: const Text(\n                          'Expand this section to review and modify the detailed prayer calendar. You can set specific percentages for each year and prayer.'),\n                      actions: [\n                        TextButton(\n                          onPressed: () => Navigator.pop(context),\n                          child: const Text('OK'),\n                        ),\n                      ],\n                    ),\n                  );\n                },\n              ),\n            ],\n          ),\n          children: [\n            _buildPrayerInputs(),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        Row(\n          children: [\n            Expanded(\n              child: TextField(\n                controller: _taqwaBufferController,\n                keyboardType: TextInputType.number,\n                decoration: const InputDecoration(\n                  labelText: 'Taqwa Buffer',\n                  hintText: 'Enter taqwa buffer percentage',\n                ),\n              ),\n            ),\n            IconButton(\n              icon: const Icon(Icons.info),\n              onPressed: () {\n                showDialog(\n                  context: context,\n                  builder: (context) => AlertDialog(\n                    title: const Text('Taqwa Buffer'),\n                    content: const Text(\n                        'Enter a percentage to add as a buffer to the calculated prayer debt. This buffer is added to account for any uncertainties or missed prayers.'),\n                    actions: [\n                      TextButton(\n                        onPressed: () => Navigator.pop(context),\n                        child: const Text('OK'),\n                      ),\n                    ],\n                  ),\n                );\n              },\n            ),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        ElevatedButton(\n          onPressed: _calculateTotalPrayers,\n          child: const Text('Calculate Prayer Debt'),\n        ),\n      ],\n    );\n  }\n\n  Widget _buildPrayerInputs() {\n    return Column(\n      crossAxisAlignment: CrossAxisAlignment.stretch,\n      children: _prayerService.prayerPercentages.entries.map((entry) {\n        int year = entry.key;\n        Map<String, int> prayers = entry.value;\n        return PrayerInputCard(\n          year: year,\n          prayers: prayers,\n          onChanged: (year, prayer, percentage) {\n            setState(() {\n              _prayerService.updatePrayerPercentage(year, prayer, percentage);\n            });\n          },\n        );\n      }).toList(),\n    );\n  }\n\n  Widget _buildResultSection() {\n    return Column(\n      crossAxisAlignment: CrossAxisAlignment.stretch,\n      children: [\n        Card(\n          elevation: 4.0,\n          margin: const EdgeInsets.symmetric(vertical: 16.0),\n          child: Padding(\n            padding: const EdgeInsets.all(16.0),\n            child: Column(\n              crossAxisAlignment: CrossAxisAlignment.start,\n              children: [\n                const Text(\n                  'Total Prayers to Make Up',\n                  style: TextStyle(\n                    fontSize: 20.0,\n                    fontWeight: FontWeight.bold,\n                  ),\n                ),\n                const SizedBox(height: 16.0),\n                LinearProgressIndicator(\n                  value: _prayerService.calculateOverallTotalPrayers() > 0\n                      ? _prayerService.overallProgress /\n                          _prayerService.calculateOverallTotalPrayers()\n                      : 0,\n                  minHeight: 24.0,\n                ),\n                const SizedBox(height: 8.0),\n                Text(\n                  '${_prayerService.overallProgress} / ${_prayerService.calculateOverallTotalPrayers()}',\n                  textAlign: TextAlign.center,\n                  style: const TextStyle(fontSize: 18.0),\n                ),\n              ],\n            ),\n          ),\n        ),\n        ..._prayerService.prayers.map((prayer) {\n          int totalPrayers =\n              _prayerService.calculateTotalPrayersForPrayer(prayer);\n          int completedPrayers = _prayerService.prayerCounts[prayer] ?? 0;\n          return PrayerProgressCard(\n            prayer: prayer,\n            completedPrayers: completedPrayers,\n            totalPrayers: totalPrayers,\n            onPressed: () => _decrementPrayer(prayer),\n          );\n        }).toList(),\n        const SizedBox(height: 24.0),\n        Row(\n          mainAxisAlignment: MainAxisAlignment.spaceEvenly,\n          children: [\n            ElevatedButton.icon(\n              onPressed: _sharePrayerData,\n              icon: const Icon(Icons.share),\n              label: const Text('Share Progress'),\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.blue,\n                padding: const EdgeInsets.symmetric(\n                  vertical: 16.0,\n                  horizontal: 24.0,\n                ),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(8.0),\n                ),\n              ),\n            ),\n            ElevatedButton.icon(\n              onPressed: () {\n                Navigator.pushReplacement(\n                  context,\n                  MaterialPageRoute(\n                    builder: (context) => const YearSelectionScreen(),\n                  ),\n                );\n              },\n              icon: const Icon(Icons.edit),\n              label: const Text('Edit'),\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.orange,\n                padding: const EdgeInsets.symmetric(\n                  vertical: 16.0,\n                  horizontal: 24.0,\n                ),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(8.0),\n                ),\n              ),\n            ),\n            ElevatedButton.icon(\n              onPressed: _resetApplication,\n              icon: const Icon(Icons.refresh),\n              label: const Text('Start Over'),\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.red,\n                padding: const EdgeInsets.symmetric(\n                  vertical: 16.0,\n                  horizontal: 24.0,\n                ),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(8.0),\n                ),\n              ),\n            ),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        ExpansionTile(\n          title: Row(\n            children: [\n              const Text('Add Details'),\n              IconButton(\n                icon: const Icon(Icons.info),\n                onPressed: () {\n                  showDialog(\n                    context: context,\n                    builder: (context) => AlertDialog(\n                      title: const Text('Detailed Prayer Calendar'),\n                      content: const Text(\n                          'Expand this section to review and modify the detailed prayer calendar. You can set specific percentages for each year and prayer.'),\n                      actions: [\n                        TextButton(\n                          onPressed: () => Navigator.pop(context),\n                          child: const Text('OK'),\n                        ),\n                      ],\n                    ),\n                  );\n                },\n              ),\n            ],\n          ),\n          children: [\n            _buildPrayerInputs(),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        TextButton.icon(\n          onPressed: () {\n            showDialog(\n              context: context,\n              builder: (context) => AlertDialog(\n                title: const Text('Explanation'),\n                content: const Text(\n                  'This app helps you track and make up your missed prayers. Enter the years and the average percentage of prayers you estimate you missed in those years. You can also set specific percentages for each prayer and year in the detailed prayer calendar. The Taqwa Buffer is an additional percentage adde to account for any missed prayers. Once you calculate your prayer debt, you can track your progress and mark prayers as completed. The progress bars show your overall progress and the progress for each prayer.',\n                ),\n                actions: [\n                  TextButton(\n                    onPressed: () => Navigator.pop(context),\n                    child: const Text('OK'),\n                  ),\n                ],\n              ),\n            );\n          },\n          icon: const Icon(Icons.info),\n          label: const Text('Explanation'),\n        ),\n      ],\n    );\n  }\n}\n\n\n\n\n\n# File: ./services/prayer_service.dart\n#######################################\n\n// services/prayer_service.dart\nimport 'dart:convert';\nimport 'package:flutter/material.dart';\nimport 'shared_preferences_service.dart';\nimport 'package:share_plus/share_plus.dart';\n\nclass PrayerService {\n  final SharedPreferencesService _preferencesService =\n      SharedPreferencesService();\n  final List<String> prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];\n  Map<String, int> prayerCounts = {};\n  Map<int, Map<String, int>> prayerPercentages = {};\n  int overallProgress = 0;\n\n  Future<void> loadSavedData() async {\n    Map<String, int> savedData = {};\n    for (var prayer in prayers) {\n      savedData[prayer] = await _preferencesService.getData(prayer) ?? 0;\n    }\n    prayerCounts = savedData;\n  }\n\n  bool hasPrayerData() {\n    return prayerCounts.values.any((count) => count > 0);\n  }\n\n  Future<void> generatePrayerInputs(int startYear, int endYear,\n      {int defaultPercentage = 95}) async {\n    prayerPercentages.clear();\n    for (int year = startYear; year <= endYear; year++) {\n      String? yearData = await _preferencesService.getData('$year');\n      if (yearData != null) {\n        // If data exists, decode and use it\n        prayerPercentages[year] = Map<String, int>.from(jsonDecode(yearData));\n      } else {\n        // Initialize with default percentage if no data exists\n        prayerPercentages[year] = {\n          for (var prayer in prayers) prayer: defaultPercentage\n        };\n      }\n    }\n  }\n\n  void applyUniformPercentage(int percentage) {\n    prayerPercentages.forEach((year, prayers) {\n      prayers.updateAll((prayer, value) => percentage);\n    });\n  }\n\n  void calculateTotalPrayers(int taqwaBuffer) {\n    prayerCounts.clear();\n    for (int year in prayerPercentages.keys) {\n      for (String prayer in prayers) {\n        int percentage = prayerPercentages[year]?[prayer] ?? 0;\n        int count = (365 * (100 - percentage) ~/ 100);\n        prayerCounts[prayer] = (prayerCounts[prayer] ?? 0) + count;\n      }\n      _preferencesService.saveData(\n          '$year', jsonEncode(prayerPercentages[year]!));\n    }\n\n    prayerCounts = prayerCounts.map((prayer, count) =>\n        MapEntry(prayer, (count * (100 + taqwaBuffer) ~/ 100)));\n    overallProgress = prayerCounts.values.fold(0, (sum, count) => sum + count);\n    savePrayerData();\n  }\n\n  void decrementPrayer(String prayer) {\n    if (prayerCounts.containsKey(prayer) && prayerCounts[prayer]! > 0) {\n      prayerCounts[prayer] = prayerCounts[prayer]! - 1;\n      overallProgress =\n          prayerCounts.values.fold(0, (sum, count) => sum + count);\n      savePrayerData();\n    }\n  }\n\n  void resetApplication() {\n    prayerCounts.clear();\n    prayerPercentages.clear();\n    overallProgress = 0;\n    _preferencesService.clearData();\n  }\n\n  void savePrayerData() {\n    for (var entry in prayerCounts.entries) {\n      _preferencesService.saveData(entry.key, entry.value);\n    }\n  }\n\n  void sharePrayerData() {\n    String shareText = 'My Prayer Progress:\\n\\n';\n    for (var entry in prayerCounts.entries) {\n      int totalPrayers = calculateTotalPrayersForPrayer(entry.key);\n      shareText += '${entry.key}: ${entry.value} / $totalPrayers\\n';\n    }\n    Share.share(shareText);\n  }\n\n  int calculateTotalPrayersForPrayer(String prayer) {\n    int totalPrayers = prayerPercentages.values.fold<int>(\n        0,\n        (sum, yearData) =>\n            sum + (365 * (100 - (yearData[prayer] ?? 0)) ~/ 100));\n    return totalPrayers;\n  }\n\n  int calculateOverallTotalPrayers() {\n    return prayers.fold<int>(\n        0, (sum, prayer) => sum + calculateTotalPrayersForPrayer(prayer));\n  }\n\n  void updatePrayerPercentage(int year, String prayer, int percentage) {\n    prayerPercentages[year]?[prayer] = percentage;\n  }\n}\n\n\n\n# File: ./widgets/prayer_input_card.dart\n#########################################\n\n// widgets/prayer_input_card.dart\nimport 'package:flutter/material.dart';\n\nclass PrayerInputCard extends StatelessWidget {\n  final int year;\n  final Map<String, int> prayers;\n  final Function(int, String, int) onChanged;\n\n  const PrayerInputCard({\n    Key? key,\n    required this.year,\n    required this.prayers,\n    required this.onChanged,\n  }) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return Card(\n      margin: const EdgeInsets.symmetric(vertical: 8.0),\n      child: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.start,\n          children: [\n            Text(\n              'Year: $year',\n              style: const TextStyle(\n                fontSize: 18.0,\n                fontWeight: FontWeight.bold,\n              ),\n            ),\n            const SizedBox(height: 8.0),\n            ...prayers.entries.map((entry) {\n              String prayer = entry.key;\n              int percentage = entry.value;\n              int completedPrayers = (365 * (100 - percentage) ~/ 100);\n              int totalPrayers = 365;\n              return Column(\n                children: [\n                  Row(\n                    children: [\n                      Expanded(\n                        child: Text('$prayer:'),\n                      ),\n                      const SizedBox(width: 8.0),\n                      Expanded(\n                        child: TextField(\n                          keyboardType: TextInputType.number,\n                          controller:\n                              TextEditingController(text: '$percentage'),\n                          onChanged: (value) {\n                            onChanged(year, prayer, int.tryParse(value) ?? 0);\n                          },\n                          decoration: const InputDecoration(\n                            hintText: 'Percentage',\n                          ),\n                        ),\n                      ),\n                    ],\n                  ),\n                  const SizedBox(height: 8.0),\n                  Text('$completedPrayers / $totalPrayers'),\n                ],\n              );\n            }).toList(),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n\n\n# File: ./widgets/prayer_progress_card.dart\n############################################\n\n// widgets/prayer_progress_card.dart\nimport 'package:flutter/material.dart';\n\nclass PrayerProgressCard extends StatelessWidget {\n  final String prayer;\n  final int completedPrayers;\n  final int totalPrayers;\n  final VoidCallback onPressed;\n\n  const PrayerProgressCard({\n    Key? key,\n    required this.prayer,\n    required this.completedPrayers,\n    required this.totalPrayers,\n    required this.onPressed,\n  }) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return Card(\n      elevation: 2.0,\n      margin: const EdgeInsets.symmetric(vertical: 8.0),\n      child: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.start,\n          children: [\n            Row(\n              mainAxisAlignment: MainAxisAlignment.spaceBetween,\n              children: [\n                Text(\n                  prayer,\n                  style: const TextStyle(\n                    fontSize: 20.0,\n                    fontWeight: FontWeight.bold,\n                  ),\n                ),\n                Text(\n                  '$completedPrayers / $totalPrayers',\n                  style: const TextStyle(fontSize: 18.0),\n                ),\n              ],\n            ),\n            const SizedBox(height: 16.0),\n            LinearProgressIndicator(\n              value: totalPrayers > 0 ? completedPrayers / totalPrayers : 0,\n              minHeight: 20.0,\n              color: Colors.green,\n              backgroundColor: Colors.green[100],\n            ),\n            const SizedBox(height: 16.0),\n            ElevatedButton(\n              onPressed: completedPrayers < totalPrayers ? onPressed : null,\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.green,\n                padding: const EdgeInsets.symmetric(\n                  vertical: 16.0,\n                  horizontal: 24.0,\n                ),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(8.0),\n                ),\n              ),\n              child: Text(\n                'Prayed $prayer',\n                style: const TextStyle(fontSize: 18.0),\n              ),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n"
          }
        ],
        "files": [
          {
            "file_name": "paste.txt"
          }
        ]
      }
    },
    {
      "id": "ca039331-57fe-427e-be99-a5fe1406c29d",
      "role": "assistant",
      "content": " Here's the updated code with the identified issues fixed:\n\n```dart\n# File: ./main.dart\n####################\n\n// main.dart\nimport 'package:flutter/material.dart';\nimport './screens/year_selection_screen.dart';\n\nvoid main() {\n  runApp(const AmanaAuditApp());\n}\n\nclass AmanaAuditApp extends StatelessWidget {\n  const AmanaAuditApp({super.key});\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      title: 'Amana Audit',\n      theme: ThemeData(\n        primarySwatch: Colors.blue,\n      ),\n      home: const YearSelectionScreen(),\n    );\n  }\n}\n\n\n\n# File: ./screens/year_selection_screen.dart\n#############################################\n\n// screens/year_selection_screen.dart\nimport 'package:flutter/material.dart';\nimport '../services/prayer_service.dart';\nimport 'home_screen.dart';\n\nclass YearSelectionScreen extends StatefulWidget {\n  const YearSelectionScreen({super.key});\n\n  @override\n  _YearSelectionScreenState createState() => _YearSelectionScreenState();\n}\n\nclass _YearSelectionScreenState extends State<YearSelectionScreen> {\n  final PrayerService _prayerService = PrayerService();\n\n  final TextEditingController _startYearController = TextEditingController();\n  final TextEditingController _endYearController = TextEditingController();\n  final TextEditingController _initialAverageGuessController =\n      TextEditingController();\n\n  Future<void> _navigateToSummary() async {\n    int startYear = int.tryParse(_startYearController.text) ?? 0;\n    int endYear = int.tryParse(_endYearController.text) ?? 0;\n    int initialAverageGuess =\n        int.tryParse(_initialAverageGuessController.text) ?? 0;\n\n    if (startYear > 0 && endYear >= startYear) {\n      await _prayerService.generatePrayerInputs(startYear, endYear);\n      _prayerService.applyUniformPercentage(initialAverageGuess);\n      _prayerService.calculateTotalPrayers(0);\n\n      Navigator.pushReplacement(\n        context,\n        MaterialPageRoute(builder: (context) => const AmanaAuditHomePage()),\n      );\n    } else {\n      showDialog(\n        context: context,\n        builder: (context) => AlertDialog(\n          title: const Text('Invalid Input'),\n          content: const Text('Please enter valid start and end years.'),\n          actions: [\n            TextButton(\n              onPressed: () => Navigator.pop(context),\n              child: const Text('OK'),\n            ),\n          ],\n        ),\n      );\n    }\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Select Years'),\n      ),\n      body: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.stretch,\n          children: [\n            TextField(\n              controller: _startYearController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'Start Year',\n                hintText: 'Enter start year',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            TextField(\n              controller: _endYearController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'End Year',\n                hintText: 'Enter end year',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            TextField(\n              controller: _initialAverageGuessController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'Initial Average Guess',\n                hintText: 'Enter initial average guess percentage',\n              ),\n            ),\n            const SizedBox(height: 24.0),\n            ElevatedButton(\n              onPressed: _navigateToSummary,\n              child: const Text('Next'),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n\n\n# File: ./screens/home_screen.dart\n###################################\n\n// screens/home_screen.dart\nimport 'package:flutter/material.dart';\nimport 'package:share_plus/share_plus.dart';\nimport '../services/prayer_service.dart';\nimport '../services/shared_preferences_service.dart';\nimport '../screens/year_selection_screen.dart';\nimport '../widgets/prayer_input_card.dart';\nimport '../widgets/prayer_progress_card.dart';\n\nclass AmanaAuditHomePage extends StatefulWidget {\n  const AmanaAuditHomePage({super.key});\n\n  @override\n  _AmanaAuditHomePageState createState() => _AmanaAuditHomePageState();\n}\n\nclass _AmanaAuditHomePageState extends State<AmanaAuditHomePage> {\n  final PrayerService _prayerService = PrayerService();\n  final SharedPreferencesService _preferencesService =\n      SharedPreferencesService();\n  String _state = 'input';\n\n  final TextEditingController _startYearController = TextEditingController();\n  final TextEditingController _endYearController = TextEditingController();\n  final TextEditingController _uniformPercentageController =\n      TextEditingController();\n  final TextEditingController _taqwaBufferController =\n      TextEditingController(text: '0');\n\n  @override\n  void initState() {\n    super.initState();\n    _loadSavedData();\n  }\n\n  Future<void> _loadSavedData() async {\n    await _prayerService.loadSavedData();\n    if (_prayerService.hasPrayerData()) {\n      setState(() {\n        _state = 'result';\n      });\n    }\n  }\n\n  Future<void> _generatePrayerInputs() async {\n    int startYear = int.tryParse(_startYearController.text) ?? 0;\n    int endYear = int.tryParse(_endYearController.text) ?? 0;\n    if (startYear > 0 && endYear >= startYear) {\n      await _prayerService.generatePrayerInputs(startYear, endYear);\n      setState(() {});\n    } else {\n      showDialog(\n        context: context,\n        builder: (context) => AlertDialog(\n          title: const Text('Invalid Input'),\n          content: const Text('Please enter valid start and end years.'),\n          actions: [\n            TextButton(\n              onPressed: () => Navigator.pop(context),\n              child: const Text('OK'),\n            ),\n          ],\n        ),\n      );\n    }\n  }\n\n  void _applyUniformPercentage() {\n    int percentage = int.tryParse(_uniformPercentageController.text) ?? 0;\n    _prayerService.applyUniformPercentage(percentage);\n    setState(() {});\n  }\n\n  void _calculateTotalPrayers() {\n    int taqwaBuffer = int.tryParse(_taqwaBufferController.text) ?? 0;\n    _prayerService.calculateTotalPrayers(taqwaBuffer);\n    _prayerService.savePrayerData();\n    setState(() {\n      _state = 'result';\n    });\n  }\n\n  void _decrementPrayer(String prayer) {\n    _prayerService.decrementPrayer(prayer);\n    _prayerService.savePrayerData();\n    setState(() {});\n  }\n\n  void _resetApplication() {\n    _prayerService.resetApplication();\n    setState(() {\n      _state = 'input';\n    });\n  }\n\n  void _sharePrayerData() {\n    _prayerService.sharePrayerData();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Amana Audit'),\n      ),\n      body: _buildBody(),\n    );\n  }\n\n  Widget _buildBody() {\n    switch (_state) {\n      case 'input':\n        return SingleChildScrollView(\n          child: Padding(\n            padding: const EdgeInsets.all(16.0),\n            child: _buildInputSection(),\n          ),\n        );\n      case 'result':\n        return SingleChildScrollView(\n          child: Padding(\n            padding: const EdgeInsets.all(16.0),\n            child: _buildResultSection(),\n          ),\n        );\n      default:\n        return Container();\n    }\n  }\n\n  Widget _buildInputSection() {\n    return Column(\n      crossAxisAlignment: CrossAxisAlignment.stretch,\n      children: [\n        TextField(\n          controller: _startYearController,\n          keyboardType: TextInputType.number,\n          decoration: const InputDecoration(\n            labelText: 'Start Year',\n            hintText: 'Enter start year',\n          ),\n        ),\n        const SizedBox(height: 16.0),\n        TextField(\n          controller: _endYearController,\n          keyboardType: TextInputType.number,\n          decoration: const InputDecoration(\n            labelText: 'End Year',\n            hintText: 'Enter end year',\n          ),\n        ),\n        const SizedBox(height: 16.0),\n        Row(\n          children: [\n            Expanded(\n              child: TextField(\n                controller: _uniformPercentageController,\n                keyboardType: TextInputType.number,\n                decoration: const InputDecoration(\n                  labelText: 'Average Percentage of Missed Prayers',\n                  hintText: 'Enter average percentage',\n                ),\n              ),\n            ),\n            IconButton(\n              icon: const Icon(Icons.info),\n              onPressed: () {\n                showDialog(\n                  context: context,\n                  builder: (context) => AlertDialog(\n                    title: const Text('Average Percentage of Missed Prayers'),\n                    content: const Text(\n                        'Enter the average percentage of prayers you estimate you missed in those years.'),\n                    actions: [\n                      TextButton(\n                        onPressed: () => Navigator.pop(context),\n                        child: const Text('OK'),\n                      ),\n                    ],\n                  ),\n                );\n              },\n            ),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        ElevatedButton(\n          onPressed: () async {\n            await _generatePrayerInputs();\n            _applyUniformPercentage();\n          },\n          child: const Text('Generate Prayer Inputs'),\n        ),\n        const SizedBox(height: 16.0),\n        ExpansionTile(\n          title: Row(\n            children: [\n              const Text('Add Details'),\n              IconButton(\n                icon: const Icon(Icons.info),\n                onPressed: () {\n                  showDialog(\n                    context: context,\n                    builder: (context) => AlertDialog(\n                      title: const Text('Detailed Prayer Calendar'),\n                      content: const Text(\n                          'Expand this section to review and modify the detailed prayer calendar. You can set specific percentages for each year and prayer.'),\n                      actions: [\n                        TextButton(\n                          onPressed: () => Navigator.pop(context),\n                          child: const Text('OK'),\n                        ),\n                      ],\n                    ),\n                  );\n                },\n              ),\n            ],\n          ),\n          children: [\n            _buildPrayerInputs(),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        Row(\n          children: [\n            Expanded(\n              child: TextField(\n                controller: _taqwaBufferController,\n                keyboardType: TextInputType.number,\n                decoration: const InputDecoration(\n                  labelText: 'Taqwa Buffer',\n                  hintText: 'Enter taqwa buffer percentage',\n                ),\n              ),\n            ),\n            IconButton(\n              icon: const Icon(Icons.info),\n              onPressed: () {\n                showDialog(\n                  context: context,\n                  builder: (context) => AlertDialog(\n                    title: const Text('Taqwa Buffer'),\n                    content: const Text(\n                        'Enter a percentage to add as a buffer to the calculated prayer debt. This buffer is added to account for any uncertainties or missed prayers.'),\n                    actions: [\n                      TextButton(\n                        onPressed: () => Navigator.pop(context),\n                        child: const Text('OK'),\n                      ),\n                    ],\n                  ),\n                );\n              },\n            ),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        ElevatedButton(\n          onPressed: _calculateTotalPrayers,\n          child: const Text('Calculate Prayer Debt'),\n        ),\n      ],\n    );\n  }\n\n  Widget _buildPrayerInputs() {\n    return Column(\n      crossAxisAlignment: CrossAxisAlignment.stretch,\n      children: _prayerService.prayerPercentages.entries.map((entry) {\n        int year = entry.key;\n        Map<String, int> prayers = entry.value;\n        return PrayerInputCard(\n          year: year,\n          prayers: prayers,\n          onChanged: (year, prayer, percentage) {\n            setState(() {\n              _prayerService.updatePrayerPercentage(year, prayer, percentage);\n            });\n          },\n        );\n      }).toList(),\n    );\n  }\n\n  Widget _buildResultSection() {\n    return Column(\n      crossAxisAlignment: CrossAxisAlignment.stretch,\n      children: [\n        Card(\n          elevation: 4.0,\n          margin: const EdgeInsets.symmetric(vertical: 16.0),\n          child: Padding(\n            padding: const EdgeInsets.all(16.0),\n            child: Column(\n              crossAxisAlignment: CrossAxisAlignment.start,\n              children: [\n                const Text(\n                  'Total Prayers to Make Up',\n                  style: TextStyle(\n                    fontSize: 20.0,\n                    fontWeight: FontWeight.bold,\n                  ),\n                ),\n                const SizedBox(height: 16.0),\n                LinearProgressIndicator(\n                  value: _prayerService.calculateOverallTotalPrayers() > 0\n                      ? _prayerService.overallProgress /\n                          _prayerService.calculateOverallTotalPrayers()\n                      : 0,\n                  minHeight: 24.0,\n                ),\n                const SizedBox(height: 8.0),\n                Text(\n                  '${_prayerService.overallProgress} / ${_prayerService.calculateOverallTotalPrayers()}',\n                  textAlign: TextAlign.center,\n                  style: const TextStyle(fontSize: 18.0),\n                ),\n              ],\n            ),\n          ),\n        ),\n        ..._prayerService.prayers.map((prayer) {\n          int totalPrayers =\n              _prayerService.calculateTotalPrayersForPrayer(prayer);\n          int completedPrayers = _prayerService.prayerCounts[prayer] ?? 0;\n          return PrayerProgressCard(\n            prayer: prayer,\n            completedPrayers: completedPrayers,\n            totalPrayers: totalPrayers,\n            onPressed: () => _decrementPrayer(prayer),\n          );\n        }).toList(),\n        const SizedBox(height: 24.0),\n        Row(\n          mainAxisAlignment: MainAxisAlignment.spaceEvenly,\n          children: [\n            ElevatedButton.icon(\n              onPressed: _sharePrayerData,\n              icon: const Icon(Icons.share),\n              label: const Text('Share Progress'),\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.blue,\n                padding: const EdgeInsets.symmetric(\n                  vertical: 16.0,\n                  horizontal: 24.0,\n                ),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(8.0),\n                ),\n              ),\n            ),\n            ElevatedButton.icon(\n              onPressed: () {\n                Navigator.pushReplacement(\n                  context,\n                  MaterialPageRoute(\n                    builder: (context)",
      "created_at": "2024-03-18T10:26:50.806625Z",
      "sequence_order": 1,
      "metadata": {
        "content": [
          {
            "start_timestamp": "2024-03-18T10:26:50.806625Z",
            "stop_timestamp": "2024-03-18T10:26:50.806625Z",
            "flags": null,
            "type": "text",
            "text": " Here's the updated code with the identified issues fixed:\n\n```dart\n# File: ./main.dart\n####################\n\n// main.dart\nimport 'package:flutter/material.dart';\nimport './screens/year_selection_screen.dart';\n\nvoid main() {\n  runApp(const AmanaAuditApp());\n}\n\nclass AmanaAuditApp extends StatelessWidget {\n  const AmanaAuditApp({super.key});\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      title: 'Amana Audit',\n      theme: ThemeData(\n        primarySwatch: Colors.blue,\n      ),\n      home: const YearSelectionScreen(),\n    );\n  }\n}\n\n\n\n# File: ./screens/year_selection_screen.dart\n#############################################\n\n// screens/year_selection_screen.dart\nimport 'package:flutter/material.dart';\nimport '../services/prayer_service.dart';\nimport 'home_screen.dart';\n\nclass YearSelectionScreen extends StatefulWidget {\n  const YearSelectionScreen({super.key});\n\n  @override\n  _YearSelectionScreenState createState() => _YearSelectionScreenState();\n}\n\nclass _YearSelectionScreenState extends State<YearSelectionScreen> {\n  final PrayerService _prayerService = PrayerService();\n\n  final TextEditingController _startYearController = TextEditingController();\n  final TextEditingController _endYearController = TextEditingController();\n  final TextEditingController _initialAverageGuessController =\n      TextEditingController();\n\n  Future<void> _navigateToSummary() async {\n    int startYear = int.tryParse(_startYearController.text) ?? 0;\n    int endYear = int.tryParse(_endYearController.text) ?? 0;\n    int initialAverageGuess =\n        int.tryParse(_initialAverageGuessController.text) ?? 0;\n\n    if (startYear > 0 && endYear >= startYear) {\n      await _prayerService.generatePrayerInputs(startYear, endYear);\n      _prayerService.applyUniformPercentage(initialAverageGuess);\n      _prayerService.calculateTotalPrayers(0);\n\n      Navigator.pushReplacement(\n        context,\n        MaterialPageRoute(builder: (context) => const AmanaAuditHomePage()),\n      );\n    } else {\n      showDialog(\n        context: context,\n        builder: (context) => AlertDialog(\n          title: const Text('Invalid Input'),\n          content: const Text('Please enter valid start and end years.'),\n          actions: [\n            TextButton(\n              onPressed: () => Navigator.pop(context),\n              child: const Text('OK'),\n            ),\n          ],\n        ),\n      );\n    }\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Select Years'),\n      ),\n      body: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.stretch,\n          children: [\n            TextField(\n              controller: _startYearController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'Start Year',\n                hintText: 'Enter start year',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            TextField(\n              controller: _endYearController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'End Year',\n                hintText: 'Enter end year',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            TextField(\n              controller: _initialAverageGuessController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'Initial Average Guess',\n                hintText: 'Enter initial average guess percentage',\n              ),\n            ),\n            const SizedBox(height: 24.0),\n            ElevatedButton(\n              onPressed: _navigateToSummary,\n              child: const Text('Next'),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n\n\n# File: ./screens/home_screen.dart\n###################################\n\n// screens/home_screen.dart\nimport 'package:flutter/material.dart';\nimport 'package:share_plus/share_plus.dart';\nimport '../services/prayer_service.dart';\nimport '../services/shared_preferences_service.dart';\nimport '../screens/year_selection_screen.dart';\nimport '../widgets/prayer_input_card.dart';\nimport '../widgets/prayer_progress_card.dart';\n\nclass AmanaAuditHomePage extends StatefulWidget {\n  const AmanaAuditHomePage({super.key});\n\n  @override\n  _AmanaAuditHomePageState createState() => _AmanaAuditHomePageState();\n}\n\nclass _AmanaAuditHomePageState extends State<AmanaAuditHomePage> {\n  final PrayerService _prayerService = PrayerService();\n  final SharedPreferencesService _preferencesService =\n      SharedPreferencesService();\n  String _state = 'input';\n\n  final TextEditingController _startYearController = TextEditingController();\n  final TextEditingController _endYearController = TextEditingController();\n  final TextEditingController _uniformPercentageController =\n      TextEditingController();\n  final TextEditingController _taqwaBufferController =\n      TextEditingController(text: '0');\n\n  @override\n  void initState() {\n    super.initState();\n    _loadSavedData();\n  }\n\n  Future<void> _loadSavedData() async {\n    await _prayerService.loadSavedData();\n    if (_prayerService.hasPrayerData()) {\n      setState(() {\n        _state = 'result';\n      });\n    }\n  }\n\n  Future<void> _generatePrayerInputs() async {\n    int startYear = int.tryParse(_startYearController.text) ?? 0;\n    int endYear = int.tryParse(_endYearController.text) ?? 0;\n    if (startYear > 0 && endYear >= startYear) {\n      await _prayerService.generatePrayerInputs(startYear, endYear);\n      setState(() {});\n    } else {\n      showDialog(\n        context: context,\n        builder: (context) => AlertDialog(\n          title: const Text('Invalid Input'),\n          content: const Text('Please enter valid start and end years.'),\n          actions: [\n            TextButton(\n              onPressed: () => Navigator.pop(context),\n              child: const Text('OK'),\n            ),\n          ],\n        ),\n      );\n    }\n  }\n\n  void _applyUniformPercentage() {\n    int percentage = int.tryParse(_uniformPercentageController.text) ?? 0;\n    _prayerService.applyUniformPercentage(percentage);\n    setState(() {});\n  }\n\n  void _calculateTotalPrayers() {\n    int taqwaBuffer = int.tryParse(_taqwaBufferController.text) ?? 0;\n    _prayerService.calculateTotalPrayers(taqwaBuffer);\n    _prayerService.savePrayerData();\n    setState(() {\n      _state = 'result';\n    });\n  }\n\n  void _decrementPrayer(String prayer) {\n    _prayerService.decrementPrayer(prayer);\n    _prayerService.savePrayerData();\n    setState(() {});\n  }\n\n  void _resetApplication() {\n    _prayerService.resetApplication();\n    setState(() {\n      _state = 'input';\n    });\n  }\n\n  void _sharePrayerData() {\n    _prayerService.sharePrayerData();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Amana Audit'),\n      ),\n      body: _buildBody(),\n    );\n  }\n\n  Widget _buildBody() {\n    switch (_state) {\n      case 'input':\n        return SingleChildScrollView(\n          child: Padding(\n            padding: const EdgeInsets.all(16.0),\n            child: _buildInputSection(),\n          ),\n        );\n      case 'result':\n        return SingleChildScrollView(\n          child: Padding(\n            padding: const EdgeInsets.all(16.0),\n            child: _buildResultSection(),\n          ),\n        );\n      default:\n        return Container();\n    }\n  }\n\n  Widget _buildInputSection() {\n    return Column(\n      crossAxisAlignment: CrossAxisAlignment.stretch,\n      children: [\n        TextField(\n          controller: _startYearController,\n          keyboardType: TextInputType.number,\n          decoration: const InputDecoration(\n            labelText: 'Start Year',\n            hintText: 'Enter start year',\n          ),\n        ),\n        const SizedBox(height: 16.0),\n        TextField(\n          controller: _endYearController,\n          keyboardType: TextInputType.number,\n          decoration: const InputDecoration(\n            labelText: 'End Year',\n            hintText: 'Enter end year',\n          ),\n        ),\n        const SizedBox(height: 16.0),\n        Row(\n          children: [\n            Expanded(\n              child: TextField(\n                controller: _uniformPercentageController,\n                keyboardType: TextInputType.number,\n                decoration: const InputDecoration(\n                  labelText: 'Average Percentage of Missed Prayers',\n                  hintText: 'Enter average percentage',\n                ),\n              ),\n            ),\n            IconButton(\n              icon: const Icon(Icons.info),\n              onPressed: () {\n                showDialog(\n                  context: context,\n                  builder: (context) => AlertDialog(\n                    title: const Text('Average Percentage of Missed Prayers'),\n                    content: const Text(\n                        'Enter the average percentage of prayers you estimate you missed in those years.'),\n                    actions: [\n                      TextButton(\n                        onPressed: () => Navigator.pop(context),\n                        child: const Text('OK'),\n                      ),\n                    ],\n                  ),\n                );\n              },\n            ),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        ElevatedButton(\n          onPressed: () async {\n            await _generatePrayerInputs();\n            _applyUniformPercentage();\n          },\n          child: const Text('Generate Prayer Inputs'),\n        ),\n        const SizedBox(height: 16.0),\n        ExpansionTile(\n          title: Row(\n            children: [\n              const Text('Add Details'),\n              IconButton(\n                icon: const Icon(Icons.info),\n                onPressed: () {\n                  showDialog(\n                    context: context,\n                    builder: (context) => AlertDialog(\n                      title: const Text('Detailed Prayer Calendar'),\n                      content: const Text(\n                          'Expand this section to review and modify the detailed prayer calendar. You can set specific percentages for each year and prayer.'),\n                      actions: [\n                        TextButton(\n                          onPressed: () => Navigator.pop(context),\n                          child: const Text('OK'),\n                        ),\n                      ],\n                    ),\n                  );\n                },\n              ),\n            ],\n          ),\n          children: [\n            _buildPrayerInputs(),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        Row(\n          children: [\n            Expanded(\n              child: TextField(\n                controller: _taqwaBufferController,\n                keyboardType: TextInputType.number,\n                decoration: const InputDecoration(\n                  labelText: 'Taqwa Buffer',\n                  hintText: 'Enter taqwa buffer percentage',\n                ),\n              ),\n            ),\n            IconButton(\n              icon: const Icon(Icons.info),\n              onPressed: () {\n                showDialog(\n                  context: context,\n                  builder: (context) => AlertDialog(\n                    title: const Text('Taqwa Buffer'),\n                    content: const Text(\n                        'Enter a percentage to add as a buffer to the calculated prayer debt. This buffer is added to account for any uncertainties or missed prayers.'),\n                    actions: [\n                      TextButton(\n                        onPressed: () => Navigator.pop(context),\n                        child: const Text('OK'),\n                      ),\n                    ],\n                  ),\n                );\n              },\n            ),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        ElevatedButton(\n          onPressed: _calculateTotalPrayers,\n          child: const Text('Calculate Prayer Debt'),\n        ),\n      ],\n    );\n  }\n\n  Widget _buildPrayerInputs() {\n    return Column(\n      crossAxisAlignment: CrossAxisAlignment.stretch,\n      children: _prayerService.prayerPercentages.entries.map((entry) {\n        int year = entry.key;\n        Map<String, int> prayers = entry.value;\n        return PrayerInputCard(\n          year: year,\n          prayers: prayers,\n          onChanged: (year, prayer, percentage) {\n            setState(() {\n              _prayerService.updatePrayerPercentage(year, prayer, percentage);\n            });\n          },\n        );\n      }).toList(),\n    );\n  }\n\n  Widget _buildResultSection() {\n    return Column(\n      crossAxisAlignment: CrossAxisAlignment.stretch,\n      children: [\n        Card(\n          elevation: 4.0,\n          margin: const EdgeInsets.symmetric(vertical: 16.0),\n          child: Padding(\n            padding: const EdgeInsets.all(16.0),\n            child: Column(\n              crossAxisAlignment: CrossAxisAlignment.start,\n              children: [\n                const Text(\n                  'Total Prayers to Make Up',\n                  style: TextStyle(\n                    fontSize: 20.0,\n                    fontWeight: FontWeight.bold,\n                  ),\n                ),\n                const SizedBox(height: 16.0),\n                LinearProgressIndicator(\n                  value: _prayerService.calculateOverallTotalPrayers() > 0\n                      ? _prayerService.overallProgress /\n                          _prayerService.calculateOverallTotalPrayers()\n                      : 0,\n                  minHeight: 24.0,\n                ),\n                const SizedBox(height: 8.0),\n                Text(\n                  '${_prayerService.overallProgress} / ${_prayerService.calculateOverallTotalPrayers()}',\n                  textAlign: TextAlign.center,\n                  style: const TextStyle(fontSize: 18.0),\n                ),\n              ],\n            ),\n          ),\n        ),\n        ..._prayerService.prayers.map((prayer) {\n          int totalPrayers =\n              _prayerService.calculateTotalPrayersForPrayer(prayer);\n          int completedPrayers = _prayerService.prayerCounts[prayer] ?? 0;\n          return PrayerProgressCard(\n            prayer: prayer,\n            completedPrayers: completedPrayers,\n            totalPrayers: totalPrayers,\n            onPressed: () => _decrementPrayer(prayer),\n          );\n        }).toList(),\n        const SizedBox(height: 24.0),\n        Row(\n          mainAxisAlignment: MainAxisAlignment.spaceEvenly,\n          children: [\n            ElevatedButton.icon(\n              onPressed: _sharePrayerData,\n              icon: const Icon(Icons.share),\n              label: const Text('Share Progress'),\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.blue,\n                padding: const EdgeInsets.symmetric(\n                  vertical: 16.0,\n                  horizontal: 24.0,\n                ),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(8.0),\n                ),\n              ),\n            ),\n            ElevatedButton.icon(\n              onPressed: () {\n                Navigator.pushReplacement(\n                  context,\n                  MaterialPageRoute(\n                    builder: (context)",
            "citations": []
          }
        ],
        "updated_at": "2024-03-18T10:26:50.806625Z",
        "attachments": [],
        "files": []
      }
    },
    {
      "id": "24881291-4c17-493c-a2a7-49adbcaa2853",
      "role": "human",
      "content": "review the code and navigation, the add details doesn't work when you first load and go from setting your initial guess for the years. it shows 408 / 0 for th\n\ne prayers so it's inverted. The percentage is the percentage you think you prayed. So the total should be the years 365 times the number of years on the bottom\n\nand the top should be the percentage ratio of that the 0 should be some multiple of 365. the buttons are also a little hard to see, can we make them smaller or\n\ntwo rows or hide the start over button behind a ... more icon. make a plan and start updating the code",
      "created_at": "2024-03-18T10:36:14.498722Z",
      "sequence_order": 2,
      "metadata": {
        "content": [
          {
            "start_timestamp": "2024-03-18T10:36:14.498722Z",
            "stop_timestamp": "2024-03-18T10:36:14.498722Z",
            "flags": null,
            "type": "text",
            "text": "review the code and navigation, the add details doesn't work when you first load and go from setting your initial guess for the years. it shows 408 / 0 for th\n\ne prayers so it's inverted. The percentage is the percentage you think you prayed. So the total should be the years 365 times the number of years on the bottom\n\nand the top should be the percentage ratio of that the 0 should be some multiple of 365. the buttons are also a little hard to see, can we make them smaller or\n\ntwo rows or hide the start over button behind a ... more icon. make a plan and start updating the code",
            "citations": []
          }
        ],
        "updated_at": "2024-03-18T10:36:14.498722Z",
        "attachments": [
          {
            "file_name": "paste.txt",
            "file_size": 28619,
            "file_type": "txt",
            "extracted_content": "\n\n# File: ./main.dart\n####################\n\n// main.dart\nimport 'package:flutter/material.dart';\nimport './screens/year_selection_screen.dart';\n\nvoid main() {\n  runApp(const AmanaAuditApp());\n}\n\nclass AmanaAuditApp extends StatelessWidget {\n  const AmanaAuditApp({super.key});\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      title: 'Amana Audit',\n      theme: ThemeData(\n        primarySwatch: Colors.blue,\n      ),\n      initialRoute: '/',\n      routes: {\n        '/': (context) => const YearSelectionScreen(),\n      },\n    );\n  }\n}\n\n\n\n# File: ./screens/year_selection_screen.dart\n#############################################\n\n// screens/year_selection_screen.dart\nimport 'package:flutter/material.dart';\nimport '../services/prayer_service.dart';\nimport 'home_screen.dart';\n\nclass YearSelectionScreen extends StatefulWidget {\n  const YearSelectionScreen({super.key});\n\n  @override\n  _YearSelectionScreenState createState() => _YearSelectionScreenState();\n}\n\nclass _YearSelectionScreenState extends State<YearSelectionScreen> {\n  final PrayerService _prayerService = PrayerService();\n\n  final TextEditingController _startYearController = TextEditingController();\n  final TextEditingController _endYearController = TextEditingController();\n  final TextEditingController _initialAverageGuessController =\n      TextEditingController();\n\n  Future<void> _navigateToSummary() async {\n    int startYear = int.tryParse(_startYearController.text) ?? 0;\n    int endYear = int.tryParse(_endYearController.text) ?? 0;\n    int initialAverageGuess =\n        int.tryParse(_initialAverageGuessController.text) ?? 0;\n\n    if (startYear > 0 && endYear >= startYear) {\n      await _prayerService.generatePrayerInputs(startYear, endYear);\n      _prayerService.applyUniformPercentage(initialAverageGuess);\n      _prayerService.calculateTotalPrayers(0);\n\n      Navigator.push(\n        context,\n        MaterialPageRoute(builder: (context) => const AmanaAuditHomePage()),\n      );\n    } else {\n      showDialog(\n        context: context,\n        builder: (context) => AlertDialog(\n          title: const Text('Invalid Input'),\n          content: const Text('Please enter valid start and end years.'),\n          actions: [\n            TextButton(\n              onPressed: () => Navigator.pop(context),\n              child: const Text('OK'),\n            ),\n          ],\n        ),\n      );\n    }\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Select Years'),\n      ),\n      body: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.stretch,\n          children: [\n            TextField(\n              controller: _startYearController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'Start Year',\n                hintText: 'Enter start year',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            TextField(\n              controller: _endYearController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'End Year',\n                hintText: 'Enter end year',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            TextField(\n              controller: _initialAverageGuessController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'Initial Average Guess',\n                hintText: 'Enter initial average guess percentage',\n              ),\n            ),\n            const SizedBox(height: 24.0),\n            ElevatedButton(\n              onPressed: _navigateToSummary,\n              child: const Text('Next'),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n\n\n# File: ./screens/home_screen.dart\n###################################\n\nimport 'package:flutter/material.dart';\nimport 'package:share_plus/share_plus.dart';\nimport '../services/prayer_service.dart';\nimport '../services/shared_preferences_service.dart';\nimport '../screens/year_selection_screen.dart';\nimport '../widgets/prayer_input_card.dart';\nimport '../widgets/prayer_progress_card.dart';\n\nclass AmanaAuditHomePage extends StatefulWidget {\n  const AmanaAuditHomePage({super.key});\n\n  @override\n  _AmanaAuditHomePageState createState() => _AmanaAuditHomePageState();\n}\n\nclass _AmanaAuditHomePageState extends State<AmanaAuditHomePage> {\n  final PrayerService _prayerService = PrayerService();\n  final SharedPreferencesService _preferencesService =\n      SharedPreferencesService();\n  String _state = 'input';\n\n  final TextEditingController _startYearController = TextEditingController();\n  final TextEditingController _endYearController = TextEditingController();\n  final TextEditingController _uniformPercentageController =\n      TextEditingController();\n  final TextEditingController _taqwaBufferController =\n      TextEditingController(text: '0');\n\n  @override\n  void initState() {\n    super.initState();\n    _loadSavedData();\n  }\n\n  Future<void> _loadSavedData() async {\n    await _prayerService.loadSavedData();\n    if (_prayerService.hasPrayerData()) {\n      setState(() {\n        _state = 'result';\n      });\n    }\n  }\n\n  Future<void> _generatePrayerInputs() async {\n    int startYear = int.tryParse(_startYearController.text) ?? 0;\n    int endYear = int.tryParse(_endYearController.text) ?? 0;\n    if (startYear > 0 && endYear >= startYear) {\n      await _prayerService.generatePrayerInputs(startYear, endYear);\n      setState(() {});\n    } else {\n      showDialog(\n        context: context,\n        builder: (context) => AlertDialog(\n          title: const Text('Invalid Input'),\n          content: const Text('Please enter valid start and end years.'),\n          actions: [\n            TextButton(\n              onPressed: () => Navigator.pop(context),\n              child: const Text('OK'),\n            ),\n          ],\n        ),\n      );\n    }\n  }\n\n  void _applyUniformPercentage() {\n    int percentage = int.tryParse(_uniformPercentageController.text) ?? 0;\n    _prayerService.applyUniformPercentage(percentage);\n    setState(() {});\n  }\n\n  void _calculateTotalPrayers() {\n    int taqwaBuffer = int.tryParse(_taqwaBufferController.text) ?? 0;\n    _prayerService.calculateTotalPrayers(taqwaBuffer);\n    _prayerService.savePrayerData();\n    setState(() {\n      _state = 'result';\n    });\n  }\n\n  void _decrementPrayer(String prayer) {\n    _prayerService.decrementPrayer(prayer);\n    _prayerService.savePrayerData();\n    setState(() {});\n  }\n\n  void _resetApplication() {\n    _prayerService.resetApplication();\n    setState(() {\n      _state = 'input';\n    });\n  }\n\n  void _sharePrayerData() {\n    _prayerService.sharePrayerData();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Amana Audit'),\n      ),\n      body: _buildBody(),\n    );\n  }\n\n  Widget _buildBody() {\n    switch (_state) {\n      case 'input':\n        return SingleChildScrollView(\n          child: Padding(\n            padding: const EdgeInsets.all(16.0),\n            child: _buildInputSection(),\n          ),\n        );\n      case 'result':\n        return SingleChildScrollView(\n          child: Padding(\n            padding: const EdgeInsets.all(16.0),\n            child: _buildResultSection(),\n          ),\n        );\n      default:\n        return Container();\n    }\n  }\n\n  Widget _buildInputSection() {\n    return Column(\n      crossAxisAlignment: CrossAxisAlignment.stretch,\n      children: [\n        TextField(\n          controller: _startYearController,\n          keyboardType: TextInputType.number,\n          decoration: const InputDecoration(\n            labelText: 'Start Year',\n            hintText: 'Enter start year',\n          ),\n        ),\n        const SizedBox(height: 16.0),\n        TextField(\n          controller: _endYearController,\n          keyboardType: TextInputType.number,\n          decoration: const InputDecoration(\n            labelText: 'End Year',\n            hintText: 'Enter end year',\n          ),\n        ),\n        const SizedBox(height: 16.0),\n        Row(\n          children: [\n            Expanded(\n              child: TextField(\n                controller: _uniformPercentageController,\n                keyboardType: TextInputType.number,\n                decoration: const InputDecoration(\n                  labelText: 'Average Percentage of Missed Prayers',\n                  hintText: 'Enter average percentage',\n                ),\n              ),\n            ),\n            IconButton(\n              icon: const Icon(Icons.info),\n              onPressed: () {\n                showDialog(\n                  context: context,\n                  builder: (context) => AlertDialog(\n                    title: const Text('Average Percentage of Missed Prayers'),\n                    content: const Text(\n                        'Enter the average percentage of prayers you estimate you missed in those years.'),\n                    actions: [\n                      TextButton(\n                        onPressed: () => Navigator.pop(context),\n                        child: const Text('OK'),\n                      ),\n                    ],\n                  ),\n                );\n              },\n            ),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        ElevatedButton(\n          onPressed: () async {\n            await _generatePrayerInputs();\n            _applyUniformPercentage();\n          },\n          child: const Text('Generate Prayer Inputs'),\n        ),\n        const SizedBox(height: 16.0),\n        ExpansionTile(\n          title: Row(\n            children: [\n              const Text('Add Details'),\n              IconButton(\n                icon: const Icon(Icons.info),\n                onPressed: () {\n                  showDialog(\n                    context: context,\n                    builder: (context) => AlertDialog(\n                      title: const Text('Detailed Prayer Calendar'),\n                      content: const Text(\n                          'Expand this section to review and modify the detailed prayer calendar. You can set specific percentages for each year and prayer.'),\n                      actions: [\n                        TextButton(\n                          onPressed: () => Navigator.pop(context),\n                          child: const Text('OK'),\n                        ),\n                      ],\n                    ),\n                  );\n                },\n              ),\n            ],\n          ),\n          children: [\n            _buildPrayerInputs(),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        Row(\n          children: [\n            Expanded(\n              child: TextField(\n                controller: _taqwaBufferController,\n                keyboardType: TextInputType.number,\n                decoration: const InputDecoration(\n                  labelText: 'Taqwa Buffer',\n                  hintText: 'Enter taqwa buffer percentage',\n                ),\n              ),\n            ),\n            IconButton(\n              icon: const Icon(Icons.info),\n              onPressed: () {\n                showDialog(\n                  context: context,\n                  builder: (context) => AlertDialog(\n                    title: const Text('Taqwa Buffer'),\n                    content: const Text(\n                        'Enter a percentage to add as a buffer to the calculated prayer debt. This buffer is added to account for any uncertainties or missed prayers.'),\n                    actions: [\n                      TextButton(\n                        onPressed: () => Navigator.pop(context),\n                        child: const Text('OK'),\n                      ),\n                    ],\n                  ),\n                );\n              },\n            ),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        ElevatedButton(\n          onPressed: _calculateTotalPrayers,\n          child: const Text('Calculate Prayer Debt'),\n        ),\n      ],\n    );\n  }\n\n  Widget _buildPrayerInputs() {\n    return Column(\n      crossAxisAlignment: CrossAxisAlignment.stretch,\n      children: _prayerService.prayerPercentages.entries.map((entry) {\n        int year = entry.key;\n        Map<String, int> prayers = entry.value;\n        return PrayerInputCard(\n          year: year,\n          prayers: prayers,\n          onChanged: (year, prayer, percentage) {\n            setState(() {\n              _prayerService.updatePrayerPercentage(year, prayer, percentage);\n            });\n          },\n        );\n      }).toList(),\n    );\n  }\n\n  Widget _buildResultSection() {\n    return Column(\n      crossAxisAlignment: CrossAxisAlignment.stretch,\n      children: [\n        Card(\n          elevation: 4.0,\n          margin: const EdgeInsets.symmetric(vertical: 16.0),\n          child: Padding(\n            padding: const EdgeInsets.all(16.0),\n            child: Column(\n              crossAxisAlignment: CrossAxisAlignment.start,\n              children: [\n                const Text(\n                  'Total Prayers to Make Up',\n                  style: TextStyle(\n                    fontSize: 20.0,\n                    fontWeight: FontWeight.bold,\n                  ),\n                ),\n                const SizedBox(height: 16.0),\n                LinearProgressIndicator(\n                  value: _prayerService.calculateOverallTotalPrayers() > 0\n                      ? _prayerService.overallProgress /\n                          _prayerService.calculateOverallTotalPrayers()\n                      : 0,\n                  minHeight: 24.0,\n                ),\n                const SizedBox(height: 8.0),\n                Text(\n                  '${_prayerService.overallProgress} / ${_prayerService.calculateOverallTotalPrayers()}',\n                  textAlign: TextAlign.center,\n                  style: const TextStyle(fontSize: 18.0),\n                ),\n              ],\n            ),\n          ),\n        ),\n        ..._prayerService.prayers.map((prayer) {\n          int totalPrayers =\n              _prayerService.calculateTotalPrayersForPrayer(prayer);\n          int completedPrayers = _prayerService.prayerCounts[prayer] ?? 0;\n          return PrayerProgressCard(\n            prayer: prayer,\n            completedPrayers: completedPrayers,\n            totalPrayers: totalPrayers,\n            onPressed: () => _decrementPrayer(prayer),\n          );\n        }).toList(),\n        const SizedBox(height: 24.0),\n        Row(\n          mainAxisAlignment: MainAxisAlignment.spaceEvenly,\n          children: [\n            ElevatedButton.icon(\n              onPressed: _sharePrayerData,\n              icon: const Icon(Icons.share),\n              label: const Text('Share Progress'),\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.blue,\n                padding: const EdgeInsets.symmetric(\n                  vertical: 16.0,\n                  horizontal: 24.0,\n                ),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(8.0),\n                ),\n              ),\n            ),\n            ElevatedButton.icon(\n              onPressed: () {\n                Navigator.pushReplacement(\n                  context,\n                  MaterialPageRoute(\n                    builder: (context) => const YearSelectionScreen(),\n                  ),\n                );\n              },\n              icon: const Icon(Icons.edit),\n              label: const Text('Edit'),\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.orange,\n                padding: const EdgeInsets.symmetric(\n                  vertical: 16.0,\n                  horizontal: 24.0,\n                ),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(8.0),\n                ),\n              ),\n            ),\n            ElevatedButton.icon(\n              onPressed: _resetApplication,\n              icon: const Icon(Icons.refresh),\n              label: const Text('Start Over'),\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.red,\n                padding: const EdgeInsets.symmetric(\n                  vertical: 16.0,\n                  horizontal: 24.0,\n                ),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(8.0),\n                ),\n              ),\n            ),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        ExpansionTile(\n          title: Row(\n            children: [\n              const Text('Add Details'),\n              IconButton(\n                icon: const Icon(Icons.info),\n                onPressed: () {\n                  showDialog(\n                    context: context,\n                    builder: (context) => AlertDialog(\n                      title: const Text('Detailed Prayer Calendar'),\n                      content: const Text(\n                          'Expand this section to review and modify the detailed prayer calendar. You can set specific percentages for each year and prayer.'),\n                      actions: [\n                        TextButton(\n                          onPressed: () => Navigator.pop(context),\n                          child: const Text('OK'),\n                        ),\n                      ],\n                    ),\n                  );\n                },\n              ),\n            ],\n          ),\n          children: [\n            _buildPrayerInputs(),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        TextButton.icon(\n          onPressed: () {\n            showDialog(\n              context: context,\n              builder: (context) => AlertDialog(\n                title: const Text('Explanation'),\n                content: const Text(\n                  'This app helps you track and make up your missed prayers. Enter the years and the average percentage of prayers you estimate you missed in those years. You can also set specific percentages for each prayer and year in the detailed prayer calendar. The Taqwa Buffer is an additional percentage adde to account for any missed prayers. Once you calculate your prayer debt, you can track your progress and mark prayers as completed. The progress bars show your overall progress and the progress for each prayer.',\n                ),\n                actions: [\n                  TextButton(\n                    onPressed: () => Navigator.pop(context),\n                    child: const Text('OK'),\n                  ),\n                ],\n              ),\n            );\n          },\n          icon: const Icon(Icons.info),\n          label: const Text('Explanation'),\n        ),\n      ],\n    );\n  }\n}\n\n\n\n# File: ./services/shared_preferences_service.dart\n###################################################\n\n// services/shared_preferences_services.dart\nimport 'package:shared_preferences/shared_preferences.dart';\n\nclass SharedPreferencesService {\n  Future<void> saveData(String key, dynamic value) async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    if (value is int) {\n      await prefs.setInt(key, value);\n    } else if (value is String) {\n      await prefs.setString(key, value);\n    } else if (value is bool) {\n      await prefs.setBool(key, value);\n    } else if (value is double) {\n      await prefs.setDouble(key, value);\n    } else if (value is List<String>) {\n      await prefs.setStringList(key, value);\n    } else {\n      throw ArgumentError('Invalid value type');\n    }\n  }\n\n  Future<dynamic> getData(String key) async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    return prefs.get(\n        key); // Simply return the value, which will be null if the key is not found\n  }\n\n  Future<void> clearData() async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    await prefs.clear();\n  }\n}\n\n\n\n# File: ./services/prayer_service.dart\n#######################################\n\n// services/prayer_service.dart\nimport 'dart:convert';\nimport 'package:flutter/material.dart';\nimport 'shared_preferences_service.dart';\nimport 'package:share_plus/share_plus.dart';\n\nclass PrayerService {\n  final SharedPreferencesService _preferencesService =\n      SharedPreferencesService();\n  final List<String> prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];\n  Map<String, int> prayerCounts = {};\n  Map<int, Map<String, int>> prayerPercentages = {};\n  int overallProgress = 0;\n\n  Future<void> loadSavedData() async {\n    Map<String, int> savedData = {};\n    for (var prayer in prayers) {\n      savedData[prayer] = await _preferencesService.getData(prayer) ?? 0;\n    }\n    prayerCounts = savedData;\n  }\n\n  bool hasPrayerData() {\n    return prayerCounts.values.any((count) => count > 0);\n  }\n\n  Future<void> generatePrayerInputs(int startYear, int endYear,\n      {int defaultPercentage = 95}) async {\n    prayerPercentages.clear();\n    for (int year = startYear; year <= endYear; year++) {\n      String? yearData = await _preferencesService.getData('$year');\n      if (yearData != null) {\n        // If data exists, decode and use it\n        prayerPercentages[year] = Map<String, int>.from(jsonDecode(yearData));\n      } else {\n        // Initialize with default percentage if no data exists\n        prayerPercentages[year] = {\n          for (var prayer in prayers) prayer: defaultPercentage\n        };\n      }\n    }\n  }\n\n  void applyUniformPercentage(int percentage) {\n    prayerPercentages.forEach((year, prayers) {\n      prayers.updateAll((prayer, value) => percentage);\n    });\n  }\n\n  void calculateTotalPrayers(int taqwaBuffer) {\n    prayerCounts.clear();\n    for (int year in prayerPercentages.keys) {\n      for (String prayer in prayers) {\n        int percentage = prayerPercentages[year]?[prayer] ?? 0;\n        int count = (365 * (100 - percentage) ~/ 100);\n        prayerCounts[prayer] = (prayerCounts[prayer] ?? 0) + count;\n      }\n      _preferencesService.saveData(\n          '$year', jsonEncode(prayerPercentages[year]!));\n    }\n\n    prayerCounts = prayerCounts.map((prayer, count) =>\n        MapEntry(prayer, (count * (100 + taqwaBuffer) ~/ 100)));\n    overallProgress = prayerCounts.values.fold(0, (sum, count) => sum + count);\n    savePrayerData();\n  }\n\n  void decrementPrayer(String prayer) {\n    if (prayerCounts.containsKey(prayer) && prayerCounts[prayer]! > 0) {\n      prayerCounts[prayer] = prayerCounts[prayer]! - 1;\n      overallProgress =\n          prayerCounts.values.fold(0, (sum, count) => sum + count);\n      savePrayerData();\n    }\n  }\n\n  void resetApplication() {\n    prayerCounts.clear();\n    prayerPercentages.clear();\n    overallProgress = 0;\n    _preferencesService.clearData();\n  }\n\n  void savePrayerData() {\n    for (var entry in prayerCounts.entries) {\n      _preferencesService.saveData(entry.key, entry.value);\n    }\n  }\n\n  void sharePrayerData() {\n    String shareText = 'My Prayer Progress:\\n\\n';\n    for (var entry in prayerCounts.entries) {\n      int totalPrayers = calculateTotalPrayersForPrayer(entry.key);\n      shareText += '${entry.key}: ${entry.value} / $totalPrayers\\n';\n    }\n    Share.share(shareText);\n  }\n\n  int calculateTotalPrayersForPrayer(String prayer) {\n    int totalPrayers = prayerPercentages.values.fold<int>(\n        0,\n        (sum, yearData) =>\n            sum + (365 * (100 - (yearData[prayer] ?? 0)) ~/ 100));\n    return totalPrayers;\n  }\n\n  int calculateOverallTotalPrayers() {\n    return prayers.fold<int>(\n        0, (sum, prayer) => sum + calculateTotalPrayersForPrayer(prayer));\n  }\n\n  void updatePrayerPercentage(int year, String prayer, int percentage) {\n    prayerPercentages[year]?[prayer] = percentage;\n  }\n}\n\n\n\n# File: ./widgets/prayer_input_card.dart\n#########################################\n\n// widgets/prayer_input_card.dart\nimport 'package:flutter/material.dart';\n\nclass PrayerInputCard extends StatelessWidget {\n  final int year;\n  final Map<String, int> prayers;\n  final Function(int, String, int) onChanged;\n\n  const PrayerInputCard({\n    Key? key,\n    required this.year,\n    required this.prayers,\n    required this.onChanged,\n  }) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return Card(\n      margin: const EdgeInsets.symmetric(vertical: 8.0),\n      child: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.start,\n          children: [\n            Text(\n              'Year: $year',\n              style: const TextStyle(\n                fontSize: 18.0,\n                fontWeight: FontWeight.bold,\n              ),\n            ),\n            const SizedBox(height: 8.0),\n            ...prayers.entries.map((entry) {\n              String prayer = entry.key;\n              int percentage = entry.value;\n              int completedPrayers = (365 * (100 - percentage) ~/ 100);\n              int totalPrayers = 365;\n              return Column(\n                children: [\n                  Row(\n                    children: [\n                      Expanded(\n                        child: Text('$prayer:'),\n                      ),\n                      const SizedBox(width: 8.0),\n                      Expanded(\n                        child: TextField(\n                          keyboardType: TextInputType.number,\n                          controller:\n                              TextEditingController(text: '$percentage'),\n                          onChanged: (value) {\n                            onChanged(year, prayer, int.tryParse(value) ?? 0);\n                          },\n                          decoration: const InputDecoration(\n                            hintText: 'Percentage',\n                          ),\n                        ),\n                      ),\n                    ],\n                  ),\n                  const SizedBox(height: 8.0),\n                  Text('$completedPrayers / $totalPrayers'),\n                ],\n              );\n            }).toList(),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n\n\n# File: ./widgets/prayer_progress_card.dart\n############################################\n\n// widgets/prayer_progress_card.dart\nimport 'package:flutter/material.dart';\n\nclass PrayerProgressCard extends StatelessWidget {\n  final String prayer;\n  final int completedPrayers;\n  final int totalPrayers;\n  final VoidCallback onPressed;\n\n  const PrayerProgressCard({\n    Key? key,\n    required this.prayer,\n    required this.completedPrayers,\n    required this.totalPrayers,\n    required this.onPressed,\n  }) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return Card(\n      elevation: 2.0,\n      margin: const EdgeInsets.symmetric(vertical: 8.0),\n      child: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.start,\n          children: [\n            Row(\n              mainAxisAlignment: MainAxisAlignment.spaceBetween,\n              children: [\n                Text(\n                  prayer,\n                  style: const TextStyle(\n                    fontSize: 20.0,\n                    fontWeight: FontWeight.bold,\n                  ),\n                ),\n                Text(\n                  '$completedPrayers / $totalPrayers',\n                  style: const TextStyle(fontSize: 18.0),\n                ),\n              ],\n            ),\n            const SizedBox(height: 16.0),\n            LinearProgressIndicator(\n              value: totalPrayers > 0 ? completedPrayers / totalPrayers : 0,\n              minHeight: 20.0,\n              color: Colors.green,\n              backgroundColor: Colors.green[100],\n            ),\n            const SizedBox(height: 16.0),\n            ElevatedButton(\n              onPressed: completedPrayers < totalPrayers ? onPressed : null,\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.green,\n                padding: const EdgeInsets.symmetric(\n                  vertical: 16.0,\n                  horizontal: 24.0,\n                ),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(8.0),\n                ),\n              ),\n              child: Text(\n                'Prayed $prayer',\n                style: const TextStyle(fontSize: 18.0),\n              ),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n"
          }
        ],
        "files": [
          {
            "file_name": "paste.txt"
          }
        ]
      }
    },
    {
      "id": "db4ddfb7-11fa-428c-8de4-55bf9e412cb3",
      "role": "assistant",
      "content": " Alright, let's review the code and address the issues you mentioned. Here's a plan to update the code:\n\n1. Fix the \"Add Details\" issue when first loading and navigating from the initial guess screen:\n   - Check the calculation logic in the `calculateTotalPrayers` method of the `PrayerService` class.\n   - Ensure that the total prayers are calculated correctly based on the number of years and the percentage of prayers prayed.\n\n2. Update the progress display to show the correct values:\n   - Modify the `PrayerProgressCard` widget to display the completed prayers on top and the total prayers on the bottom.\n   - Update the calculation logic in the `calculateTotalPrayersForPrayer` method of the `PrayerService` class to correctly calculate the total prayers based on the number of years and the percentage of prayers prayed.\n\n3. Improve the button layout and visibility:\n   - Reduce the size of the buttons or arrange them in two rows to make them more visible and accessible.\n   - Consider hiding the \"Start Over\" button behind a \"more\" icon or menu to declutter the interface.\n\nNow, let's start updating the code:\n\n1. In the `prayer_service.dart` file, update the `calculateTotalPrayers` method:\n\n```dart\nvoid calculateTotalPrayers(int taqwaBuffer) {\n  prayerCounts.clear();\n  for (int year in prayerPercentages.keys) {\n    for (String prayer in prayers) {\n      int percentage = prayerPercentages[year]?[prayer] ?? 0;\n      int count = (365 * percentage ~/ 100);\n      prayerCounts[prayer] = (prayerCounts[prayer] ?? 0) + count;\n    }\n    _preferencesService.saveData('$year', jsonEncode(prayerPercentages[year]!));\n  }\n\n  prayerCounts = prayerCounts.map((prayer, count) => MapEntry(prayer, (count * (100 + taqwaBuffer) ~/ 100)));\n  overallProgress = prayerCounts.values.fold(0, (sum, count) => sum);\n  savePrayerData();\n}\n```\n\n2. In the `prayer_service.dart` file, update the `calculateTotalPrayersForPrayer` method:\n\n```dart\nint calculateTotalPrayersForPrayer(String prayer) {\n  int totalYears = prayerPercentages.length;\n  int totalPrayers = totalYears * 365;\n  return totalPrayers;\n}\n```\n\n3. In the `prayer_progress_card.dart` file, update the `PrayerProgressCard` widget:\n\n```dart\nText(\n  '$completedPrayers',\n  style: const TextStyle(fontSize: 18.0),\n),\nconst SizedBox(height: 8.0),\nText(\n  '/ $totalPrayers',\n  style: const TextStyle(fontSize: 18.0),\n),\n```\n\n4. In the `home_screen.dart` file, update the `_buildResultSection` method to arrange the buttons in two rows and hide the \"Start Over\" button behind a \"more\" icon:\n\n```dart\nRow(\n  mainAxisAlignment: MainAxisAlignment.spaceEvenly,\n  children: [\n    ElevatedButton.icon(\n      onPressed: _sharePrayerData,\n      icon: const Icon(Icons.share),\n      label: const Text('Share'),\n      style: ElevatedButton.styleFrom(\n        backgroundColor: Colors.blue,\n        padding: const EdgeInsets.symmetric(\n          vertical: 12.0,\n          horizontal: 16.0,\n        ),\n        shape: RoundedRectangleBorder(\n          borderRadius: BorderRadius.circular(8.0),\n        ),\n      ),\n    ),\n    ElevatedButton.icon(\n      onPressed: () {\n        Navigator.pushReplacement(\n          context,\n          MaterialPageRoute(\n            builder: (context) => const YearSelectionScreen(),\n          ),\n        );\n      },\n      icon: const Icon(Icons.edit),\n      label: const Text('Edit'),\n      style: ElevatedButton.styleFrom(\n        backgroundColor: Colors.orange,\n        padding: const EdgeInsets.symmetric(\n          vertical: 12.0,\n          horizontal: 16.0,\n        ),\n        shape: RoundedRectangleBorder(\n          borderRadius: BorderRadius.circular(8.0),\n        ),\n      ),\n    ),\n  ],\n),\nconst SizedBox(height: 16.0),\nRow(\n  mainAxisAlignment: MainAxisAlignment.end,\n  children: [\n    IconButton(\n      onPressed: () {\n        showModalBottomSheet(\n          context: context,\n          builder: (context) => Container(\n            padding: const EdgeInsets.all(16.0),\n            child: Column(\n              mainAxisSize: MainAxisSize.min,\n              children: [\n                ListTile(\n                  leading: const Icon(Icons.refresh),\n                  title: const Text('Start Over'),\n                  onTap: () {\n                    Navigator.pop(context);\n                    _resetApplication();\n                  },\n                ),\n              ],\n            ),\n          ),\n        );\n      },\n      icon: const Icon(Icons.more_vert),\n    ),\n  ],\n),\n```\n\nThese changes should address the issues you mentioned. The \"Add Details\" section should now display the correct values when first loading and navigating from the initial guess screen. The progress display will show the completed prayers on top and the total prayers on the bottom. The buttons are arranged in two rows to improve visibility, and the \"Start Over\" button is hidden behind a \"more\" icon.\n\nPlease let me know if you have any further questions or if there's anything else I can assist you with!",
      "created_at": "2024-03-18T10:36:14.498722Z",
      "sequence_order": 3,
      "metadata": {
        "content": [
          {
            "start_timestamp": "2024-03-18T10:36:14.498722Z",
            "stop_timestamp": "2024-03-18T10:36:14.498722Z",
            "flags": null,
            "type": "text",
            "text": " Alright, let's review the code and address the issues you mentioned. Here's a plan to update the code:\n\n1. Fix the \"Add Details\" issue when first loading and navigating from the initial guess screen:\n   - Check the calculation logic in the `calculateTotalPrayers` method of the `PrayerService` class.\n   - Ensure that the total prayers are calculated correctly based on the number of years and the percentage of prayers prayed.\n\n2. Update the progress display to show the correct values:\n   - Modify the `PrayerProgressCard` widget to display the completed prayers on top and the total prayers on the bottom.\n   - Update the calculation logic in the `calculateTotalPrayersForPrayer` method of the `PrayerService` class to correctly calculate the total prayers based on the number of years and the percentage of prayers prayed.\n\n3. Improve the button layout and visibility:\n   - Reduce the size of the buttons or arrange them in two rows to make them more visible and accessible.\n   - Consider hiding the \"Start Over\" button behind a \"more\" icon or menu to declutter the interface.\n\nNow, let's start updating the code:\n\n1. In the `prayer_service.dart` file, update the `calculateTotalPrayers` method:\n\n```dart\nvoid calculateTotalPrayers(int taqwaBuffer) {\n  prayerCounts.clear();\n  for (int year in prayerPercentages.keys) {\n    for (String prayer in prayers) {\n      int percentage = prayerPercentages[year]?[prayer] ?? 0;\n      int count = (365 * percentage ~/ 100);\n      prayerCounts[prayer] = (prayerCounts[prayer] ?? 0) + count;\n    }\n    _preferencesService.saveData('$year', jsonEncode(prayerPercentages[year]!));\n  }\n\n  prayerCounts = prayerCounts.map((prayer, count) => MapEntry(prayer, (count * (100 + taqwaBuffer) ~/ 100)));\n  overallProgress = prayerCounts.values.fold(0, (sum, count) => sum);\n  savePrayerData();\n}\n```\n\n2. In the `prayer_service.dart` file, update the `calculateTotalPrayersForPrayer` method:\n\n```dart\nint calculateTotalPrayersForPrayer(String prayer) {\n  int totalYears = prayerPercentages.length;\n  int totalPrayers = totalYears * 365;\n  return totalPrayers;\n}\n```\n\n3. In the `prayer_progress_card.dart` file, update the `PrayerProgressCard` widget:\n\n```dart\nText(\n  '$completedPrayers',\n  style: const TextStyle(fontSize: 18.0),\n),\nconst SizedBox(height: 8.0),\nText(\n  '/ $totalPrayers',\n  style: const TextStyle(fontSize: 18.0),\n),\n```\n\n4. In the `home_screen.dart` file, update the `_buildResultSection` method to arrange the buttons in two rows and hide the \"Start Over\" button behind a \"more\" icon:\n\n```dart\nRow(\n  mainAxisAlignment: MainAxisAlignment.spaceEvenly,\n  children: [\n    ElevatedButton.icon(\n      onPressed: _sharePrayerData,\n      icon: const Icon(Icons.share),\n      label: const Text('Share'),\n      style: ElevatedButton.styleFrom(\n        backgroundColor: Colors.blue,\n        padding: const EdgeInsets.symmetric(\n          vertical: 12.0,\n          horizontal: 16.0,\n        ),\n        shape: RoundedRectangleBorder(\n          borderRadius: BorderRadius.circular(8.0),\n        ),\n      ),\n    ),\n    ElevatedButton.icon(\n      onPressed: () {\n        Navigator.pushReplacement(\n          context,\n          MaterialPageRoute(\n            builder: (context) => const YearSelectionScreen(),\n          ),\n        );\n      },\n      icon: const Icon(Icons.edit),\n      label: const Text('Edit'),\n      style: ElevatedButton.styleFrom(\n        backgroundColor: Colors.orange,\n        padding: const EdgeInsets.symmetric(\n          vertical: 12.0,\n          horizontal: 16.0,\n        ),\n        shape: RoundedRectangleBorder(\n          borderRadius: BorderRadius.circular(8.0),\n        ),\n      ),\n    ),\n  ],\n),\nconst SizedBox(height: 16.0),\nRow(\n  mainAxisAlignment: MainAxisAlignment.end,\n  children: [\n    IconButton(\n      onPressed: () {\n        showModalBottomSheet(\n          context: context,\n          builder: (context) => Container(\n            padding: const EdgeInsets.all(16.0),\n            child: Column(\n              mainAxisSize: MainAxisSize.min,\n              children: [\n                ListTile(\n                  leading: const Icon(Icons.refresh),\n                  title: const Text('Start Over'),\n                  onTap: () {\n                    Navigator.pop(context);\n                    _resetApplication();\n                  },\n                ),\n              ],\n            ),\n          ),\n        );\n      },\n      icon: const Icon(Icons.more_vert),\n    ),\n  ],\n),\n```\n\nThese changes should address the issues you mentioned. The \"Add Details\" section should now display the correct values when first loading and navigating from the initial guess screen. The progress display will show the completed prayers on top and the total prayers on the bottom. The buttons are arranged in two rows to improve visibility, and the \"Start Over\" button is hidden behind a \"more\" icon.\n\nPlease let me know if you have any further questions or if there's anything else I can assist you with!",
            "citations": []
          }
        ],
        "updated_at": "2024-03-18T10:36:14.498722Z",
        "attachments": [],
        "files": []
      }
    },
    {
      "id": "9bd64e61-7dec-4cfd-b04b-564e25e5bcc9",
      "role": "human",
      "content": "review this entire codebase and identify duplications and weird navigation issues. Resolve them and return the entire code base fixed in one long prompt",
      "created_at": "2024-03-18T11:22:11.962440Z",
      "sequence_order": 4,
      "metadata": {
        "content": [
          {
            "start_timestamp": "2024-03-18T11:22:11.962440Z",
            "stop_timestamp": "2024-03-18T11:22:11.962440Z",
            "flags": null,
            "type": "text",
            "text": "review this entire codebase and identify duplications and weird navigation issues. Resolve them and return the entire code base fixed in one long prompt",
            "citations": []
          }
        ],
        "updated_at": "2024-03-18T11:22:11.962440Z",
        "attachments": [
          {
            "file_name": "paste.txt",
            "file_size": 29901,
            "file_type": "txt",
            "extracted_content": "\n\n# File: ./main.dart\n####################\n\nimport 'package:flutter/material.dart';\nimport './screens/year_selection_screen.dart';\n\nvoid main() {\n  runApp(const AmanaAuditApp());\n}\n\nclass AmanaAuditApp extends StatelessWidget {\n  const AmanaAuditApp({super.key});\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      title: 'Amana Audit',\n      theme: ThemeData(\n        primarySwatch: Colors.blue,\n      ),\n      home: const YearSelectionScreen(),\n    );\n  }\n}\n\n\n\n# File: ./screens/year_selection_screen.dart\n#############################################\n\nimport 'package:flutter/material.dart';\nimport '../services/prayer_service.dart';\nimport 'home_screen.dart';\n\nclass YearSelectionScreen extends StatefulWidget {\n  const YearSelectionScreen({super.key});\n\n  @override\n  _YearSelectionScreenState createState() => _YearSelectionScreenState();\n}\n\nclass _YearSelectionScreenState extends State<YearSelectionScreen> {\n  final PrayerService _prayerService = PrayerService();\n\n  final TextEditingController _startYearController = TextEditingController();\n  final TextEditingController _endYearController = TextEditingController();\n  final TextEditingController _initialAverageGuessController =\n      TextEditingController();\n\n  bool _showDetails = false;\n\n  Future<void> _navigateToSummary() async {\n    int startYear = int.tryParse(_startYearController.text) ?? 0;\n    int endYear = int.tryParse(_endYearController.text) ?? 0;\n    int initialAverageGuess =\n        int.tryParse(_initialAverageGuessController.text) ?? 0;\n\n    if (startYear > 0 && endYear >= startYear) {\n      await _prayerService.generatePrayerInputs(startYear, endYear);\n      _prayerService.applyUniformPercentage(initialAverageGuess);\n      _prayerService.calculateTotalPrayers(0);\n\n      Navigator.pushReplacement(\n        context,\n        MaterialPageRoute(builder: (context) => const AmanaAuditHomePage()),\n      );\n    } else {\n      showDialog(\n        context: context,\n        builder: (context) => AlertDialog(\n          title: const Text('Invalid Input'),\n          content: const Text('Please enter valid start and end years.'),\n          actions: [\n            TextButton(\n              onPressed: () => Navigator.pop(context),\n              child: const Text('OK'),\n            ),\n          ],\n        ),\n      );\n    }\n  }\n\n  void _onNextPressed() {\n    setState(() {\n      _showDetails = true;\n    });\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Select Years'),\n      ),\n      body: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.stretch,\n          children: [\n            TextField(\n              controller: _startYearController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'Start Year',\n                hintText: 'Enter start year',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            TextField(\n              controller: _endYearController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'End Year',\n                hintText: 'Enter end year',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            TextField(\n              controller: _initialAverageGuessController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'Initial Average Guess',\n                hintText: 'Enter initial average guess percentage',\n              ),\n            ),\n            const SizedBox(height: 24.0),\n            ElevatedButton(\n              onPressed: _onNextPressed,\n              child: const Text('Next'),\n            ),\n            Visibility(\n              visible: _showDetails,\n              child: ElevatedButton(\n                onPressed: _navigateToSummary,\n                child: const Text('Add Details'),\n              ),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n\n\n# File: ./screens/home_screen.dart\n###################################\n\n// screens/home_screen.dart\nimport 'package:flutter/material.dart';\nimport 'package:share_plus/share_plus.dart';\nimport '../services/prayer_service.dart';\nimport '../services/shared_preferences_service.dart';\nimport '../screens/year_selection_screen.dart';\nimport '../widgets/prayer_input_card.dart';\nimport '../widgets/prayer_progress_card.dart';\n\nclass AmanaAuditHomePage extends StatefulWidget {\n  const AmanaAuditHomePage({super.key});\n\n  @override\n  _AmanaAuditHomePageState createState() => _AmanaAuditHomePageState();\n}\n\nclass _AmanaAuditHomePageState extends State<AmanaAuditHomePage> {\n  final PrayerService _prayerService = PrayerService();\n  final SharedPreferencesService _preferencesService =\n      SharedPreferencesService();\n  String _state = 'input';\n\n  final TextEditingController _startYearController = TextEditingController();\n  final TextEditingController _endYearController = TextEditingController();\n  final TextEditingController _uniformPercentageController =\n      TextEditingController();\n  final TextEditingController _taqwaBufferController =\n      TextEditingController(text: '0');\n\n  @override\n  void initState() {\n    super.initState();\n    _initializeData();\n  }\n\n  Future<void> _initializeData() async {\n    await _loadSavedData();\n    if (!_prayerService.hasPrayerData()) {\n      await _prayerService.generatePrayerInputs(\n          2000, 2023); // Use appropriate default values\n      _prayerService\n          .applyUniformPercentage(50); // Use appropriate default value\n      _prayerService.calculateTotalPrayers(10); // Use appropriate default value\n    }\n    setState(() {});\n  }\n\n  Future<void> _loadSavedData() async {\n    await _prayerService.loadSavedData();\n    if (_prayerService.hasPrayerData()) {\n      setState(() {\n        _state = 'result';\n      });\n    }\n  }\n\n  Future<void> _generatePrayerInputs() async {\n    int startYear = int.tryParse(_startYearController.text) ?? 0;\n    int endYear = int.tryParse(_endYearController.text) ?? 0;\n    if (startYear > 0 && endYear >= startYear) {\n      await _prayerService.generatePrayerInputs(startYear, endYear);\n      setState(() {});\n    } else {\n      showDialog(\n        context: context,\n        builder: (context) => AlertDialog(\n          title: const Text('Invalid Input'),\n          content: const Text('Please enter valid start and end years.'),\n          actions: [\n            TextButton(\n              onPressed: () => Navigator.pop(context),\n              child: const Text('OK'),\n            ),\n          ],\n        ),\n      );\n    }\n  }\n\n  void _applyUniformPercentage() {\n    int percentage = int.tryParse(_uniformPercentageController.text) ?? 0;\n    _prayerService.applyUniformPercentage(percentage);\n    setState(() {});\n  }\n\n  void _calculateTotalPrayers() {\n    int taqwaBuffer = int.tryParse(_taqwaBufferController.text) ?? 0;\n    _prayerService.calculateTotalPrayers(taqwaBuffer);\n    _prayerService.savePrayerData();\n    setState(() {\n      _state = 'result';\n    });\n  }\n\n  void _decrementPrayer(String prayer) {\n    _prayerService.decrementPrayer(prayer);\n    _prayerService.savePrayerData();\n    setState(() {});\n  }\n\n  void _resetApplication() {\n    _prayerService.resetApplication();\n    setState(() {\n      _state = 'input';\n    });\n  }\n\n  void _sharePrayerData() {\n    _prayerService.sharePrayerData();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Amana Audit'),\n      ),\n      body: _buildBody(),\n    );\n  }\n\n  Widget _buildBody() {\n    switch (_state) {\n      case 'input':\n        return SingleChildScrollView(\n          child: Padding(\n            padding: const EdgeInsets.all(16.0),\n            child: _buildInputSection(),\n          ),\n        );\n      case 'result':\n        return SingleChildScrollView(\n          child: Padding(\n            padding: const EdgeInsets.all(16.0),\n            child: _buildResultSection(),\n          ),\n        );\n      default:\n        return Container();\n    }\n  }\n\n  Widget _buildInputSection() {\n    return Column(\n      crossAxisAlignment: CrossAxisAlignment.stretch,\n      children: [\n        TextField(\n          controller: _startYearController,\n          keyboardType: TextInputType.number,\n          decoration: const InputDecoration(\n            labelText: 'Start Year',\n            hintText: 'Enter start year',\n          ),\n        ),\n        const SizedBox(height: 16.0),\n        TextField(\n          controller: _endYearController,\n          keyboardType: TextInputType.number,\n          decoration: const InputDecoration(\n            labelText: 'End Year',\n            hintText: 'Enter end year',\n          ),\n        ),\n        const SizedBox(height: 16.0),\n        Row(\n          children: [\n            Expanded(\n              child: TextField(\n                controller: _uniformPercentageController,\n                keyboardType: TextInputType.number,\n                decoration: const InputDecoration(\n                  labelText: 'Average Percentage of Missed Prayers',\n                  hintText: 'Enter average percentage',\n                ),\n              ),\n            ),\n            IconButton(\n              icon: const Icon(Icons.info),\n              onPressed: () {\n                showDialog(\n                  context: context,\n                  builder: (context) => AlertDialog(\n                    title: const Text('Average Percentage of Missed Prayers'),\n                    content: const Text(\n                        'Enter the average percentage of prayers you estimate you missed in those years.'),\n                    actions: [\n                      TextButton(\n                        onPressed: () => Navigator.pop(context),\n                        child: const Text('OK'),\n                      ),\n                    ],\n                  ),\n                );\n              },\n            ),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        ElevatedButton(\n          onPressed: () async {\n            await _generatePrayerInputs();\n            _applyUniformPercentage();\n          },\n          child: const Text('Generate Prayer Inputs'),\n        ),\n        const SizedBox(height: 16.0),\n        ExpansionTile(\n          title: Row(\n            children: [\n              const Text('Add Details'),\n              IconButton(\n                icon: const Icon(Icons.info),\n                onPressed: () {\n                  showDialog(\n                    context: context,\n                    builder: (context) => AlertDialog(\n                      title: const Text('Detailed Prayer Calendar'),\n                      content: const Text(\n                          'Expand this section to review and modify the detailed prayer calendar. You can set specific percentages for each year and prayer.'),\n                      actions: [\n                        TextButton(\n                          onPressed: () => Navigator.pop(context),\n                          child: const Text('OK'),\n                        ),\n                      ],\n                    ),\n                  );\n                },\n              ),\n            ],\n          ),\n          children: [\n            _buildPrayerInputs(),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        Row(\n          children: [\n            Expanded(\n              child: TextField(\n                controller: _taqwaBufferController,\n                keyboardType: TextInputType.number,\n                decoration: const InputDecoration(\n                  labelText: 'Taqwa Buffer',\n                  hintText: 'Enter taqwa buffer percentage',\n                ),\n              ),\n            ),\n            IconButton(\n              icon: const Icon(Icons.info),\n              onPressed: () {\n                showDialog(\n                  context: context,\n                  builder: (context) => AlertDialog(\n                    title: const Text('Taqwa Buffer'),\n                    content: const Text(\n                        'Enter a percentage to add as a buffer to the calculated prayer debt. This buffer is added to account for any uncertainties or missed prayers.'),\n                    actions: [\n                      TextButton(\n                        onPressed: () => Navigator.pop(context),\n                        child: const Text('OK'),\n                      ),\n                    ],\n                  ),\n                );\n              },\n            ),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        ElevatedButton(\n          onPressed: _calculateTotalPrayers,\n          child: const Text('Calculate Prayer Debt'),\n        ),\n      ],\n    );\n  }\n\n  Widget _buildPrayerInputs() {\n    return Column(\n      crossAxisAlignment: CrossAxisAlignment.stretch,\n      children: _prayerService.prayerPercentages.entries.map((entry) {\n        int year = entry.key;\n        Map<String, int> prayers = entry.value;\n        return PrayerInputCard(\n          year: year,\n          prayers: prayers,\n          onChanged: (year, prayer, percentage) {\n            setState(() {\n              _prayerService.updatePrayerPercentage(year, prayer, percentage);\n            });\n          },\n        );\n      }).toList(),\n    );\n  }\n\n  Widget _buildResultSection() {\n    return Column(\n      crossAxisAlignment: CrossAxisAlignment.stretch,\n      children: [\n        Card(\n          elevation: 4.0,\n          margin: const EdgeInsets.symmetric(vertical: 16.0),\n          child: Padding(\n            padding: const EdgeInsets.all(16.0),\n            child: Column(\n              crossAxisAlignment: CrossAxisAlignment.start,\n              children: [\n                const Text(\n                  'Total Prayers to Make Up',\n                  style: TextStyle(\n                    fontSize: 20.0,\n                    fontWeight: FontWeight.bold,\n                  ),\n                ),\n                const SizedBox(height: 16.0),\n                LinearProgressIndicator(\n                  value: _prayerService.calculateOverallTotalPrayers() > 0\n                      ? _prayerService.overallProgress /\n                          _prayerService.calculateOverallTotalPrayers()\n                      : 0,\n                  minHeight: 24.0,\n                ),\n                const SizedBox(height: 8.0),\n                Text(\n                  '${_prayerService.overallProgress} / ${_prayerService.calculateOverallTotalPrayers()}',\n                  textAlign: TextAlign.center,\n                  style: const TextStyle(fontSize: 18.0),\n                ),\n              ],\n            ),\n          ),\n        ),\n        ..._prayerService.prayers.map((prayer) {\n          int totalPrayers =\n              _prayerService.calculateTotalPrayersForPrayer(prayer);\n          int completedPrayers = _prayerService.prayerCounts[prayer] ?? 0;\n          return PrayerProgressCard(\n            prayer: prayer,\n            completedPrayers: completedPrayers,\n            totalPrayers: totalPrayers,\n            onPressed: () => _decrementPrayer(prayer),\n          );\n        }).toList(),\n        const SizedBox(height: 24.0),\n        Row(\n          mainAxisAlignment: MainAxisAlignment.spaceEvenly,\n          children: [\n            ElevatedButton.icon(\n              onPressed: _sharePrayerData,\n              icon: const Icon(Icons.share),\n              label: const Text('Share'),\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.blue,\n                padding: const EdgeInsets.symmetric(\n                  vertical: 12.0,\n                  horizontal: 16.0,\n                ),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(8.0),\n                ),\n              ),\n            ),\n            ElevatedButton.icon(\n              onPressed: () {\n                Navigator.pushReplacement(\n                  context,\n                  MaterialPageRoute(\n                    builder: (context) => const YearSelectionScreen(),\n                  ),\n                );\n              },\n              icon: const Icon(Icons.edit),\n              label: const Text('Edit'),\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.orange,\n                padding: const EdgeInsets.symmetric(\n                  vertical: 12.0,\n                  horizontal: 16.0,\n                ),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(8.0),\n                ),\n              ),\n            ),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        Row(\n          mainAxisAlignment: MainAxisAlignment.end,\n          children: [\n            IconButton(\n              onPressed: () {\n                showModalBottomSheet(\n                  context: context,\n                  builder: (context) => Container(\n                    padding: const EdgeInsets.all(16.0),\n                    child: Column(\n                      mainAxisSize: MainAxisSize.min,\n                      children: [\n                        ListTile(\n                          leading: const Icon(Icons.refresh),\n                          title: const Text('Start Over'),\n                          onTap: () {\n                            Navigator.pop(context);\n                            _resetApplication();\n                          },\n                        ),\n                      ],\n                    ),\n                  ),\n                );\n              },\n              icon: const Icon(Icons.more_vert),\n            ),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        ExpansionTile(\n          title: Row(\n            children: [\n              const Text('Add Details'),\n              IconButton(\n                icon: const Icon(Icons.info),\n                onPressed: () {\n                  showDialog(\n                    context: context,\n                    builder: (context) => AlertDialog(\n                      title: const Text('Detailed Prayer Calendar'),\n                      content: const Text(\n                          'Expand this section to review and modify the detailed prayer calendar. You can set specific percentages for each year and prayer.'),\n                      actions: [\n                        TextButton(\n                          onPressed: () => Navigator.pop(context),\n                          child: const Text('OK'),\n                        ),\n                      ],\n                    ),\n                  );\n                },\n              ),\n            ],\n          ),\n          children: [\n            _buildPrayerInputs(),\n          ],\n        ),\n        const SizedBox(height: 16.0),\n        TextButton.icon(\n          onPressed: () {\n            showDialog(\n              context: context,\n              builder: (context) => AlertDialog(\n                title: const Text('Explanation'),\n                content: const Text(\n                  'This app helps you track and make up your missed prayers. Enter the years and the average percentage of prayers you estimate you missed in those years. You can also set specific percentages for each prayer and year in the detailed prayer calendar. The Taqwa Buffer is an additional percentage adde to account for any missed prayers. Once you calculate your prayer debt, you can track your progress and mark prayers as completed. The progress bars show your overall progress and the progress for each prayer.',\n                ),\n                actions: [\n                  TextButton(\n                    onPressed: () => Navigator.pop(context),\n                    child: const Text('OK'),\n                  ),\n                ],\n              ),\n            );\n          },\n          icon: const Icon(Icons.info),\n          label: const Text('Explanation'),\n        ),\n      ],\n    );\n  }\n}\n\n\n\n# File: ./services/shared_preferences_service.dart\n###################################################\n\n// services/shared_preferences_services.dart\nimport 'package:shared_preferences/shared_preferences.dart';\n\nclass SharedPreferencesService {\n  Future<void> saveData(String key, dynamic value) async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    if (value is int) {\n      await prefs.setInt(key, value);\n    } else if (value is String) {\n      await prefs.setString(key, value);\n    } else if (value is bool) {\n      await prefs.setBool(key, value);\n    } else if (value is double) {\n      await prefs.setDouble(key, value);\n    } else if (value is List<String>) {\n      await prefs.setStringList(key, value);\n    } else {\n      throw ArgumentError('Invalid value type');\n    }\n  }\n\n  Future<dynamic> getData(String key) async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    return prefs.get(\n        key); // Simply return the value, which will be null if the key is not found\n  }\n\n  Future<void> clearData() async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    await prefs.clear();\n  }\n}\n\n\n\n# File: ./services/prayer_service.dart\n#######################################\n\n// services/prayer_service.dart\nimport 'dart:convert';\nimport 'package:flutter/material.dart';\nimport 'shared_preferences_service.dart';\nimport 'package:share_plus/share_plus.dart';\n\nclass PrayerService {\n  final SharedPreferencesService _preferencesService =\n      SharedPreferencesService();\n  final List<String> prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];\n  Map<String, int> prayerCounts = {};\n  Map<int, Map<String, int>> prayerPercentages = {};\n  int overallProgress = 0;\n\n  Future<void> loadSavedData() async {\n    Map<String, int> savedData = {};\n    for (var prayer in prayers) {\n      savedData[prayer] = await _preferencesService.getData(prayer) ?? 0;\n    }\n    prayerCounts = savedData;\n  }\n\n  bool hasPrayerData() {\n    return prayerCounts.values.any((count) => count > 0);\n  }\n\n  Future<void> generatePrayerInputs(int startYear, int endYear,\n      {int defaultPercentage = 95}) async {\n    prayerPercentages.clear();\n    for (int year = startYear; year <= endYear; year++) {\n      String? yearData = await _preferencesService.getData('$year');\n      if (yearData != null) {\n        // If data exists, decode and use it\n        prayerPercentages[year] = Map<String, int>.from(jsonDecode(yearData));\n      } else {\n        // Initialize with default percentage if no data exists\n        prayerPercentages[year] = {\n          for (var prayer in prayers) prayer: defaultPercentage\n        };\n      }\n    }\n  }\n\n  void applyUniformPercentage(int percentage) {\n    prayerPercentages.forEach((year, prayers) {\n      prayers.updateAll((prayer, value) => percentage);\n    });\n  }\n\n  void calculateTotalPrayers(int taqwaBuffer) {\n    prayerCounts.clear();\n    for (int year in prayerPercentages.keys) {\n      for (String prayer in prayers) {\n        int percentage = prayerPercentages[year]?[prayer] ?? 0;\n        int count = (365 * percentage ~/ 100);\n        prayerCounts[prayer] = (prayerCounts[prayer] ?? 0) + count;\n      }\n      _preferencesService.saveData(\n          '$year', jsonEncode(prayerPercentages[year]!));\n    }\n\n    // Directly modify prayerCounts using map\n    prayerCounts\n        .updateAll((prayer, count) => (count * (100 + taqwaBuffer) ~/ 100));\n\n    // Calculate the overall progress\n    overallProgress = prayerCounts.values.fold(0, (sum, count) => sum + count);\n\n    savePrayerData();\n  }\n\n  void decrementPrayer(String prayer) {\n    if (prayerCounts.containsKey(prayer) && prayerCounts[prayer]! > 0) {\n      prayerCounts[prayer] = prayerCounts[prayer]! - 1;\n      overallProgress =\n          prayerCounts.values.fold(0, (sum, count) => sum + count);\n      savePrayerData();\n    }\n  }\n\n  void resetApplication() {\n    prayerCounts.clear();\n    prayerPercentages.clear();\n    overallProgress = 0;\n    _preferencesService.clearData();\n  }\n\n  void savePrayerData() {\n    for (var entry in prayerCounts.entries) {\n      _preferencesService.saveData(entry.key, entry.value);\n    }\n  }\n\n  void sharePrayerData() {\n    String shareText = 'My Prayer Progress:\\n\\n';\n    for (var entry in prayerCounts.entries) {\n      int totalPrayers = calculateTotalPrayersForPrayer(entry.key);\n      shareText += '${entry.key}: ${entry.value} / $totalPrayers\\n';\n    }\n    Share.share(shareText);\n  }\n\n  int calculateTotalPrayersForPrayer(String prayer) {\n    int totalYears = prayerPercentages.length;\n    int totalPrayers = totalYears * 365;\n    return totalPrayers;\n  }\n\n  int calculateOverallTotalPrayers() {\n    return prayers.fold<int>(\n        0, (sum, prayer) => sum + calculateTotalPrayersForPrayer(prayer));\n  }\n\n  void updatePrayerPercentage(int year, String prayer, int percentage) {\n    prayerPercentages[year]?[prayer] = percentage;\n  }\n}\n\n\n\n# File: ./widgets/prayer_input_card.dart\n#########################################\n\n// widgets/prayer_input_card.dart\nimport 'package:flutter/material.dart';\n\nclass PrayerInputCard extends StatelessWidget {\n  final int year;\n  final Map<String, int> prayers;\n  final Function(int, String, int) onChanged;\n\n  const PrayerInputCard({\n    Key? key,\n    required this.year,\n    required this.prayers,\n    required this.onChanged,\n  }) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return Card(\n      margin: const EdgeInsets.symmetric(vertical: 8.0),\n      child: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.start,\n          children: [\n            Text(\n              'Year: $year',\n              style: const TextStyle(\n                fontSize: 18.0,\n                fontWeight: FontWeight.bold,\n              ),\n            ),\n            const SizedBox(height: 8.0),\n            ...prayers.entries.map((entry) {\n              String prayer = entry.key;\n              int percentage = entry.value;\n              int completedPrayers = (365 * (100 - percentage) ~/ 100);\n              int totalPrayers = 365;\n              return Column(\n                children: [\n                  Row(\n                    children: [\n                      Expanded(\n                        child: Text('$prayer:'),\n                      ),\n                      const SizedBox(width: 8.0),\n                      Expanded(\n                        child: TextField(\n                          keyboardType: TextInputType.number,\n                          controller:\n                              TextEditingController(text: '$percentage'),\n                          onChanged: (value) {\n                            onChanged(year, prayer, int.tryParse(value) ?? 0);\n                          },\n                          decoration: const InputDecoration(\n                            hintText: 'Percentage',\n                          ),\n                        ),\n                      ),\n                    ],\n                  ),\n                  const SizedBox(height: 8.0),\n                  Text('$completedPrayers / $totalPrayers'),\n                ],\n              );\n            }).toList(),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n\n\n# File: ./widgets/prayer_progress_card.dart\n############################################\n\n// widgets/prayer_progress_card.dart\nimport 'package:flutter/material.dart';\n\nclass PrayerProgressCard extends StatelessWidget {\n  final String prayer;\n  final int completedPrayers;\n  final int totalPrayers;\n  final VoidCallback onPressed;\n\n  const PrayerProgressCard({\n    Key? key,\n    required this.prayer,\n    required this.completedPrayers,\n    required this.totalPrayers,\n    required this.onPressed,\n  }) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return Card(\n      elevation: 2.0,\n      margin: const EdgeInsets.symmetric(vertical: 8.0),\n      child: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.start,\n          children: [\n            Row(\n              mainAxisAlignment: MainAxisAlignment.spaceBetween,\n              children: [\n                Text(\n                  prayer,\n                  style: const TextStyle(\n                    fontSize: 20.0,\n                    fontWeight: FontWeight.bold,\n                  ),\n                ),\n                Text(\n                  '$completedPrayers',\n                  style: const TextStyle(fontSize: 18.0),\n                ),\n                const SizedBox(height: 8.0),\n                Text(\n                  '/ $totalPrayers',\n                  style: const TextStyle(fontSize: 18.0),\n                ),\n              ],\n            ),\n            const SizedBox(height: 16.0),\n            LinearProgressIndicator(\n              value: totalPrayers > 0 ? completedPrayers / totalPrayers : 0,\n              minHeight: 20.0,\n              color: Colors.green,\n              backgroundColor: Colors.green[100],\n            ),\n            const SizedBox(height: 16.0),\n            ElevatedButton(\n              onPressed: completedPrayers < totalPrayers ? onPressed : null,\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.green,\n                padding: const EdgeInsets.symmetric(\n                  vertical: 16.0,\n                  horizontal: 24.0,\n                ),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(8.0),\n                ),\n              ),\n              child: Text(\n                'Prayed $prayer',\n                style: const TextStyle(fontSize: 18.0),\n              ),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n"
          }
        ],
        "files": [
          {
            "file_name": "paste.txt"
          }
        ]
      }
    },
    {
      "id": "bd5239ce-8ce7-4a8a-a2fb-dcbfadd49538",
      "role": "assistant",
      "content": " Here's the updated codebase with duplications removed and navigation issues resolved:\n\n```dart\n# File: ./main.dart\n####################\n\nimport 'package:flutter/material.dart';\nimport './screens/year_selection_screen.dart';\n\nvoid main() {\n  runApp(const AmanaAuditApp());\n}\n\nclass AmanaAuditApp extends StatelessWidget {\n  const AmanaAuditApp({super.key});\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      title: 'Amana Audit',\n      theme: ThemeData(\n        primarySwatch: Colors.blue,\n      ),\n      home: const YearSelectionScreen(),\n    );\n  }\n}\n\n# File: ./screens/year_selection_screen.dart\n#############################################\n\nimport 'package:flutter/material.dart';\nimport '../services/prayer_service.dart';\nimport 'home_screen.dart';\n\nclass YearSelectionScreen extends StatefulWidget {\n  const YearSelectionScreen({super.key});\n\n  @override\n  _YearSelectionScreenState createState() => _YearSelectionScreenState();\n}\n\nclass _YearSelectionScreenState extends State<YearSelectionScreen> {\n  final PrayerService _prayerService = PrayerService();\n\n  final TextEditingController _startYearController = TextEditingController();\n  final TextEditingController _endYearController = TextEditingController();\n  final TextEditingController _initialAverageGuessController =\n      TextEditingController();\n\n  Future<void> _navigateToHomePage() async {\n    int startYear = int.tryParse(_startYearController.text) ?? 0;\n    int endYear = int.tryParse(_endYearController.text) ?? 0;\n    int initialAverageGuess =\n        int.tryParse(_initialAverageGuessController.text) ?? 0;\n\n    if (startYear > 0 && endYear >= startYear) {\n      await _prayerService.generatePrayerInputs(startYear, endYear);\n      _prayerService.applyUniformPercentage(initialAverageGuess);\n      _prayerService.calculateTotalPrayers(0);\n\n      Navigator.pushReplacement(\n        context,\n        MaterialPageRoute(builder: (context) => const AmanaAuditHomePage()),\n      );\n    } else {\n      showDialog(\n        context: context,\n        builder: (context) => AlertDialog(\n          title: const Text('Invalid Input'),\n          content: const Text('Please enter valid start and end years.'),\n          actions: [\n            TextButton(\n              onPressed: () => Navigator.pop(context),\n              child: const Text('OK'),\n            ),\n          ],\n        ),\n      );\n    }\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Select Years'),\n      ),\n      body: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.stretch,\n          children: [\n            TextField(\n              controller: _startYearController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'Start Year',\n                hintText: 'Enter start year',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            TextField(\n              controller: _endYearController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'End Year',\n                hintText: 'Enter end year',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            TextField(\n              controller: _initialAverageGuessController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'Initial Average Guess',\n                hintText: 'Enter initial average guess percentage',\n              ),\n            ),\n            const SizedBox(height: 24.0),\n            ElevatedButton(\n              onPressed: _navigateToHomePage,\n              child: const Text('Next'),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n# File: ./screens/home_screen.dart\n###################################\n\n// screens/home_screen.dart\nimport 'package:flutter/material.dart';\nimport 'package:share_plus/share_plus.dart';\nimport '../services/prayer_service.dart';\nimport '../services/shared_preferences_service.dart';\nimport '../screens/year_selection_screen.dart';\nimport '../widgets/prayer_input_card.dart';\nimport '../widgets/prayer_progress_card.dart';\n\nclass AmanaAuditHomePage extends StatefulWidget {\n  const AmanaAuditHomePage({super.key});\n\n  @override\n  _AmanaAuditHomePageState createState() => _AmanaAuditHomePageState();\n}\n\nclass _AmanaAuditHomePageState extends State<AmanaAuditHomePage> {\n  final PrayerService _prayerService = PrayerService();\n  final SharedPreferencesService _preferencesService =\n      SharedPreferencesService();\n\n  final TextEditingController _taqwaBufferController =\n      TextEditingController(text: '0');\n\n  @override\n  void initState() {\n    super.initState();\n    _loadSavedData();\n  }\n\n  Future<void> _loadSavedData() async {\n    await _prayerService.loadSavedData();\n    setState(() {});\n  }\n\n  void _calculateTotalPrayers() {\n    int taqwaBuffer = int.tryParse(_taqwaBufferController.text) ?? 0;\n    _prayerService.calculateTotalPrayers(taqwaBuffer);\n    _prayerService.savePrayerData();\n    setState(() {});\n  }\n\n  void _decrementPrayer(String prayer) {\n    _prayerService.decrementPrayer(prayer);\n    _prayerService.savePrayerData();\n    setState(() {});\n  }\n\n  void _resetApplication() {\n    _prayerService.resetApplication();\n    Navigator.pushReplacement(\n      context,\n      MaterialPageRoute(builder: (context) => const YearSelectionScreen()),\n    );\n  }\n\n  void _sharePrayerData() {\n    _prayerService.sharePrayerData();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Amana Audit'),\n      ),\n      body: SingleChildScrollView(\n        child: Padding(\n          padding: const EdgeInsets.all(16.0),\n          child: Column(\n            crossAxisAlignment: CrossAxisAlignment.stretch,\n            children: [\n              Card(\n                elevation: 4.0,\n                margin: const EdgeInsets.symmetric(vertical: 16.0),\n                child: Padding(\n                  padding: const EdgeInsets.all(16.0),\n                  child: Column(\n                    crossAxisAlignment: CrossAxisAlignment.start,\n                    children: [\n                      const Text(\n                        'Total Prayers to Make Up',\n                        style: TextStyle(\n                          fontSize: 20.0,\n                          fontWeight: FontWeight.bold,\n                        ),\n                      ),\n                      const SizedBox(height: 16.0),\n                      LinearProgressIndicator(\n                        value: _prayerService.calculateOverallTotalPrayers() > 0\n                            ? _prayerService.overallProgress /\n                                _prayerService.calculateOverallTotalPrayers()\n                            : 0,\n                        minHeight: 24.0,\n                      ),\n                      const SizedBox(height: 8.0),\n                      Text(\n                        '${_prayerService.overallProgress} / ${_prayerService.calculateOverallTotalPrayers()}',\n                        textAlign: TextAlign.center,\n                        style: const TextStyle(fontSize: 18.0),\n                      ),\n                    ],\n                  ),\n                ),\n              ),\n              ..._prayerService.prayers.map((prayer) {\n                int totalPrayers =\n                    _prayerService.calculateTotalPrayersForPrayer(prayer);\n                int completedPrayers = _prayerService.prayerCounts[prayer] ?? 0;\n                return PrayerProgressCard(\n                  prayer: prayer,\n                  completedPrayers: completedPrayers,\n                  totalPrayers: totalPrayers,\n                  onPressed: () => _decrementPrayer(prayer),\n                );\n              }).toList(),\n              const SizedBox(height: 24.0),\n              Row(\n                mainAxisAlignment: MainAxisAlignment.spaceEvenly,\n                children: [\n                  ElevatedButton.icon(\n                    onPressed: _sharePrayerData,\n                    icon: const Icon(Icons.share),\n                    label: const Text('Share'),\n                    style: ElevatedButton.styleFrom(\n                      backgroundColor: Colors.blue,\n                      padding: const EdgeInsets.symmetric(\n                        vertical: 12.0,\n                        horizontal: 16.0,\n                      ),\n                      shape: RoundedRectangleBorder(\n                        borderRadius: BorderRadius.circular(8.0),\n                      ),\n                    ),\n                  ),\n                  ElevatedButton.icon(\n                    onPressed: () {\n                      Navigator.pushReplacement(\n                        context,\n                        MaterialPageRoute(\n                          builder: (context) => const YearSelectionScreen(),\n                        ),\n                      );\n                    },\n                    icon: const Icon(Icons.edit),\n                    label: const Text('Edit'),\n                    style: ElevatedButton.styleFrom(\n                      backgroundColor: Colors.orange,\n                      padding: const EdgeInsets.symmetric(\n                        vertical: 12.0,\n                        horizontal: 16.0,\n                      ),\n                      shape: RoundedRectangleBorder(\n                        borderRadius: BorderRadius.circular(8.0),\n                      ),\n                    ),\n                  ),\n                ],\n              ),\n              const SizedBox(height: 16.0),\n              Row(\n                mainAxisAlignment: MainAxisAlignment.end,\n                children: [\n                  IconButton(\n                    onPressed: () {\n                      showModalBottomSheet(\n                        context: context,\n                        builder: (context) => Container(\n                          padding: const EdgeInsets.all(16.0),\n                          child: Column(\n                            mainAxisSize: MainAxisSize.min,\n                            children: [\n                              ListTile(\n                                leading: const Icon(Icons.refresh),\n                                title: const Text('Start Over'),\n                                onTap: () {\n                                  Navigator.pop(context);\n                                  _resetApplication();\n                                },\n                              ),\n                            ],\n                          ),\n                        ),\n                      );\n                    },\n                    icon: const Icon(Icons.more_vert),\n                  ),\n                ],\n              ),\n              ExpansionTile(\n                title: Row(\n                  children: [\n                    const Text('Add Details'),\n                    IconButton(\n                      icon: const Icon(Icons.info),\n                      onPressed: () {\n                        showDialog(\n                          context: context,\n                          builder: (context) => AlertDialog(\n                            title: const Text('Detailed Prayer Calendar'),\n                            content: const Text(\n                                'Expand this section to review and modify the detailed prayer calendar. You can set specific percentages for each year and prayer.'),\n                            actions: [\n                              TextButton(\n                                onPressed: () => Navigator.pop(context),\n                                child: const Text('OK'),\n                              ),\n                            ],\n                          ),\n                        );\n                      },\n                    ),\n                  ],\n                ),\n                children: [\n                  Column(\n                    crossAxisAlignment: CrossAxisAlignment.stretch,\n                    children: _prayerService.prayerPercentages.entries\n                        .map((entry) {\n                      int year = entry.key;\n                      Map<String, int> prayers = entry.value;\n                      return PrayerInputCard(\n                        year: year,\n                        prayers: prayers,\n                        onChanged: (year, prayer, percentage) {\n                          setState(() {\n                            _prayerService.updatePrayerPercentage(\n                                year, prayer, percentage);\n                          });\n                        },\n                      );\n                    }).toList(),\n                  ),\n                ],\n              ),\n              const SizedBox(height: 16.0),\n              Row(\n                children: [\n                  Expanded(\n                    child: TextField(\n                      controller: _taqwaBufferController,\n                      keyboardType: TextInputType.number,\n                      decoration: const InputDecoration(\n                        labelText: 'Taqwa Buffer',\n                        hintText: 'Enter taqwa buffer percentage',\n                      ),\n                    ),\n                  ),\n                  IconButton(\n                    icon: const Icon(Icons.info),\n                    onPressed: () {\n                      showDialog(\n                        context: context,\n                        builder: (context) => AlertDialog(\n                          title: const Text('Taqwa Buffer'),\n                          content: const Text(\n                              'Enter a percentage to add as a buffer to the calculated prayer debt. This buffer is added to account for any uncertainties or missed prayers.'),\n                          actions: [\n                            TextButton(\n                              onPressed: () => Navigator.pop(context),\n                              child: const Text('OK'),\n                            ),\n                          ],\n                        ),\n                      );\n                    },\n                  ),\n                ],\n              ),\n              const SizedBox(height: 16.0),\n              ElevatedButton(\n                onPressed: _calculateTotalPrayers,\n                child: const Text('Calculate Prayer Debt'),\n              ),\n              const SizedBox(height: 16.0),\n              TextButton.icon(\n                onPressed: () {\n                  showDialog(\n                    context: context,\n                    builder: (context) => AlertDialog(\n                      title: const Text('Explanation'),\n                      content: const Text(\n                        'This app helps you track and make up your missed prayers. Enter the years and the average percentage of prayers you estimate you missed in those years. You can also set specific percentages for each prayer and year in the detailed prayer calendar. The Taqwa Buffer is an additional percentage added to account for any missed prayers. Once you calculate your prayer debt, you can track your progress and mark prayers as completed. The progress bars show your overall progress and the progress for each prayer.',\n                      ),\n                      actions: [\n                        TextButton(\n                          onPressed: () => Navigator.pop(context),\n                          child: const Text('OK'),\n                        ),\n                      ],\n                    ),\n                  );\n                },\n                icon: const Icon(Icons.info),\n                label: const Text('Explanation'),\n              ),\n            ],\n          ),\n        ),\n      ),\n    );\n  }\n}\n\n# File: ./services/shared_preferences_service.dart\n###################################################\n\n// services/shared_preferences_services.dart\nimport 'package:shared_preferences/shared_preferences.dart';\n\nclass SharedPreferencesService {\n  Future<void> saveData(String key, dynamic value) async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    if (value is int) {\n      await prefs.setInt(key, value);\n    } else if (value is String) {\n      await prefs.setString(key, value);\n    } else if (value is bool) {\n      await prefs.setBool(key, value);\n    } else if (value is double) {\n      await prefs.setDouble(key, value);\n    } else if (value is List<String>) {\n      await prefs.setStringList(key, value);\n    } else {\n      throw ArgumentError('Invalid value type');\n    }\n  }\n\n  Future<dynamic> getData(String key) async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    return prefs.get(key);\n  }\n\n  Future<void> clearData() async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    await prefs.clear();\n  }\n}\n\n# File: ./services/prayer_service.dart\n#",
      "created_at": "2024-03-18T11:22:11.962440Z",
      "sequence_order": 5,
      "metadata": {
        "content": [
          {
            "start_timestamp": "2024-03-18T11:22:11.962440Z",
            "stop_timestamp": "2024-03-18T11:22:11.962440Z",
            "flags": null,
            "type": "text",
            "text": " Here's the updated codebase with duplications removed and navigation issues resolved:\n\n```dart\n# File: ./main.dart\n####################\n\nimport 'package:flutter/material.dart';\nimport './screens/year_selection_screen.dart';\n\nvoid main() {\n  runApp(const AmanaAuditApp());\n}\n\nclass AmanaAuditApp extends StatelessWidget {\n  const AmanaAuditApp({super.key});\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      title: 'Amana Audit',\n      theme: ThemeData(\n        primarySwatch: Colors.blue,\n      ),\n      home: const YearSelectionScreen(),\n    );\n  }\n}\n\n# File: ./screens/year_selection_screen.dart\n#############################################\n\nimport 'package:flutter/material.dart';\nimport '../services/prayer_service.dart';\nimport 'home_screen.dart';\n\nclass YearSelectionScreen extends StatefulWidget {\n  const YearSelectionScreen({super.key});\n\n  @override\n  _YearSelectionScreenState createState() => _YearSelectionScreenState();\n}\n\nclass _YearSelectionScreenState extends State<YearSelectionScreen> {\n  final PrayerService _prayerService = PrayerService();\n\n  final TextEditingController _startYearController = TextEditingController();\n  final TextEditingController _endYearController = TextEditingController();\n  final TextEditingController _initialAverageGuessController =\n      TextEditingController();\n\n  Future<void> _navigateToHomePage() async {\n    int startYear = int.tryParse(_startYearController.text) ?? 0;\n    int endYear = int.tryParse(_endYearController.text) ?? 0;\n    int initialAverageGuess =\n        int.tryParse(_initialAverageGuessController.text) ?? 0;\n\n    if (startYear > 0 && endYear >= startYear) {\n      await _prayerService.generatePrayerInputs(startYear, endYear);\n      _prayerService.applyUniformPercentage(initialAverageGuess);\n      _prayerService.calculateTotalPrayers(0);\n\n      Navigator.pushReplacement(\n        context,\n        MaterialPageRoute(builder: (context) => const AmanaAuditHomePage()),\n      );\n    } else {\n      showDialog(\n        context: context,\n        builder: (context) => AlertDialog(\n          title: const Text('Invalid Input'),\n          content: const Text('Please enter valid start and end years.'),\n          actions: [\n            TextButton(\n              onPressed: () => Navigator.pop(context),\n              child: const Text('OK'),\n            ),\n          ],\n        ),\n      );\n    }\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Select Years'),\n      ),\n      body: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.stretch,\n          children: [\n            TextField(\n              controller: _startYearController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'Start Year',\n                hintText: 'Enter start year',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            TextField(\n              controller: _endYearController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'End Year',\n                hintText: 'Enter end year',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            TextField(\n              controller: _initialAverageGuessController,\n              keyboardType: TextInputType.number,\n              decoration: const InputDecoration(\n                labelText: 'Initial Average Guess',\n                hintText: 'Enter initial average guess percentage',\n              ),\n            ),\n            const SizedBox(height: 24.0),\n            ElevatedButton(\n              onPressed: _navigateToHomePage,\n              child: const Text('Next'),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n# File: ./screens/home_screen.dart\n###################################\n\n// screens/home_screen.dart\nimport 'package:flutter/material.dart';\nimport 'package:share_plus/share_plus.dart';\nimport '../services/prayer_service.dart';\nimport '../services/shared_preferences_service.dart';\nimport '../screens/year_selection_screen.dart';\nimport '../widgets/prayer_input_card.dart';\nimport '../widgets/prayer_progress_card.dart';\n\nclass AmanaAuditHomePage extends StatefulWidget {\n  const AmanaAuditHomePage({super.key});\n\n  @override\n  _AmanaAuditHomePageState createState() => _AmanaAuditHomePageState();\n}\n\nclass _AmanaAuditHomePageState extends State<AmanaAuditHomePage> {\n  final PrayerService _prayerService = PrayerService();\n  final SharedPreferencesService _preferencesService =\n      SharedPreferencesService();\n\n  final TextEditingController _taqwaBufferController =\n      TextEditingController(text: '0');\n\n  @override\n  void initState() {\n    super.initState();\n    _loadSavedData();\n  }\n\n  Future<void> _loadSavedData() async {\n    await _prayerService.loadSavedData();\n    setState(() {});\n  }\n\n  void _calculateTotalPrayers() {\n    int taqwaBuffer = int.tryParse(_taqwaBufferController.text) ?? 0;\n    _prayerService.calculateTotalPrayers(taqwaBuffer);\n    _prayerService.savePrayerData();\n    setState(() {});\n  }\n\n  void _decrementPrayer(String prayer) {\n    _prayerService.decrementPrayer(prayer);\n    _prayerService.savePrayerData();\n    setState(() {});\n  }\n\n  void _resetApplication() {\n    _prayerService.resetApplication();\n    Navigator.pushReplacement(\n      context,\n      MaterialPageRoute(builder: (context) => const YearSelectionScreen()),\n    );\n  }\n\n  void _sharePrayerData() {\n    _prayerService.sharePrayerData();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Amana Audit'),\n      ),\n      body: SingleChildScrollView(\n        child: Padding(\n          padding: const EdgeInsets.all(16.0),\n          child: Column(\n            crossAxisAlignment: CrossAxisAlignment.stretch,\n            children: [\n              Card(\n                elevation: 4.0,\n                margin: const EdgeInsets.symmetric(vertical: 16.0),\n                child: Padding(\n                  padding: const EdgeInsets.all(16.0),\n                  child: Column(\n                    crossAxisAlignment: CrossAxisAlignment.start,\n                    children: [\n                      const Text(\n                        'Total Prayers to Make Up',\n                        style: TextStyle(\n                          fontSize: 20.0,\n                          fontWeight: FontWeight.bold,\n                        ),\n                      ),\n                      const SizedBox(height: 16.0),\n                      LinearProgressIndicator(\n                        value: _prayerService.calculateOverallTotalPrayers() > 0\n                            ? _prayerService.overallProgress /\n                                _prayerService.calculateOverallTotalPrayers()\n                            : 0,\n                        minHeight: 24.0,\n                      ),\n                      const SizedBox(height: 8.0),\n                      Text(\n                        '${_prayerService.overallProgress} / ${_prayerService.calculateOverallTotalPrayers()}',\n                        textAlign: TextAlign.center,\n                        style: const TextStyle(fontSize: 18.0),\n                      ),\n                    ],\n                  ),\n                ),\n              ),\n              ..._prayerService.prayers.map((prayer) {\n                int totalPrayers =\n                    _prayerService.calculateTotalPrayersForPrayer(prayer);\n                int completedPrayers = _prayerService.prayerCounts[prayer] ?? 0;\n                return PrayerProgressCard(\n                  prayer: prayer,\n                  completedPrayers: completedPrayers,\n                  totalPrayers: totalPrayers,\n                  onPressed: () => _decrementPrayer(prayer),\n                );\n              }).toList(),\n              const SizedBox(height: 24.0),\n              Row(\n                mainAxisAlignment: MainAxisAlignment.spaceEvenly,\n                children: [\n                  ElevatedButton.icon(\n                    onPressed: _sharePrayerData,\n                    icon: const Icon(Icons.share),\n                    label: const Text('Share'),\n                    style: ElevatedButton.styleFrom(\n                      backgroundColor: Colors.blue,\n                      padding: const EdgeInsets.symmetric(\n                        vertical: 12.0,\n                        horizontal: 16.0,\n                      ),\n                      shape: RoundedRectangleBorder(\n                        borderRadius: BorderRadius.circular(8.0),\n                      ),\n                    ),\n                  ),\n                  ElevatedButton.icon(\n                    onPressed: () {\n                      Navigator.pushReplacement(\n                        context,\n                        MaterialPageRoute(\n                          builder: (context) => const YearSelectionScreen(),\n                        ),\n                      );\n                    },\n                    icon: const Icon(Icons.edit),\n                    label: const Text('Edit'),\n                    style: ElevatedButton.styleFrom(\n                      backgroundColor: Colors.orange,\n                      padding: const EdgeInsets.symmetric(\n                        vertical: 12.0,\n                        horizontal: 16.0,\n                      ),\n                      shape: RoundedRectangleBorder(\n                        borderRadius: BorderRadius.circular(8.0),\n                      ),\n                    ),\n                  ),\n                ],\n              ),\n              const SizedBox(height: 16.0),\n              Row(\n                mainAxisAlignment: MainAxisAlignment.end,\n                children: [\n                  IconButton(\n                    onPressed: () {\n                      showModalBottomSheet(\n                        context: context,\n                        builder: (context) => Container(\n                          padding: const EdgeInsets.all(16.0),\n                          child: Column(\n                            mainAxisSize: MainAxisSize.min,\n                            children: [\n                              ListTile(\n                                leading: const Icon(Icons.refresh),\n                                title: const Text('Start Over'),\n                                onTap: () {\n                                  Navigator.pop(context);\n                                  _resetApplication();\n                                },\n                              ),\n                            ],\n                          ),\n                        ),\n                      );\n                    },\n                    icon: const Icon(Icons.more_vert),\n                  ),\n                ],\n              ),\n              ExpansionTile(\n                title: Row(\n                  children: [\n                    const Text('Add Details'),\n                    IconButton(\n                      icon: const Icon(Icons.info),\n                      onPressed: () {\n                        showDialog(\n                          context: context,\n                          builder: (context) => AlertDialog(\n                            title: const Text('Detailed Prayer Calendar'),\n                            content: const Text(\n                                'Expand this section to review and modify the detailed prayer calendar. You can set specific percentages for each year and prayer.'),\n                            actions: [\n                              TextButton(\n                                onPressed: () => Navigator.pop(context),\n                                child: const Text('OK'),\n                              ),\n                            ],\n                          ),\n                        );\n                      },\n                    ),\n                  ],\n                ),\n                children: [\n                  Column(\n                    crossAxisAlignment: CrossAxisAlignment.stretch,\n                    children: _prayerService.prayerPercentages.entries\n                        .map((entry) {\n                      int year = entry.key;\n                      Map<String, int> prayers = entry.value;\n                      return PrayerInputCard(\n                        year: year,\n                        prayers: prayers,\n                        onChanged: (year, prayer, percentage) {\n                          setState(() {\n                            _prayerService.updatePrayerPercentage(\n                                year, prayer, percentage);\n                          });\n                        },\n                      );\n                    }).toList(),\n                  ),\n                ],\n              ),\n              const SizedBox(height: 16.0),\n              Row(\n                children: [\n                  Expanded(\n                    child: TextField(\n                      controller: _taqwaBufferController,\n                      keyboardType: TextInputType.number,\n                      decoration: const InputDecoration(\n                        labelText: 'Taqwa Buffer',\n                        hintText: 'Enter taqwa buffer percentage',\n                      ),\n                    ),\n                  ),\n                  IconButton(\n                    icon: const Icon(Icons.info),\n                    onPressed: () {\n                      showDialog(\n                        context: context,\n                        builder: (context) => AlertDialog(\n                          title: const Text('Taqwa Buffer'),\n                          content: const Text(\n                              'Enter a percentage to add as a buffer to the calculated prayer debt. This buffer is added to account for any uncertainties or missed prayers.'),\n                          actions: [\n                            TextButton(\n                              onPressed: () => Navigator.pop(context),\n                              child: const Text('OK'),\n                            ),\n                          ],\n                        ),\n                      );\n                    },\n                  ),\n                ],\n              ),\n              const SizedBox(height: 16.0),\n              ElevatedButton(\n                onPressed: _calculateTotalPrayers,\n                child: const Text('Calculate Prayer Debt'),\n              ),\n              const SizedBox(height: 16.0),\n              TextButton.icon(\n                onPressed: () {\n                  showDialog(\n                    context: context,\n                    builder: (context) => AlertDialog(\n                      title: const Text('Explanation'),\n                      content: const Text(\n                        'This app helps you track and make up your missed prayers. Enter the years and the average percentage of prayers you estimate you missed in those years. You can also set specific percentages for each prayer and year in the detailed prayer calendar. The Taqwa Buffer is an additional percentage added to account for any missed prayers. Once you calculate your prayer debt, you can track your progress and mark prayers as completed. The progress bars show your overall progress and the progress for each prayer.',\n                      ),\n                      actions: [\n                        TextButton(\n                          onPressed: () => Navigator.pop(context),\n                          child: const Text('OK'),\n                        ),\n                      ],\n                    ),\n                  );\n                },\n                icon: const Icon(Icons.info),\n                label: const Text('Explanation'),\n              ),\n            ],\n          ),\n        ),\n      ),\n    );\n  }\n}\n\n# File: ./services/shared_preferences_service.dart\n###################################################\n\n// services/shared_preferences_services.dart\nimport 'package:shared_preferences/shared_preferences.dart';\n\nclass SharedPreferencesService {\n  Future<void> saveData(String key, dynamic value) async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    if (value is int) {\n      await prefs.setInt(key, value);\n    } else if (value is String) {\n      await prefs.setString(key, value);\n    } else if (value is bool) {\n      await prefs.setBool(key, value);\n    } else if (value is double) {\n      await prefs.setDouble(key, value);\n    } else if (value is List<String>) {\n      await prefs.setStringList(key, value);\n    } else {\n      throw ArgumentError('Invalid value type');\n    }\n  }\n\n  Future<dynamic> getData(String key) async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    return prefs.get(key);\n  }\n\n  Future<void> clearData() async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    await prefs.clear();\n  }\n}\n\n# File: ./services/prayer_service.dart\n#",
            "citations": []
          }
        ],
        "updated_at": "2024-03-18T11:22:11.962440Z",
        "attachments": [],
        "files": []
      }
    }
  ]
}