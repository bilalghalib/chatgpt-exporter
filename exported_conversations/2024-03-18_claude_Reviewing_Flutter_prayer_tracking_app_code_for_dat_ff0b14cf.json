{
  "id": "ff0b14cf-4e4f-4028-8a24-b6db7dc91476",
  "source": "claude",
  "title": "Reviewing Flutter prayer tracking app code for data loading and validation",
  "created_at": "2024-03-18T23:57:42.827509Z",
  "updated_at": "2024-03-19T00:03:18.537817Z",
  "summary": "",
  "message_count": 4,
  "messages": [
    {
      "id": "fe972c54-7fa1-4b84-931c-d4463f3cf7bf",
      "role": "human",
      "content": "",
      "created_at": "2024-03-18T23:59:12.818492Z",
      "sequence_order": 0,
      "metadata": {
        "content": [
          {
            "start_timestamp": "2024-03-18T23:59:12.818492Z",
            "stop_timestamp": "2024-03-18T23:59:12.818492Z",
            "flags": null,
            "type": "text",
            "text": "",
            "citations": []
          }
        ],
        "updated_at": "2024-03-18T23:59:12.818492Z",
        "attachments": [
          {
            "file_name": "paste.txt",
            "file_size": 23967,
            "file_type": "txt",
            "extracted_content": "review 3 ways to address this issue:\n\nPerforming hot restart...                                               \nRestarted application in 875ms.\nflutter: Loaded prayer data: {Fajr: 407, Dhuhr: 365, Asr: 365, Maghrib: 365, Isha: 365}\nflutter: Loaded prayer data: {Fajr: 407, Dhuhr: 365, Asr: 365, Maghrib: 365, Isha: 365}\n\n══╡ EXCEPTION CAUGHT BY WIDGETS LIBRARY ╞═══════════════════════════════════════════════════════════\nThe following FormatException was thrown building FutureBuilder<void>(dirty, state:\n_FutureBuilderState<void>#5487a):\nInvalid radix-10 number (at character 1)\nInstance of 'Future<dynamic>'\n^\n\nThe relevant error-causing widget was:\n  FutureBuilder<void>\n  FutureBuilder:file:///Users/bilalghalib/Projects/amana_audit/lib/screens/home_screen.dart:32:12\n\nWhen the exception was thrown, this was the stack:\n#0      int._handleFormatError (dart:core-patch/integers_patch.dart:126:5)\n#1      int._parseRadix (dart:core-patch/integers_patch.dart:152:16)\n#2      int._parse (dart:core-patch/integers_patch.dart:98:12)\n#3      int.parse (dart:core-patch/integers_patch.dart:60:12)\n#4      _HomeScreenState._buildPrayerProgressList (package:amana_audit/screens/home_screen.dart:88:25)\n#5      _HomeScreenState._buildUI (package:amana_audit/screens/home_screen.dart:67:18)\nin this code:\n\n\n# File: ./main.dart\n####################\n\n// main.dart\nimport 'package:flutter/material.dart';\nimport 'screens/home_screen.dart';\nimport 'services/shared_preferences_service.dart';\nimport 'screens/year_selection_screen.dart';\nimport 'services/prayer_service.dart';\n\nvoid main() async {\n  WidgetsFlutterBinding.ensureInitialized();\n  final prefsService = SharedPreferencesService();\n  final prayerService = PrayerService();\n  var showYearSelection =\n      await prefsService.getData('showYearSelection') ?? true;\n\n  runApp(AmanaAuditApp(\n    showYearSelection: showYearSelection,\n    prayerService: prayerService,\n  ));\n}\n\nclass AmanaAuditApp extends StatelessWidget {\n  final bool showYearSelection;\n  final PrayerService prayerService;\n\n  const AmanaAuditApp({\n    Key? key,\n    required this.showYearSelection,\n    required this.prayerService,\n  }) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      title: 'Amana Audit',\n      theme: ThemeData(\n        primarySwatch: Colors.blue,\n      ),\n      home: showYearSelection\n          ? YearSelectionScreen(prayerService: prayerService)\n          : HomeScreen(prayerService: prayerService),\n    );\n  }\n}\n\n\n\n# File: ./providers/year_selection_provider.dart\n#################################################\n\n// providers/year_selection_provider.dart\nimport 'package:flutter/material.dart';\nimport '../services/prayer_service.dart';\n\nclass YearSelectionProvider with ChangeNotifier {\n  final PrayerService prayerService;\n  final TextEditingController startYearController;\n  final TextEditingController endYearController;\n  final TextEditingController averagePercentageController;\n  final TextEditingController taqwaBufferController;\n\n  YearSelectionProvider({required this.prayerService})\n      : startYearController = TextEditingController(text: '2022'),\n        endYearController = TextEditingController(text: '2023'),\n        averagePercentageController = TextEditingController(text: '50'),\n        taqwaBufferController = TextEditingController(text: '5');\n\n  void saveAndInitializePrayerData() {\n    int startYear =\n        int.tryParse(startYearController.text) ?? DateTime.now().year;\n    int endYear = int.tryParse(endYearController.text) ?? DateTime.now().year;\n    int averagePercentageMissed =\n        int.tryParse(averagePercentageController.text) ?? 0;\n    int taqwaBuffer = int.tryParse(taqwaBufferController.text) ?? 0;\n\n    prayerService.preferencesService.saveData('startYear', startYear);\n    prayerService.preferencesService.saveData('endYear', endYear);\n    prayerService.preferencesService\n        .saveData('averagePercentageMissed', averagePercentageMissed);\n    prayerService.preferencesService.saveData('taqwaBuffer', taqwaBuffer);\n\n    prayerService.calculateTotalPrayers(\n        startYear, endYear, averagePercentageMissed, taqwaBuffer);\n\n    notifyListeners();\n  }\n}\n\n\n\n# File: ./screens/year_selection_screen.dart\n#############################################\n\n// screens/year_selection_screen.dart\nimport 'package:flutter/material.dart';\nimport '../providers/year_selection_provider.dart';\nimport '../services/prayer_service.dart';\nimport 'home_screen.dart';\n\nclass YearSelectionScreen extends StatefulWidget {\n  final PrayerService prayerService;\n\n  const YearSelectionScreen({Key? key, required this.prayerService})\n      : super(key: key);\n\n  @override\n  State<YearSelectionScreen> createState() => _YearSelectionScreenState();\n}\n\nclass _YearSelectionScreenState extends State<YearSelectionScreen> {\n  late final YearSelectionProvider _provider;\n  late final TextEditingController _startYearController;\n  late final TextEditingController _endYearController;\n  late final TextEditingController _averagePercentageController;\n  late final TextEditingController _taqwaBufferController;\n\n  @override\n  void initState() {\n    super.initState();\n    _provider = YearSelectionProvider(prayerService: widget.prayerService);\n    _startYearController = _provider.startYearController;\n    _endYearController = _provider.endYearController;\n    _averagePercentageController = _provider.averagePercentageController;\n    _taqwaBufferController = _provider.taqwaBufferController;\n  }\n\n  void _navigateToHomeScreen() async {\n    _provider.saveAndInitializePrayerData();\n    await widget.prayerService.preferencesService\n        .saveData('showYearSelection', false);\n    Navigator.pushReplacement(\n      context,\n      MaterialPageRoute(\n        builder: (context) => HomeScreen(prayerService: widget.prayerService),\n      ),\n    );\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Year Selection'),\n      ),\n      body: SingleChildScrollView(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          children: [\n            _buildTextField(_startYearController, 'Start Year',\n                _validateYear(_startYearController.text)),\n            const SizedBox(height: 8),\n            _buildTextField(_endYearController, 'End Year',\n                _validateYear(_endYearController.text)),\n            const SizedBox(height: 8),\n            _buildTextField(_averagePercentageController, 'Average % Missed',\n                _validatePercentage(_averagePercentageController.text)),\n            const SizedBox(height: 8),\n            _buildTextField(_taqwaBufferController, 'Taqwa Buffer %',\n                _validatePercentage(_taqwaBufferController.text)),\n            const SizedBox(height: 20),\n            ElevatedButton(\n              onPressed: _navigateToHomeScreen,\n              child: const Text('Save Data'),\n            ),\n            const SizedBox(height: 10),\n            ElevatedButton(\n              onPressed: _navigateToHomeScreen,\n              child: const Text('Next'),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n\n  Widget _buildTextField(\n      TextEditingController controller, String label, String? errorText) {\n    return TextField(\n      controller: controller,\n      keyboardType: TextInputType.number,\n      decoration: InputDecoration(\n        labelText: label,\n        border: const OutlineInputBorder(),\n        errorText: errorText,\n      ),\n    );\n  }\n\n  String? _validateYear(String value) {\n    if (value.length != 4) return 'Enter a valid year';\n    return null;\n  }\n\n  String? _validatePercentage(String value) {\n    if (value.isEmpty ||\n        int.tryParse(value) == null ||\n        int.parse(value) < 0 ||\n        int.parse(value) > 100) {\n      return 'Enter a value between 0 and 100';\n    }\n    return null;\n  }\n}\n\n\n\n# File: ./screens/home_screen.dart\n###################################\n\n// screens/home_screen.dart\nimport 'package:flutter/material.dart';\nimport '../services/prayer_service.dart';\nimport '../screens/year_selection_screen.dart';\nimport '../widgets/prayer_progress_card.dart';\n\nclass HomeScreen extends StatefulWidget {\n  final PrayerService prayerService;\n\n  const HomeScreen({Key? key, required this.prayerService}) : super(key: key);\n\n  @override\n  _HomeScreenState createState() => _HomeScreenState();\n}\n\nclass _HomeScreenState extends State<HomeScreen> {\n  late final PrayerService _prayerService;\n\n  @override\n  void initState() {\n    super.initState();\n    _prayerService = widget.prayerService;\n    _loadInitialData();\n  }\n\n  Future<void> _loadInitialData() async {\n    await _prayerService.loadSavedData();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return FutureBuilder(\n      future: _loadInitialData(),\n      builder: (context, snapshot) {\n        if (snapshot.connectionState == ConnectionState.waiting) {\n          return Scaffold(\n            appBar: AppBar(\n              title: const Text('Amana Audit'),\n            ),\n            body: Center(child: CircularProgressIndicator()),\n          );\n        } else if (snapshot.hasError) {\n          return Scaffold(\n            appBar: AppBar(\n              title: const Text('Amana Audit'),\n            ),\n            body: Center(child: Text('Error: ${snapshot.error}')),\n          );\n        } else {\n          return _buildUI();\n        }\n      },\n    );\n  }\n\n  Widget _buildUI() {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Amana Audit'),\n      ),\n      body: SingleChildScrollView(\n        child: Padding(\n          padding: const EdgeInsets.all(16.0),\n          child: Column(\n            crossAxisAlignment: CrossAxisAlignment.stretch,\n            children: [\n              ..._buildPrayerProgressList(),\n              ElevatedButton(\n                onPressed: _resetApplication,\n                child: const Text('Start Over'),\n              ),\n              ElevatedButton(\n                onPressed: _sharePrayerData,\n                child: const Text('Share'),\n              ),\n            ],\n          ),\n        ),\n      ),\n    );\n  }\n\n  List<Widget> _buildPrayerProgressList() {\n    String startYearString =\n        _prayerService.preferencesService.getData('startYear').toString();\n    String endYearString =\n        _prayerService.preferencesService.getData('endYear').toString();\n    int startYear = int.parse(startYearString);\n    int endYear = int.parse(endYearString);\n\n    int totalYears = endYear - startYear + 1;\n    int daysInYear = 365;\n    int totalPrayersPerType = totalYears * daysInYear;\n\n    return _prayerService.prayers.map<Widget>((prayer) {\n      int missedPrayers = _prayerService.prayerMissedCounts[prayer] ?? 0;\n      return PrayerProgressCard(\n        prayer: prayer,\n        completedPrayers: totalPrayersPerType - missedPrayers,\n        totalPrayers: totalPrayersPerType,\n        onPressed: () {\n          if (missedPrayers > 0) {\n            _prayerService.incrementPrayer(prayer);\n            setState(() {});\n          }\n        },\n      );\n    }).toList();\n  }\n\n  void _resetApplication() async {\n    bool resetSuccessful = await _prayerService.resetApplication();\n    if (resetSuccessful) {\n      await _prayerService.preferencesService\n          .saveData('showYearSelection', true);\n      Navigator.pushReplacement(\n        context,\n        MaterialPageRoute(\n            builder: (context) =>\n                YearSelectionScreen(prayerService: _prayerService)),\n      );\n    } else {\n      // Handle the error or notify the user\n    }\n  }\n\n  void _sharePrayerData() {\n    _prayerService.sharePrayerData();\n  }\n}\n\n\n\n# File: ./lib/screens/home_screen.dart\n#######################################\n\n\n\n\n# File: ./lib/services/prayer_service.dart\n###########################################\n\n\n\n\n# File: ./services/shared_preferences_service.dart\n###################################################\n\n// services/shared_preferences_service.dart\nimport 'package:shared_preferences/shared_preferences.dart';\nimport 'dart:convert';\n\nclass SharedPreferencesService {\n  Future<void> saveData(String key, dynamic value) async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    if (value is int) {\n      await prefs.setInt(key, value);\n    } else if (value is String) {\n      await prefs.setString(key, value);\n    } else if (value is bool) {\n      await prefs.setBool(key, value);\n    } else if (value is double) {\n      await prefs.setDouble(key, value);\n    } else if (value is List<String>) {\n      await prefs.setStringList(key, value);\n    } else if (value is Map) {\n      String jsonString = jsonEncode(value);\n      await prefs.setString(key, jsonString);\n    } else {\n      throw ArgumentError('Invalid value type');\n    }\n  }\n\n  Future<dynamic> getData(String key) async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    var value = prefs.get(key);\n\n    if (value is String) {\n      try {\n        return jsonDecode(value); // Attempt to decode JSON\n      } catch (e) {\n        // If decoding fails, return the string value\n        return value;\n      }\n    }\n    return value; // Return the value as it is for other data types\n  }\n\n  Future<void> clearData() async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    await prefs.clear();\n  }\n}\n\n\n\n# File: ./services/prayer_service.dart\n#######################################\n\n// services/prayer_service.dart\nimport 'dart:convert';\nimport 'package:flutter/material.dart';\nimport 'shared_preferences_service.dart';\nimport 'package:share_plus/share_plus.dart';\n\nclass PrayerService {\n  final SharedPreferencesService _preferencesService =\n      SharedPreferencesService();\n  final List<String> prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];\n  Map<String, int> prayerMissedCounts = {};\n\n  SharedPreferencesService get preferencesService => _preferencesService;\n\n  Future<void> loadSavedData() async {\n    var prayerDataJson = await _preferencesService.getData('prayerData');\n    if (prayerDataJson is String) {\n      Map<String, dynamic> prayerData = jsonDecode(prayerDataJson);\n      prayerMissedCounts =\n          prayerData.map((key, value) => MapEntry(key, value as int));\n    } else if (prayerDataJson is Map) {\n      prayerMissedCounts = Map<String, int>.from(prayerDataJson);\n    }\n    print('Loaded prayer data: $prayerMissedCounts');\n  }\n\n  void savePrayerData() {\n    var prayerData = jsonEncode(prayerMissedCounts);\n    _preferencesService.saveData('prayerData', prayerData);\n  }\n\n  void calculateTotalPrayers(\n      int startYear, int endYear, int percentageMissed, int taqwaBuffer) {\n    int totalYears = endYear - startYear + 1;\n    int daysInYear = 365; // Adjust for leap years if necessary\n\n    int totalPrayersForEach = totalYears * daysInYear;\n    int missedPrayersForEach = (totalPrayersForEach * percentageMissed) ~/ 100;\n    int adjustedMissedPrayersForEach =\n        (missedPrayersForEach * (100 + taqwaBuffer)) ~/ 100;\n\n    for (String prayer in prayers) {\n      prayerMissedCounts[prayer] = adjustedMissedPrayersForEach;\n    }\n\n    savePrayerData();\n  }\n\n  void incrementPrayer(String prayer) {\n    int currentPrayed = prayerMissedCounts[prayer] ?? 0;\n    int newPrayedCount = currentPrayed + 1;\n\n    prayerMissedCounts[prayer] = newPrayedCount;\n    savePrayerData();\n  }\n\n  void sharePrayerData() {\n    String shareText = 'My Prayer Progress:\\n\\n';\n    for (String prayer in prayers) {\n      int missedPrayers = prayerMissedCounts[prayer] ?? 0;\n      shareText += '$prayer: Missed $missedPrayers times\\n';\n    }\n    Share.share(shareText);\n  }\n\n  Future<bool> resetApplication() async {\n    try {\n      prayerMissedCounts.clear();\n      await _preferencesService.clearData();\n      return true;\n    } catch (e) {\n      print(\"Error resetting application: $e\");\n      return false;\n    }\n  }\n}\n\n\n\n# File: ./widgets/prayer_input_card.dart\n#########################################\n\nimport 'package:flutter/material.dart';\n\nclass PrayerInputCard extends StatelessWidget {\n  final int year;\n  final Map<String, int> prayers;\n  final Function(int, String, int) onChanged;\n\n  const PrayerInputCard({\n    Key? key,\n    required this.year,\n    required this.prayers,\n    required this.onChanged,\n  }) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return Card(\n      margin: const EdgeInsets.symmetric(vertical: 8.0),\n      child: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.start,\n          children: [\n            Text(\n              'Year: $year',\n              style: const TextStyle(\n                fontSize: 18.0,\n                fontWeight: FontWeight.bold,\n              ),\n            ),\n            const SizedBox(height: 8.0),\n            ...prayers.entries.map((entry) {\n              String prayer = entry.key;\n              int percentage = entry.value;\n              int completedPrayers = (365 * (100 - percentage) ~/ 100);\n              int totalPrayers = 365;\n              return Column(\n                children: [\n                  Row(\n                    children: [\n                      Expanded(\n                        child: Text('$prayer:'),\n                      ),\n                      const SizedBox(width: 8.0),\n                      Expanded(\n                        child: TextField(\n                          keyboardType: TextInputType.number,\n                          controller: TextEditingController(text: '$percentage'),\n                          onChanged: (value) {\n                            onChanged(year, prayer, int.tryParse(value) ?? 0);\n                          },\n                          decoration: const InputDecoration(\n                            hintText: 'Percentage',\n                          ),\n                        ),\n                      ),\n                    ],\n                  ),\n                  const SizedBox(height: 8.0),\n                  Text('$completedPrayers / $totalPrayers'),\n                ],\n              );\n            }).toList(),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n// widgets/prayer_progress_card.dart\nimport 'package:flutter/material.dart';\n\nclass PrayerProgressCard extends StatelessWidget {\n  final String prayer;\n  final int completedPrayers;\n  final int totalPrayers;\n  final VoidCallback onPressed;\n\n  const PrayerProgressCard({\n    Key? key,\n    required this.prayer,\n    required this.completedPrayers,\n    required this.totalPrayers,\n    required this.onPressed,\n  }) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return Card(\n      elevation: 2.0,\n      margin: const EdgeInsets.symmetric(vertical: 8.0),\n      child: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.start,\n          children: [\n            Row(\n              mainAxisAlignment: MainAxisAlignment.spaceBetween,\n              children: [\n                Text(\n                  prayer,\n                  style: const TextStyle(\n                    fontSize: 20.0,\n                    fontWeight: FontWeight.bold,\n                  ),\n                ),\n                Text(\n                  '$completedPrayers',\n                  style: const TextStyle(fontSize: 18.0),\n                ),\n                const SizedBox(height: 8.0),\n                Text(\n                  '/ ${totalPrayers - completedPrayers}',\n                  style: const TextStyle(fontSize: 18.0),\n                ),\n              ],\n            ),\n            const SizedBox(height: 16.0),\n            ClipRRect(\n              borderRadius: BorderRadius.circular(10.0),\n              child: LinearProgressIndicator(\n                value: totalPrayers > 0 ? completedPrayers / totalPrayers : 0,\n                minHeight: 20.0,\n                backgroundColor: Colors.grey[300],\n                valueColor: const AlwaysStoppedAnimation<Color>(Colors.green),\n                semanticsLabel: 'Progress',\n                semanticsValue:\n                    '${(completedPrayers / totalPrayers * 100).toStringAsFixed(0)}%',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            ElevatedButton(\n              onPressed: completedPrayers < totalPrayers ? onPressed : null,\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.green,\n                padding: const EdgeInsets.symmetric(\n                  vertical: 16.0,\n                  horizontal: 24.0,\n                ),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(8.0),\n                ),\n              ),\n              child: Text(\n                'Prayed $prayer',\n                style: const TextStyle(fontSize: 18.0),\n              ),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n\n# File: ./widgets/prayer_progress_card.dart\n############################################\n\n//prayer_progress_card.dart\nimport 'package:flutter/material.dart';\n\nclass PrayerProgressCard extends StatelessWidget {\n  final String prayer;\n  final int completedPrayers;\n  final int totalPrayers;\n  final VoidCallback onPressed;\n\n  const PrayerProgressCard({\n    Key? key,\n    required this.prayer,\n    required this.completedPrayers,\n    required this.totalPrayers,\n    required this.onPressed,\n  }) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return Card(\n      elevation: 2.0,\n      margin: const EdgeInsets.symmetric(vertical: 8.0),\n      child: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.start,\n          children: [\n            Row(\n              mainAxisAlignment: MainAxisAlignment.spaceBetween,\n              children: [\n                Text(\n                  prayer,\n                  style: const TextStyle(\n                    fontSize: 20.0,\n                    fontWeight: FontWeight.bold,\n                  ),\n                ),\n                Text(\n                  '$completedPrayers',\n                  style: const TextStyle(fontSize: 18.0),\n                ),\n                const SizedBox(height: 8.0),\n                Text(\n                  '/ $totalPrayers',\n                  style: const TextStyle(fontSize: 18.0),\n                ),\n              ],\n            ),\n            const SizedBox(height: 16.0),\n            ClipRRect(\n              borderRadius: BorderRadius.circular(10.0),\n              child: LinearProgressIndicator(\n                value: totalPrayers > 0 ? completedPrayers / totalPrayers : 0,\n                minHeight: 20.0,\n                backgroundColor: Colors.grey[300],\n                valueColor: const AlwaysStoppedAnimation<Color>(Colors.green),\n                semanticsLabel: 'Progress',\n                semanticsValue:\n                    '${(completedPrayers / totalPrayers * 100).toStringAsFixed(0)}%',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            ElevatedButton(\n              onPressed: completedPrayers < totalPrayers ? onPressed : null,\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.green,\n                padding: const EdgeInsets.symmetric(\n                  vertical: 16.0,\n                  horizontal: 24.0,\n                ),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(8.0),\n                ),\n              ),\n              child: Text(\n                'Prayed $prayer',\n                style: const TextStyle(fontSize: 18.0),\n              ),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\ndetermine what the code does, it’s objectives and simplify whereever you can"
          }
        ],
        "files": [
          {
            "file_name": "paste.txt"
          }
        ]
      }
    },
    {
      "id": "9d75a4b9-d510-4309-ab1c-cabd0ab2972d",
      "role": "assistant",
      "content": " Here are three ways to address the issue:\n\n1. Ensure the data loaded from shared preferences is of the correct type before parsing.\n\nIn the `_buildPrayerProgressList` method of the `_HomeScreenState` class, you are parsing the `startYear` and `endYear` values as integers using `int.parse`. However, it seems that the values retrieved from shared preferences are of type `Future<dynamic>` instead of `String`.\n\nTo fix this, you can await the `getData` calls to ensure you have the actual values before parsing them. Modify the code as follows:\n\n```dart\nList<Widget> _buildPrayerProgressList() async {\n  var startYearValue = await _prayerService.preferencesService.getData('startYear');\n  var endYearValue = await _prayerService.preferencesService.getData('endYear');\n  \n  if (startYearValue is int && endYearValue is int) {\n    int startYear = startYearValue;\n    int endYear = endYearValue;\n\n    // Rest of the code...\n  } else {\n    // Handle the case when the values are not of the expected type\n    // You can display an error message or take appropriate action\n  }\n  \n  // Rest of the code...\n}\n```\n\n2. Handle null or invalid values gracefully.\n\nIn case the `startYear` or `endYear` values are null or not of the expected type, you can handle them gracefully by providing default values or displaying an error message to the user.\n\nModify the code in the `_buildPrayerProgressList` method as follows:\n\n```dart\nList<Widget> _buildPrayerProgressList() async {\n  var startYearValue = await _prayerService.preferencesService.getData('startYear');\n  var endYearValue = await _prayerService.preferencesService.getData('endYear');\n  \n  int startYear = startYearValue is int ? startYearValue : DateTime.now().year;\n  int endYear = endYearValue is int ? endYearValue : DateTime.now().year;\n\n  // Rest of the code...\n}\n```\n\nIn this case, if the values are not of type `int`, default values (e.g., the current year) are used.\n\n3. Validate and sanitize user input.\n\nWhen saving the `startYear` and `endYear` values from the `YearSelectionScreen`, ensure that the user input is validated and sanitized before storing them in shared preferences.\n\nIn the `saveAndInitializePrayerData` method of the `YearSelectionProvider` class, you can add validation checks for the year values. For example:\n\n```dart\nvoid saveAndInitializePrayerData() {\n  int startYear = int.tryParse(startYearController.text) ?? DateTime.now().year;\n  int endYear = int.tryParse(endYearController.text) ?? DateTime.now().year;\n\n  if (startYear <= 0 || endYear <= 0 || startYear > endYear) {\n    // Handle invalid input, display an error message to the user\n    return;\n  }\n\n  // Rest of the code...\n}\n```\n\nThis ensures that the `startYear` and `endYear` values are valid before saving them to shared preferences.\n\nBy implementing these modifications, you can handle the `FormatException` and ensure that the prayer data is loaded and parsed correctly.\n\nAdditionally, I would recommend reviewing the overall architecture and data flow of your app to ensure that data is being managed and passed between screens and services in a consistent and reliable manner. Proper error handling and data validation should be implemented throughout the app to provide a smooth user experience.",
      "created_at": "2024-03-18T23:59:12.818492Z",
      "sequence_order": 1,
      "metadata": {
        "content": [
          {
            "start_timestamp": "2024-03-18T23:59:12.818492Z",
            "stop_timestamp": "2024-03-18T23:59:12.818492Z",
            "flags": null,
            "type": "text",
            "text": " Here are three ways to address the issue:\n\n1. Ensure the data loaded from shared preferences is of the correct type before parsing.\n\nIn the `_buildPrayerProgressList` method of the `_HomeScreenState` class, you are parsing the `startYear` and `endYear` values as integers using `int.parse`. However, it seems that the values retrieved from shared preferences are of type `Future<dynamic>` instead of `String`.\n\nTo fix this, you can await the `getData` calls to ensure you have the actual values before parsing them. Modify the code as follows:\n\n```dart\nList<Widget> _buildPrayerProgressList() async {\n  var startYearValue = await _prayerService.preferencesService.getData('startYear');\n  var endYearValue = await _prayerService.preferencesService.getData('endYear');\n  \n  if (startYearValue is int && endYearValue is int) {\n    int startYear = startYearValue;\n    int endYear = endYearValue;\n\n    // Rest of the code...\n  } else {\n    // Handle the case when the values are not of the expected type\n    // You can display an error message or take appropriate action\n  }\n  \n  // Rest of the code...\n}\n```\n\n2. Handle null or invalid values gracefully.\n\nIn case the `startYear` or `endYear` values are null or not of the expected type, you can handle them gracefully by providing default values or displaying an error message to the user.\n\nModify the code in the `_buildPrayerProgressList` method as follows:\n\n```dart\nList<Widget> _buildPrayerProgressList() async {\n  var startYearValue = await _prayerService.preferencesService.getData('startYear');\n  var endYearValue = await _prayerService.preferencesService.getData('endYear');\n  \n  int startYear = startYearValue is int ? startYearValue : DateTime.now().year;\n  int endYear = endYearValue is int ? endYearValue : DateTime.now().year;\n\n  // Rest of the code...\n}\n```\n\nIn this case, if the values are not of type `int`, default values (e.g., the current year) are used.\n\n3. Validate and sanitize user input.\n\nWhen saving the `startYear` and `endYear` values from the `YearSelectionScreen`, ensure that the user input is validated and sanitized before storing them in shared preferences.\n\nIn the `saveAndInitializePrayerData` method of the `YearSelectionProvider` class, you can add validation checks for the year values. For example:\n\n```dart\nvoid saveAndInitializePrayerData() {\n  int startYear = int.tryParse(startYearController.text) ?? DateTime.now().year;\n  int endYear = int.tryParse(endYearController.text) ?? DateTime.now().year;\n\n  if (startYear <= 0 || endYear <= 0 || startYear > endYear) {\n    // Handle invalid input, display an error message to the user\n    return;\n  }\n\n  // Rest of the code...\n}\n```\n\nThis ensures that the `startYear` and `endYear` values are valid before saving them to shared preferences.\n\nBy implementing these modifications, you can handle the `FormatException` and ensure that the prayer data is loaded and parsed correctly.\n\nAdditionally, I would recommend reviewing the overall architecture and data flow of your app to ensure that data is being managed and passed between screens and services in a consistent and reliable manner. Proper error handling and data validation should be implemented throughout the app to provide a smooth user experience.",
            "citations": []
          }
        ],
        "updated_at": "2024-03-18T23:59:12.818492Z",
        "attachments": [],
        "files": []
      }
    },
    {
      "id": "9b47977b-d947-4aaa-a2ea-a2be7e0ed6fa",
      "role": "human",
      "content": "Please review the overall architecture and data flow of your app to ensure that data is being managed and passed between screens and services in a consistent and reliable manner. Proper error handling and data validation should be implemented throughout the app to provide a smooth user experience.\n\nReturn any changes as the entire file returned in one prompt with all the functions implemented so i can copy and paste at one time, reminder of the code:",
      "created_at": "2024-03-19T00:03:18.537817Z",
      "sequence_order": 2,
      "metadata": {
        "content": [
          {
            "start_timestamp": "2024-03-19T00:03:18.537817Z",
            "stop_timestamp": "2024-03-19T00:03:18.537817Z",
            "flags": null,
            "type": "text",
            "text": "Please review the overall architecture and data flow of your app to ensure that data is being managed and passed between screens and services in a consistent and reliable manner. Proper error handling and data validation should be implemented throughout the app to provide a smooth user experience.\n\nReturn any changes as the entire file returned in one prompt with all the functions implemented so i can copy and paste at one time, reminder of the code:",
            "citations": []
          }
        ],
        "updated_at": "2024-03-19T00:03:18.537817Z",
        "attachments": [
          {
            "file_name": "combined_files.txt",
            "file_size": 22466,
            "file_type": "text/plain",
            "extracted_content": "\n\n# File: ./main.dart\n####################\n\n// main.dart\nimport 'package:flutter/material.dart';\nimport 'screens/home_screen.dart';\nimport 'services/shared_preferences_service.dart';\nimport 'screens/year_selection_screen.dart';\nimport 'services/prayer_service.dart';\n\nvoid main() async {\n  WidgetsFlutterBinding.ensureInitialized();\n  final prefsService = SharedPreferencesService();\n  final prayerService = PrayerService();\n  var showYearSelection =\n      await prefsService.getData('showYearSelection') ?? true;\n\n  runApp(AmanaAuditApp(\n    showYearSelection: showYearSelection,\n    prayerService: prayerService,\n  ));\n}\n\nclass AmanaAuditApp extends StatelessWidget {\n  final bool showYearSelection;\n  final PrayerService prayerService;\n\n  const AmanaAuditApp({\n    Key? key,\n    required this.showYearSelection,\n    required this.prayerService,\n  }) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      title: 'Amana Audit',\n      theme: ThemeData(\n        primarySwatch: Colors.blue,\n      ),\n      home: showYearSelection\n          ? YearSelectionScreen(prayerService: prayerService)\n          : HomeScreen(prayerService: prayerService),\n    );\n  }\n}\n\n\n\n# File: ./providers/year_selection_provider.dart\n#################################################\n\n// providers/year_selection_provider.dart\nimport 'package:flutter/material.dart';\nimport '../services/prayer_service.dart';\n\nclass YearSelectionProvider with ChangeNotifier {\n  final PrayerService prayerService;\n  final TextEditingController startYearController;\n  final TextEditingController endYearController;\n  final TextEditingController averagePercentageController;\n  final TextEditingController taqwaBufferController;\n\n  YearSelectionProvider({required this.prayerService})\n      : startYearController = TextEditingController(text: '2022'),\n        endYearController = TextEditingController(text: '2023'),\n        averagePercentageController = TextEditingController(text: '50'),\n        taqwaBufferController = TextEditingController(text: '5');\n\n  void saveAndInitializePrayerData() {\n    int startYear =\n        int.tryParse(startYearController.text) ?? DateTime.now().year;\n    int endYear = int.tryParse(endYearController.text) ?? DateTime.now().year;\n    int averagePercentageMissed =\n        int.tryParse(averagePercentageController.text) ?? 0;\n    int taqwaBuffer = int.tryParse(taqwaBufferController.text) ?? 0;\n\n    prayerService.preferencesService.saveData('startYear', startYear);\n    prayerService.preferencesService.saveData('endYear', endYear);\n    prayerService.preferencesService\n        .saveData('averagePercentageMissed', averagePercentageMissed);\n    prayerService.preferencesService.saveData('taqwaBuffer', taqwaBuffer);\n\n    prayerService.calculateTotalPrayers(\n        startYear, endYear, averagePercentageMissed, taqwaBuffer);\n\n    notifyListeners();\n  }\n}\n\n\n\n# File: ./screens/year_selection_screen.dart\n#############################################\n\n// screens/year_selection_screen.dart\nimport 'package:flutter/material.dart';\nimport '../providers/year_selection_provider.dart';\nimport '../services/prayer_service.dart';\nimport 'home_screen.dart';\n\nclass YearSelectionScreen extends StatefulWidget {\n  final PrayerService prayerService;\n\n  const YearSelectionScreen({Key? key, required this.prayerService})\n      : super(key: key);\n\n  @override\n  State<YearSelectionScreen> createState() => _YearSelectionScreenState();\n}\n\nclass _YearSelectionScreenState extends State<YearSelectionScreen> {\n  late final YearSelectionProvider _provider;\n  late final TextEditingController _startYearController;\n  late final TextEditingController _endYearController;\n  late final TextEditingController _averagePercentageController;\n  late final TextEditingController _taqwaBufferController;\n\n  @override\n  void initState() {\n    super.initState();\n    _provider = YearSelectionProvider(prayerService: widget.prayerService);\n    _startYearController = _provider.startYearController;\n    _endYearController = _provider.endYearController;\n    _averagePercentageController = _provider.averagePercentageController;\n    _taqwaBufferController = _provider.taqwaBufferController;\n  }\n\n  void _navigateToHomeScreen() async {\n    _provider.saveAndInitializePrayerData();\n    await widget.prayerService.preferencesService\n        .saveData('showYearSelection', false);\n    Navigator.pushReplacement(\n      context,\n      MaterialPageRoute(\n        builder: (context) => HomeScreen(prayerService: widget.prayerService),\n      ),\n    );\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Year Selection'),\n      ),\n      body: SingleChildScrollView(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          children: [\n            _buildTextField(_startYearController, 'Start Year',\n                _validateYear(_startYearController.text)),\n            const SizedBox(height: 8),\n            _buildTextField(_endYearController, 'End Year',\n                _validateYear(_endYearController.text)),\n            const SizedBox(height: 8),\n            _buildTextField(_averagePercentageController, 'Average % Missed',\n                _validatePercentage(_averagePercentageController.text)),\n            const SizedBox(height: 8),\n            _buildTextField(_taqwaBufferController, 'Taqwa Buffer %',\n                _validatePercentage(_taqwaBufferController.text)),\n            const SizedBox(height: 20),\n            ElevatedButton(\n              onPressed: _navigateToHomeScreen,\n              child: const Text('Save Data'),\n            ),\n            const SizedBox(height: 10),\n            ElevatedButton(\n              onPressed: _navigateToHomeScreen,\n              child: const Text('Next'),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n\n  Widget _buildTextField(\n      TextEditingController controller, String label, String? errorText) {\n    return TextField(\n      controller: controller,\n      keyboardType: TextInputType.number,\n      decoration: InputDecoration(\n        labelText: label,\n        border: const OutlineInputBorder(),\n        errorText: errorText,\n      ),\n    );\n  }\n\n  String? _validateYear(String value) {\n    if (value.length != 4) return 'Enter a valid year';\n    return null;\n  }\n\n  String? _validatePercentage(String value) {\n    if (value.isEmpty ||\n        int.tryParse(value) == null ||\n        int.parse(value) < 0 ||\n        int.parse(value) > 100) {\n      return 'Enter a value between 0 and 100';\n    }\n    return null;\n  }\n}\n\n\n\n# File: ./screens/home_screen.dart\n###################################\n\n// screens/home_screen.dart\nimport 'package:flutter/material.dart';\nimport '../services/prayer_service.dart';\nimport '../screens/year_selection_screen.dart';\nimport '../widgets/prayer_progress_card.dart';\n\nclass HomeScreen extends StatefulWidget {\n  final PrayerService prayerService;\n\n  const HomeScreen({Key? key, required this.prayerService}) : super(key: key);\n\n  @override\n  _HomeScreenState createState() => _HomeScreenState();\n}\n\nclass _HomeScreenState extends State<HomeScreen> {\n  late final PrayerService _prayerService;\n\n  @override\n  void initState() {\n    super.initState();\n    _prayerService = widget.prayerService;\n    _loadInitialData();\n  }\n\n  Future<void> _loadInitialData() async {\n    await _prayerService.loadSavedData();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return FutureBuilder(\n      future: _loadInitialData(),\n      builder: (context, snapshot) {\n        if (snapshot.connectionState == ConnectionState.waiting) {\n          return Scaffold(\n            appBar: AppBar(\n              title: const Text('Amana Audit'),\n            ),\n            body: Center(child: CircularProgressIndicator()),\n          );\n        } else if (snapshot.hasError) {\n          return Scaffold(\n            appBar: AppBar(\n              title: const Text('Amana Audit'),\n            ),\n            body: Center(child: Text('Error: ${snapshot.error}')),\n          );\n        } else {\n          return _buildUI();\n        }\n      },\n    );\n  }\n\n  Widget _buildUI() {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Amana Audit'),\n      ),\n      body: SingleChildScrollView(\n        child: Padding(\n          padding: const EdgeInsets.all(16.0),\n          child: Column(\n            crossAxisAlignment: CrossAxisAlignment.stretch,\n            children: [\n              ..._buildPrayerProgressList(),\n              ElevatedButton(\n                onPressed: _resetApplication,\n                child: const Text('Start Over'),\n              ),\n              ElevatedButton(\n                onPressed: _sharePrayerData,\n                child: const Text('Share'),\n              ),\n            ],\n          ),\n        ),\n      ),\n    );\n  }\n\n  List<Widget> _buildPrayerProgressList() {\n    String startYearString =\n        _prayerService.preferencesService.getData('startYear').toString();\n    String endYearString =\n        _prayerService.preferencesService.getData('endYear').toString();\n    int startYear = int.parse(startYearString);\n    int endYear = int.parse(endYearString);\n\n    int totalYears = endYear - startYear + 1;\n    int daysInYear = 365;\n    int totalPrayersPerType = totalYears * daysInYear;\n\n    return _prayerService.prayers.map<Widget>((prayer) {\n      int missedPrayers = _prayerService.prayerMissedCounts[prayer] ?? 0;\n      return PrayerProgressCard(\n        prayer: prayer,\n        completedPrayers: totalPrayersPerType - missedPrayers,\n        totalPrayers: totalPrayersPerType,\n        onPressed: () {\n          if (missedPrayers > 0) {\n            _prayerService.incrementPrayer(prayer);\n            setState(() {});\n          }\n        },\n      );\n    }).toList();\n  }\n\n  void _resetApplication() async {\n    bool resetSuccessful = await _prayerService.resetApplication();\n    if (resetSuccessful) {\n      await _prayerService.preferencesService\n          .saveData('showYearSelection', true);\n      Navigator.pushReplacement(\n        context,\n        MaterialPageRoute(\n            builder: (context) =>\n                YearSelectionScreen(prayerService: _prayerService)),\n      );\n    } else {\n      // Handle the error or notify the user\n    }\n  }\n\n  void _sharePrayerData() {\n    _prayerService.sharePrayerData();\n  }\n}\n\n\n\n# File: ./lib/screens/home_screen.dart\n#######################################\n\n\n\n\n# File: ./lib/services/prayer_service.dart\n###########################################\n\n\n\n\n# File: ./services/shared_preferences_service.dart\n###################################################\n\n// services/shared_preferences_service.dart\nimport 'package:shared_preferences/shared_preferences.dart';\nimport 'dart:convert';\n\nclass SharedPreferencesService {\n  Future<void> saveData(String key, dynamic value) async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    if (value is int) {\n      await prefs.setInt(key, value);\n    } else if (value is String) {\n      await prefs.setString(key, value);\n    } else if (value is bool) {\n      await prefs.setBool(key, value);\n    } else if (value is double) {\n      await prefs.setDouble(key, value);\n    } else if (value is List<String>) {\n      await prefs.setStringList(key, value);\n    } else if (value is Map) {\n      String jsonString = jsonEncode(value);\n      await prefs.setString(key, jsonString);\n    } else {\n      throw ArgumentError('Invalid value type');\n    }\n  }\n\n  Future<dynamic> getData(String key) async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    var value = prefs.get(key);\n\n    if (value is String) {\n      try {\n        return jsonDecode(value); // Attempt to decode JSON\n      } catch (e) {\n        // If decoding fails, return the string value\n        return value;\n      }\n    }\n    return value; // Return the value as it is for other data types\n  }\n\n  Future<void> clearData() async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    await prefs.clear();\n  }\n}\n\n\n\n# File: ./services/prayer_service.dart\n#######################################\n\n// services/prayer_service.dart\nimport 'dart:convert';\nimport 'package:flutter/material.dart';\nimport 'shared_preferences_service.dart';\nimport 'package:share_plus/share_plus.dart';\n\nclass PrayerService {\n  final SharedPreferencesService _preferencesService =\n      SharedPreferencesService();\n  final List<String> prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];\n  Map<String, int> prayerMissedCounts = {};\n\n  SharedPreferencesService get preferencesService => _preferencesService;\n\n  Future<void> loadSavedData() async {\n    var prayerDataJson = await _preferencesService.getData('prayerData');\n    if (prayerDataJson is String) {\n      Map<String, dynamic> prayerData = jsonDecode(prayerDataJson);\n      prayerMissedCounts =\n          prayerData.map((key, value) => MapEntry(key, value as int));\n    } else if (prayerDataJson is Map) {\n      prayerMissedCounts = Map<String, int>.from(prayerDataJson);\n    }\n    print('Loaded prayer data: $prayerMissedCounts');\n  }\n\n  void savePrayerData() {\n    var prayerData = jsonEncode(prayerMissedCounts);\n    _preferencesService.saveData('prayerData', prayerData);\n  }\n\n  void calculateTotalPrayers(\n      int startYear, int endYear, int percentageMissed, int taqwaBuffer) {\n    int totalYears = endYear - startYear + 1;\n    int daysInYear = 365; // Adjust for leap years if necessary\n\n    int totalPrayersForEach = totalYears * daysInYear;\n    int missedPrayersForEach = (totalPrayersForEach * percentageMissed) ~/ 100;\n    int adjustedMissedPrayersForEach =\n        (missedPrayersForEach * (100 + taqwaBuffer)) ~/ 100;\n\n    for (String prayer in prayers) {\n      prayerMissedCounts[prayer] = adjustedMissedPrayersForEach;\n    }\n\n    savePrayerData();\n  }\n\n  void incrementPrayer(String prayer) {\n    int currentPrayed = prayerMissedCounts[prayer] ?? 0;\n    int newPrayedCount = currentPrayed + 1;\n\n    prayerMissedCounts[prayer] = newPrayedCount;\n    savePrayerData();\n  }\n\n  void sharePrayerData() {\n    String shareText = 'My Prayer Progress:\\n\\n';\n    for (String prayer in prayers) {\n      int missedPrayers = prayerMissedCounts[prayer] ?? 0;\n      shareText += '$prayer: Missed $missedPrayers times\\n';\n    }\n    Share.share(shareText);\n  }\n\n  Future<bool> resetApplication() async {\n    try {\n      prayerMissedCounts.clear();\n      await _preferencesService.clearData();\n      return true;\n    } catch (e) {\n      print(\"Error resetting application: $e\");\n      return false;\n    }\n  }\n}\n\n\n\n# File: ./widgets/prayer_input_card.dart\n#########################################\n\nimport 'package:flutter/material.dart';\n\nclass PrayerInputCard extends StatelessWidget {\n  final int year;\n  final Map<String, int> prayers;\n  final Function(int, String, int) onChanged;\n\n  const PrayerInputCard({\n    Key? key,\n    required this.year,\n    required this.prayers,\n    required this.onChanged,\n  }) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return Card(\n      margin: const EdgeInsets.symmetric(vertical: 8.0),\n      child: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.start,\n          children: [\n            Text(\n              'Year: $year',\n              style: const TextStyle(\n                fontSize: 18.0,\n                fontWeight: FontWeight.bold,\n              ),\n            ),\n            const SizedBox(height: 8.0),\n            ...prayers.entries.map((entry) {\n              String prayer = entry.key;\n              int percentage = entry.value;\n              int completedPrayers = (365 * (100 - percentage) ~/ 100);\n              int totalPrayers = 365;\n              return Column(\n                children: [\n                  Row(\n                    children: [\n                      Expanded(\n                        child: Text('$prayer:'),\n                      ),\n                      const SizedBox(width: 8.0),\n                      Expanded(\n                        child: TextField(\n                          keyboardType: TextInputType.number,\n                          controller: TextEditingController(text: '$percentage'),\n                          onChanged: (value) {\n                            onChanged(year, prayer, int.tryParse(value) ?? 0);\n                          },\n                          decoration: const InputDecoration(\n                            hintText: 'Percentage',\n                          ),\n                        ),\n                      ),\n                    ],\n                  ),\n                  const SizedBox(height: 8.0),\n                  Text('$completedPrayers / $totalPrayers'),\n                ],\n              );\n            }).toList(),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n// widgets/prayer_progress_card.dart\nimport 'package:flutter/material.dart';\n\nclass PrayerProgressCard extends StatelessWidget {\n  final String prayer;\n  final int completedPrayers;\n  final int totalPrayers;\n  final VoidCallback onPressed;\n\n  const PrayerProgressCard({\n    Key? key,\n    required this.prayer,\n    required this.completedPrayers,\n    required this.totalPrayers,\n    required this.onPressed,\n  }) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return Card(\n      elevation: 2.0,\n      margin: const EdgeInsets.symmetric(vertical: 8.0),\n      child: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.start,\n          children: [\n            Row(\n              mainAxisAlignment: MainAxisAlignment.spaceBetween,\n              children: [\n                Text(\n                  prayer,\n                  style: const TextStyle(\n                    fontSize: 20.0,\n                    fontWeight: FontWeight.bold,\n                  ),\n                ),\n                Text(\n                  '$completedPrayers',\n                  style: const TextStyle(fontSize: 18.0),\n                ),\n                const SizedBox(height: 8.0),\n                Text(\n                  '/ ${totalPrayers - completedPrayers}',\n                  style: const TextStyle(fontSize: 18.0),\n                ),\n              ],\n            ),\n            const SizedBox(height: 16.0),\n            ClipRRect(\n              borderRadius: BorderRadius.circular(10.0),\n              child: LinearProgressIndicator(\n                value: totalPrayers > 0 ? completedPrayers / totalPrayers : 0,\n                minHeight: 20.0,\n                backgroundColor: Colors.grey[300],\n                valueColor: const AlwaysStoppedAnimation<Color>(Colors.green),\n                semanticsLabel: 'Progress',\n                semanticsValue:\n                    '${(completedPrayers / totalPrayers * 100).toStringAsFixed(0)}%',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            ElevatedButton(\n              onPressed: completedPrayers < totalPrayers ? onPressed : null,\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.green,\n                padding: const EdgeInsets.symmetric(\n                  vertical: 16.0,\n                  horizontal: 24.0,\n                ),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(8.0),\n                ),\n              ),\n              child: Text(\n                'Prayed $prayer',\n                style: const TextStyle(fontSize: 18.0),\n              ),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n\n# File: ./widgets/prayer_progress_card.dart\n############################################\n\n//prayer_progress_card.dart\nimport 'package:flutter/material.dart';\n\nclass PrayerProgressCard extends StatelessWidget {\n  final String prayer;\n  final int completedPrayers;\n  final int totalPrayers;\n  final VoidCallback onPressed;\n\n  const PrayerProgressCard({\n    Key? key,\n    required this.prayer,\n    required this.completedPrayers,\n    required this.totalPrayers,\n    required this.onPressed,\n  }) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return Card(\n      elevation: 2.0,\n      margin: const EdgeInsets.symmetric(vertical: 8.0),\n      child: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.start,\n          children: [\n            Row(\n              mainAxisAlignment: MainAxisAlignment.spaceBetween,\n              children: [\n                Text(\n                  prayer,\n                  style: const TextStyle(\n                    fontSize: 20.0,\n                    fontWeight: FontWeight.bold,\n                  ),\n                ),\n                Text(\n                  '$completedPrayers',\n                  style: const TextStyle(fontSize: 18.0),\n                ),\n                const SizedBox(height: 8.0),\n                Text(\n                  '/ $totalPrayers',\n                  style: const TextStyle(fontSize: 18.0),\n                ),\n              ],\n            ),\n            const SizedBox(height: 16.0),\n            ClipRRect(\n              borderRadius: BorderRadius.circular(10.0),\n              child: LinearProgressIndicator(\n                value: totalPrayers > 0 ? completedPrayers / totalPrayers : 0,\n                minHeight: 20.0,\n                backgroundColor: Colors.grey[300],\n                valueColor: const AlwaysStoppedAnimation<Color>(Colors.green),\n                semanticsLabel: 'Progress',\n                semanticsValue:\n                    '${(completedPrayers / totalPrayers * 100).toStringAsFixed(0)}%',\n              ),\n            ),\n            const SizedBox(height: 16.0),\n            ElevatedButton(\n              onPressed: completedPrayers < totalPrayers ? onPressed : null,\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.green,\n                padding: const EdgeInsets.symmetric(\n                  vertical: 16.0,\n                  horizontal: 24.0,\n                ),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(8.0),\n                ),\n              ),\n              child: Text(\n                'Prayed $prayer',\n                style: const TextStyle(fontSize: 18.0),\n              ),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\n"
          }
        ],
        "files": [
          {
            "file_name": "combined_files.txt"
          }
        ]
      }
    },
    {
      "id": "c7e60c9e-3387-43b0-8fc8-d765cd9f5777",
      "role": "assistant",
      "content": " Here's the updated code with the suggested changes implemented:\n\n```dart\n// main.dart\nimport 'package:flutter/material.dart';\nimport 'screens/home_screen.dart';\nimport 'services/shared_preferences_service.dart';\nimport 'screens/year_selection_screen.dart';\nimport 'services/prayer_service.dart';\n\nvoid main() async {\n  WidgetsFlutterBinding.ensureInitialized();\n  final prefsService = SharedPreferencesService();\n  final prayerService = PrayerService();\n  var showYearSelection =\n      await prefsService.getData('showYearSelection') ?? true;\n\n  runApp(AmanaAuditApp(\n    showYearSelection: showYearSelection,\n    prayerService: prayerService,\n  ));\n}\n\nclass AmanaAuditApp extends StatelessWidget {\n  final bool showYearSelection;\n  final PrayerService prayerService;\n\n  const AmanaAuditApp({\n    Key? key,\n    required this.showYearSelection,\n    required this.prayerService,\n  }) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      title: 'Amana Audit',\n      theme: ThemeData(\n        primarySwatch: Colors.blue,\n      ),\n      home: showYearSelection\n          ? YearSelectionScreen(prayerService: prayerService)\n          : HomeScreen(prayerService: prayerService),\n    );\n  }\n}\n\n// providers/year_selection_provider.dart\nimport 'package:flutter/material.dart';\nimport '../services/prayer_service.dart';\n\nclass YearSelectionProvider with ChangeNotifier {\n  final PrayerService prayerService;\n  final TextEditingController startYearController;\n  final TextEditingController endYearController;\n  final TextEditingController averagePercentageController;\n  final TextEditingController taqwaBufferController;\n\n  YearSelectionProvider({required this.prayerService})\n      : startYearController = TextEditingController(text: '2022'),\n        endYearController = TextEditingController(text: '2023'),\n        averagePercentageController = TextEditingController(text: '50'),\n        taqwaBufferController = TextEditingController(text: '5');\n\n  void saveAndInitializePrayerData() {\n    int startYear = int.tryParse(startYearController.text) ?? DateTime.now().year;\n    int endYear = int.tryParse(endYearController.text) ?? DateTime.now().year;\n\n    if (startYear <= 0 || endYear <= 0 || startYear > endYear) {\n      // Handle invalid input, display an error message to the user\n      return;\n    }\n\n    int averagePercentageMissed =\n        int.tryParse(averagePercentageController.text) ?? 0;\n    int taqwaBuffer = int.tryParse(taqwaBufferController.text) ?? 0;\n\n    prayerService.preferencesService.saveData('startYear', startYear);\n    prayerService.preferencesService.saveData('endYear', endYear);\n    prayerService.preferencesService\n        .saveData('averagePercentageMissed', averagePercentageMissed);\n    prayerService.preferencesService.saveData('taqwaBuffer', taqwaBuffer);\n\n    prayerService.calculateTotalPrayers(\n        startYear, endYear, averagePercentageMissed, taqwaBuffer);\n\n    notifyListeners();\n  }\n}\n\n// screens/year_selection_screen.dart\nimport 'package:flutter/material.dart';\nimport '../providers/year_selection_provider.dart';\nimport '../services/prayer_service.dart';\nimport 'home_screen.dart';\n\nclass YearSelectionScreen extends StatefulWidget {\n  final PrayerService prayerService;\n\n  const YearSelectionScreen({Key? key, required this.prayerService})\n      : super(key: key);\n\n  @override\n  State<YearSelectionScreen> createState() => _YearSelectionScreenState();\n}\n\nclass _YearSelectionScreenState extends State<YearSelectionScreen> {\n  late final YearSelectionProvider _provider;\n  late final TextEditingController _startYearController;\n  late final TextEditingController _endYearController;\n  late final TextEditingController _averagePercentageController;\n  late final TextEditingController _taqwaBufferController;\n\n  @override\n  void initState() {\n    super.initState();\n    _provider = YearSelectionProvider(prayerService: widget.prayerService);\n    _startYearController = _provider.startYearController;\n    _endYearController = _provider.endYearController;\n    _averagePercentageController = _provider.averagePercentageController;\n    _taqwaBufferController = _provider.taqwaBufferController;\n  }\n\n  void _navigateToHomeScreen() async {\n    _provider.saveAndInitializePrayerData();\n    await widget.prayerService.preferencesService\n        .saveData('showYearSelection', false);\n    Navigator.pushReplacement(\n      context,\n      MaterialPageRoute(\n        builder: (context) => HomeScreen(prayerService: widget.prayerService),\n      ),\n    );\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Year Selection'),\n      ),\n      body: SingleChildScrollView(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          children: [\n            _buildTextField(_startYearController, 'Start Year',\n                _validateYear(_startYearController.text)),\n            const SizedBox(height: 8),\n            _buildTextField(_endYearController, 'End Year',\n                _validateYear(_endYearController.text)),\n            const SizedBox(height: 8),\n            _buildTextField(_averagePercentageController, 'Average % Missed',\n                _validatePercentage(_averagePercentageController.text)),\n            const SizedBox(height: 8),\n            _buildTextField(_taqwaBufferController, 'Taqwa Buffer %',\n                _validatePercentage(_taqwaBufferController.text)),\n            const SizedBox(height: 20),\n            ElevatedButton(\n              onPressed: _navigateToHomeScreen,\n              child: const Text('Save Data'),\n            ),\n            const SizedBox(height: 10),\n            ElevatedButton(\n              onPressed: _navigateToHomeScreen,\n              child: const Text('Next'),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n\n  Widget _buildTextField(\n      TextEditingController controller, String label, String? errorText) {\n    return TextField(\n      controller: controller,\n      keyboardType: TextInputType.number,\n      decoration: InputDecoration(\n        labelText: label,\n        border: const OutlineInputBorder(),\n        errorText: errorText,\n      ),\n    );\n  }\n\n  String? _validateYear(String value) {\n    if (value.length != 4) return 'Enter a valid year';\n    return null;\n  }\n\n  String? _validatePercentage(String value) {\n    if (value.isEmpty ||\n        int.tryParse(value) == null ||\n        int.parse(value) < 0 ||\n        int.parse(value) > 100) {\n      return 'Enter a value between 0 and 100';\n    }\n    return null;\n  }\n}\n\n// screens/home_screen.dart\nimport 'package:flutter/material.dart';\nimport '../services/prayer_service.dart';\nimport '../screens/year_selection_screen.dart';\nimport '../widgets/prayer_progress_card.dart';\n\nclass HomeScreen extends StatefulWidget {\n  final PrayerService prayerService;\n\n  const HomeScreen({Key? key, required this.prayerService}) : super(key: key);\n\n  @override\n  _HomeScreenState createState() => _HomeScreenState();\n}\n\nclass _HomeScreenState extends State<HomeScreen> {\n  late final PrayerService _prayerService;\n\n  @override\n  void initState() {\n    super.initState();\n    _prayerService = widget.prayerService;\n    _loadInitialData();\n  }\n\n  Future<void> _loadInitialData() async {\n    await _prayerService.loadSavedData();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return FutureBuilder(\n      future: _loadInitialData(),\n      builder: (context, snapshot) {\n        if (snapshot.connectionState == ConnectionState.waiting) {\n          return Scaffold(\n            appBar: AppBar(\n              title: const Text('Amana Audit'),\n            ),\n            body: Center(child: CircularProgressIndicator()),\n          );\n        } else if (snapshot.hasError) {\n          return Scaffold(\n            appBar: AppBar(\n              title: const Text('Amana Audit'),\n            ),\n            body: Center(child: Text('Error: ${snapshot.error}')),\n          );\n        } else {\n          return _buildUI();\n        }\n      },\n    );\n  }\n\n  Widget _buildUI() {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Amana Audit'),\n      ),\n      body: SingleChildScrollView(\n        child: Padding(\n          padding: const EdgeInsets.all(16.0),\n          child: Column(\n            crossAxisAlignment: CrossAxisAlignment.stretch,\n            children: [\n              ..._buildPrayerProgressList(),\n              ElevatedButton(\n                onPressed: _resetApplication,\n                child: const Text('Start Over'),\n              ),\n              ElevatedButton(\n                onPressed: _sharePrayerData,\n                child: const Text('Share'),\n              ),\n            ],\n          ),\n        ),\n      ),\n    );\n  }\n\n  List<Widget> _buildPrayerProgressList() {\n    return FutureBuilder<List<Widget>>(\n      future: _getPrayerProgressWidgets(),\n      builder: (context, snapshot) {\n        if (snapshot.hasData) {\n          return snapshot.data!;\n        } else if (snapshot.hasError) {\n          return [Text('Error: ${snapshot.error}')];\n        } else {\n          return [CircularProgressIndicator()];\n        }\n      },\n    );\n  }\n\n  Future<List<Widget>> _getPrayerProgressWidgets() async {\n    var startYearValue =\n        await _prayerService.preferencesService.getData('startYear');\n    var endYearValue =\n        await _prayerService.preferencesService.getData('endYear');\n\n    if (startYearValue is int && endYearValue is int) {\n      int startYear = startYearValue;\n      int endYear = endYearValue;\n\n      int totalYears = endYear - startYear + 1;\n      int daysInYear = 365;\n      int totalPrayersPerType = totalYears * daysInYear;\n\n      return _prayerService.prayers.map<Widget>((prayer) {\n        int missedPrayers = _prayerService.prayerMissedCounts[prayer] ?? 0;\n        return PrayerProgressCard(\n          prayer: prayer,\n          completedPrayers: totalPrayersPerType - missedPrayers,\n          totalPrayers: totalPrayersPerType,\n          onPressed: () {\n            if (missedPrayers > 0) {\n              _prayerService.incrementPrayer(prayer);\n              setState(() {});\n            }\n          },\n        );\n      }).toList();\n    } else {\n      return [Text('Invalid start or end year')];\n    }\n  }\n\n  void _resetApplication() async {\n    bool resetSuccessful = await _prayerService.resetApplication();\n    if (resetSuccessful) {\n      await _prayerService.preferencesService\n          .saveData('showYearSelection', true);\n      Navigator.pushReplacement(\n        context,\n        MaterialPageRoute(\n            builder: (context) =>\n                YearSelectionScreen(prayerService: _prayerService)),\n      );\n    } else {\n      // Handle the error or notify the user\n    }\n  }\n\n  void _sharePrayerData() {\n    _prayerService.sharePrayerData();\n  }\n}\n\n// services/shared_preferences_service.dart\nimport 'package:shared_preferences/shared_preferences.dart';\nimport 'dart:convert';\n\nclass SharedPreferencesService {\n  Future<void> saveData(String key, dynamic value) async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    if (value is int) {\n      await prefs.setInt(key, value);\n    } else if (value is String) {\n      await prefs.setString(key, value);\n    } else if (value is bool) {\n      await prefs.setBool(key, value);\n    } else if (value is double) {\n      await prefs.setDouble(key, value);\n    } else if (value is List<String>) {\n      await prefs.setStringList(key, value);\n    } else if (value is Map) {\n      String jsonString = jsonEncode(value);\n      await prefs.setString(key, jsonString);\n    } else {\n      throw ArgumentError('Invalid value type');\n    }\n  }\n\n  Future<dynamic> getData(String key) async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    var value = prefs.get(key);\n\n    if (value is String) {\n      try {\n        return jsonDecode(value); // Attempt to decode JSON\n      } catch (e) {\n        // If decoding fails, return the string value\n        return value;\n      }\n    }\n    return value; // Return the value as it is for other data types\n  }\n\n  Future<void> clearData() async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    await prefs.clear();\n  }\n}\n\n// services/prayer_service.dart\nimport 'dart:convert';\nimport 'package:flutter/material.dart';\nimport 'shared_preferences_service.dart';\nimport 'package:share_plus/share_plus.dart';\n\nclass PrayerService {\n  final SharedPreferencesService _preferencesService =\n      SharedPreferencesService();\n  final List<String> prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];\n  Map<String, int> prayerMissedCounts = {};\n\n  SharedPreferencesService get preferencesService => _preferencesService;\n\n  Future<void> loadSavedData() async {\n    var prayerDataJson = await _preferencesService.getData('prayerData');\n    if (prayerDataJson is String) {\n      Map<String, dynamic> prayerData = jsonDecode(prayerDataJson);\n      prayerMissedCounts =\n          prayerData.map((key, value) => MapEntry(key, value as int));\n    } else if (prayerDataJson is Map) {\n      prayerMissedCounts = Map<String, int>.from(prayerDataJson);\n    }\n    print('Loaded prayer data: $prayerMissedCounts');\n  }\n\n  void savePrayerData() {\n    var prayerData = jsonEncode(prayerMissedCounts);\n    _preferencesService.saveData('prayerData', prayerData);\n  }\n\n  void calculateTotalPrayers(\n      int startYear, int endYear, int percentageMissed, int taqwaBuffer) {\n    int totalYears = endYear - startYear + 1;\n    int daysInYear = 365; // Adjust for leap years if necessary\n\n    int totalPrayersForEach = totalYears * daysInYear;\n    int missedPrayersForEach = (totalPrayersForEach * percentageMissed) ~/ 100;\n    int adjustedMissedPrayersForEach =\n        (missedPrayersForEach",
      "created_at": "2024-03-19T00:03:18.537817Z",
      "sequence_order": 3,
      "metadata": {
        "content": [
          {
            "start_timestamp": "2024-03-19T00:03:18.537817Z",
            "stop_timestamp": "2024-03-19T00:03:18.537817Z",
            "flags": null,
            "type": "text",
            "text": " Here's the updated code with the suggested changes implemented:\n\n```dart\n// main.dart\nimport 'package:flutter/material.dart';\nimport 'screens/home_screen.dart';\nimport 'services/shared_preferences_service.dart';\nimport 'screens/year_selection_screen.dart';\nimport 'services/prayer_service.dart';\n\nvoid main() async {\n  WidgetsFlutterBinding.ensureInitialized();\n  final prefsService = SharedPreferencesService();\n  final prayerService = PrayerService();\n  var showYearSelection =\n      await prefsService.getData('showYearSelection') ?? true;\n\n  runApp(AmanaAuditApp(\n    showYearSelection: showYearSelection,\n    prayerService: prayerService,\n  ));\n}\n\nclass AmanaAuditApp extends StatelessWidget {\n  final bool showYearSelection;\n  final PrayerService prayerService;\n\n  const AmanaAuditApp({\n    Key? key,\n    required this.showYearSelection,\n    required this.prayerService,\n  }) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      title: 'Amana Audit',\n      theme: ThemeData(\n        primarySwatch: Colors.blue,\n      ),\n      home: showYearSelection\n          ? YearSelectionScreen(prayerService: prayerService)\n          : HomeScreen(prayerService: prayerService),\n    );\n  }\n}\n\n// providers/year_selection_provider.dart\nimport 'package:flutter/material.dart';\nimport '../services/prayer_service.dart';\n\nclass YearSelectionProvider with ChangeNotifier {\n  final PrayerService prayerService;\n  final TextEditingController startYearController;\n  final TextEditingController endYearController;\n  final TextEditingController averagePercentageController;\n  final TextEditingController taqwaBufferController;\n\n  YearSelectionProvider({required this.prayerService})\n      : startYearController = TextEditingController(text: '2022'),\n        endYearController = TextEditingController(text: '2023'),\n        averagePercentageController = TextEditingController(text: '50'),\n        taqwaBufferController = TextEditingController(text: '5');\n\n  void saveAndInitializePrayerData() {\n    int startYear = int.tryParse(startYearController.text) ?? DateTime.now().year;\n    int endYear = int.tryParse(endYearController.text) ?? DateTime.now().year;\n\n    if (startYear <= 0 || endYear <= 0 || startYear > endYear) {\n      // Handle invalid input, display an error message to the user\n      return;\n    }\n\n    int averagePercentageMissed =\n        int.tryParse(averagePercentageController.text) ?? 0;\n    int taqwaBuffer = int.tryParse(taqwaBufferController.text) ?? 0;\n\n    prayerService.preferencesService.saveData('startYear', startYear);\n    prayerService.preferencesService.saveData('endYear', endYear);\n    prayerService.preferencesService\n        .saveData('averagePercentageMissed', averagePercentageMissed);\n    prayerService.preferencesService.saveData('taqwaBuffer', taqwaBuffer);\n\n    prayerService.calculateTotalPrayers(\n        startYear, endYear, averagePercentageMissed, taqwaBuffer);\n\n    notifyListeners();\n  }\n}\n\n// screens/year_selection_screen.dart\nimport 'package:flutter/material.dart';\nimport '../providers/year_selection_provider.dart';\nimport '../services/prayer_service.dart';\nimport 'home_screen.dart';\n\nclass YearSelectionScreen extends StatefulWidget {\n  final PrayerService prayerService;\n\n  const YearSelectionScreen({Key? key, required this.prayerService})\n      : super(key: key);\n\n  @override\n  State<YearSelectionScreen> createState() => _YearSelectionScreenState();\n}\n\nclass _YearSelectionScreenState extends State<YearSelectionScreen> {\n  late final YearSelectionProvider _provider;\n  late final TextEditingController _startYearController;\n  late final TextEditingController _endYearController;\n  late final TextEditingController _averagePercentageController;\n  late final TextEditingController _taqwaBufferController;\n\n  @override\n  void initState() {\n    super.initState();\n    _provider = YearSelectionProvider(prayerService: widget.prayerService);\n    _startYearController = _provider.startYearController;\n    _endYearController = _provider.endYearController;\n    _averagePercentageController = _provider.averagePercentageController;\n    _taqwaBufferController = _provider.taqwaBufferController;\n  }\n\n  void _navigateToHomeScreen() async {\n    _provider.saveAndInitializePrayerData();\n    await widget.prayerService.preferencesService\n        .saveData('showYearSelection', false);\n    Navigator.pushReplacement(\n      context,\n      MaterialPageRoute(\n        builder: (context) => HomeScreen(prayerService: widget.prayerService),\n      ),\n    );\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Year Selection'),\n      ),\n      body: SingleChildScrollView(\n        padding: const EdgeInsets.all(16.0),\n        child: Column(\n          children: [\n            _buildTextField(_startYearController, 'Start Year',\n                _validateYear(_startYearController.text)),\n            const SizedBox(height: 8),\n            _buildTextField(_endYearController, 'End Year',\n                _validateYear(_endYearController.text)),\n            const SizedBox(height: 8),\n            _buildTextField(_averagePercentageController, 'Average % Missed',\n                _validatePercentage(_averagePercentageController.text)),\n            const SizedBox(height: 8),\n            _buildTextField(_taqwaBufferController, 'Taqwa Buffer %',\n                _validatePercentage(_taqwaBufferController.text)),\n            const SizedBox(height: 20),\n            ElevatedButton(\n              onPressed: _navigateToHomeScreen,\n              child: const Text('Save Data'),\n            ),\n            const SizedBox(height: 10),\n            ElevatedButton(\n              onPressed: _navigateToHomeScreen,\n              child: const Text('Next'),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n\n  Widget _buildTextField(\n      TextEditingController controller, String label, String? errorText) {\n    return TextField(\n      controller: controller,\n      keyboardType: TextInputType.number,\n      decoration: InputDecoration(\n        labelText: label,\n        border: const OutlineInputBorder(),\n        errorText: errorText,\n      ),\n    );\n  }\n\n  String? _validateYear(String value) {\n    if (value.length != 4) return 'Enter a valid year';\n    return null;\n  }\n\n  String? _validatePercentage(String value) {\n    if (value.isEmpty ||\n        int.tryParse(value) == null ||\n        int.parse(value) < 0 ||\n        int.parse(value) > 100) {\n      return 'Enter a value between 0 and 100';\n    }\n    return null;\n  }\n}\n\n// screens/home_screen.dart\nimport 'package:flutter/material.dart';\nimport '../services/prayer_service.dart';\nimport '../screens/year_selection_screen.dart';\nimport '../widgets/prayer_progress_card.dart';\n\nclass HomeScreen extends StatefulWidget {\n  final PrayerService prayerService;\n\n  const HomeScreen({Key? key, required this.prayerService}) : super(key: key);\n\n  @override\n  _HomeScreenState createState() => _HomeScreenState();\n}\n\nclass _HomeScreenState extends State<HomeScreen> {\n  late final PrayerService _prayerService;\n\n  @override\n  void initState() {\n    super.initState();\n    _prayerService = widget.prayerService;\n    _loadInitialData();\n  }\n\n  Future<void> _loadInitialData() async {\n    await _prayerService.loadSavedData();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return FutureBuilder(\n      future: _loadInitialData(),\n      builder: (context, snapshot) {\n        if (snapshot.connectionState == ConnectionState.waiting) {\n          return Scaffold(\n            appBar: AppBar(\n              title: const Text('Amana Audit'),\n            ),\n            body: Center(child: CircularProgressIndicator()),\n          );\n        } else if (snapshot.hasError) {\n          return Scaffold(\n            appBar: AppBar(\n              title: const Text('Amana Audit'),\n            ),\n            body: Center(child: Text('Error: ${snapshot.error}')),\n          );\n        } else {\n          return _buildUI();\n        }\n      },\n    );\n  }\n\n  Widget _buildUI() {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Amana Audit'),\n      ),\n      body: SingleChildScrollView(\n        child: Padding(\n          padding: const EdgeInsets.all(16.0),\n          child: Column(\n            crossAxisAlignment: CrossAxisAlignment.stretch,\n            children: [\n              ..._buildPrayerProgressList(),\n              ElevatedButton(\n                onPressed: _resetApplication,\n                child: const Text('Start Over'),\n              ),\n              ElevatedButton(\n                onPressed: _sharePrayerData,\n                child: const Text('Share'),\n              ),\n            ],\n          ),\n        ),\n      ),\n    );\n  }\n\n  List<Widget> _buildPrayerProgressList() {\n    return FutureBuilder<List<Widget>>(\n      future: _getPrayerProgressWidgets(),\n      builder: (context, snapshot) {\n        if (snapshot.hasData) {\n          return snapshot.data!;\n        } else if (snapshot.hasError) {\n          return [Text('Error: ${snapshot.error}')];\n        } else {\n          return [CircularProgressIndicator()];\n        }\n      },\n    );\n  }\n\n  Future<List<Widget>> _getPrayerProgressWidgets() async {\n    var startYearValue =\n        await _prayerService.preferencesService.getData('startYear');\n    var endYearValue =\n        await _prayerService.preferencesService.getData('endYear');\n\n    if (startYearValue is int && endYearValue is int) {\n      int startYear = startYearValue;\n      int endYear = endYearValue;\n\n      int totalYears = endYear - startYear + 1;\n      int daysInYear = 365;\n      int totalPrayersPerType = totalYears * daysInYear;\n\n      return _prayerService.prayers.map<Widget>((prayer) {\n        int missedPrayers = _prayerService.prayerMissedCounts[prayer] ?? 0;\n        return PrayerProgressCard(\n          prayer: prayer,\n          completedPrayers: totalPrayersPerType - missedPrayers,\n          totalPrayers: totalPrayersPerType,\n          onPressed: () {\n            if (missedPrayers > 0) {\n              _prayerService.incrementPrayer(prayer);\n              setState(() {});\n            }\n          },\n        );\n      }).toList();\n    } else {\n      return [Text('Invalid start or end year')];\n    }\n  }\n\n  void _resetApplication() async {\n    bool resetSuccessful = await _prayerService.resetApplication();\n    if (resetSuccessful) {\n      await _prayerService.preferencesService\n          .saveData('showYearSelection', true);\n      Navigator.pushReplacement(\n        context,\n        MaterialPageRoute(\n            builder: (context) =>\n                YearSelectionScreen(prayerService: _prayerService)),\n      );\n    } else {\n      // Handle the error or notify the user\n    }\n  }\n\n  void _sharePrayerData() {\n    _prayerService.sharePrayerData();\n  }\n}\n\n// services/shared_preferences_service.dart\nimport 'package:shared_preferences/shared_preferences.dart';\nimport 'dart:convert';\n\nclass SharedPreferencesService {\n  Future<void> saveData(String key, dynamic value) async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    if (value is int) {\n      await prefs.setInt(key, value);\n    } else if (value is String) {\n      await prefs.setString(key, value);\n    } else if (value is bool) {\n      await prefs.setBool(key, value);\n    } else if (value is double) {\n      await prefs.setDouble(key, value);\n    } else if (value is List<String>) {\n      await prefs.setStringList(key, value);\n    } else if (value is Map) {\n      String jsonString = jsonEncode(value);\n      await prefs.setString(key, jsonString);\n    } else {\n      throw ArgumentError('Invalid value type');\n    }\n  }\n\n  Future<dynamic> getData(String key) async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    var value = prefs.get(key);\n\n    if (value is String) {\n      try {\n        return jsonDecode(value); // Attempt to decode JSON\n      } catch (e) {\n        // If decoding fails, return the string value\n        return value;\n      }\n    }\n    return value; // Return the value as it is for other data types\n  }\n\n  Future<void> clearData() async {\n    SharedPreferences prefs = await SharedPreferences.getInstance();\n    await prefs.clear();\n  }\n}\n\n// services/prayer_service.dart\nimport 'dart:convert';\nimport 'package:flutter/material.dart';\nimport 'shared_preferences_service.dart';\nimport 'package:share_plus/share_plus.dart';\n\nclass PrayerService {\n  final SharedPreferencesService _preferencesService =\n      SharedPreferencesService();\n  final List<String> prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];\n  Map<String, int> prayerMissedCounts = {};\n\n  SharedPreferencesService get preferencesService => _preferencesService;\n\n  Future<void> loadSavedData() async {\n    var prayerDataJson = await _preferencesService.getData('prayerData');\n    if (prayerDataJson is String) {\n      Map<String, dynamic> prayerData = jsonDecode(prayerDataJson);\n      prayerMissedCounts =\n          prayerData.map((key, value) => MapEntry(key, value as int));\n    } else if (prayerDataJson is Map) {\n      prayerMissedCounts = Map<String, int>.from(prayerDataJson);\n    }\n    print('Loaded prayer data: $prayerMissedCounts');\n  }\n\n  void savePrayerData() {\n    var prayerData = jsonEncode(prayerMissedCounts);\n    _preferencesService.saveData('prayerData', prayerData);\n  }\n\n  void calculateTotalPrayers(\n      int startYear, int endYear, int percentageMissed, int taqwaBuffer) {\n    int totalYears = endYear - startYear + 1;\n    int daysInYear = 365; // Adjust for leap years if necessary\n\n    int totalPrayersForEach = totalYears * daysInYear;\n    int missedPrayersForEach = (totalPrayersForEach * percentageMissed) ~/ 100;\n    int adjustedMissedPrayersForEach =\n        (missedPrayersForEach",
            "citations": []
          }
        ],
        "updated_at": "2024-03-19T00:03:18.537817Z",
        "attachments": [],
        "files": []
      }
    }
  ]
}