{
  "id": "0ef7862a-7059-47ba-832b-a703cb91d05d",
  "source": "claude",
  "title": "Documentation strategy for protocol and reference app",
  "created_at": "2025-11-06T11:57:53.878370Z",
  "updated_at": "2025-11-06T12:22:57.952014Z",
  "summary": "**Conversation Overview**\n\nThe user is working on the Cursive platform, a system for human-authored content with proof-of-humanity verification. They requested a comprehensive documentation overhaul, expressing frustration with having too many documents that mixed aspirational protocol thinking with practical implementation needs. The user wanted to \"delete everything\" and focus only on foundational documentation based on their core decisions for both the protocol and reference app.\n\nClaude performed a major documentation cleanup, analyzing 15+ existing documents and consolidating them into 7 essential files. The cleanup distinguished between premature protocol abstractions (which were archived) and practical implementation guidance (which was refined and kept). Key deliverables included START_HERE.md (90-minute developer onboarding guide), CORE_PRIMITIVES.md (replacing DATA_DICTIONARY with current database reality), SHARE_AND_VERIFY.md (replacing MVP_SHARE_SESSION_SPEC with a concrete 4-week implementation plan), DATABASE_REALITY.md (actionable schema cleanup with runnable SQL), and QUICK_REFERENCE.md (printable developer cheat sheet).\n\nThe user then shifted focus, revealing they had created a \"reset edition\" document that drew a hard line between Protocol (CP-0.1) and Reference App. They specifically requested a protocol-only specification, envisioning Cursive Protocol as the next fundamental layer of the internet stack - after HTTP (transport), HTML (structure), CSS (presentation), and JavaScript (behavior) - adding context, meaning, provenance, and humanity verification. Claude created CURSIVE_PROTOCOL_v0.1.md, an implementation-agnostic specification defining CPL (Cursive Page Language) and CHL (Cursive Hospitality Language) formats, verification protocols, export standards, and compliance levels. This protocol document was designed to be like reading HTTP or HTML5 specifications - focused purely on the contracts any implementation must honor, without reference to specific technologies like Supabase or Next.js.\n\nThe conversation demonstrated the user's evolution from wanting practical implementation docs to recognizing the need for a foundational protocol specification that could enable multiple implementations and true interoperability across the internet.",
  "message_count": 4,
  "messages": [
    {
      "id": "019a5907-cf93-700f-b3bf-84bb24a1ed50",
      "role": "human",
      "content": "based on these ideas can you review and no worries about migrating anything we can delete everything can you review and update our docs what do we need foundationally and let's ignore the rest, give me the best set of documentation based on our decisions for the protocol and reference app",
      "created_at": "2025-11-06T11:57:55.665368Z",
      "sequence_order": 0,
      "metadata": {
        "content": [
          {
            "start_timestamp": "2025-11-06T11:57:55.658509Z",
            "stop_timestamp": "2025-11-06T11:57:55.658509Z",
            "flags": null,
            "type": "text",
            "text": "based on these ideas can you review and no worries about migrating anything we can delete everything can you review and update our docs what do we need foundationally and let's ignore the rest, give me the best set of documentation based on our decisions for the protocol and reference app",
            "citations": []
          }
        ],
        "updated_at": "2025-11-06T11:57:55.665368Z",
        "attachments": [
          {
            "file_name": "DATA_DICTIONARY.md",
            "file_size": 14260,
            "file_type": "",
            "extracted_content": "# Cursive Data Dictionary\n\n**Last Updated:** November 6, 2025\n**Source of Values:** [VALUES.md](../VALUES.md)\n**Purpose:** Canonical vocabulary that ties every primitive to schema expectations, allowed affordances, and the values it serves.\n\n> Every concept listed here must be kept in sync with the database schema, generated types, and application terminology.\n> New nouns **must** be added here before code or schema changes land.\n\n---\n\n## âš ï¸ Schema Cleanup In Progress (Nov 2025)\n\n**See:** [SCHEMA_CLEANUP_PLAN.md](./SCHEMA_CLEANUP_PLAN.md) for full surgical migration plan.\n\n**Pending Changes:**\n- `released_prompts` â†’ `invitations` (clearer naming)\n- `mail_items.type='notification'` â†’ new `notifications` table\n- `guide_pages` â†’ decision needed (drop or keep as template source)\n- `sections` â†’ decision needed (drop or keep for daily grouping)\n- `collections.collection_kind` â†’ drop duplicate column\n\n**Key Decision:** Protocol (export formats) vs Reference App (database schema) are separate concerns. This dictionary describes the protocol vocabulary. The database is our implementation.\n\n---\n\n## Legend\n\n- **Schema** â€“ Primary table(s) and notable columns. `metadata.*` indicates JSONB fields.\n- **Allowed Actions** â€“ Operations the protocol permits for this primitive (beyond vanilla CRUD).\n- **Values** â€“ Tags referencing the principles in `VALUES.md` (e.g., `Agency`, `Embodied`, `Hospitality`).\n- **Notes** â€“ Additional constraints, provenance requirements, or future work.\n\n---\n\n## Core Primitives\n\n### Page\n- **Definition:** Sacred human-authored document (TipTap-compatible) that captures text, handwriting, and drawings.  \n- **Schema:** `public.pages`  \n  - Required: `id`, `collection_id`, `content`, `metadata`, `created_by`, `origin` (`human` | `suggested`)  \n  - Metadata: `sheets[]`, `process_fingerprint`, `quorum_receipts[]`, `export_receipts[]`  \n- **Allowed Actions:** create, update (human-only), archive, export, transclude, attach whisper suggestion, record process metrics.  \n- **Values:** Agency, VerifiableCraft, Transparency, Embodied, Sovereignty.  \n- **Notes:** Automated writes are prohibited; suggestions must remain in chrome until explicitly inserted.\n\n### Collection\n- **Definition:** Top-level space representing a journal, guide, or shared archive.  \n- **Schema:** `public.collections` (`id`, `owner_id`, `kind`, `title`, `metadata`)  \n- **Allowed Actions:** create, fork (with consent), share, archive, export.  \n- **Values:** Hospitality, Agency, Sovereignty.  \n- **Notes:** Replaces legacy term *notebook*. `kind` âˆˆ (`workspace`, `template`, `shared`).\n\n### Folder\n- **Definition:** Optional organizational container within a collection for grouping pages.  \n- **Schema:** `public.folders` (`collection_id`, `parent_folder_id`, `visibility`, `order_index`)  \n- **Allowed Actions:** create, reorder, hide/reveal.  \n- **Values:** Agency, Hospitality.  \n- **Notes:** Nested folders permitted. Used by hosts to stage experiences (e.g., â€œWeek 1â€).\n\n### Sheet\n- **Definition:** Fixed-size surface nested within a Page to encourage deliberate expansion.  \n- **Schema:** Stored in `pages.metadata.sheets[]`  \n  - Fields: `id`, `content`, `created_at`, `stroke_count`, `scroll_depth`  \n- **Allowed Actions:** add, remove (with confirmation), reorder within a page.  \n- **Values:** Embodied, Slowness, VerifiableCraft.  \n- **Notes:** First sheet mirrors `pages.content` for backward compatibility.\n\n### Invitation\n- **Definition:** Timed prompt that routes a participant or cohort to a page, template, or experience.\n- **Schema:** `invitations` (formerly `released_prompts`), `mail_items.type='invitation'`, `responses`\n  - `invitations`: Released prompts with scheduling, routing, and completion tracking\n  - `mail_items`: Delivery mechanism to participant inboxes\n  - `responses`: Participant submissions linked to invitation\n- **Allowed Actions:** schedule, release, pause, resend, digest, track completion.\n- **Values:** Hospitality, ConnectionToOthers, SlowCorrespondence.\n- **Notes:** Always authored by a human host; tooling can remind but not auto-release without consent. Front-end presentation varies by context (assignment, worksheet, exercise, invitation) but backend uses consistent \"invitation\" terminology.\n\n### Tool Plugin\n- **Definition:** Consciously invoked helper (e.g., Leaf Identifier, Mood Tracker) that produces structured output with provenance.  \n- **Schema:** `tool_plugins`, `tool_runs`, `tool_cards`, `user_tool_settings`, `group_tool_settings`  \n- **Allowed Actions:** register plugin, invoke, render modal/sidebar, emit whisper card, attach reference to page.  \n- **Values:** Embodied, Competence, Transparency.  \n- **Notes:** Output stored as references or metadata; never writes directly into Page content.\n\n### Quorum\n- **Definition:** Proof that a specified number of authenticated humans were present/engaged to unlock an experience or artifact.  \n- **Schema:** `quorum_events`, `page_events`, `presence_streams`, future `quorum_receipts` contract.  \n- **Allowed Actions:** register quorum requirement, attest presence, unlock content, issue receipt.  \n- **Values:** ConnectionToOthers, VerifiableCraft, Sovereignty.  \n- **Notes:** Each receipt includes timestamp, participant IDs (hashed if necessary), and validation mechanism (e.g., stroke threshold).\n\n### Transclusion\n- **Definition:** Live reference to a Page or block rendered within another context while preserving ownership and provenance.  \n- **Schema:** `transclusions` (`source_page_id`, `target_page_id`, `fragment_id`, `permissions`)  \n- **Allowed Actions:** embed, update reference, revoke.  \n- **Values:** ConnectionToSelf, ConnectionToOthers, Transparency, Sovereignty.  \n- **Notes:** Supports backlinks; editing remains at the source.\n\n### Insight Lens\n- **Definition:** Creator-defined scaffold or analysis routine that produces insight cards or structured data (deterministic, AI-assisted, or hybrid).  \n- **Schema:** `insight_lenses`, `insight_runs`, `insights`, `insight_evidence_links`  \n- **Allowed Actions:** create, calibrate, run on page/collection, produce suggestion, attach evidence.  \n- **Values:** ConnectionToTruth, Competence, Transparency.  \n- **Notes:** Output must include `confidence`, `reasoning`, `suggested_actions[]`. Human ratification required before affecting page.\n\n### Presentation Session\n- **Definition:** Captured timeline of page creation events (navigation, strokes, typing, audio) serving three purposes: (1) always-on background capture for proof-of-human fingerprints, (2) intentional recorded walkthroughs with audio for sharing/teaching, (3) live-streamed sessions that transition to recordings.\n- **Schema:** `presentation_sessions`\n  - Core fields: `id`, `page_id`, `collection_id`, `owner_id`, `session_type`, `started_at`, `ended_at`, `active_duration_ms`, `audio_url`, `fingerprint`, `metadata`, `created_at`, `updated_at`\n  - Session types:\n    - `background`: Always-on per-page capture (no audio); generates proof-of-human fingerprint\n    - `recorded`: Intentional recording with optional audio; shareable via `/w/:sessionId`\n    - `live`: Real-time streaming with required audio; viewers watch via `/live/:sessionId`; becomes `recorded` when ended\n  - Events table: `presentation_events` (`session_id`, `timestamp_ms`, `event_type`, `event_data`)\n  - Fingerprint: JSONB containing cryptographic hash, temporal stats, behavioral markers (stroke variance, idle patterns, revision count) proving human authorship\n  - Metadata: JSONB envelope for title, description, visibility (`private` | `link-only` | `public`), viewer_count, idle_segments[], trimming preferences\n- **Allowed Actions:**\n  - Background: auto-start on page open, auto-end on blur/close, generate fingerprint\n  - Recorded: start/stop recording, toggle audio, trim idle segments, share link, delete\n  - Live: broadcast start, stream events via realtime, track viewers, end session (converts to recorded)\n  - All: export timeline, download proof certificate (PDF with fingerprint), verify authenticity\n- **Values:** VerifiableCraft, Transparency, Hospitality, Embodied, Sovereignty.\n- **Notes:**\n  - Background sessions run silently for every page edit; owner can view timeline in \"Activity\" sidebar\n  - Fingerprint algorithm detects human patterns: stroke duration variance (200-800ms), idle gaps indicating thought, revision sequences, temporal inconsistencies impossible for AI/paste\n  - Live sessions use same event schema as recorded; realtime broadcast via Supabase channel `live:${sessionId}`\n  - Idle segments (>30s no input) can be trimmed for sharing while preserving full timeline for authenticity verification\n  - Teachers/reviewers see both finished page and process timeline; supports apprenticeship model\n\n### Host Prompt Cycle\n- **Definition:** Rhythm of facilitationâ€”scheduling prompts, pausing cohorts, releasing compilations.\n- **Schema:** `mail_items`, `host_tasks`, `compilations`, `scheduler_settings`\n- **Allowed Actions:** schedule/pause, email release, send digest, generate PDF/mail, reassign host.\n- **Values:** Hospitality, SlowCorrespondence.\n- **Notes:** Hosts can operate entirely via email/SMS responders; platform must respect pauses (vacations).\n\n### Export Receipt\n- **Definition:** Portable manifest describing exported content, proofs, badges, and encryption metadata for sovereignty.  \n- **Schema:** `.cursive` archive manifest (JSON) + optional on-chain reference  \n- **Allowed Actions:** generate, sign, verify, import.  \n- **Values:** Sovereignty, Transparency, VerifiableCraft.  \n- **Notes:** Includes provenance receipts (quorum, tool runs), badge ownership (future decentralized ID).\n\n---\n\n## Supporting Concepts\n\n| Concept            | Definition                                                                 | Schema Highlights                              | Values                         |\n|--------------------|----------------------------------------------------------------------------|-----------------------------------------------|--------------------------------|\n| **Process Fingerprint** | Aggregated metrics describing how a Page was created (stroke counts, edit timeline, device mix). | `pages.metadata.process_fingerprint` | VerifiableCraft, Transparency |\n| **Session Fingerprint** | Cryptographic proof-of-human derived from presentation session events; includes SHA-256 hash of event timeline, temporal markers (active duration, idle gaps), behavioral signals (stroke variance, revision patterns), and metadata. Cannot be faked by AI or copy-paste due to human-specific timing patterns. | `presentation_sessions.fingerprint` | VerifiableCraft, Transparency, Sovereignty |\n| **Whisper Suggestion** | Ephemeral card containing an AI or deterministic suggestion that the user may apply. | `tool_cards`, `insights`, `suggestion_logs`   | Competence, Transparency       |\n| **Presence Stream**   | Time-series data indicating active participants in a session.           | `presence_streams`, `page_events`             | ConnectionToOthers, Hospitality|\n| **Badge / Credential**| Verifiable recognition (host-awarded, quorum-earned) owned by the participant. | `credentials`, future decentralized wallet   | Sovereignty, VerifiableCraft   |\n| **Ink Stroke** | Handwritten mark or drawing on a page surface captured as vector path data. | `ink_strokes` (`page_id`, `sheet_id`, `stroke_data`, `tool_type`, `color`, `width`) | Embodied, VerifiableCraft |\n| **Sheet Isolation (sheet_id)** | Column linking ink strokes to specific sheets within multi-sheet pages. NULL indicates page-level drawing (backward compatible). | `ink_strokes.sheet_id`, indexed with `(page_id, sheet_id)` for efficient filtering | Embodied, Sovereignty |\n| **System Notification** | Automated alert about platform events (due dates, comments, releases). Distinct from human-authored mail. | `notifications` (split from `mail_items` Nov 2025) with `notification_type`, `subject_type`, `subject_id` | Hospitality, Transparency |\n\n---\n\n## Terminology Guardrails\n\n### Deprecated Terms (Migrate Away From)\n- **notebook** â†’ `collection` (container term from legacy model)\n- **lesson** â†’ `invitation` or `page` (too generic, use specific primitive)\n- **assignment** â†’ `invitation` (backend term, frontend can customize display)\n- **released_prompts** â†’ `invitations` (renamed for clarity Nov 2025)\n- **guide** â†’ `collection` with `kind='template'` (guide is informal term, not schema primitive)\n\n### Current Correct Terms\n- **Collection** - Top-level container (journal, template, workspace)\n- **Folder** - Organizational grouping within collection\n- **Page** - Sacred human-authored document\n- **Invitation** - Timed prompt routing cohort to page/experience\n- **Mail Item** - Human correspondence (letter, share, gift, invitation delivery)\n- **Notification** - System alert (split from mail_items Nov 2025)\n\n### Provenance Requirements\n- All content-modifying records require `origin`, `author_id`, `suggested_by_tool_id?`, `confidence?`\n- Structured fields derived from AI must store `raw_input`, `interpreted_value`, `confidence`, and `ratified_at` timestamp\n\n### Vocabulary Consistency\n- **Backend** uses canonical terms (invitation, collection, page)\n- **Frontend** can customize display using `collections.label_singular/label_plural` (e.g., \"Assignment\", \"Worksheet\", \"Exercise\")\n- **Protocol exports** use canonical vocabulary for portability\n\nTerminology audits scan for deprecated words and missing provenance fields. See tooling in the reference application for implementation details.\n\n---\n\n## How to Propose a New Concept\n\n1. Draft the entry in this dictionary (definition, schema, values, allowed actions).  \n2. Identify which values from [VALUES.md](../VALUES.md) it serves; add new value tags if necessary.  \n3. Update or add specs in `../specs/` (JSON schema, diagrams).  \n4. Create or modify database migrations; regenerate Supabase types.  \n5. Reference the new dictionary entry in implementation pull requests.\n\nWhen the dictionary, schema, and implementations stay aligned, the protocol remains a faithful expression of our values.\n"
          },
          {
            "file_name": "SCHEMA_CLEANUP_PLAN.md",
            "file_size": 10109,
            "file_type": "",
            "extracted_content": "# Schema Cleanup Plan: Surgical Migration\n\n**Date:** November 6, 2025\n**Status:** Review & Approval\n**Philosophy:** Fix contradictions, keep all capabilities that serve our values\n\n---\n\n## Executive Summary\n\nThis is **NOT** a minimization exercise. This is fixing 5 specific contradictions while preserving all ~30 tables that serve our values.\n\n**Key Distinction:**\n- **Protocol** = Export/interchange formats (pages, SARECs, routing DSL)\n- **Reference App** = Full database implementation (~30 tables)\n\nThe protocol emerges from documenting export formats, not from stripping the database.\n\n---\n\n## The 5 Real Problems\n\n### 1. Double Kind Column âŒ\n```sql\ncollections.kind              -- TEXT enum\ncollections.collection_kind   -- CUSTOM enum (duplicate!)\n```\n\n**Fix:** Keep TEXT, drop custom type\n\n---\n\n### 2. Triple Parent Path âŒ\n```sql\npages.section_id     -- FK to sections\npages.folder_id      -- FK to folders\npages.collection_id  -- FK to collections (too direct)\n```\n\n**Current Reality:**\n- 11 pages total\n- 0 have section_id\n- All have folder_id\n- sections table has 0 records\n\n**Fix:**\n- Drop `pages.collection_id` (navigate via folder)\n- Make section optional: `(section_id IS NOT NULL XOR folder_id IS NOT NULL)`\n- Keep sections table (needed for daily page grouping + assignment metadata)\n\n---\n\n### 3. Guide_pages vs Pages âŒ\n```sql\nguide_pages  -- 0 records, 18 code references\npages        -- 11 records, 59 code references\n```\n\n**Confusion:** Are guide_pages templates and pages instances?\n\n**Decision Point Needed:**\n- **Option A:** Drop guide_pages, use `pages.page_type = 'template'`\n- **Option B:** Keep guide_pages as source templates, add `pages.source_guide_page_id`\n\n**Recommendation:** Option A (simpler, guide_pages is empty)\n\n---\n\n### 4. Terminology Drift âŒ\n```sql\nnotebooks              -- deprecated, 1 record exists\nreleased_prompts       -- should be \"invitations\"\nnotebookId in code     -- should be collectionId\n```\n\n**Fix:**\n- Keep notebooks as compat view temporarily\n- Rename `released_prompts` â†’ `invitations`\n- Gradual rename of `notebookId` â†’ `collectionId` in code\n\n---\n\n### 5. Mail Types Unclear âŒ\n```sql\nmail_items.type CHECK IN ('invitation', 'notification', 'share', 'gift')\n-- But code creates 'letter' (not in constraint!) âŒ\n-- Mixing correspondence with system alerts âŒ\n```\n\n**Fix:**\n- Split `type='notification'` â†’ new `notifications` table\n- Update constraint to allow `'letter'`\n- Final types: `('invitation', 'letter', 'share', 'gift')`\n\n---\n\n## What We're KEEPING (All ~30 Tables)\n\n### Core Content (5)\n- âœ… `profiles` - User accounts\n- âœ… `organizations` - Institutional accounts\n- âœ… `collections` - Top-level containers (journals, guides, templates)\n- âœ… `folders` - Organizational grouping within collections\n- âœ… `pages` - Sacred human-authored documents\n\n### Cohorts & Groups (5)\n- âœ… `groups` - Cohorts/classes\n- âœ… `group_members` - Enrollment\n- âœ… `invitations` - Timed prompts (renamed from released_prompts)\n- âœ… `responses` - Student submissions\n- âœ… `answers` - Extracted assessment data\n\n### Communication (2)\n- âœ… `mail_items` - Human correspondence (letters, shares, invitations, gifts)\n- âœ… `notifications` - System alerts (NEW, split from mail_items)\n\n### Assessment & Routing (SAREC) (3)\n- âœ… `questions` - Reusable assessment registry\n- âœ… `answers` - Responses with extraction + confidence\n- âœ… `pages.action` - Conditional navigation (metadata column)\n\n### Analysis & Rollups (3)\n- âœ… `aggregations` - Cohort insights\n- âœ… `lenses` - Analysis definitions\n- âœ… `lens_results` - Cached analysis with evidence\n\n### Tools & Whispers (5)\n- âœ… `tool_plugins` - Registered tools\n- âœ… `tool_runs` - Invocation log\n- âœ… `tool_cards` - Suggestion outputs\n- âœ… `user_tool_settings` - Personal configs\n- âœ… `group_tool_settings` - Cohort configs\n\n### Views & Display (2)\n- âœ… `views` - Display configurations\n- âœ… `saved_views` - User/group view presets\n\n### Verification & Proof (4)\n- âœ… `page_verifications` - Proof-of-human badges\n- âœ… `verification_access_requests` - Share permissions\n- âœ… `ink_strokes` - Handwriting data (proof-of-human)\n- âœ… `presentation_sessions` - Walkthrough recordings\n\n### History (1)\n- âœ… `page_history` - Audit trail\n\n---\n\n## What to Conditionally Drop (Check First)\n\nRun these queries to see what's actually unused:\n\n```sql\nSELECT\n  'collection_usage_stats' as table_name,\n  COUNT(*) as rows,\n  CASE WHEN COUNT(*) = 0 THEN 'âœ“ CAN DROP' ELSE 'âœ— IN USE' END as status\nFROM collection_usage_stats\n\nUNION ALL\n\nSELECT 'collection_ratings', COUNT(*),\n  CASE WHEN COUNT(*) = 0 THEN 'âœ“ CAN DROP' ELSE 'âœ— IN USE' END\nFROM collection_ratings\n\nUNION ALL\n\nSELECT 'personal_schedules', COUNT(*),\n  CASE WHEN COUNT(*) = 0 THEN 'âœ“ CAN DROP' ELSE 'âœ— IN USE' END\nFROM personal_schedules\n\nUNION ALL\n\nSELECT 'sections', COUNT(*),\n  CASE WHEN COUNT(*) = 0 THEN 'âš ï¸ DECIDE' ELSE 'âœ— KEEP' END\nFROM sections\n\nUNION ALL\n\nSELECT 'guide_pages', COUNT(*),\n  CASE WHEN COUNT(*) = 0 THEN 'âš ï¸ DECIDE' ELSE 'âœ— KEEP' END\nFROM guide_pages\n\nUNION ALL\n\nSELECT 'snapshots', COUNT(*),\n  CASE WHEN COUNT(*) = 0 THEN 'âœ“ CAN DROP' ELSE 'âœ— IN USE' END\nFROM snapshots\n\nUNION ALL\n\nSELECT 'writing_sessions', COUNT(*),\n  CASE WHEN COUNT(*) = 0 THEN 'âœ“ CAN DROP' ELSE 'âœ— IN USE' END\nFROM writing_sessions;\n```\n\n---\n\n## The Surgical Migration Script\n\nSee `20251106000000_surgical_schema_cleanup.sql` for full migration.\n\n### Key Changes\n\n1. **Fix double kind column**\n   ```sql\n   ALTER TABLE collections DROP COLUMN collection_kind;\n   -- Keep TEXT kind with constraint\n   ```\n\n2. **Fix triple parent path**\n   ```sql\n   ALTER TABLE pages DROP COLUMN collection_id;\n   -- Navigate via: page â†’ folder â†’ collection\n\n   ALTER TABLE pages ADD CONSTRAINT page_parent_exclusive\n     CHECK (\n       (section_id IS NOT NULL AND folder_id IS NULL) OR\n       (section_id IS NULL AND folder_id IS NOT NULL)\n     );\n   ```\n\n3. **Clarify guide_pages** (DECISION NEEDED)\n   ```sql\n   -- Option A: Drop guide_pages\n   DROP TABLE guide_pages CASCADE;\n   ALTER TABLE pages ADD COLUMN page_type TEXT\n     CHECK (page_type IN ('daily', 'template', 'response', 'custom'));\n\n   -- Option B: Keep as template source\n   ALTER TABLE pages ADD COLUMN source_guide_page_id uuid\n     REFERENCES guide_pages(id);\n   ```\n\n4. **Rename for clarity**\n   ```sql\n   ALTER TABLE released_prompts RENAME TO invitations;\n   ALTER TABLE responses RENAME COLUMN released_id TO invitation_id;\n   ```\n\n5. **Split mail from notifications**\n   ```sql\n   CREATE TABLE notifications (\n     id uuid PRIMARY KEY,\n     recipient_id uuid REFERENCES auth.users(id),\n     notification_type TEXT CHECK (notification_type IN\n       ('comment', 'due_date', 'release', 'mention', 'system')),\n     subject_type TEXT CHECK (subject_type IN\n       ('page', 'comment', 'invitation', 'response')),\n     subject_id uuid NOT NULL,\n     title TEXT NOT NULL,\n     message TEXT,\n     action_url TEXT,\n     payload jsonb DEFAULT '{}',\n     read_at timestamptz,\n     created_at timestamptz DEFAULT now()\n   );\n\n   -- Update mail_items constraint\n   ALTER TABLE mail_items DROP CONSTRAINT mail_items_type_check;\n   ALTER TABLE mail_items ADD CONSTRAINT mail_items_type_check\n     CHECK (type IN ('invitation', 'letter', 'share', 'gift'));\n   ```\n\n---\n\n## Protocol vs Reference App Split\n\n### Protocol (Export Formats - To Document)\n\nWhat gets exported in a `.cursive` archive:\n\n1. **Page Format**\n   ```json\n   {\n     \"version\": \"1.0\",\n     \"content\": { /* TipTap JSON */ },\n     \"metadata\": {\n       \"action\": { /* Routing DSL */ },\n       \"sheets\": [ /* Multi-page support */ ],\n       \"process_fingerprint\": { /* Proof-of-human */ }\n     }\n   }\n   ```\n\n2. **SAREC Format** (Assessment)\n   ```json\n   {\n     \"question_id\": \"calc.u_sub.v1\",\n     \"rubric\": { /* 4-level rubric */ },\n     \"evidence_sources\": [ /* What to analyze */ ],\n     \"routing_condition\": { /* When to route */ },\n     \"confidence_threshold\": 0.70\n   }\n   ```\n\n3. **Routing DSL**\n   ```json\n   {\n     \"action\": {\n       \"type\": \"conditional_navigate\",\n       \"conditions\": [\n         {\n           \"if\": \"answer.score < 0.4\",\n           \"then\": \"navigate:remedial_page\",\n           \"confidence\": 0.70\n         }\n       ]\n     }\n   }\n   ```\n\n4. **Tool Invocation Contract**\n   ```json\n   {\n     \"tool_id\": \"leaf_identifier.v1\",\n     \"input\": { /* Structured params */ },\n     \"output\": { /* Suggestion card */ },\n     \"provenance\": { /* Who/when/why */ }\n   }\n   ```\n\n### Reference App (Database - Our Implementation)\n\nAll ~30 tables listed above. The database is OUR business logic. The protocol is the EXPORT format for portability.\n\n---\n\n## Migration Checklist\n\n- [ ] **Review this plan** with team\n- [ ] **Run check queries** to see what's actually empty\n- [ ] **Decide on guide_pages**: Drop or keep?\n- [ ] **Decide on sections**: Drop or keep for daily grouping?\n- [ ] **Write migration script** (20251106000000_surgical_schema_cleanup.sql)\n- [ ] **Test on staging** environment\n- [ ] **Backup production** before running\n- [ ] **Run migration** with validation queries\n- [ ] **Update DATA_DICTIONARY.md** with new terminology\n- [ ] **Document protocol export formats** (separate from schema)\n- [ ] **Update code** to use new table names (invitations, etc.)\n\n---\n\n## Success Criteria\n\nâœ… All contradictions resolved (5 problems fixed)\nâœ… All value-serving capabilities preserved\nâœ… Clear distinction between protocol (exports) and app (database)\nâœ… Zero data loss\nâœ… Improved clarity for future development\n\n---\n\n## Next Steps\n\n1. **Team Review** - Discuss decisions on guide_pages and sections\n2. **Create Migration** - Write the actual SQL migration\n3. **Update Docs** - Refresh DATA_DICTIONARY.md\n4. **Document Protocol** - Write export format specs\n5. **Execute** - Run migration on staging, then production\n"
          },
          {
            "file_name": "DESIGN_PHILOSOPHY.md",
            "file_size": 7915,
            "file_type": "",
            "extracted_content": "# Design Philosophy\n\n**Last Updated:** October 30, 2025\n**Purpose:** Translate the protocol values into concrete UI/UX decisions\n\n---\n\n## Preamble: Craft Over Convenience\n\nEvery visual element, interaction pattern, and affordance in Cursive must honor our core values. This is not \"design for design's sake\"â€”it is the deliberate expression of a philosophy that rejects the hostile, engagement-optimized patterns of modern web platforms in favor of calm, embodied, human-centered craft.\n\n---\n\n## Visual Language: Japanese Woodworking Aesthetic\n\n**Why:** Embodies **Qualitative Perception**, **Embodied Cognition**, and **Verifiable Craft**. Japanese woodworking tools are precise, minimal, and beautifulâ€”they reveal their function without decoration.\n\n### Typography\n- **Font weights:** 300-400 (light to regular). Never \"bold\" except for critical actions\n- **Font sizes:** Modest and restrained (0.75rem - 1rem for UI, 1rem - 1.125rem for content)\n- **Letter spacing:** Slightly tight (-0.01em to -0.02em) for precision\n- **Line height:** Generous (1.6 - 1.8) for readability and calm\n\n### Color Palette: Stone & Natural Materials\n```css\n/* Primary palette - Stone colors */\n--stone-50: #fafaf9;   /* Backgrounds */\n--stone-100: #f5f5f4;  /* Subtle divisions */\n--stone-200: #e7e5e4;  /* Borders, dividers */\n--stone-300: #d6d3d1;  /* Stronger borders */\n--stone-400: #a8a29e;  /* Disabled state */\n--stone-500: #78716c;  /* Hover states */\n--stone-600: #57534e;  /* Secondary text */\n--stone-700: #44403c;  /* Primary text */\n--stone-800: #292524;  /* Headings, emphasis */\n--stone-900: #1c1917;  /* Maximum contrast */\n```\n\n**Anti-patterns to avoid:**\n- Bright, saturated colors (blue, red, green) except for **rare, meaningful signals**\n- Gradients, shadows, or glows\n- High-contrast \"pop\" elements designed to capture attention\n\n### Borders & Corners\n- **Border radius:** 2px maximum (square, precise corners)\n- **Border width:** 1px (consistent, clean lines)\n- **Border color:** Stone-200 to Stone-300 (subtle, not aggressive)\n- **No drop shadows** (except for true modals that need depth separation)\n\n### Spacing & Layout\n- **Gap between elements:** 0.25rem - 0.5rem (tight, considered)\n- **Padding:** Generous but not excessive (0.5rem - 1rem)\n- **Max-width for content:** 210mm (A4 paper metaphor - **Embodied Cognition**)\n- **Vertical rhythm:** Consistent, predictable spacing based on 0.25rem grid\n\n### Interactive Elements (Buttons, Links)\n- **Default state:** Subtle border, minimal background, stone colors\n- **Hover state:** Border darkens slightly, no animation\n- **Active state:** Inverted (dark background, light text)\n- **Disabled state:** Reduced opacity (0.35), muted color\n- **Transitions:** None or minimal (no smooth animations)\n\n---\n\n## Interaction Patterns: Deliberate, Not Optimized\n\n**Why:** Honors **Hospitality over Hostility** and **Competence over Automation**.\n\n### No Dark Patterns\n- **No infinite scroll** - Pages have fixed heights (A4 metaphor)\n- **No autoplay** - All media requires explicit interaction\n- **No engagement metrics** - No \"likes\", \"views\", or visible follower counts\n- **No notification badges** - We don't fight for attention\n- **No streaks or gamification** - Recognition honors genuine accomplishment, not habit formation\n\n### Intentional Friction\n- **Save actions require confirmation** - We value deliberation\n- **Pasting requires provenance** - You must cite external content\n- **Tool invocation is explicit** - Tools don't run automatically\n- **AI suggestions appear as whispers** - Never auto-accept, always ratify\n\n### Progressive Disclosure\n- **Beginners see scaffolding** - Helpful hints, structured guidance\n- **Masters get full control** - Expert modes reveal complexity\n- **Complexity is earned** - Features unlock as competence grows\n\n---\n\n## Component Patterns\n\n### Toolbar\n```css\n/* Japanese craft aesthetic - clean, minimal, precise */\n.editor-toolbar {\n  background: transparent;\n  border: none;\n  gap: 0.25rem;  /* Tight spacing */\n}\n\n.editor-toolbar__button {\n  border-radius: 2px;  /* Square corners */\n  border: 1px solid #e7e5e4;  /* Subtle stone border */\n  background: #fafaf9;  /* Stone-50 */\n  color: #292524;  /* Stone-800 */\n  font-weight: 400;  /* Regular weight, not bold */\n  transition: none;  /* No animations */\n}\n\n.editor-toolbar__button--active {\n  background: #292524;  /* Inverted */\n  color: #fafaf9;\n}\n```\n\n### Modal Overlays\n- **Backdrop:** Semi-transparent stone-900 with subtle blur\n- **Modal container:** White background, stone-200 border, 2px radius\n- **ESC key closes** - Keyboard accessibility\n- **Click outside closes** - Clear affordance for dismissal\n\n### Forms & Inputs\n- **Labels:** Above inputs, stone-700, 0.875rem\n- **Inputs:** Stone-200 border, 2px radius, stone-50 background\n- **Focus state:** Stone-500 border (no glow, no shadow)\n- **Validation:** Inline, immediate, with clear guidance\n\n---\n\n## Layout Principles\n\n### Page as Primary Metaphor\n- **Fixed dimensions:** 210mm Ã— 297mm (A4 paper)\n- **Sheets within pages:** Horizontal scroll for multi-page documents\n- **Overflow triggers new sheets:** Deliberate expansion, not infinite scroll\n\n### Toolbar Positioning\n- **Sticky below header:** Connected with shared border line\n- **Collapses when not needed:** Maximize writing space\n- **Minimal visual weight:** Doesn't compete with content\n\n### Title & Metadata\n- **Small, subtle:** 0.75rem, stone-600, editable with hover icon\n- **Positioned on page:** Not in global chrome\n- **Edit icon appears on hover:** Progressive disclosure\n\n---\n\n## Affordances for Core Values\n\n### 1. Qualitative Perception (Beauty, Awe, Pride)\n- **Process visibility:** Option to share stroke data, edit history, time spent\n- **Recognition without gamification:** Badges as certificates, not rewards\n- **Highlighting craft:** Show the maker's signature, the human fingerprint\n\n### 2. Embodied Cognition (Place, Body, Drawing)\n- **Pen/stylus as first-class:** Drawing is not \"extra\"\n- **GPS context:** Where you write matters\n- **Photo tools:** Leaf identifier, place markers (modals, not inline)\n\n### 3. Competence over Automation\n- **Suggestion + Ratification:** LLM proposes, human confirms\n- **Show confidence levels:** \"I'm 95% sure you wrote '1'\"\n- **Keep original input:** Never discard the human's raw expression\n\n### 4. Hospitality over Hostility\n- **Human hosts required:** Automation only reminds, never replaces\n- **Email-based interactions:** Hosts can act without opening platform\n- **Pause/resume cycles:** Respect human rhythms and vacations\n\n### 5. Verifiable Craft (Process as Proof)\n- **Stroke count logging:** For proof-of-human signatures\n- **Provenance flags:** `origin: human | suggested`\n- **Export includes receipts:** Process metadata travels with content\n\n### 6. Sovereignty (True Ownership)\n- **Export everything:** `.cursive` bundles with full provenance\n- **Encrypted badges:** Cryptographically owned, portable\n- **Protocol guarantees:** Values encoded in data structures\n\n---\n\n## Implementation Checklist\n\nBefore adding any new UI component, ask:\n\n- [ ] Does it use stone colors and 2px border-radius?\n- [ ] Does it avoid animation/transition effects?\n- [ ] Does it require explicit user action (no auto-behavior)?\n- [ ] Does it support keyboard navigation and accessibility?\n- [ ] Does it feel calm, deliberate, and crafted?\n- [ ] Does it serve the human heart, not engagement metrics?\n\nIf any answer is \"no\", redesign or don't build.\n\n---\n\n## Reference Implementations\n\nSee `reference-app/src/styles/tab-editor.css` for canonical examples:\n- `.editor-toolbar` - Japanese craft aesthetic\n- `.sheet-panel` - A4 paper metaphor\n- `.sheet-title-button` - Minimal, hover-revealed edit icon\n- `.toolbar-expand` - Square, subtle, intentional\n\n---\n\n**Next:** See [DATA_DICTIONARY.md](./DATA_DICTIONARY.md) for how these design patterns map to specific primitives and affordances.\n"
          },
          {
            "file_name": "003-paginated-documents-with-session-recording.md",
            "file_size": 5082,
            "file_type": "",
            "extracted_content": "# ADR 003: Paginated Documents with Session Recording\n\n**Status**: Accepted\n**Date**: 2025-10-30\n**Deciders**: Protocol Team\n**Related**: VALUES.md (Embodied Cognition, Sovereignty), README.md (Page primitive)\n\n---\n\n## Context\n\nWe faced a critical tension in the Page primitive design:\n\n1. **Atomicity Requirement**: A daily journal entry should be a single atomic unit for export, backup, and integrity\n2. **Performance Constraint**: Loading a 400-page document (118,800mm of content) is impractical\n3. **Visual Metaphor**: We want to maintain the A4 page metaphor with visible page breaks\n4. **Playback Feature**: Users want to replay their writing/drawing sessions with scroll history\n5. **Deep Linking**: Need to link to specific sections within a long document\n\nThe initial \"sheets in metadata\" approach created complexity without solving the performance issue.\n\n---\n\n## Decision\n\nWe will implement a **hybrid atomic + paginated architecture**:\n\n### Data Model\n\n**Single atomic document in database**:\n```typescript\npages: {\n  id: uuid,\n  content: JSONContent,  // Full TipTap document (logical)\n  metadata: {\n    page_breaks: PageBreak[],        // Visual markers\n    session_recordings: SessionEvent[], // Playback data\n    total_pages: number,\n    created_at: timestamp,\n    updated_at: timestamp\n  }\n}\n\ninterface PageBreak {\n  offset: number;      // Vertical offset in mm\n  id: string;          // For anchoring (e.g., \"page-2\")\n  created_at: timestamp;\n}\n\ninterface SessionEvent {\n  timestamp: number;\n  type: 'scroll' | 'typing' | 'drawing';\n  data: {\n    page?: number,\n    position?: number,\n    content?: any\n  };\n}\n```\n\n### URL Structure\n\n```\n/user/journal/2025-10-29                   // Default (page 1)\n/user/journal/2025-10-29?page=2            // Specific page\n/user/journal/2025-10-29?page=2#heading    // Page + anchor\n/user/journal/2025-10-29?playback=session-123  // Playback mode\n```\n\n### Loading Strategy\n\n**Client requests**: `GET /api/pages/{id}?page=2`\n\n**Server responds with**:\n```json\n{\n  \"page\": 2,\n  \"content\": {...},  // Only this page's content\n  \"surroundingPages\": [1, 3],\n  \"totalPages\": 400,\n  \"hasNext\": true,\n  \"hasPrev\": true,\n  \"pageBreaks\": [...]\n}\n```\n\n**Client prefetches**: Adjacent pages (n-1, n+1) for smooth navigation\n\n**Virtual scrolling**: Only render visible page + 1 above + 1 below\n\n### Export Strategy\n\n**Full document export**: Server assembles all pages into single atomic JSON\n```json\n{\n  \"content\": {...},  // Complete TipTap doc\n  \"metadata\": {\n    \"page_breaks\": [...],\n    \"session_recordings\": [...],\n    \"total_pages\": 400,\n    \"total_words\": 12000\n  },\n  \"format_version\": \"1.0\"\n}\n```\n\n---\n\n## Consequences\n\n### Positive\n\nâœ… **Performance**: Load 1-3 pages at a time, regardless of document size\nâœ… **Atomicity**: Single export captures complete document\nâœ… **Open Web**: REST-style `/username/...` paths with standard query parameters for navigation\nâœ… **Playback**: Session events enable \"replay creation\" feature\nâœ… **Deep Linking**: Page + anchor = shareable URLs\nâœ… **Print Ready**: CSS `@page` breaks work naturally\nâœ… **Simplicity**: No complex sheet metadata management\n\n### Negative\n\nâŒ **Server Complexity**: Must chunk/reassemble documents\nâŒ **Prefetch Logic**: Need smart adjacent page loading\nâŒ **State Management**: Track current page across reloads\n\n### Neutral\n\nâš–ï¸ **Visual Page Markers**: Inserted automatically at 297mm intervals\nâš–ï¸ **Drawing Canvas**: One canvas per loaded page (manageable)\nâš–ï¸ **Session Recording**: Adds ~10KB per hour of writing (acceptable)\n\n---\n\n## Implementation Notes\n\n### Phase 1: Core Pagination (Week 1)\n- [ ] API endpoint: `GET /api/pages/{id}?page=n`\n- [ ] Client-side virtualization hook\n- [ ] URL query param handling\n- [ ] Page navigation UI (sidebar)\n\n### Phase 2: Session Recording (Week 2)\n- [ ] Record scroll, typing, drawing events\n- [ ] Store in `metadata.session_recordings`\n- [ ] Playback viewer component\n- [ ] Timeline scrubber UI\n\n### Phase 3: Export & Polish (Week 3)\n- [ ] Full document assembly endpoint\n- [ ] `.cursive` export format with sessions\n- [ ] Print stylesheet with page breaks\n- [ ] iPad drawing lock feature\n\n---\n\n## Alternatives Considered\n\n### Alternative 1: Infinite Scroll (No Pagination)\n**Rejected**: Performance issues with large documents, drawing canvas complexity\n\n### Alternative 2: Sheets as Separate Rows\n**Rejected**: Loses atomic day concept, more DB rows, harder to version\n\n### Alternative 3: Collections as Days\n**Rejected**: Over-engineered, breaks schema hierarchy\n\n---\n\n## Related Documents\n\n- [VALUES.md](../VALUES.md) - Embodied Cognition (A4 metaphor), Sovereignty (atomic export)\n- [README.md](../README.md) - Page primitive definition\n- [DATA_DICTIONARY.md](../docs/DATA_DICTIONARY.md) - Page schema\n\n---\n\n## References\n\n- Google Docs pagination strategy\n- Notion's block-based rendering\n- TipTap virtualization examples\n- W3C CSS Paged Media Module\n\n---\n\n**Approved by**: Protocol Team\n**Implementation**: Starting 2025-10-30\n"
          },
          {
            "file_name": "ADR-001-TWO-PRIMITIVES.md",
            "file_size": 13802,
            "file_type": "",
            "extracted_content": "# ADR 001: Two Primitives + Extension Taxonomy\n\n**Status:** Proposed\n**Date:** 2025-10-22\n**Deciders:** Bilal\n**Tags:** architecture, primitives, protocol\n\n---\n\n## Context and Problem Statement\n\nCursive needs a parsimonious architecture that is:\n- **Paper-simple** - As versatile as paper (book, origami, hat)\n- **Protocol-grade** - Clear enough for cross-implementation interoperability\n- **Human-legible** - Creators never touch \"scary schema talk\"\n- **Values-aligned** - Respects agency, transparency, provenance, hospitality\n\n**Question:** How many primitives? What's core protocol vs. extension?\n\n---\n\n## Decision Drivers\n\n1. **Simplicity** - Fewer primitives = clearer mental model\n2. **Expressiveness** - Must support courses, journals, games, rituals, salons\n3. **Interoperability** - Other implementations must understand core contract\n4. **Extensibility** - Power features without bloating the base\n5. **Human Agency** - User control, contestability, transparency\n\n---\n\n## Considered Options\n\n### Option A: Three Primitives (Pages, Routes, Tools)\n- Pages = content\n- Routes = navigation\n- Tools = AI helpers\n\n**Rejected:** Tools are too heterogeneous - inline lenses vs route computations vs insight generation are different concerns.\n\n### Option B: One Primitive (Pages + Metadata)\n- Everything is a page with different metadata\n- Routes are page metadata\n- Tools are page references\n\n**Rejected:** Too generic, loses clarity about what happens when.\n\n### Option C: Two Primitives + Extension Points (CHOSEN)\n- **Core:** Pages, Routes\n- **Extensions:** Lenses, Insights, Anchors, Computations\n\n---\n\n## Decision Outcome\n\n**Chosen option:** Two Primitives + Extension Taxonomy\n\n### Core Protocol (CP-1.0)\n\n#### Primitive 1: **Page**\n\n**What it is:**\n- Unit of human thought (writing, drawing, responding)\n- TipTap JSON content + structured fields (JSONB) + metadata/tags\n\n**Schema:**\n```typescript\ninterface Page {\n  id: string;\n  section_id: string;\n  content: TipTapJSON;           // Rich text + custom nodes\n  fields: Record<string, any>;   // Structured responses (deterministic)\n  metadata: {\n    tags: string[];              // Semantic grouping\n    template?: string;           // Created from template\n    created_at: timestamp;\n    updated_at: timestamp;\n  };\n}\n```\n\n**Custom TipTap Nodes (part of protocol):**\n- `questionNode` - Structured questions (deterministic form fields)\n- `transclude` - Embed other pages\n- `drawing` - Canvas areas (ink strokes)\n- `guidePrompt` - Prompts from guides\n\n**Key:** Pages are self-contained. No page depends on routes to exist.\n\n---\n\n#### Primitive 2: **Route**\n\n**What it is:**\n- Declarative instruction for \"what happens after this page\"\n- Triggered by Continue button (or auto-trigger)\n- Contains: condition + action\n\n**Schema:**\n```typescript\ninterface Route {\n  id: string;\n  from_page_id: string;\n  trigger: 'continue' | 'auto';\n\n  // Condition (optional - omit for unconditional)\n  condition?: {\n    type: 'simple' | 'formula' | 'computation';\n\n    // Simple: single field comparison\n    simple?: {\n      field: string;           // e.g., \"energy-level\"\n      operator: 'eq' | 'neq' | 'gt' | 'lt' | 'contains';\n      value: any;\n    };\n\n    // Formula: JavaScript-like expression\n    formula?: string;          // e.g., \"(fields.score1 + fields.score2) / 2 > 7\"\n\n    // Computation: call extension\n    computation?: {\n      type: string;            // e.g., \"llm-eval\", \"matching\", \"rollup\"\n      config: any;\n    };\n  };\n\n  // Action (required)\n  action: {\n    type: 'navigate' | 'create' | 'notify';\n\n    // Navigate\n    to_page_id?: string;\n\n    // Create\n    template?: string;\n    fields?: Record<string, any>;\n    organization?: {\n      folder: string;\n      tags: string[];\n    };\n\n    // Notify\n    recipient_id?: string;\n    message?: string;\n  };\n\n  // Multiple routes per page, evaluated in order\n  order: number;\n}\n```\n\n**Key:** Routes are declarative. Computation types are extensible.\n\n---\n\n### Extension Points (Explicitly Not Primitives)\n\nThese are **capabilities** that enhance the core but aren't required for protocol compliance.\n\n#### Extension 1: **Lenses** (Inline Writing Tools)\n\n**What it is:**\n- User-invoked AI helper during writing\n- Suggests, never autonomous\n- Always shows cost + requires approval\n\n**Trigger:** `/` menu or text selection\n\n**Examples:**\n- Find connections to past work\n- Get examples of concept\n- Suggest structure\n- Cite sources\n\n**Protocol contract:**\n```typescript\ninterface Lens {\n  id: string;\n  name: string;\n  trigger: 'inline' | 'selection';\n  prompt_template: string;\n  context_sources: string[];     // 'page.content', 'user.past_pages', etc.\n  output_schema: JSONSchema;\n  actions: {\n    type: 'insert' | 'suggest' | 'create_page';\n    label: string;\n  }[];\n  cost_cents?: number;\n  requires_approval: boolean;\n}\n```\n\n**Implementation:** Reference server provides lens execution. Clients render suggestions.\n\n---\n\n#### Extension 2: **Computations** (Route Logic)\n\n**What it is:**\n- Pluggable evaluation logic called BY routes\n- Deterministic or LLM-enhanced\n\n**Types:**\n\n**Type: `deterministic`**\n- Pure logic (no LLM)\n- Examples: field comparison, array intersection, aggregation\n\n**Type: `matching`**\n- Structured field comparison between users\n- Example: mentor matching by skills + availability\n\n**Type: `llm-eval`**\n- Call LLM with prompt + schema\n- Returns structured result\n- Route condition checks result\n\n**Protocol contract:**\n```typescript\ninterface Computation {\n  type: string;                    // Extensible: \"deterministic\", \"matching\", \"llm-eval\", custom\n  config: any;                     // Type-specific config\n\n  // For llm-eval:\n  config: {\n    prompt: string;\n    context_sources: string[];\n    output_schema: JSONSchema;\n  };\n}\n```\n\n**Implementation:** Server evaluates, clients trust result.\n\n---\n\n#### Extension 3: **Insights** (Pattern Detection)\n\n**What it is:**\n- Derived observations from page responses\n- Built via Notices (what to observe) â†’ Insights (observations with evidence)\n\n**Trigger:** Page completion, rollup jobs, dashboard queries\n\n**Protocol contract:**\n```typescript\ninterface Notice {\n  id: string;\n  guide_id: string;\n  name: string;                    // \"Energy trends\", \"Struggling with integration\"\n  kind: 'deterministic' | 'llm' | 'rollup';\n  config: {\n    source: string;                // SQL-like or tag-based query\n    computation?: Computation;     // Optional LLM enhancement\n  };\n}\n\ninterface Insight {\n  id: string;\n  notice_id: string;\n  user_id: string;\n  scope: 'page' | 'user' | 'guide';\n  value: {\n    raw: any;                      // Direct metric value\n    interpreted?: any;             // LLM interpretation\n    theory_of_mind?: {             // User model\n      knows: string[];\n      struggles_with: string[];\n      prefers: string[];\n      confidence: number;\n    };\n  };\n  evidence: {                      // Provenance\n    page_id: string;\n    excerpt: string;\n    start: number;\n    end: number;\n  }[];\n  created_at: timestamp;\n}\n```\n\n**Key:** Insights ALWAYS include evidence. Users can contest/edit.\n\n---\n\n#### Extension 4: **Anchors** (Context Beyond Pages)\n\n**What it is:**\n- Contextual metadata for pages (time, location, people)\n\n**Types:**\n\n**Time Anchors:**\n- `scheduled_for` - Due dates for mail items\n- `created_at`, `updated_at` - Automatic timestamps\n\n**Person Anchors:**\n- `author_id` - Who wrote this\n- `recipient_id` - Who receives this (letters, mail)\n- `participant_ids` - Collaborators (shared pages)\n\n**Place Anchors (GPS-aware, opt-in):**\n- `location: {lat, lon, accuracy, timestamp}`\n- Enables place-bound experiences (walks, field trips, locative games)\n\n**Protocol contract:**\n```typescript\ninterface Anchor {\n  type: 'time' | 'person' | 'place';\n\n  // Time\n  scheduled_for?: timestamp;\n\n  // Person\n  author_id?: string;\n  recipient_id?: string;\n\n  // Place (requires explicit user consent)\n  location?: {\n    lat: number;\n    lon: number;\n    accuracy: number;\n    timestamp: timestamp;\n    consent_given: boolean;       // Must be true\n  };\n}\n```\n\n**Privacy guarantee:** GPS data NEVER sent without explicit per-page consent.\n\n---\n\n### Extension Taxonomy (Inheritance Tree)\n\n```\nCURSIVE PROTOCOL\nâ”‚\nâ”œâ”€ PRIMITIVES (required for compliance)\nâ”‚  â”œâ”€ Page\nâ”‚  â””â”€ Route\nâ”‚\nâ”œâ”€ EXTENSIONS (optional, composable)\nâ”‚  â”‚\nâ”‚  â”œâ”€ Content Extensions\nâ”‚  â”‚  â”œâ”€ Custom TipTap Nodes (questionNode, transclude, drawing)\nâ”‚  â”‚  â””â”€ Rich Media (images, videos, embeds)\nâ”‚  â”‚\nâ”‚  â”œâ”€ Logic Extensions\nâ”‚  â”‚  â”œâ”€ Computations (deterministic, matching, llm-eval)\nâ”‚  â”‚  â””â”€ Route Conditions (simple, formula, computation)\nâ”‚  â”‚\nâ”‚  â”œâ”€ Intelligence Extensions\nâ”‚  â”‚  â”œâ”€ Lenses (inline tools, selection tools)\nâ”‚  â”‚  â”œâ”€ Insights (notices, observations, ToM)\nâ”‚  â”‚  â””â”€ Context (rollup, aggregation, profiles)\nâ”‚  â”‚\nâ”‚  â””â”€ Anchor Extensions\nâ”‚     â”œâ”€ Time (scheduling, history)\nâ”‚     â”œâ”€ Person (authorship, collaboration)\nâ”‚     â””â”€ Place (GPS, locative, opt-in)\nâ”‚\nâ””â”€ IMPLEMENTATIONS (how servers/clients realize it)\n   â”œâ”€ Reference Server (AGPL, Supabase/Postgres)\n   â”œâ”€ Reference Client (Proprietary, Next.js/TipTap)\n   â””â”€ Third-party (mobile apps, LMS integrations, etc.)\n```\n\n---\n\n## Consequences\n\n### Good\n\nâœ… **Mental clarity** - \"Pages and routes, everything else is optional\"\nâœ… **Protocol-grade** - Clear contract for cross-implementation\nâœ… **Extensibility** - Add GPS, new computations, custom lenses without changing core\nâœ… **Graceful degradation** - Core works without any extensions\nâœ… **Human-legible** - Authors write pages, optionally add routes, never see \"extensions\"\n\n### Bad\n\nâš ï¸ **Implied complexity** - Lenses/insights \"just appear\" to creators\nâš ï¸ **Rollup magic** - When does guide metric become user trait?\nâš ï¸ **Implementation burden** - Servers must implement extension registry\n\n### Neutral\n\nðŸ”· **Two-tier protocol** - Core (pages/routes) vs Extensions (everything else)\nðŸ”· **Spec work required** - Each extension needs formal contract\n\n---\n\n## Compliance Requirements\n\n### Tier 1: Core Protocol\n**Required for \"Cursive 1.0 Compliant\":**\n- [ ] Store/retrieve Pages (with content, fields, metadata)\n- [ ] Evaluate Routes (simple conditions + navigate/create/notify actions)\n- [ ] Support deterministic computations\n- [ ] Export format (JSON with pages + routes)\n\n### Tier 2: Intelligence Extensions\n**Optional, declare support:**\n- [ ] Lenses (inline tools)\n- [ ] LLM computations (llm-eval)\n- [ ] Insights (notices + observations)\n- [ ] Context rollup\n\n### Tier 3: Anchor Extensions\n**Optional, declare support:**\n- [ ] Time anchors (scheduling)\n- [ ] Person anchors (collaboration)\n- [ ] Place anchors (GPS, with privacy guarantees)\n\n---\n\n## Implementation Notes\n\n### For Creators (How it feels):\n\n**Writing a page:**\n1. Write content in TipTap\n2. Optionally add `/question` blocks (structured fields)\n3. Optionally invoke lenses (`/` menu)\n4. Hit Continue\n\n**Adding routing:**\n1. Click routing icon\n2. Add simple rules: \"If energy is high â†’ Challenge page\"\n3. Or use templates (Yes/No branch, etc.)\n\n**No mention of \"extensions\" or \"primitives\".** Just pages and optional branching.\n\n---\n\n### For Implementers (What to build):\n\n**Minimum viable (Tier 1):**\n- PostgreSQL schema (pages, routes)\n- Route evaluator (simple conditions)\n- REST API (CRUD pages/routes)\n- Export JSON\n\n**Full reference (Tier 2 + 3):**\n- LLM integration (OpenAI/Anthropic)\n- Lens execution\n- Insight rollup jobs\n- GPS permission flow\n\n---\n\n## Open Questions\n\n### 1. Context Roll-up Rules\n**Problem:** When does a guide metric become a user trait?\n\n**Proposed solution:**\n- User sees \"Context Timeline\" (editable)\n- Each insight shows: source page + \"Why we believe this\" + Veto button\n- Rollup happens on page completion, user can contest immediately\n- **See ADR-002 for full design**\n\n### 2. Insight Card Interoperability\n**Problem:** Dashboard cards live in docs, not spec.\n\n**Proposed solution:**\n- Draft CP-1.0-Insights spec\n- Schema: card config, query language, evidence requirements\n- Rendering hints (chart type, filters)\n- **See ADR-003 for full spec**\n\n### 3. GPS Privacy Guardrails\n**Problem:** Place anchors assume opt-in hardware and permissions.\n\n**Proposed solution:**\n- Per-page consent (never blanket permission)\n- Graceful fallback (manual text entry: \"Today I'm at...\")\n- Privacy stories documented\n- **See ADR-004 for capabilities matrix**\n\n### 4. Deterministic + LLM Mental Models\n**Problem:** Mixing deterministic and LLM logic in same route confuses authors.\n\n**Proposed solution:**\n- Simple Mode: only deterministic (field comparisons)\n- Advanced Mode: unlock formulas + LLM computations\n- Clear UI affordance: \"This route uses AI\" badge\n- **See SIMPLE_UX_METRICS_ROUTING.md**\n\n---\n\n## Related Decisions\n\n- ADR-002: Context Roll-up with User Agency (TBD)\n- ADR-003: Insight Card Protocol Spec (TBD)\n- ADR-004: GPS Capabilities and Privacy Matrix (TBD)\n- ADR-005: Guided Authoring Workflow (TBD)\n\n---\n\n## References\n\n- `CURSIVE_V2_FINAL_CLEAN.md` - Master architecture\n- `SIMPLE_UX_METRICS_ROUTING.md` - UX design for metrics/routing\n- `ARCHITECTURE_CLARIFICATIONS.md` - Questions that led to this ADR\n\n---\n\n**Status:** Ready for review. Awaiting confirmation before updating master docs.\n"
          },
          {
            "file_name": "VALUES.md",
            "file_size": 10932,
            "file_type": "",
            "extracted_content": "# The Cursive Values\n\n**Last Updated:** October 29, 2025\n**Purpose:** To define the philosophical foundation of the Cursive Protocol\n\n---\n\n## Preamble: Reintegrating the Human Heart\n\nCursive is a quiet stand for humanity on the internet. It rejects the post-Cartesian split that severed mind from body, reason from feeling, objective from subjective. We believe that true knowing is qualitative, embodied, and feltâ€”not just measured and analyzed.\n\nThis is software for the human heart. It creates space for:\n- **Awe** - The feeling when we witness someone's genuine craft\n- **Pride** - The satisfaction of working hard on something beautiful\n- **Depth** - The productive friction that comes from sitting with difficulty\n- **Connection** - The recognition that comes from truly seeing another's work\n\nWe use modern technology not to optimize away the human experience, but to amplify and celebrate it.\n\n---\n\n## The Six Core Values\n\n### 1. Qualitative Perception & The Human Heart\n\n**Core Idea:** There are ways of knowing that cannot be reduced to data. Beauty, meaning, connection, and understanding are felt realities that precede and transcend measurement. The system must honor qualitative experience as a legitimate form of knowledge.\n\n**How This Value Speaks:**\n> \"...productive friction, helping people make time/space to really enjoy the beauty of human connection and depth and working hard on something and being proud of the work and craft and seeing other people's work/effort and being in awe...\"\n\n**Implications for the Protocol:**\n- The protocol must have primitives for expressing and preserving qualitative dimensions: beauty, effort, meaning, connection\n- Metrics exist to serve understanding, never to replace felt experience\n- The system deliberately creates \"productive friction\" - moments that require patience, care, and sustained attention\n- Features are designed to help people notice and appreciate the texture of human work: the hesitation in a drawing, the revision history of a thought, the care in a response\n- Success is measured not in engagement metrics but in reported depth of experience and quality of connection\n\n**Anti-Patterns to Avoid:**\n- Reducing human experience to quantifiable metrics (likes, followers, engagement scores)\n- Optimizing for speed and efficiency over depth and meaning\n- Treating all content as equivalent \"data\" regardless of its human context\n- Gamification that manipulates behavior rather than supporting intrinsic motivation\n\n---\n\n### 2. Embodied & Situated Knowing\n\n**Core Idea:** True understanding is not abstract or disembodied. It is rooted in our physical bodies, our senses, and the specific places we inhabit. The digital tool must honor and connect with the physical world, not replace it.\n\n**How This Value Speaks:**\n> \"...connecting people to their qualitative perspectives, connecting to place (GPS, looking around you, a tool that allows you to upload a photo of a leaf to know what kind of trees are growing nearby, etc) and to the body, using a pen, drawing...\"\n\n**Implications for the Protocol:**\n- The protocol must support sensory input: location, images, audio, physical gestures\n- The page metaphor respects the haptic reality of paper - it has size, texture, resistance\n- Drawing with a pen is a first-class citizen, not a secondary feature\n- Tools can connect writing to place: what trees surround you, what season is it, where are you sitting\n- The system assumes users are whole people in real places, not disembodied \"users\"\n\n**Anti-Patterns to Avoid:**\n- Assuming all interaction happens at a desk on a large screen\n- Treating physical context as \"metadata\" rather than essential information\n- Making handwriting/drawing second-class to typing\n- Creating experiences that require sustained screen attention at the expense of being present in place\n\n---\n\n### 3. Apprenticeship & Mastery (Competence over Automation)\n\n**Core Idea:** Technology should function as a master craftsperson's tool, designed to help an apprentice gain competence. It scaffolds skill, it doesn't automate it away. Its purpose is to make the user better, not to make itself indispensable.\n\n**How This Value Speaks:**\n> \"...the idea that the LLM doesn't DO anything for you, it helps you gain competence not decays it... people can talk freeform and the LLMs can help provide a structured answer (multi/single select, number, etc) without making the person a button presser, they can share freely...\"\n\n**Implications for the Protocol:**\n- AI interactions must be designed as learning opportunities, not shortcuts\n- The protocol favors \"suggestion and ratification\" over \"generation and acceptance\"\n- The system tracks the user's engagement with the process as a measure of growing skill\n- Complexity is revealed progressively - beginners get scaffolding, masters get full control\n- Every automated assistance must have a manual override that teaches the underlying skill\n\n**Anti-Patterns to Avoid:**\n- AI that completes tasks without user involvement (e.g., \"write this essay for me\")\n- Hiding complexity in ways that prevent understanding\n- Creating dependency on the tool rather than building user capability\n- Optimizing for quick results over deep learning\n\n---\n\n### 4. Gardens, Not Battlefields (Hospitality over Hostility)\n\n**Core Idea:** The digital world should be a cultivated space for growth, reflection, and connectionâ€”a gardenâ€”not a battlefield for attention. This requires human tending, deliberate paths, and a rejection of algorithmic manipulation.\n\n**How This Value Speaks:**\n> \"...hospitality (courses are together, hosts //must// send you the prompts on schedule, the tool just reminds them when to send it)... we want to create a calm, connecting publishing platform where we can show ourselves as one of the last stands for humanity on the internet, webrings not algorithmic... we recognize in the background - not as a way to manipulate people into behaviors (badges)...\"\n\n**Implications for the Protocol:**\n- The protocol must prioritize human-curated connections over machine-generated feeds\n- It must have primitives for \"hosting\" and \"guiding\" that empower human facilitators\n- The system operates on human rhythms, not algorithmic optimization for engagement\n- Recognition exists to honor genuine accomplishment, never to manipulate behavior\n- Connections happen through deliberate invitation (webrings), not opaque algorithms\n\n**Anti-Patterns to Avoid:**\n- Infinite scroll, autoplay, or other engagement-maximizing dark patterns\n- Algorithmic feeds that optimize for attention capture\n- Gamification designed to create addiction (streaks, points, leaderboards)\n- Automated notifications that interrupt flow\n- Making human facilitators optional or replaceable by automation\n\n---\n\n### 5. Authenticity & Verifiable Craft (Process as Proof)\n\n**Core Idea:** In an age of effortless digital reproduction, the process of human creationâ€”with all its effort, messiness, and intentionâ€”is a precious and verifiable act. The system must be able to distinguish and celebrate authentic human work.\n\n**How This Value Speaks:**\n> \"...we don't allow pasting without provenance/citation and maybe no images unless you drew them yourself... making it so you do your work out loud, in public, sharing your page/process... proof-ish of human (save stroke count/monitor for human patterns and personal fingerprints)...\"\n\n**Implications for the Protocol:**\n- The protocol must be a high-fidelity recorder of the creative act\n- It needs primitives for provenance, citation, and process_metadata (stroke data, edit history, time spent)\n- The system defines what constitutes a \"proof-of-human\" signature\n- Content created by AI must be clearly marked and cited\n- The process of creation is as valuable as the final artifact\n- Users can choose to share their \"making-of\" as evidence of authentic work\n\n**Anti-Patterns to Avoid:**\n- Allowing uncited copying or pasting from external sources\n- Treating AI-generated and human-generated content as equivalent\n- Hiding the process and only showing polished final products\n- Making it easy to falsely claim work as one's own\n- Optimizing for productivity at the expense of genuine craft\n\n---\n\n### 6. Sovereignty & Durability (True Ownership)\n\n**Core Idea:** A person's thoughts, identity, and reputation are their own. They must be cryptographically owned, truly portable, and durable enough to outlive any single platform. The protocol, not the platform, is the guarantee.\n\n**How This Value Speaks:**\n> \"...encrypted profiles where badges are truly owned by people and exportable off the system... all this must be exportable and transposable to other systems operating by the same protocol, the protocol must encode the values...\"\n\n**Implications for the Protocol:**\n- The protocol is the ultimate guarantor of user sovereignty\n- It must define data structures not just for content, but for verifiable credentials, reputation, and identity\n- All user data must be exportable in a clean, documented format\n- The protocol must be built on open, durable standards (not proprietary formats)\n- A user must be able to pack up their entire digital self and move elsewhere\n- The protocol itself must encode these values so that any compliant implementation respects them\n\n**Anti-Patterns to Avoid:**\n- Proprietary data formats that lock users in\n- Making export difficult, incomplete, or lossy\n- Claiming ownership over user-generated content\n- Building features that only work within the platform ecosystem\n- Using network effects to trap users rather than serve them\n\n---\n\n## Living These Values: Design Principles\n\nEvery feature, every decision, every line of code must be judged against these values. When in doubt, ask:\n\n1. **Does this honor the qualitative, felt experience?** Or does it reduce humanity to metrics?\n2. **Does this connect people to their bodies and places?** Or does it further disembodiment?\n3. **Does this help users gain competence?** Or does it create dependency?\n4. **Does this create a cultivated garden?** Or does it exploit attention?\n5. **Does this honor authentic craft?** Or does it enable easy forgery?\n6. **Does this ensure sovereignty?** Or does it trap users?\n\nIf a feature violates any of these values, we either redesign it or we don't build it.\n\n---\n\n## The Promise\n\nWe promise to build technology that:\n- Respects the human heart and qualitative knowing\n- Honors the body and the physical world\n- Helps people grow in skill and understanding\n- Creates calm, hospitable spaces for connection\n- Celebrates authentic human effort\n- Ensures lasting ownership and portability\n\nThis is the Cursive Protocol. This is our stand for humanity on the internet.\n\n---\n\n**Next Steps:**\n- See [DATA_DICTIONARY.md](./docs/DATA_DICTIONARY.md) for how values translate into primitives\n- See [DESIGN_PHILOSOPHY.md](./docs/DESIGN_PHILOSOPHY.md) for UI/UX design principles\n"
          },
          {
            "file_name": "CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md",
            "file_size": 12539,
            "file_type": "",
            "extracted_content": "# Cursive Protocol 1.0 - Specification Outline\n\n**Date:** October 22, 2025  \n**Status:** Draft for review  \n**Purpose:** Reference standard for implementations\n\n---\n\n## ðŸŽ¯ Overview\n\n**Cursive Protocol (CP) defines:**\n- How pages are structured (CPL - Cursive Page Language)\n- How logic executes (CSA - Cursive Script API)\n- How tools work (CTP - Cursive Tool Protocol)\n- How data flows (CDA - Cursive Data API)\n- How instances federate (CPF - Cursive Protocol Federation)\n\n**Like HTTP/HTML/JavaScript:**\n- Open specification\n- Multiple implementations possible\n- Versioned (CP-1.0, CP-1.1, etc.)\n- Compliance test suite\n\n---\n\n## ðŸ“š Specification Documents\n\n### CP-1.0-CPL: Cursive Page Language\n\n**Defines:** Content structure\n\n```markdown\n# Cursive Page Language 1.0\n\n## 1. Page Structure\n\nA page is a JSON document with:\n- metadata (author, created_at, version)\n- content (TipTap JSON)\n- fields (structured key-value pairs)\n- context_hints (tags, topics)\n\n### 1.1 Minimal Valid Page\n\n{\n  \"cursive\": \"1.0\",\n  \"type\": \"page\",\n  \"id\": \"uuid\",\n  \"metadata\": {\n    \"author\": \"user@instance.com\",\n    \"created_at\": \"2025-01-15T10:00:00Z\"\n  },\n  \"content\": {\n    \"type\": \"doc\",\n    \"content\": []\n  }\n}\n\n## 2. Content Blocks\n\n### 2.1 Standard Blocks (TipTap-compatible)\n- paragraph\n- heading (1-6)\n- bullet_list / ordered_list\n- blockquote\n- code_block\n\n### 2.2 Cursive-Specific Blocks\n\n#### 2.2.1 Question Block\n{\n  \"type\": \"question\",\n  \"attrs\": {\n    \"key\": \"energy\",\n    \"qtype\": \"rating\",\n    \"prompt\": \"How is your energy?\",\n    \"required\": true,\n    \"min\": 1,\n    \"max\": 5\n  }\n}\n\nQuestion types:\n- rating (min/max)\n- text (short/long)\n- choice (single/multiple)\n- scale (labeled points)\n- checkbox (boolean)\n\n#### 2.2.2 Ink Block\n{\n  \"type\": \"ink\",\n  \"attrs\": {\n    \"strokes\": [\n      {\n        \"points\": [[x,y,p], ...],\n        \"color\": \"#000000\",\n        \"width\": 2\n      }\n    ],\n    \"width\": 800,\n    \"height\": 600\n  }\n}\n\n#### 2.2.3 Transclusion Block\n{\n  \"type\": \"transclusion\",\n  \"attrs\": {\n    \"source_page_id\": \"uuid\",\n    \"excerpt\": true,\n    \"editable\": false\n  }\n}\n\n## 3. Fields (Structured Data)\n\nPages have a `fields` object for structured data:\n\n{\n  \"fields\": {\n    \"energy\": 4,\n    \"topics\": [\"integrals\", \"by-parts\"],\n    \"completed\": true,\n    \"submitted_at\": \"2025-01-15T14:30:00Z\"\n  }\n}\n\nField types:\n- string\n- number\n- boolean\n- array\n- object\n- date/timestamp\n\n## 4. Context Hints\n\n{\n  \"context_hints\": {\n    \"tags\": [\"reflection\", \"math\"],\n    \"topics\": [\"integrals\"],\n    \"difficulty\": \"intermediate\",\n    \"estimated_time_minutes\": 30\n  }\n}\n\n## 5. Compliance\n\nA CP-1.0-CPL compliant implementation MUST:\n- Accept valid page JSON\n- Render standard blocks\n- Store fields accurately\n- Preserve unknown fields (forward compatibility)\n- Validate against JSON schema\n\nA CP-1.0-CPL compliant implementation SHOULD:\n- Render cursive-specific blocks\n- Support ink drawing\n- Handle transclusions\n\nA CP-1.0-CPL compliant implementation MAY:\n- Add custom block types (namespaced)\n- Extend fields schema\n- Add metadata fields\n```\n\n---\n\n### CP-1.0-CSA: Cursive Script API\n\n**Defines:** Logic execution\n\n```markdown\n# Cursive Script API 1.0\n\n## 1. Routes\n\nRoutes define what happens when user continues from a page.\n\n### 1.1 Route Structure\n\n{\n  \"cursive\": \"1.0\",\n  \"type\": \"route\",\n  \"id\": \"uuid\",\n  \"from_page_id\": \"uuid\",\n  \"trigger\": \"submit\",\n  \"condition\": {\n    \"if\": {\"fields.completed\": true},\n    \"then\": \"execute\"\n  },\n  \"action\": {\n    \"type\": \"navigate\" | \"create_page\",\n    \"to_page_id\": \"uuid\",  // if navigate\n    \"template\": \"string\",  // if create\n    \"computation\": {...}   // optional\n  }\n}\n\n## 2. Conditions\n\n### 2.1 Comparison Operators\n- eq (equals)\n- ne (not equals)\n- gt, gte, lt, lte (numeric comparison)\n- in (array membership)\n- contains (string/array contains)\n\n### 2.2 Logical Operators\n- and\n- or\n- not\n\n### 2.3 Examples\n\n// Simple\n{\"fields.energy\": {\"gte\": 4}}\n\n// Compound\n{\n  \"and\": [\n    {\"fields.completed\": true},\n    {\"fields.score\": {\"gte\": 7}}\n  ]\n}\n\n## 3. Computations\n\nRoutes can execute computations before creating pages.\n\n### 3.1 Deterministic Computation\n\n{\n  \"type\": \"deterministic\",\n  \"formula\": {\n    \"score\": \"SUM(fields.q1, fields.q2, fields.q3) / 3\",\n    \"passed\": \"score >= 7\"\n  },\n  \"output_fields\": [\"score\", \"passed\"]\n}\n\n### 3.2 Matching Computation\n\n{\n  \"type\": \"matching\",\n  \"match_against\": \"users_with_role:mentor\",\n  \"criteria\": {\n    \"overlap\": [\"fields.topics\", \"mentor.can_teach\"],\n    \"availability\": [\"fields.availability\", \"mentor.availability\"]\n  },\n  \"output_fields\": [\"matches\"]\n}\n\n### 3.3 LLM Computation (Optional)\n\n{\n  \"type\": \"llm\",\n  \"requires\": \"llm_credits\",\n  \"model\": \"claude-sonnet-4\",\n  \"prompt\": \"Analyze this reflection...\",\n  \"output_schema\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"insights\": {\"type\": \"array\"},\n      \"score\": {\"type\": \"number\"}\n    }\n  },\n  \"output_fields\": [\"insights\", \"score\"]\n}\n\n## 4. Page Creation Templates\n\nWhen action is \"create_page\", route can use template:\n\n{\n  \"template\": \"mentor_match_results\",\n  \"content_generator\": {\n    \"type\": \"structured\",\n    \"blocks\": [\n      {\n        \"type\": \"heading\",\n        \"text\": \"Your Mentor Matches\"\n      },\n      {\n        \"type\": \"match_table\",\n        \"data\": \"computation.matches\"\n      }\n    ]\n  },\n  \"organization\": {\n    \"folder\": \"Mentor Matches\",\n    \"tags\": [\"mentor-matching\"]\n  }\n}\n\n## 5. Sandboxing (Advanced)\n\nImplementations MAY support custom JavaScript:\n\n{\n  \"type\": \"custom_script\",\n  \"sandbox\": true,\n  \"timeout_ms\": 2000,\n  \"code\": \"return answers.energy * 2;\"\n}\n\nSandbox MUST:\n- No DOM access\n- No network (except allowlist)\n- 2s timeout\n- Memory limit\n```\n\n---\n\n### CP-1.0-CTP: Cursive Tool Protocol\n\n**Defines:** How tools work\n\n```markdown\n# Cursive Tool Protocol 1.0\n\n## 1. Tool Definition\n\n{\n  \"cursive\": \"1.0\",\n  \"type\": \"tool\",\n  \"id\": \"citation_helper\",\n  \"version\": \"1.0.0\",\n  \"name\": \"Citation Helper\",\n  \"description\": \"Suggests citations for claims\",\n  \n  \"trigger\": {\n    \"type\": \"inline_action\",\n    \"menu_label\": \"Cite Sources\"\n  },\n  \n  \"input\": {\n    \"type\": \"selection\",\n    \"schema\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"text\": {\"type\": \"string\"},\n        \"context\": {\"type\": \"object\"}\n      }\n    }\n  },\n  \n  \"output\": {\n    \"type\": \"insert_text\",\n    \"schema\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"citations\": {\"type\": \"array\"},\n        \"formatted_text\": {\"type\": \"string\"}\n      }\n    }\n  },\n  \n  \"implementation\": {\n    \"type\": \"llm\",\n    \"requires\": \"llm_credits\",\n    \"model\": \"claude-sonnet-4\",\n    \"estimated_cost_cents\": 2\n  }\n}\n\n## 2. Tool Invocation\n\nPOST /api/tools/citation_helper/run\n{\n  \"input\": {\n    \"text\": \"LLMs can reason about complex topics.\",\n    \"context\": {\n      \"page_id\": \"uuid\",\n      \"user_id\": \"uuid\"\n    }\n  }\n}\n\nResponse:\n{\n  \"ok\": true,\n  \"output\": {\n    \"citations\": [\n      {\"source\": \"...\", \"url\": \"...\"}\n    ],\n    \"formatted_text\": \"LLMs can reason[1]...\"\n  },\n  \"cost_cents\": 2,\n  \"provenance\": {\n    \"model\": \"claude-sonnet-4\",\n    \"tokens\": 150,\n    \"timestamp\": \"2025-01-15T14:30:00Z\"\n  }\n}\n\n## 3. Tool Types\n\n### 3.1 Inline Action\n- Triggered by user\n- Works on selection or page\n- Returns content to insert\n\n### 3.2 Computed Route\n- Triggered by Continue button\n- Creates new page\n- Can use LLM or deterministic\n\n### 3.3 Background\n- Runs periodically\n- Updates context\n- No user interaction\n\n## 4. Security\n\nTools MUST:\n- Declare cost upfront\n- Rate limit requests\n- Validate input\n- Sandbox execution\n- Log provenance\n\n## 5. Marketplace (v1.5)\n\nTools can be published:\n\n{\n  \"marketplace\": {\n    \"published\": true,\n    \"price_cents\": 0,  // Free or paid per-use\n    \"author\": \"user@instance.com\",\n    \"license\": \"MIT\",\n    \"category\": \"writing\",\n    \"ratings_avg\": 4.5\n  }\n}\n```\n\n---\n\n### CP-1.0-CDA: Cursive Data API\n\n**Defines:** Data structures and API\n\n```markdown\n# Cursive Data API 1.0\n\n## 1. Core Entities\n\n### 1.1 User\n{\n  \"id\": \"uuid\",\n  \"canonical_id\": \"alice@cursive.com\",\n  \"display_name\": \"Alice\",\n  \"home_instance\": \"cursive.com\"\n}\n\n### 1.2 Page (see CPL)\n\n### 1.3 Guide\n{\n  \"id\": \"uuid\",\n  \"title\": \"Philosophy 101\",\n  \"author\": \"user@instance.com\",\n  \"pages\": [\"page_id_1\", \"page_id_2\"],\n  \"settings\": {\n    \"navigation\": \"linear\",\n    \"gallery_enabled\": true\n  }\n}\n\n### 1.4 Context\n{\n  \"user_id\": \"uuid\",\n  \"guide_id\": \"uuid\",\n  \"theory_of_mind\": {\n    \"knows\": [...],\n    \"prefers\": [...]\n  },\n  \"structured_fields\": {...},\n  \"tags\": [...],\n  \"provenance\": {...}\n}\n\n## 2. REST API Endpoints\n\n### 2.1 Pages\nGET    /api/pages/:id\nPOST   /api/pages\nPUT    /api/pages/:id\nDELETE /api/pages/:id\n\n### 2.2 Guides\nGET    /api/guides/:id\nPOST   /api/guides\nGET    /api/guides/:id/pages\n\n### 2.3 Routes\nGET    /api/guides/:id/routes\nPOST   /api/routes\nPUT    /api/routes/:id\n\n### 2.4 Tools\nGET    /api/tools\nGET    /api/tools/:id\nPOST   /api/tools/:id/run\n\n### 2.5 Context\nGET    /api/context/user/:user_id/guide/:guide_id\nPUT    /api/context/user/:user_id/guide/:guide_id\n\n## 3. WebSocket Events\n\n### 3.1 Real-time Updates\nws://instance.com/ws\n\nEvents:\n- page.updated\n- prompt.released\n- letter.received\n- tool.completed\n\n## 4. Export/Import\n\n### 4.1 User Bundle\nGET /api/export/user/:id\n\nReturns:\n{\n  \"cursive\": \"1.0\",\n  \"type\": \"user_bundle\",\n  \"user\": {...},\n  \"pages\": [...],\n  \"notebooks\": [...],\n  \"context\": [...]\n}\n\n### 4.2 Guide Bundle\nGET /api/export/guide/:id\n\nReturns guide + pages + routes + tools\n\n## 5. Compliance\n\nImplementations MUST:\n- Support REST endpoints\n- Validate JSON schemas\n- Handle errors properly\n- Return proper status codes\n- Support CORS\n\nImplementations SHOULD:\n- Support WebSocket\n- Support export/import\n- Rate limit requests\n- Cache appropriately\n```\n\n---\n\n### CP-1.0-CPF: Cursive Protocol Federation (v2.0)\n\n**Defines:** How instances federate\n\n```markdown\n# Cursive Protocol Federation 1.0\n\n## 1. Identity\n\nUsers have canonical IDs: user@instance.com\n\nEach instance maintains:\n- Local users\n- Remote user cache\n- Following/followers\n\n## 2. ActivityPub Bridge\n\nCursive federates via ActivityPub for:\n- Public pages\n- Public guides\n- Letters between instances\n\n## 3. WebFinger\n\nGET /.well-known/webfinger?resource=acct:alice@cursive.com\n\nReturns:\n{\n  \"subject\": \"acct:alice@cursive.com\",\n  \"links\": [\n    {\n      \"rel\": \"self\",\n      \"type\": \"application/activity+json\",\n      \"href\": \"https://cursive.com/alice\"\n    }\n  ]\n}\n\n## 4. Cross-Instance Guides\n\nGuides can reference pages from other instances:\n\n{\n  \"guide_id\": \"uuid@cursive.com\",\n  \"pages\": [\n    {\"id\": \"uuid\", \"instance\": \"cursive.com\"},\n    {\"id\": \"uuid\", \"instance\": \"university.edu\"}\n  ]\n}\n\n## 5. Trust & Moderation\n\nEach instance decides:\n- Which instances to federate with\n- Content policies\n- Moderation rules\n```\n\n---\n\n## âœ… Compliance & Testing\n\n### Compliance Levels:\n\n**Level 1: Core (MUST)**\n- CPL page rendering\n- Basic fields support\n- REST API\n\n**Level 2: Interactive (SHOULD)**\n- CSA routes\n- Computations\n- Tools (deterministic)\n\n**Level 3: Advanced (MAY)**\n- LLM tools\n- Custom scripts\n- Federation\n\n### Test Suite:\n\n```typescript\n// Example compliance test\ndescribe('CP-1.0-CPL Compliance', () => {\n  it('renders valid page', async () => {\n    const page = loadFixture('valid-page.json');\n    const rendered = await implementation.render(page);\n    expect(rendered).toBeDefined();\n  });\n  \n  it('preserves unknown fields', async () => {\n    const page = {...validPage, custom_field: 'value'};\n    const saved = await implementation.save(page);\n    expect(saved.custom_field).toBe('value');\n  });\n});\n```\n\n---\n\n## ðŸŽ¯ Implementation Checklist\n\n### Week 1-2: Foundation\n- [ ] Define JSON schemas\n- [ ] Generate TypeScript types\n- [ ] Write compliance tests\n- [ ] Document all specs\n\n### Week 3-6: Server\n- [ ] Implement CPL parser\n- [ ] Implement CSA evaluator\n- [ ] Build REST API\n- [ ] Pass compliance tests\n\n### Week 7-12: Studio\n- [ ] Build page editor\n- [ ] Build route designer\n- [ ] Build tool interface\n- [ ] Integrate with server\n\n### Week 13+: Advanced\n- [ ] Tool marketplace\n- [ ] Federation\n- [ ] Custom scripts\n- [ ] Mobile apps\n\n---\n\n## ðŸ“œ License & Governance\n\n**Protocol:** MIT License (open)  \n**Reference Server:** AGPL (open-source)  \n**Reference Client:** Proprietary (for now)\n\n**Governance:**\n- Specification maintained by Cursive team\n- Community proposals via GitHub\n- Versioned releases (semantic versioning)\n- Backwards compatibility promise\n\n---\n\n**This is the Cursive Protocol 1.0 specification outline.**  \n**Ready for detailed implementation!** ðŸš€\n"
          },
          {
            "file_name": "CONVIVIAL-DOMAIN-MODEL.md",
            "file_size": 2460,
            "file_type": "",
            "extracted_content": "# Convivial Domain Model (Draft)\n\n**Status:** Draft â€¢ October 30, 2025\n\nThis appendix describes how the protocol primitives collaborate to honour the values articulated in [`protocol/VALUES.md`](../VALUES.md).\n\n## Layers\n\n1. **Page (Human Craft)**\n   - Source of truth: [`protocol/docs/DATA_DICTIONARY.md#page`](../docs/DATA_DICTIONARY.md#page)\n   - Values: Agency, Verifiable Craft, Transparency\n   - Guarantees: human-authored content, process fingerprint, export receipts\n\n2. **Thinking Node (Whisper Layer)**\n   - Surface: Tool plugins + insight lenses suggesting connections\n   - Values: Competence over Automation, Transparency\n   - Rule: output stored as suggestions/metadata; never mutates page without human ratification\n\n3. **Hospitality Layer (Host Prompt Cycle)**\n   - Surface: Invitations, mail releases, facilitator digests\n   - Values: Hospitality, Slow Correspondence, Connection to Others\n   - Rule: host remains responsible; software nudges/summarises but cannot auto-release\n\n4. **Presence & Quorum**\n   - Surface: Quorum receipts, presence streams, embodied prompts (GPS, sensors)\n   - Values: Embodied Cognition, Connection to Others, Verifiable Craft\n   - Rule: unlocks content/actions only when human presence criteria satisfied and logged\n\n5. **Portability & Sovereignty**\n   - Surface: `.cursive` export manifest, encrypted badges, provenance receipts\n   - Values: Durable Sovereignty, Transparency\n   - Rule: every artifact (pages, badges, receipts) can be exported/imported with verifiable provenance\n\n## Flow Overview\n\n```mermaid\nsequenceDiagram\n  participant Host\n  participant Participant\n  participant Tool as Thinking Node\n  participant Quorum\n  participant Export\n\n  Host->>Participant: Invitation (mail item)\n  Participant->>Page: Human writing/drawing (Page layer)\n  Tool-->>Participant: Whisper suggestion (optional)\n  Participant->>Page: Ratify suggestion (if accepted)\n  Quorum->>Participant: Unlock shared context when presence verified\n  Export->>Participant: Issue receipt / export bundle on demand\n```\n\nEach arrow touches a primitive defined in the dictionary. Implementations must cite these primitives and values in migrations, schema changes, and pull requests.\n\n## Next Steps\n\n- Expand with concrete JSON examples for invitations, quorum receipts, and export manifests.\n- Add trace diagrams for Today â†’ journal flow and group facilitation.\n- Link to protocol specs once View contracts are formalised.\n"
          },
          {
            "file_name": "COLLABORATIVE-EDITING-SPEC.md",
            "file_size": 11973,
            "file_type": "",
            "extracted_content": "# Collaborative Real-Time Editing Specification\n\n**Version:** 1.0.0\n**Status:** Draft\n**Date:** October 22, 2025\n**Purpose:** Enable co-editing experiences (hangman, shared docs, live drawing)\n\n---\n\n## ðŸŽ¯ Use Cases\n\n1. **Hangman game** - Multiple players editing same page, revealing letters\n2. **Shared documents** - Collaborative writing (like Google Docs)\n3. **Live drawing** - Multiple people drawing on same canvas (already exists via ink_strokes)\n4. **Brainstorming** - Real-time sticky notes / concept mapping\n5. **Peer review** - Simultaneous annotations\n\n---\n\n## ðŸ—ï¸ Architecture\n\n### Core Primitives (Reuse Existing)\n\n**Pages** remain the unit:\n- One page = one collaborative session\n- Fields store current state\n- Content stores TipTap JSON (for documents)\n\n**Routes** can enable/disable collaboration:\n```typescript\n{\n  \"page_id\": \"hangman-game\",\n  \"collaboration\": {\n    \"enabled\": true,\n    \"mode\": \"realtime\",  // or \"turn-based\"\n    \"participants\": [\"user1\", \"user2\"],\n    \"permissions\": {\n      \"can_edit\": [\"user1\", \"user2\"],\n      \"can_view\": [\"facilitator\"]\n    }\n  }\n}\n```\n\n---\n\n## ðŸ“¡ Real-Time Sync (Two Approaches)\n\n### Approach 1: Supabase Realtime (Recommended for V1)\n\n**What it does:**\n- Postgres changes broadcast via WebSocket\n- Uses Supabase Realtime channels\n- No custom WebSocket server needed\n\n**How it works:**\n```typescript\n// Client subscribes to page changes\nconst channel = supabase\n  .channel(`page:${pageId}`)\n  .on('postgres_changes', {\n    event: '*',\n    schema: 'public',\n    table: 'pages',\n    filter: `id=eq.${pageId}`\n  }, (payload) => {\n    // Update local state with new content\n    updateEditor(payload.new.content);\n  })\n  .subscribe();\n\n// Client sends update\nawait supabase\n  .from('pages')\n  .update({ content: newContent, updated_at: new Date() })\n  .eq('id', pageId);\n```\n\n**Pros:**\n- âœ… Already have Supabase\n- âœ… No custom server\n- âœ… Simple setup\n- âœ… Works for low-frequency updates (hangman, turn-based games)\n\n**Cons:**\n- âŒ Not ideal for high-frequency (typing every keystroke)\n- âŒ Full document broadcast (not just diffs)\n- âŒ Last-write-wins conflict resolution\n\n---\n\n### Approach 2: TipTap Collaboration (For Documents)\n\n**What it does:**\n- Uses Yjs CRDT for conflict-free merging\n- Broadcasts only changes (not full doc)\n- Supports simultaneous editing\n- Shows live cursors\n\n**Provider options:**\n\n**A) Hocuspocus (self-hosted)**\n```bash\nnpm install @hocuspocus/server @tiptap/extension-collaboration\n```\n\n```typescript\n// Server (hocuspocus)\nimport { Server } from '@hocuspocus/server';\n\nconst server = Server.configure({\n  port: 1234,\n  onAuthenticate: async (data) => {\n    // Verify user can edit this page\n    const canEdit = await checkPermissions(data.token, data.documentName);\n    if (!canEdit) throw new Error('Forbidden');\n  },\n  async onStoreDocument(data) {\n    // Save to Supabase when doc changes\n    await supabase\n      .from('pages')\n      .update({ content: data.document })\n      .eq('id', data.documentName);\n  }\n});\n\nserver.listen();\n```\n\n```typescript\n// Client (TipTap editor)\nimport { Editor } from '@tiptap/core';\nimport Collaboration from '@tiptap/extension-collaboration';\nimport CollaborationCursor from '@tiptap/extension-collaboration-cursor';\nimport { HocuspocusProvider } from '@hocuspocus/provider';\nimport * as Y from 'yjs';\n\nconst ydoc = new Y.Doc();\nconst provider = new HocuspocusProvider({\n  url: 'ws://localhost:1234',\n  name: pageId,\n  document: ydoc,\n  token: authToken\n});\n\nconst editor = new Editor({\n  extensions: [\n    StarterKit.configure({\n      history: false  // Yjs handles history\n    }),\n    Collaboration.configure({\n      document: ydoc\n    }),\n    CollaborationCursor.configure({\n      provider,\n      user: {\n        name: currentUser.name,\n        color: currentUser.color\n      }\n    })\n  ]\n});\n```\n\n**Pros:**\n- âœ… True real-time (keystroke-level)\n- âœ… CRDT conflict resolution (no lost edits)\n- âœ… Live cursors\n- âœ… Industry standard (used by Notion, Figma, etc.)\n\n**Cons:**\n- âŒ Requires WebSocket server (hocuspocus)\n- âŒ More complex infrastructure\n- âŒ Yjs learning curve\n\n**B) Liveblocks (Managed SaaS)**\n```typescript\nimport { LiveblocksProvider } from '@liveblocks/yjs';\nimport { createClient } from '@liveblocks/client';\n\nconst client = createClient({\n  authEndpoint: '/api/liveblocks-auth'\n});\n\nconst { room, leave } = client.enterRoom(pageId);\nconst ydoc = new Y.Doc();\nconst provider = new LiveblocksProvider(room, ydoc);\n\n// Same TipTap setup as above\n```\n\n**Pros:**\n- âœ… No server to manage\n- âœ… Built-in presence, cursors, comments\n- âœ… Analytics dashboard\n\n**Cons:**\n- âŒ Paid service ($99/month after free tier)\n- âŒ Vendor lock-in\n\n---\n\n## ðŸŽ® Game-Specific Patterns\n\n### Hangman (Turn-Based)\n\n**State stored in page.fields:**\n```typescript\n{\n  \"word\": \"PROTOCOL\",        // Hidden from players\n  \"revealed\": \"P_O_O_O_\",    // Current state\n  \"guesses\": [\"P\", \"O\", \"X\"],\n  \"lives\": 5,\n  \"current_turn\": \"user2\",\n  \"players\": [\"user1\", \"user2\"],\n  \"status\": \"in_progress\"    // or \"won\" | \"lost\"\n}\n```\n\n**Route for turn action:**\n```typescript\n<route from=\"hangman-game\" on=\"button#guess-letter\">\n  // Validate it's user's turn\n  if (page.fields.current_turn !== current_user()) {\n    return error(\"Not your turn\");\n  }\n\n  const guess = answers.letter.toUpperCase();\n\n  // Check if letter in word\n  const word = page.fields.word;\n  const revealed = page.fields.revealed.split('');\n\n  let correct = false;\n  for (let i = 0; i < word.length; i++) {\n    if (word[i] === guess && revealed[i] === '_') {\n      revealed[i] = guess;\n      correct = true;\n    }\n  }\n\n  // Update state\n  update_page({\n    page_id: current_page(),\n    fields: {\n      revealed: revealed.join(''),\n      guesses: [...page.fields.guesses, guess],\n      lives: correct ? page.fields.lives : page.fields.lives - 1,\n      current_turn: nextPlayer(page.fields.players, current_user()),\n      status: checkWinCondition(revealed, page.fields.lives)\n    }\n  });\n\n  // Notify other player via Supabase Realtime\n  // (auto-updates their view)\n</route>\n```\n\n**Client listens for updates:**\n```typescript\nconst channel = supabase\n  .channel(`hangman:${pageId}`)\n  .on('postgres_changes', {\n    event: 'UPDATE',\n    schema: 'public',\n    table: 'pages',\n    filter: `id=eq.${pageId}`\n  }, (payload) => {\n    // Update UI with new revealed letters\n    setRevealed(payload.new.fields.revealed);\n    setLives(payload.new.fields.lives);\n    setCurrentTurn(payload.new.fields.current_turn);\n\n    if (payload.new.fields.status === 'won') {\n      showVictory();\n    } else if (payload.new.fields.status === 'lost') {\n      showDefeat();\n    }\n  })\n  .subscribe();\n```\n\n**Pros of this approach:**\n- âœ… Simple (just page.fields + Supabase Realtime)\n- âœ… Turn-based prevents conflicts\n- âœ… Easy to audit (page_history tracks every turn)\n\n---\n\n### Shared Document (Real-Time)\n\n**Use TipTap Collaboration:**\n```typescript\n// Enable collaboration on guide page\nguide_pages.collaboration = {\n  \"enabled\": true,\n  \"provider\": \"hocuspocus\",\n  \"url\": \"wss://collab.cursive.com\"\n};\n```\n\n**Permissions (via route policy):**\n```typescript\npolicy.require({\n  subject: current_user(),\n  action: \"edit\",\n  resource: page_id,\n  conditions: [\n    \"has_role('participant')\",\n    \"page.collaboration.enabled === true\",\n    \"current_user() IN page.collaboration.participants\"\n  ]\n});\n```\n\n**Save snapshots periodically:**\n```typescript\n// Hocuspocus onStoreDocument hook\nonStoreDocument: async ({ documentName, document }) => {\n  await supabase\n    .from('pages')\n    .update({\n      content: document,\n      updated_at: new Date()\n    })\n    .eq('id', documentName);\n\n  // Also create history snapshot every 5 minutes\n  await supabase\n    .from('page_history')\n    .insert({\n      page_id: documentName,\n      action: 'snapshot',\n      changes: { content: document },\n      updated_by: null  // system\n    });\n}\n```\n\n---\n\n### Live Drawing (Already Exists!)\n\n**Current implementation:**\n- `ink_strokes` table stores strokes\n- Each stroke has `user_id`, `stroke_data` (Konva JSON)\n- Supabase Realtime broadcasts new strokes\n\n**To improve:**\n```typescript\n// Add presence (who's drawing right now)\nconst presenceChannel = supabase.channel(`drawing:${pageId}:presence`, {\n  config: {\n    presence: {\n      key: currentUser.id\n    }\n  }\n});\n\npresenceChannel\n  .on('presence', { event: 'sync' }, () => {\n    const state = presenceChannel.presenceState();\n    const users = Object.keys(state);\n    showActiveCursors(users);\n  })\n  .subscribe();\n\n// Track when user is actively drawing\npresenceChannel.track({\n  user_id: currentUser.id,\n  user_name: currentUser.name,\n  color: currentUser.color,\n  cursor: { x: mouseX, y: mouseY }\n});\n```\n\n---\n\n## ðŸ—„ï¸ Database Schema\n\n**No new tables needed!** Use existing:\n\n```sql\n-- Pages store current state\npages (\n  id,\n  content,     -- TipTap JSON or Yjs document\n  fields,      -- Game state (hangman, etc.)\n  metadata     -- { collaboration: {...} }\n)\n\n-- Ink strokes already handle drawing\nink_strokes (\n  id,\n  page_id,\n  user_id,\n  stroke_data\n)\n\n-- History for audit/replay\npage_history (\n  page_id,\n  updated_by,\n  changes,     -- Snapshot or diff\n  action       -- 'edit' | 'snapshot' | 'turn'\n)\n```\n\n**Add indexes:**\n```sql\nCREATE INDEX idx_pages_collaboration ON pages ((metadata->'collaboration'));\nCREATE INDEX idx_ink_strokes_page_time ON ink_strokes (page_id, created_at);\n```\n\n---\n\n## ðŸš€ Implementation Phases\n\n### V1: Turn-Based Games (Supabase Realtime)\n- âœ… Use existing Supabase Realtime\n- âœ… Store state in page.fields\n- âœ… Routes handle turn logic\n- âœ… No additional infra needed\n\n**Enables:**\n- Hangman\n- Tic-tac-toe\n- Polls\n- Q&A sessions\n\n### V1.5: Live Drawing Enhancements\n- Add presence (active cursors)\n- Stroke batching (reduce DB writes)\n- Replay mode (animate stroke history)\n\n### V2: Real-Time Documents (Yjs + Hocuspocus)\n- Deploy Hocuspocus server\n- Add TipTap Collaboration extension\n- Live cursors\n- Conflict-free editing\n\n**Enables:**\n- Collaborative writing\n- Shared notes\n- Live annotations\n- Multi-user concept maps\n\n---\n\n## ðŸ“‹ Protocol Additions\n\n### CP-1.0-COLLAB: Collaborative Editing Protocol\n\n```typescript\ninterface CollaborationConfig {\n  enabled: boolean;\n  mode: \"realtime\" | \"turn-based\";\n  provider?: \"supabase\" | \"hocuspocus\" | \"liveblocks\";\n  participants: string[];       // user IDs\n  permissions: {\n    can_edit: string[];\n    can_view: string[];\n    can_comment: string[];\n  };\n  presence?: {\n    show_cursors: boolean;\n    show_names: boolean;\n    timeout_ms: number;         // How long before user shown as inactive\n  };\n}\n```\n\n### Route Actions\n\n**New action: `update_collaborative_page`**\n```typescript\n{\n  type: \"update_collaborative_page\",\n  params: {\n    page_id: string,\n    changes: any,                // Patch/diff\n    merge_strategy: \"last-write-wins\" | \"crdt\" | \"turn-based\"\n  }\n}\n```\n\n**New action: `broadcast_presence`**\n```typescript\n{\n  type: \"broadcast_presence\",\n  params: {\n    channel: string,             // e.g., \"page:123:presence\"\n    data: {\n      cursor?: {x: number, y: number},\n      selection?: {start: number, end: number},\n      status?: \"active\" | \"idle\" | \"away\"\n    }\n  }\n}\n```\n\n---\n\n## âœ… Summary\n\n**For hangman and turn-based games:**\n- Use Supabase Realtime (already have it)\n- Store state in page.fields\n- Routes handle turn logic\n- Simple, works today\n\n**For real-time documents (later):**\n- Add Hocuspocus server\n- Use Yjs CRDT\n- TipTap Collaboration extension\n- Industry-standard approach\n\n**For live drawing (enhance existing):**\n- Already works with ink_strokes\n- Add presence tracking\n- Improve performance with batching\n\n**No protocol changes needed for V1.** Everything works with existing primitives (pages, routes, tools, views).\n\n---\n\n**Ready for hangman! ðŸŽ¯**\n"
          },
          {
            "file_name": "GPS_TRUST_MATRIX.md",
            "file_size": 5954,
            "file_type": "",
            "extracted_content": "# GPS Trust Matrix & Fallback Guidance\n\n**Version:** 1.0  \n**Status:** Draft for review  \n**Date:** October 22, 2025  \n**Author:** Cursive Protocol Team  \n\n---\n\n## ðŸŽ¯ Purpose\n\nDefine how GPS/location-aware experiences operate in Cursive with clear privacy levels, verification strategies, fallbacks, and policy hooks so hosts, regulators, and facilitators can trust the system.\n\n---\n\n## ðŸ—º Trust Levels Overview\n\n| Level | Name | Accuracy | Data Stored | Use Cases | Requires | Notes |\n|-------|------|----------|-------------|-----------|----------|-------|\n| 0 | Off | None | `location_state = \"disabled\"` | Fully remote guides | Nothing | Respect learner choice |\n| 1 | Coarse | ~5 km (geohash-3) | `geohash_prefix` only | City-based discovery | User opt-in | No precise gating |\n| 2 | Verified | ~150 m (geohash-6) | `attestation_token` + optional proof | Place-based unlocks | Opt-in + platform attestation | Default for geofence routes |\n| 3 | Strong | ~30 m (geohash-7) + manual proof | `attestation_token` + `manual_code` | High-stakes events | Opt-in + manual confirmation | Optional; warns in UI |\n\n---\n\n## ðŸ” Attestation Workflow (Levels 2+)\n\n1. Learner taps â€œVerify locationâ€.\n2. Client collects coarse GPS â†’ rounds to allowed precision.\n3. Client calculates attestation payload:\n   ```json\n   {\n     \"user_id\": \"...\",\n     \"guide_id\": \"...\",\n     \"geohash\": \"u09tu..\",  // truncated per level\n     \"timestamp\": \"2025-10-22T09:00:00Z\",\n     \"nonce\": \"random\"\n   }\n   ```\n4. Client signs payload with device key (WebAuthn/local secure storage) or sends to platform attestation service if hardware supported.\n5. Server validates within tolerance window, stores:\n   ```json\n   {\n     \"attestation_id\": \"...\",\n     \"user_id\": \"...\",\n     \"guide_id\": \"...\",\n     \"level\": 2,\n     \"geohash_prefix\": \"u09tu\",\n     \"verified_at\": \"...\",\n     \"expires_at\": \"...\",\n     \"proof\": {\n       \"signature\": \"...\",\n       \"manual_code\": null\n     }\n   }\n   ```\n6. Route condition `attest.location({geohash:\"u09tu\", radius_m:120})` evaluates using stored attestation plus freshness check.\n\n---\n\n## ðŸŒ Fallbacks & Accessibility\n\n| Scenario | Fallback | Impact |\n|----------|----------|--------|\n| GPS disabled | Offer manual code phrase (â€œSpeak the mural phraseâ€) | route condition uses `attest.manual_code` |\n| No hardware attestation | Use server-side verification with IP + coarse GPS | mark as `level=1` (Coarse) |\n| Privacy choice â€œoffâ€ | Show alternative path (â€œDo reflection from home?â€) | Maintain experience parity |\n| Offline | Provide printable QR token; store as manual code on scan | optional |\n\nImplementation hook in route:\n```js\nif (attest.location({geohash:\"u09tu\", radius_m:120})) {\n  navigate(\"hilltop_prompt\");\n} else {\n  navigate(\"remote_reflection\");\n}\n```\n\n---\n\n## ðŸ“‹ Policy Hooks\n\nRoute authors declare required level:\n```json\npolicy.require({\n  subject: \"route:hilltop_unlocked\",\n  wants: [\"location.geohash_prefix\"],\n  conditions: [\"location.level >= 2\", \"consent.location == true\"]\n});\n```\n\nPolicy engine enforces:\n- Consent checked (`consent.location`)\n- Level meets requirement\n- Attestation not expired (`expires_at > now`)\n- Manual code (if provided) matches expected\n\nAdmins can configure tenant defaults:\n```json\n\"location_policy\": {\n  \"default_level\": 1,\n  \"allow_strong\": false,\n  \"manual_codes_required\": true\n}\n```\n\n---\n\n## ðŸ” Transparency to Learners\n\nUI copy guidelines:\n- Show current level (â€œWeâ€™ll confirm youâ€™re near the garden; no precise location stored.â€)\n- Provide opt-out button\n- Expose â€œWhy we need thisâ€ (links to policy)\n- Offer manual fallback (â€œEnter todayâ€™s codeâ€)\n\nProfile â€œMy Dataâ€ page shows history:\n```json\n[\n  {\n    \"guide\": \"Hilltop Retreat\",\n    \"level\": 2,\n    \"geohash_prefix\": \"u09tu\",\n    \"verified_at\": \"2025-10-21T04:02Z\",\n    \"fallback_used\": false\n  }\n]\n```\n\nUsers can revoke location data per guide (policy removes stored attestations).\n\n---\n\n## âš ï¸ Risk Mitigation\n\n- Level 3 usage flagged in audit logs (requires manual proof).\n- Geohash precision capped (never store full lat/long).\n- No continuous trackingâ€”attestation is momentary.\n- Default level per guide = 0 (Off) until author enables.\n- Scheduler ensures location data auto-expires (e.g., 24 hours).\n- Manual codes change daily (QR or phrase).\n\n---\n\n## âœ… Implementation Checklist\n\n1. Attestation service with signature + expiry validation.\n2. Client SDK supporting:\n   - Location consent prompt\n   - Precision rounding per level\n   - Manual code entry fallback\n3. Policy engine update for `location.level` conditions.\n4. Route helper `attest.location(params)` with caching.\n5. â€œNearbyâ€ View uses level 1 (Coarse) only.\n6. Audit tools showing level usage per guide.\n\n---\n\n## ðŸ—‚ Appendix\n\n### A. Example Guide Config\n\n```json\n\"location\": {\n  \"required\": true,\n  \"level\": 2,\n  \"fallbacks\": [\"manual_code\"],\n  \"events\": [\n    {\"page\": \"hilltop_prompt\", \"geohash\": \"u09tu\", \"radius_m\": 120, \"time_window\": \"dawn\"}\n  ]\n}\n```\n\n### B. Manual Code Workflow\n\n1. Host prints code phrase daily (â€œRemember the windâ€).\n2. Participant enters via route prompt.\n3. System stores hashed `manual_code` alongside attestation record.\n4. Valid for limited window (e.g., 12 hours).\n\n### C. QR Token Workflow\n\n1. Host generates `mint_qr_token(guide, ttl=6h)`.\n2. QR encodes `manual_code + geohash`.\n3. Participant scans â†’ portal handles attestation + code entry.\n\n---\n\n## ðŸŽ‰ Result\n\nHosts can confidently use GPS-aware experiences with:\n- Clear trust levels\n- Mandatory consent\n- Verified proof and expiring attestations\n- Manual fallbacks for privacy-first participants\n- Transparent auditing for educators and regulators\n\nThis resolves the â€œGPS trust & fallbackâ€ gap identified in the architecture review.\n\n"
          },
          {
            "file_name": "ROUTE_ACTION_CONTRACT_V1_1.md",
            "file_size": 8792,
            "file_type": "",
            "extracted_content": "# Route Action Contract v1.1\n\n**Version:** 1.1 (supersedes Route Actions v1.0 CRUD only)  \n**Status:** Draft for review  \n**Date:** October 22, 2025  \n**Scope:** Extends route capabilities with batch, transaction, schedule, and safety primitives required for real facilitation flows.\n\n---\n\n## 1. Motivation\n\nV1.0 delivered CRUD + navigate + send. Real experiences (mentorship, cohort launches, reminders) need:\n\n- Atomic sequences (update + letter + schedule)\n- Idempotency (avoid duplicate letters on retry)\n- Batch updates (set statuses across multiple pages)\n- Scheduling / enqueueing (Today/Mailbox in future)\n- Compensating actions (undo on failure)\n\nThis document specifies the additional verbs, payload schemas, and runtime guarantees. Forward compatible with the V1.0 API.\n\n---\n\n## 2. Action Model Recap\n\nEvery route execution produces an ordered list of **actions**. Runtime validates policy, executes action, records an **event**. Item format:\n\n```json\n{\n  \"type\": \"update_page\",\n  \"params\": {...},\n  \"idempotency_key\": \"optional\",\n  \"policy\": {\"wants\": [], \"scope\": \"...\"},\n  \"metadata\": {\"source\": \"route_id\", \"trace\": \"...\"}\n}\n```\n\nWe extend the grammar to include new action types and wrappers.\n\n---\n\n## 3. New Action Types\n\n### 3.1 `schedule_page`\n\nEnqueue a page to appear in Today or Mailbox at a future time.\n\n```json\n{\n  \"type\": \"schedule_page\",\n  \"params\": {\n    \"page_id\": \"page-123\",\n    \"delivery\": {\n      \"channel\": \"today|mail\",\n      \"at\": \"2025-10-25T09:00:00Z\",\n      \"remind_at\": \"2025-10-24T09:00:00Z\"\n    },\n    \"recipient\": \"user-456\"\n  }\n}\n```\n\nGuards:\n- Policy require read access to page + permission to schedule.\n- Validates future timestamp & timezone.\n\n### 3.2 `batch_update`\n\nApply multiple updates atomically.\n\n```json\n{\n  \"type\": \"batch_update\",\n  \"params\": {\n    \"operations\": [\n      {\"page_id\": \"page-1\", \"fields\": {\"status\": \"completed\"}},\n      {\"page_id\": \"page-2\", \"fields\": {\"status\": \"ready\"}}\n    ],\n    \"atomic\": true\n  }\n}\n```\n\nAll updates pass owner/policy checks. If `atomic` true and any update fails, none applied.\n\n### 3.3 `transaction`\n\nWrap a sequence of actions that must succeed or be rolled back.\n\n```json\n{\n  \"type\": \"transaction\",\n  \"actions\": [\n    {\"type\": \"update_page\", ...},\n    {\"type\": \"send\", ...},\n    {\"type\": \"schedule_page\", ...}\n  ],\n  \"compensate\": [\n    {\"type\": \"update_page\", ... rollback payload ...}\n  ],\n  \"idempotency_key\": \"txn-123\"\n}\n```\n\nSemantics:\n- Runtime executes nested actions sequentially.\n- If any action fails, runtime executes `compensate` block in reverse order.\n- Transaction boundaries recorded in event log.\n\n### 3.4 `checkpoint`\n\nEnsures idempotency across retries (e.g., network errors).\n\n```json\n{\n  \"type\": \"checkpoint\",\n  \"params\": {\n    \"key\": \"mentor-request-{{request_id}}\"\n  }\n}\n```\n\nIf key seen before in same route run, runtime short-circuits remaining actions.\n\n### 3.5 `emit_insight`\n\nRaise a named signal other routes/views can subscribe to.\n\n```json\n{\n  \"type\": \"emit_insight\",\n  \"params\": {\n    \"kind\": \"mentor_request_created\",\n    \"payload\": {\"request_id\": \"page-123\"},\n    \"scope\": \"guide-456\"\n  }\n}\n```\n\nUsed to trigger follow-on automation (e.g., reminders).\n\n### 3.6 `notify`\n\nSend structured in-app/push/email notification (not a letter).\n\n```json\n{\n  \"type\": \"notify\",\n  \"params\": {\n    \"recipient\": \"user-789\",\n    \"channel\": \"in_app|email|push\",\n    \"template\": \"mentor-request-sent\",\n    \"data\": {\"mentor_name\": \"Alex\"}\n  }\n}\n```\n\n### 3.7 `webhook.post`\n\nCall external service (rate-limited, policy enforced).\n\n```json\n{\n  \"type\": \"webhook.post\",\n  \"params\": {\n    \"url\": \"https://example.com/hook\",\n    \"body\": {\"event\": \"mentor_matched\", \"guide_id\": \"g1\"},\n    \"headers\": {\"Authorization\": \"Bearer ...\"},\n    \"timeout_ms\": 5000\n  }\n}\n```\n\nPolicy must whitelist domain; runtime redacts sensitive fields automatically.\n\n---\n\n## 4. Batch Execution Semantics\n\nRoutes may emit multiple top-level actions. Runtime processes sequentially; transactions provide atomic grouping. Example:\n\n```json\n[\n  {\"type\": \"checkpoint\", \"params\": {\"key\": \"req-abc\"}},\n  {\"type\": \"transaction\", \"idempotency_key\": \"txn-1\",\n    \"actions\": [\n      {\"type\": \"update_page\", ...},\n      {\"type\": \"send\", ...},\n      {\"type\": \"schedule_page\", ...}\n    ],\n    \"compensate\": [\n      {\"type\": \"update_page\", \"params\": {\"page_id\":\"...\", \"fields\":{\"status\":\"pending\"}}}\n    ]\n  },\n  {\"type\": \"notify\", ...}\n]\n```\n\nIf transaction fails, runtime executes compensate, records failure event, stops processing further actions unless `continue_on_error` flag present (default false).\n\n---\n\n## 5. Scheduler Interface\n\n`schedule_page` enqueues tasks in the scheduler service with structure:\n\n```json\n{\n  \"job_id\": \"sched-789\",\n  \"page_id\": \"...\",\n  \"recipient\": \"...\",\n  \"channel\": \"today\",\n  \"run_at\": \"2025-11-01T09:00:00Z\",\n  \"metadata\": {\"route_id\": \"...\", \"created_by\": \"user-123\"}\n}\n```\n\nScheduler guarantees at least once delivery. When executed, event logged with provenance referencing original route. Companion `cancel_schedule(job_id)` planned for v1.2.\n\n---\n\n## 6. Policy Integration\n\nEach new action requires explicit policy scopes:\n\n| Action | Required Capabilities |\n|--------|-----------------------|\n| schedule_page | `policy.require({wants:[\"page.read\"], action:\"schedule\"})` |\n| batch_update | `policy.require({wants:[\"page.update\"], all_pages:true})` |\n| transaction | Validates each nested action |\n| checkpoint | No additional policy (metadata only) |\n| emit_insight | Must be whitelisted per guide |\n| notify | Requires `notification.send` scope |\n| webhook.post | Requires `integration.call` + domain allowlist |\n\nThe wizard/helper APIs should auto-insert policy.require blocks, as in mentor matching design.\n\n---\n\n## 7. Event Logging (for Diff & Audit)\n\nEach action produces event with consistent shape:\n\n```json\n{\n  \"event\": \"route_action_executed\",\n  \"route_id\": \"route-mentor-match\",\n  \"action_type\": \"update_page\",\n  \"status\": \"success|failure\",\n  \"payload\": {... sanitized ...},\n  \"transaction_id\": \"txn-1?\",\n  \"idempotency_key\": \"checkpoint?\",\n  \"timestamp\": \"...\"\n}\n```\n\nThis powers future â€œGuide Diff & Migrateâ€ UI and audit logs.\n\n---\n\n## 8. Backwards Compatibility\n\n- Routes using only V1.0 verbs remain valid.\n- Runtime version negotiation via route manifest (`\"contract_version\": \"1.1\"`).\n- If an implementation lacks a verb, runtime responds `501 ACTION_UNSUPPORTED`.\n\n---\n\n## 9. Reference Examples\n\n### 9.1 Mentoring Transaction\n\n```json\n[\n  {\"type\": \"checkpoint\", \"params\": {\"key\": \"request-{{request_id}}\"}},\n  {\"type\": \"transaction\",\n    \"actions\": [\n      {\"type\": \"update_page\", \"params\": {\"page_id\":\"{{request_id}}\",\"fields\":{\"status\":\"accepted\",\"mentor_id\":\"{{mentor_id}}\"}}},\n      {\"type\": \"update_page\", \"params\": {\"page_id\":\"{{mentor_profile_id}}\",\"fields\":{\"current_load\":{\"$inc\":1}}}},\n      {\"type\": \"send\", \"params\": {\"page_id\":\"{{confirmation_letter}}\",\"to\":[\"{{mentee_id}}\"]}},\n      {\"type\": \"schedule_page\", \"params\": {\"page_id\":\"{{followup_prompt}}\",\"recipient\":\"{{mentor_id}}\",\"delivery\":{\"channel\":\"today\",\"at\":\"{{followup_date}}\"}}}\n    ],\n    \"compensate\": [\n      {\"type\":\"update_page\",\"params\":{\"page_id\":\"{{request_id}}\",\"fields\":{\"status\":\"pending\",\"mentor_id\":null}}},\n      {\"type\":\"update_page\",\"params\":{\"page_id\":\"{{mentor_profile_id}}\",\"fields\":{\"current_load\":{\"$dec\":1}}}}\n    ],\n    \"idempotency_key\": \"mentor-accept-{{request_id}}\"\n  },\n  {\"type\": \"notify\",\"params\":{\"recipient\":\"{{mentee_id}}\",\"channel\":\"in_app\",\"template\":\"mentor-accepted\"}}\n]\n```\n\n### 9.2 Cohort Launch Batch\n\n```json\n[\n  {\"type\": \"batch_update\", \"params\": {\n    \"operations\": [\n      {\"page_id\":\"prompt-1\",\"fields\":{\"status\":\"released\",\"released_at\":\"{{now}}\"}},\n      {\"page_id\":\"prompt-2\",\"fields\":{\"status\":\"ready\"}}\n    ],\n    \"atomic\": true\n  }},\n  {\"type\": \"emit_insight\", \"params\": {\n    \"kind\": \"cohort_prompt_released\",\n    \"payload\": {\"prompt_id\": \"prompt-1\"},\n    \"scope\": \"guide-abc\"\n  }}\n]\n```\n\n---\n\n## 10. Implementation Notes\n\n- Runtime must expose hooks for route authoring tools to introspect supported verbs.\n- SDKs should generate TypeScript helpers (e.g., `Route.actions.transaction([...])`).\n- Diagnostics: on failure, return structured error with `action_index` and message.\n- Testing: add fixtures for idempotent retries, failed transactions (ensure compensate executed).\n\n---\n\n## âœ… Summary\n\nRoute contract v1.1 provides:\n- **batch_update** for multi-page changes\n- **transaction + compensate + checkpoint** for atomic workflows\n- **schedule_page** for future deliveries\n- **notify, webhook, emit_insight** for orchestrating the larger ecosystem\n\nThese primitives unblock complex facilitation flows (mentor matching, reminders, cohort releases) while preserving safety, transparency, and authoring simplicity.\n\n"
          }
        ],
        "files": [
          {
            "file_name": "sarec-integration-guide.md"
          },
          {
            "file_name": "MVP_SHARE_SESSION_SPEC.md"
          },
          {
            "file_name": "ADR-002-CONTEXT-ROLLUP-AGENCY.md"
          },
          {
            "file_name": "CP-1.0-VIEW-SPEC.md"
          },
          {
            "file_name": "DATA_DICTIONARY.md"
          },
          {
            "file_name": "SCHEMA_CLEANUP_PLAN.md"
          },
          {
            "file_name": "DESIGN_PHILOSOPHY.md"
          },
          {
            "file_name": "003-paginated-documents-with-session-recording.md"
          },
          {
            "file_name": "ADR-001-TWO-PRIMITIVES.md"
          },
          {
            "file_name": "VALUES.md"
          },
          {
            "file_name": "CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md"
          },
          {
            "file_name": "CONVIVIAL-DOMAIN-MODEL.md"
          },
          {
            "file_name": "COLLABORATIVE-EDITING-SPEC.md"
          },
          {
            "file_name": "GPS_TRUST_MATRIX.md"
          },
          {
            "file_name": "ROUTE_ACTION_CONTRACT_V1_1.md"
          }
        ]
      }
    },
    {
      "id": "019a5907-cf93-700f-b3bf-84bc05948982",
      "role": "assistant",
      "content": "Looking at all the documentation provided, the user wants me to review and update their docs to focus on what's truly foundational for both the protocol and reference app. They want to ignore anything that's not essential and get a clean, focused set of documentation based on their core decisions.\n\nLet me analyze what's truly foundational here:\n\n**Core Values** (VALUES.md) - This is fundamental, it's the \"why\" behind everything\n**Core Primitives** - Pages, Collections, Invitations (from DATA_DICTIONARY.md)\n**Share + Verification System** (MVP_SHARE_SESSION_SPEC.md) - This seems like a current priority\n**SAREC Integration** (sarec-integration-guide.md) - Assessment is core to their educational use case\n**Schema Cleanup** (SCHEMA_CLEANUP_PLAN.md) - They need clarity on what exists vs what's needed\n\nWhat's NOT foundational or is over-engineered:\n- Multiple protocol specs (CPL, CSA, CTP, etc.) - too abstract, premature\n- Federation (CPF) - way too early\n- GPS Trust Matrix - specific feature, not core\n- Collaborative editing spec - specific feature\n- Route Action Contract v1.1 - overly complex for current needs\n- Context rollup with user agency (ADR-002) - important but can be simplified\n- Two primitives taxonomy (ADR-001) - good thinking but too abstract\n\nThe user wants to:\n1. Keep what's foundational\n2. Delete/ignore the rest\n3. Get clean, focused documentation\n\nI should provide them with:\n1. A core set of ~3-5 essential documents\n2. Clear reasoning about what to keep/remove\n3. Updated versions that are practical and implementable\n\nLet me think about the metaphor they like - they want clarity like a carpenter's tools laid out on a bench, not a blueprint for a city.I'll help you cut through to what's truly foundational. Looking at your docs, you've got some brilliant thinking mixed with premature abstraction. Let's build the essential docs you actually need right now.\n\nHere's what I see as **genuinely foundational**:\n\n## Keep & Clean Up (3-4 Core Docs)\n\n### 1. **VALUES.md** ✅ Keep as-is\nYour philosophical foundation is solid and well-articulated. This stays.\n\n### 2. **DATA_DICTIONARY.md** → Simplify to \"CORE_PRIMITIVES.md\"\n**Problem:** Mixed protocol idealism with implementation reality\n**Fix:** Split into what exists vs what you're building\n\n### 3. **MVP_SHARE_SESSION_SPEC.md** → Becomes \"SHARE_AND_VERIFY.md\"  \n**Problem:** Good practical spec but buried in details\n**Fix:** This is your current priority - make it the hero\n\n### 4. **SAREC_INTEGRATION.md** ✅ Keep the guide\n**Why:** Assessment IS your differentiator. This doc is practical gold.\n\n## Delete or Archive\n\n- ❌ CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md - Too abstract, too early\n- ❌ CP-1.0-VIEW-SPEC.md - Premature protocol thinking\n- ❌ ROUTE_ACTION_CONTRACT_V1_1.md - Over-engineered\n- ❌ GPS_TRUST_MATRIX.md - Feature spec, not foundational\n- ❌ COLLABORATIVE-EDITING-SPEC.md - Feature spec, not foundational\n- ❌ ADR-001-TWO-PRIMITIVES.md - Good thinking, but too architectural\n- ❌ ADR-002-CONTEXT-ROLLUP-AGENCY.md - Important concept but overcomplicated\n- ❌ CONVIVIAL-DOMAIN-MODEL.md - Draft that never got fleshed out\n\nLet me create the cleaned-up essential docs:\n```\nThis block is not supported on your current device yet.\n```\n\nGood, now I need to create a simplified share and verify document that focuses on what they're actually building right now, stripping out the over-engineering.\n```\nThis block is not supported on your current device yet.\n```\n\nGood. Now I need to create a simplified schema reality check document that clarifies what actually exists vs what needs to be built/cleaned up. This should incorporate the decisions from SCHEMA_CLEANUP_PLAN but make it more actionable.\n```\nThis block is not supported on your current device yet.\n```\n\nGood. Now I need to create one final document that's a simple README/implementation guide that ties everything together. This should be the \"start here\" document.\n```\nThis block is not supported on your current device yet.\n```\n\nPerfect. Now let me create a final summary document that explains what I kept, what I removed, and why - to help them understand the cleanup rationale.\n```\nThis block is not supported on your current device yet.\n```\n\nPerfect. Now let me create one more document - a quick reference card that developers can print or keep open while coding.\n```\nThis block is not supported on your current device yet.\n```\n\nPerfect! Now let me create a final document that lists all the files I've created and provides a recommendation for what to do with the old files.\n```\nThis block is not supported on your current device yet.\n```\n\nPerfect! Now let me create a final summary view of what I've delivered and provide links to all the documents.Perfect! I've completely reorganized your documentation. Here's what you now have:\n\n## 📦 Your New Documentation (7 Essential Files)\n\n### [START_HERE.md](computer:///mnt/user-data/outputs/START_HERE.md)\n**Your new entry point.** 90-minute onboarding guide with setup instructions, file structure, common tasks, and links to everything else.\n\n### [CORE_PRIMITIVES.md](computer:///mnt/user-data/outputs/CORE_PRIMITIVES.md)\n**Replaces DATA_DICTIONARY.** Shows what actually exists in your database today, what you're building right now, and what you're NOT building yet. No protocol fantasies - just reality.\n\n### [SHARE_AND_VERIFY.md](computer:///mnt/user-data/outputs/SHARE_AND_VERIFY.md)\n**Replaces MVP_SHARE_SESSION_SPEC.** Your 4-week implementation plan with actual code examples, the fingerprint algorithm explained clearly, and concrete testing checklists.\n\n### [DATABASE_REALITY.md](computer:///mnt/user-data/outputs/DATABASE_REALITY.md)\n**Replaces SCHEMA_CLEANUP_PLAN.** The 5 real contradictions in your schema, runnable SQL to fix them, and a 3-week code migration checklist. Surgical, not demolition.\n\n### [QUICK_REFERENCE.md](computer:///mnt/user-data/outputs/QUICK_REFERENCE.md)\n**Bonus cheat sheet.** Print this, keep it visible while coding. All the key patterns, commands, and rules on one page.\n\n### Plus Documentation Guides\n\n**[CLEANUP_SUMMARY.md](computer:///mnt/user-data/outputs/CLEANUP_SUMMARY.md)** - Explains what changed and why\n\n**[MIGRATION_PLAN.md](computer:///mnt/user-data/outputs/MIGRATION_PLAN.md)** - Step-by-step commands to reorganize your docs folder\n\n---\n\n## What I Kept Unchanged ✅\n\n- **VALUES.md** - Your philosophical foundation is solid\n- **DESIGN_PHILOSOPHY.md** - Japanese woodworking aesthetic, still relevant\n- **sarec-integration-guide.md** - Your differentiator, pure gold\n\n---\n\n## What I Removed ❌\n\n**12 documents** that were either:\n- Premature protocol abstraction (CP-1.0-CPL, CSA, CTP, etc.)\n- Over-engineered features (Route Action Contract v1.1)\n- Solved problems (ADR-003 pagination)\n- Unfinished drafts (Convivial Domain Model)\n\nAll the good thinking is captured in the new docs - just without the noise.\n\n---\n\n## Key Improvements\n\n**Before:** \"Here's how the protocol COULD work across implementations\"  \n**After:** \"Here's what exists today and what we're building this week\"\n\n**Before:** 15+ documents, hard to know what's real  \n**After:** 7 documents, clear current priorities\n\n**Before:** New developers overwhelmed  \n**After:** 90-minute onboarding via START_HERE.md\n\n---\n\n## Next Steps\n\n1. Read [MIGRATION_PLAN.md](computer:///mnt/user-data/outputs/MIGRATION_PLAN.md) for commands to reorganize your docs folder\n2. Archive or delete the 12 old documents (your choice)\n3. Update README.md to link to START_HERE.md\n4. Start implementing [SHARE_AND_VERIFY.md](computer:///mnt/user-data/outputs/SHARE_AND_VERIFY.md) - your Week 1 begins with SharePageDialog\n\n**No more protocol theory. No more premature abstraction. Just clear, practical docs for what you're building right now.**",
      "created_at": "2025-11-06T12:06:13.282647Z",
      "sequence_order": 1,
      "metadata": {
        "content": [
          {
            "start_timestamp": "2025-11-06T11:57:59.634184Z",
            "stop_timestamp": "2025-11-06T11:58:11.136715Z",
            "flags": null,
            "type": "thinking",
            "thinking": "Looking at all the documentation provided, the user wants me to review and update their docs to focus on what's truly foundational for both the protocol and reference app. They want to ignore anything that's not essential and get a clean, focused set of documentation based on their core decisions.\n\nLet me analyze what's truly foundational here:\n\n**Core Values** (VALUES.md) - This is fundamental, it's the \"why\" behind everything\n**Core Primitives** - Pages, Collections, Invitations (from DATA_DICTIONARY.md)\n**Share + Verification System** (MVP_SHARE_SESSION_SPEC.md) - This seems like a current priority\n**SAREC Integration** (sarec-integration-guide.md) - Assessment is core to their educational use case\n**Schema Cleanup** (SCHEMA_CLEANUP_PLAN.md) - They need clarity on what exists vs what's needed\n\nWhat's NOT foundational or is over-engineered:\n- Multiple protocol specs (CPL, CSA, CTP, etc.) - too abstract, premature\n- Federation (CPF) - way too early\n- GPS Trust Matrix - specific feature, not core\n- Collaborative editing spec - specific feature\n- Route Action Contract v1.1 - overly complex for current needs\n- Context rollup with user agency (ADR-002) - important but can be simplified\n- Two primitives taxonomy (ADR-001) - good thinking but too abstract\n\nThe user wants to:\n1. Keep what's foundational\n2. Delete/ignore the rest\n3. Get clean, focused documentation\n\nI should provide them with:\n1. A core set of ~3-5 essential documents\n2. Clear reasoning about what to keep/remove\n3. Updated versions that are practical and implementable\n\nLet me think about the metaphor they like - they want clarity like a carpenter's tools laid out on a bench, not a blueprint for a city.",
            "summaries": [
              {
                "summary": "Thinking about consolidating documentation foundations for protocol and reference app."
              },
              {
                "summary": "Distilling essential documentation for protocol and reference app."
              },
              {
                "summary": "Distilled documentation to core foundational elements, discarding premature abstractions."
              }
            ],
            "cut_off": false
          },
          {
            "start_timestamp": "2025-11-06T11:58:11.341336Z",
            "stop_timestamp": "2025-11-06T11:58:21.958482Z",
            "flags": null,
            "type": "text",
            "text": "I'll help you cut through to what's truly foundational. Looking at your docs, you've got some brilliant thinking mixed with premature abstraction. Let's build the essential docs you actually need right now.\n\nHere's what I see as **genuinely foundational**:\n\n## Keep & Clean Up (3-4 Core Docs)\n\n### 1. **VALUES.md** ✅ Keep as-is\nYour philosophical foundation is solid and well-articulated. This stays.\n\n### 2. **DATA_DICTIONARY.md** → Simplify to \"CORE_PRIMITIVES.md\"\n**Problem:** Mixed protocol idealism with implementation reality\n**Fix:** Split into what exists vs what you're building\n\n### 3. **MVP_SHARE_SESSION_SPEC.md** → Becomes \"SHARE_AND_VERIFY.md\"  \n**Problem:** Good practical spec but buried in details\n**Fix:** This is your current priority - make it the hero\n\n### 4. **SAREC_INTEGRATION.md** ✅ Keep the guide\n**Why:** Assessment IS your differentiator. This doc is practical gold.\n\n## Delete or Archive\n\n- ❌ CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md - Too abstract, too early\n- ❌ CP-1.0-VIEW-SPEC.md - Premature protocol thinking\n- ❌ ROUTE_ACTION_CONTRACT_V1_1.md - Over-engineered\n- ❌ GPS_TRUST_MATRIX.md - Feature spec, not foundational\n- ❌ COLLABORATIVE-EDITING-SPEC.md - Feature spec, not foundational\n- ❌ ADR-001-TWO-PRIMITIVES.md - Good thinking, but too architectural\n- ❌ ADR-002-CONTEXT-ROLLUP-AGENCY.md - Important concept but overcomplicated\n- ❌ CONVIVIAL-DOMAIN-MODEL.md - Draft that never got fleshed out\n\nLet me create the cleaned-up essential docs:",
            "citations": []
          },
          {
            "start_timestamp": "2025-11-06T11:58:22.192784Z",
            "stop_timestamp": "2025-11-06T11:59:12.713191Z",
            "flags": null,
            "type": "tool_use",
            "name": "create_file",
            "input": {
              "path": "/mnt/user-data/outputs/CORE_PRIMITIVES.md",
              "file_text": "# Core Primitives\n\n**Last Updated:** November 6, 2025  \n**Purpose:** The essential building blocks that exist today and what we're actively building\n\n---\n\n## Philosophy in 3 Sentences\n\n1. **Pages are sacred** - Human-authored documents (text + handwriting + drawings)\n2. **Collections organize pages** - Journals, guides, workspaces\n3. **Everything proves its humanity** - Process fingerprints, session recordings, verifiable craft\n\n---\n\n## What Exists Today (Database Reality)\n\n### Page\n**The sacred human-authored document**\n\n```typescript\npages {\n  id: uuid\n  collection_id: uuid  // belongs to a collection\n  folder_id: uuid      // optional organization\n  content: jsonb       // TipTap document\n  metadata: jsonb      // process fingerprints, sheets, etc.\n  created_by: uuid\n  created_at: timestamp\n  updated_at: timestamp\n}\n```\n\n**Key rules:**\n- Only humans write to `content`\n- AI suggestions stay in UI chrome until explicitly inserted\n- Process captured in `metadata.process_fingerprint`\n\n### Collection\n**Top-level container: journal, guide, workspace**\n\n```typescript\ncollections {\n  id: uuid\n  owner_id: uuid\n  kind: text  // 'workspace' | 'template' | 'shared'\n  title: text\n  metadata: jsonb\n}\n```\n\n**Replaces:** Legacy term \"notebook\"\n\n### Folder\n**Optional grouping within collections**\n\n```typescript\nfolders {\n  id: uuid\n  collection_id: uuid\n  parent_folder_id: uuid  // supports nesting\n  name: text\n  order_index: int\n}\n```\n\n### Invitation\n**Timed prompt that routes a cohort to pages/experiences**\n\n```typescript\ninvitations {  // formerly 'released_prompts'\n  id: uuid\n  collection_id: uuid     // source collection\n  scheduled_for: timestamp\n  released_at: timestamp\n  status: text  // 'draft' | 'scheduled' | 'released'\n  \n  // Delivery\n  mail_items[]  // how it reaches participants\n  responses[]   // participant submissions\n}\n```\n\n**Frontend can call these:** \"Assignment\", \"Worksheet\", \"Exercise\" - backend stays \"invitation\"\n\n### Ink Strokes\n**Handwriting and drawing data**\n\n```typescript\nink_strokes {\n  id: uuid\n  page_id: uuid\n  sheet_id: uuid  // NULL = page-level drawing\n  stroke_data: jsonb  // vector path data\n  created_by: uuid\n  created_at: timestamp\n}\n```\n\n**Why this matters:** Stroke timing patterns = proof of human authorship\n\n---\n\n## What We're Building (Current Priority)\n\n### Presentation Sessions\n**Background recording + intentional walkthroughs + live streams**\n\n```typescript\npresentation_sessions {\n  id: uuid\n  page_id: uuid\n  session_type: text  // 'background' | 'recorded' | 'live'\n  \n  // Timing\n  started_at: timestamp\n  ended_at: timestamp\n  active_duration_ms: int\n  \n  // Proof of human\n  fingerprint: jsonb {\n    hash: sha256\n    stroke_variance: float  // 200-800ms = human\n    idle_gaps: int[]        // thinking pauses\n    revision_count: int     // human error rate\n    confidence_score: int   // 0-100\n  }\n  \n  // Sharing\n  audio_url: text         // if recorded with audio\n  visibility: text        // 'private' | 'link-only' | 'public'\n}\n```\n\n**Three use cases:**\n1. **Background** - Always-on per page, generates fingerprint\n2. **Recorded** - Intentional walkthrough with optional audio\n3. **Live** - Real-time stream, becomes recorded when ended\n\n### Page Verifications\n**Public badge showing \"Human-made\"**\n\n```typescript\npage_verifications {\n  page_id: uuid PRIMARY KEY\n  fingerprint_hash: text\n  confidence_score: int  // 0-100, show badge if >= 70\n  badge_visibility: text  // 'auto' | 'always' | 'never'\n  metrics: jsonb\n  updated_at: timestamp\n}\n```\n\n**Badge shows when:**\n- Confidence >= 70\n- User hasn't hidden it\n- Page is shared publicly\n\n### Verification Access Requests\n**Teachers request to see full creation timeline**\n\n```typescript\nverification_access_requests {\n  id: uuid\n  page_id: uuid\n  requester_id: uuid    // teacher\n  owner_id: uuid        // student\n  message: text\n  status: text          // 'pending' | 'approved' | 'declined'\n  expires_at: timestamp\n}\n```\n\n**Flow:**\n1. Teacher views page with badge → clicks \"Request full history\"\n2. Student gets notification → approves\n3. Teacher can watch complete session recordings\n\n---\n\n## What We're NOT Building Yet\n\n### ❌ Protocol Federation\nToo early. Focus on single-instance excellence first.\n\n### ❌ Tool Marketplace\nPremature. Build 3-5 essential tools first, then think about publishing.\n\n### ❌ Complex Routing DSL\nCurrent simple routing works. Don't over-engineer.\n\n### ❌ LLM-Based Auto-Assessment\nSAREC works great as human-authored rubrics + LLM extraction. Don't make it autonomous.\n\n---\n\n## Key Architectural Decisions\n\n### 1. Pages Navigate Via Folders, Not Collections\n```sql\n-- ❌ OLD: pages.collection_id (too direct)\n-- ✅ NEW: page → folder → collection\n```\n\n**Why:** Allows folder-level organization without breaking collection integrity\n\n### 2. Invitations > Released Prompts\nTerminology matters. \"Invitation\" is clearer than \"released_prompts\"\n\n### 3. Notifications Split From Mail\n```sql\n-- ❌ OLD: mail_items.type IN ('invitation', 'notification', 'letter')\n-- ✅ NEW: \n--   mail_items.type IN ('invitation', 'letter', 'share', 'gift')\n--   notifications (separate table)\n```\n\n**Why:** System alerts ≠ human correspondence\n\n### 4. Background Sessions Are Always On\nEvery page edit gets a background session. Owner can view in \"Activity\" sidebar but it's not intrusive.\n\n**Why:** Proof-of-human fingerprints require complete timeline\n\n---\n\n## Critical Rules (Non-Negotiable)\n\n### Content Authorship\n```typescript\n// ✅ ALLOWED\npages.content = user_typed_content\npages.content = user_drew_strokes\npages.content = user_ratified_suggestion\n\n// ❌ FORBIDDEN\npages.content = ai_generated_content  // must stay in UI as suggestion\n```\n\n### Provenance Required\nEvery content-affecting action needs:\n- `origin: 'human' | 'suggested'`\n- `author_id: uuid`\n- `confidence?: float` (if AI-assisted)\n\n### Export Sovereignty\nAny user can export:\n- All their pages (TipTap JSON)\n- All their sessions (event timelines)\n- All their fingerprints (proof certificates)\n- Format: `.cursive` archive (ZIP)\n\n---\n\n## What \"Protocol\" Actually Means\n\n**Not:** Abstract interchange format between hypothetical implementations  \n**Is:** Export format guaranteeing portability\n\nWhen a user exports their work, they get:\n```\nmy-work.cursive/  (ZIP)\n├─ manifest.json      # version, contents list\n├─ pages/\n│  ├─ page-1.json     # TipTap content + metadata\n│  └─ page-2.json\n├─ sessions/\n│  ├─ session-1.json  # event timeline\n│  └─ session-2.json\n└─ fingerprints/\n   └─ page-1-proof.json  # verification certificate\n```\n\n**That's the protocol.** Not CPL, CSA, CTP abstractions.\n\n---\n\n## Next: Implementation Priorities\n\n### Week 1-2: Share + Verify (MVP)\n- [ ] `/p/{pageId}` public page route\n- [ ] `SharePageDialog` component\n- [ ] Fingerprint calculation from sessions\n- [ ] Badge display when confidence >= 70\n\n### Week 3-4: Access Requests\n- [ ] \"Request full history\" flow\n- [ ] Notification system for approvals\n- [ ] `/w/p/{pageId}` aggregated session viewer\n\n### Week 5+: Export\n- [ ] `.cursive` archive generation\n- [ ] Proof certificate PDF download\n- [ ] Import from archive (sovereignty)\n\n---\n\n## Testing Reality Check\n\nBefore shipping any feature, ask:\n\n1. **Can I export it?** If not, sovereignty violated\n2. **Can AI fake it?** If yes, fingerprint insufficient\n3. **Does it require human action?** If not, agency violated\n4. **Is provenance preserved?** If not, transparency violated\n\n---\n\n**This is what exists. This is what we're building. Everything else is noise.**\n",
              "description": "Creating streamlined core primitives document focusing on what actually exists and what's being built"
            },
            "message": "Creating streamlined core primitives document focusing on what actually exists and what's being built",
            "integration_name": null,
            "integration_icon_url": null,
            "context": null,
            "display_content": {
              "type": "json_block",
              "json_block": "{\"language\": \"markdown\", \"code\": \"# Core Primitives\\n\\n**Last Updated:** November 6, 2025  \\n**Purpose:** The essential building blocks that exist today and what we're actively building\\n\\n---\\n\\n## Philosophy in 3 Sentences\\n\\n1. **Pages are sacred** - Human-authored documents (text + handwriting + drawings)\\n2. **Collections organize pages** - Journals, guides, workspaces\\n3. **Everything proves its humanity** - Process fingerprints, session recordings, verifiable craft\\n\\n---\\n\\n## What Exists Today (Database Reality)\\n\\n### Page\\n**The sacred human-authored document**\\n\\n```typescript\\npages {\\n  id: uuid\\n  collection_id: uuid  // belongs to a collection\\n  folder_id: uuid      // optional organization\\n  content: jsonb       // TipTap document\\n  metadata: jsonb      // process fingerprints, sheets, etc.\\n  created_by: uuid\\n  created_at: timestamp\\n  updated_at: timestamp\\n}\\n```\\n\\n**Key rules:**\\n- Only humans write to `content`\\n- AI suggestions stay in UI chrome until explicitly inserted\\n- Process captured in `metadata.process_fingerprint`\\n\\n### Collection\\n**Top-level container: journal, guide, workspace**\\n\\n```typescript\\ncollections {\\n  id: uuid\\n  owner_id: uuid\\n  kind: text  // 'workspace' | 'template' | 'shared'\\n  title: text\\n  metadata: jsonb\\n}\\n```\\n\\n**Replaces:** Legacy term \\\"notebook\\\"\\n\\n### Folder\\n**Optional grouping within collections**\\n\\n```typescript\\nfolders {\\n  id: uuid\\n  collection_id: uuid\\n  parent_folder_id: uuid  // supports nesting\\n  name: text\\n  order_index: int\\n}\\n```\\n\\n### Invitation\\n**Timed prompt that routes a cohort to pages/experiences**\\n\\n```typescript\\ninvitations {  // formerly 'released_prompts'\\n  id: uuid\\n  collection_id: uuid     // source collection\\n  scheduled_for: timestamp\\n  released_at: timestamp\\n  status: text  // 'draft' | 'scheduled' | 'released'\\n  \\n  // Delivery\\n  mail_items[]  // how it reaches participants\\n  responses[]   // participant submissions\\n}\\n```\\n\\n**Frontend can call these:** \\\"Assignment\\\", \\\"Worksheet\\\", \\\"Exercise\\\" - backend stays \\\"invitation\\\"\\n\\n### Ink Strokes\\n**Handwriting and drawing data**\\n\\n```typescript\\nink_strokes {\\n  id: uuid\\n  page_id: uuid\\n  sheet_id: uuid  // NULL = page-level drawing\\n  stroke_data: jsonb  // vector path data\\n  created_by: uuid\\n  created_at: timestamp\\n}\\n```\\n\\n**Why this matters:** Stroke timing patterns = proof of human authorship\\n\\n---\\n\\n## What We're Building (Current Priority)\\n\\n### Presentation Sessions\\n**Background recording + intentional walkthroughs + live streams**\\n\\n```typescript\\npresentation_sessions {\\n  id: uuid\\n  page_id: uuid\\n  session_type: text  // 'background' | 'recorded' | 'live'\\n  \\n  // Timing\\n  started_at: timestamp\\n  ended_at: timestamp\\n  active_duration_ms: int\\n  \\n  // Proof of human\\n  fingerprint: jsonb {\\n    hash: sha256\\n    stroke_variance: float  // 200-800ms = human\\n    idle_gaps: int[]        // thinking pauses\\n    revision_count: int     // human error rate\\n    confidence_score: int   // 0-100\\n  }\\n  \\n  // Sharing\\n  audio_url: text         // if recorded with audio\\n  visibility: text        // 'private' | 'link-only' | 'public'\\n}\\n```\\n\\n**Three use cases:**\\n1. **Background** - Always-on per page, generates fingerprint\\n2. **Recorded** - Intentional walkthrough with optional audio\\n3. **Live** - Real-time stream, becomes recorded when ended\\n\\n### Page Verifications\\n**Public badge showing \\\"Human-made\\\"**\\n\\n```typescript\\npage_verifications {\\n  page_id: uuid PRIMARY KEY\\n  fingerprint_hash: text\\n  confidence_score: int  // 0-100, show badge if >= 70\\n  badge_visibility: text  // 'auto' | 'always' | 'never'\\n  metrics: jsonb\\n  updated_at: timestamp\\n}\\n```\\n\\n**Badge shows when:**\\n- Confidence >= 70\\n- User hasn't hidden it\\n- Page is shared publicly\\n\\n### Verification Access Requests\\n**Teachers request to see full creation timeline**\\n\\n```typescript\\nverification_access_requests {\\n  id: uuid\\n  page_id: uuid\\n  requester_id: uuid    // teacher\\n  owner_id: uuid        // student\\n  message: text\\n  status: text          // 'pending' | 'approved' | 'declined'\\n  expires_at: timestamp\\n}\\n```\\n\\n**Flow:**\\n1. Teacher views page with badge \\u2192 clicks \\\"Request full history\\\"\\n2. Student gets notification \\u2192 approves\\n3. Teacher can watch complete session recordings\\n\\n---\\n\\n## What We're NOT Building Yet\\n\\n### \\u274c Protocol Federation\\nToo early. Focus on single-instance excellence first.\\n\\n### \\u274c Tool Marketplace\\nPremature. Build 3-5 essential tools first, then think about publishing.\\n\\n### \\u274c Complex Routing DSL\\nCurrent simple routing works. Don't over-engineer.\\n\\n### \\u274c LLM-Based Auto-Assessment\\nSAREC works great as human-authored rubrics + LLM extraction. Don't make it autonomous.\\n\\n---\\n\\n## Key Architectural Decisions\\n\\n### 1. Pages Navigate Via Folders, Not Collections\\n```sql\\n-- \\u274c OLD: pages.collection_id (too direct)\\n-- \\u2705 NEW: page \\u2192 folder \\u2192 collection\\n```\\n\\n**Why:** Allows folder-level organization without breaking collection integrity\\n\\n### 2. Invitations > Released Prompts\\nTerminology matters. \\\"Invitation\\\" is clearer than \\\"released_prompts\\\"\\n\\n### 3. Notifications Split From Mail\\n```sql\\n-- \\u274c OLD: mail_items.type IN ('invitation', 'notification', 'letter')\\n-- \\u2705 NEW: \\n--   mail_items.type IN ('invitation', 'letter', 'share', 'gift')\\n--   notifications (separate table)\\n```\\n\\n**Why:** System alerts \\u2260 human correspondence\\n\\n### 4. Background Sessions Are Always On\\nEvery page edit gets a background session. Owner can view in \\\"Activity\\\" sidebar but it's not intrusive.\\n\\n**Why:** Proof-of-human fingerprints require complete timeline\\n\\n---\\n\\n## Critical Rules (Non-Negotiable)\\n\\n### Content Authorship\\n```typescript\\n// \\u2705 ALLOWED\\npages.content = user_typed_content\\npages.content = user_drew_strokes\\npages.content = user_ratified_suggestion\\n\\n// \\u274c FORBIDDEN\\npages.content = ai_generated_content  // must stay in UI as suggestion\\n```\\n\\n### Provenance Required\\nEvery content-affecting action needs:\\n- `origin: 'human' | 'suggested'`\\n- `author_id: uuid`\\n- `confidence?: float` (if AI-assisted)\\n\\n### Export Sovereignty\\nAny user can export:\\n- All their pages (TipTap JSON)\\n- All their sessions (event timelines)\\n- All their fingerprints (proof certificates)\\n- Format: `.cursive` archive (ZIP)\\n\\n---\\n\\n## What \\\"Protocol\\\" Actually Means\\n\\n**Not:** Abstract interchange format between hypothetical implementations  \\n**Is:** Export format guaranteeing portability\\n\\nWhen a user exports their work, they get:\\n```\\nmy-work.cursive/  (ZIP)\\n\\u251c\\u2500 manifest.json      # version, contents list\\n\\u251c\\u2500 pages/\\n\\u2502  \\u251c\\u2500 page-1.json     # TipTap content + metadata\\n\\u2502  \\u2514\\u2500 page-2.json\\n\\u251c\\u2500 sessions/\\n\\u2502  \\u251c\\u2500 session-1.json  # event timeline\\n\\u2502  \\u2514\\u2500 session-2.json\\n\\u2514\\u2500 fingerprints/\\n   \\u2514\\u2500 page-1-proof.json  # verification certificate\\n```\\n\\n**That's the protocol.** Not CPL, CSA, CTP abstractions.\\n\\n---\\n\\n## Next: Implementation Priorities\\n\\n### Week 1-2: Share + Verify (MVP)\\n- [ ] `/p/{pageId}` public page route\\n- [ ] `SharePageDialog` component\\n- [ ] Fingerprint calculation from sessions\\n- [ ] Badge display when confidence >= 70\\n\\n### Week 3-4: Access Requests\\n- [ ] \\\"Request full history\\\" flow\\n- [ ] Notification system for approvals\\n- [ ] `/w/p/{pageId}` aggregated session viewer\\n\\n### Week 5+: Export\\n- [ ] `.cursive` archive generation\\n- [ ] Proof certificate PDF download\\n- [ ] Import from archive (sovereignty)\\n\\n---\\n\\n## Testing Reality Check\\n\\nBefore shipping any feature, ask:\\n\\n1. **Can I export it?** If not, sovereignty violated\\n2. **Can AI fake it?** If yes, fingerprint insufficient\\n3. **Does it require human action?** If not, agency violated\\n4. **Is provenance preserved?** If not, transparency violated\\n\\n---\\n\\n**This is what exists. This is what we're building. Everything else is noise.**\\n\", \"filename\": \"/mnt/user-data/outputs/CORE_PRIMITIVES.md\"}"
            },
            "approval_options": null,
            "approval_key": null
          },
          {
            "start_timestamp": null,
            "stop_timestamp": null,
            "flags": null,
            "type": "tool_result",
            "name": "create_file",
            "content": [
              {
                "type": "text",
                "text": "File created successfully: /mnt/user-data/outputs/CORE_PRIMITIVES.md",
                "uuid": "26164d66-7363-4234-940e-9d2426e6065e"
              }
            ],
            "is_error": false,
            "message": null,
            "integration_name": null,
            "integration_icon_url": null,
            "display_content": {
              "type": "text",
              "text": "File created successfully: /mnt/user-data/outputs/CORE_PRIMITIVES.md"
            }
          },
          {
            "start_timestamp": null,
            "stop_timestamp": null,
            "flags": null,
            "type": "token_budget"
          },
          {
            "start_timestamp": "2025-11-06T11:59:28.466242Z",
            "stop_timestamp": "2025-11-06T11:59:29.379101Z",
            "flags": null,
            "type": "thinking",
            "thinking": "Good, now I need to create a simplified share and verify document that focuses on what they're actually building right now, stripping out the over-engineering.",
            "summaries": [
              {
                "summary": "Resolved to streamline documentation by eliminating unnecessary complexity."
              }
            ],
            "cut_off": false
          },
          {
            "start_timestamp": "2025-11-06T11:59:29.830130Z",
            "stop_timestamp": "2025-11-06T12:00:35.919347Z",
            "flags": null,
            "type": "tool_use",
            "name": "create_file",
            "input": {
              "path": "/mnt/user-data/outputs/SHARE_AND_VERIFY.md",
              "file_text": "# Share + Verify: MVP Specification\n\n**Status:** Active Implementation  \n**Target:** 3-4 weeks  \n**Purpose:** Students share work + teachers verify authenticity\n\n---\n\n## The Core Problem\n\n**Students need to:** Share finished work with proof it's human-made  \n**Teachers need to:** View work + optionally see creation process  \n**Platform needs to:** Generate unfakeable proof-of-human badges\n\n---\n\n## Three Share Types (Priority Order)\n\n### 1. Share Page (Week 1)\n**URL:** `/p/{pageId}`  \n**Shows:** Finished work + verification badge (if confident)  \n**Access:** Public / Unlisted / Private\n\n### 2. Share Walkthrough - Single Session (Week 2)  \n**URL:** `/w/s/{sessionId}`  \n**Shows:** Replay of one recording session  \n**Access:** Link-only by default\n\n### 3. Share Walkthrough - Full History (Week 3)\n**URL:** `/w/p/{pageId}`  \n**Shows:** All sessions stitched together  \n**Access:** Requires approval from owner\n\n---\n\n## Week 1: Share Page + Badge\n\n### Database Changes\n\n```sql\n-- 1. Add page visibility\nALTER TABLE pages\nADD COLUMN visibility TEXT DEFAULT 'private' \n  CHECK (visibility IN ('public', 'unlisted', 'private'));\n\n-- 2. Create verifications table\nCREATE TABLE page_verifications (\n  page_id UUID PRIMARY KEY REFERENCES pages(id) ON DELETE CASCADE,\n  fingerprint_hash TEXT NOT NULL,\n  confidence_score INTEGER CHECK (confidence_score BETWEEN 0 AND 100),\n  badge_visibility TEXT DEFAULT 'auto',\n  metrics JSONB,\n  updated_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- 3. Update sessions for sharing\nALTER TABLE presentation_sessions \nADD COLUMN capture_type TEXT DEFAULT 'background',\nADD COLUMN public BOOLEAN DEFAULT false,\nADD COLUMN include_audio BOOLEAN DEFAULT false;\n```\n\n### API Routes\n\n```typescript\nGET  /api/pages/{id}/public      // Public page view\nPUT  /api/pages/{id}/visibility   // Update visibility\nPOST /api/verification/calculate/{pageId}  // Generate fingerprint\nGET  /api/pages/{id}/verification  // Get verification data\n```\n\n### Components\n\n#### SharePageDialog\n```tsx\n<SharePageDialog page={page}>\n  <RadioGroup label=\"Who can view\">\n    <Radio value=\"private\">Only me</Radio>\n    <Radio value=\"unlisted\">Anyone with link</Radio>\n    <Radio value=\"public\">Everyone</Radio>\n  </RadioGroup>\n  \n  <Checkbox>Show verification badge</Checkbox>\n  \n  <CopyButton url={`/p/${page.id}`} />\n</SharePageDialog>\n```\n\n#### PublicPageView (`/p/[pageId]/page.tsx`)\n```tsx\n// 1. Check visibility\nif (page.visibility === 'private' && !isOwner) {\n  return <NotFound />\n}\n\n// 2. Render page content\n<TipTapRenderer content={page.content} />\n\n// 3. Show badge if confident\n{verification?.confidence_score >= 70 && (\n  <VerificationBadge \n    verification={verification}\n    onClick={() => setShowModal(true)}\n  />\n)}\n```\n\n#### VerificationBadge\n```tsx\n<div className=\"verification-badge\" onClick={onClick}>\n  <CheckIcon />\n  <span>Human-made</span>\n  <span className=\"confidence\">{score}% confidence</span>\n</div>\n```\n\n---\n\n## The Fingerprint Algorithm\n\n### What Makes Content Human?\n\n**Humans have patterns AI cannot fake:**\n\n1. **Stroke timing variance:** 200-800ms per stroke (hand wobble)\n2. **Idle gaps:** Multiple 5+ second pauses (thinking)\n3. **Correction rate:** 5-20% of actions are edits/undos (mistakes)\n4. **Temporal inconsistency:** Speed varies throughout session\n\n**AI/paste has:**\n- <50ms variance (too perfect)\n- No idle gaps (no thinking)\n- <1% corrections (no mistakes)\n- Constant speed (robotic)\n\n### Implementation\n\n```typescript\nasync function calculateFingerprint(pageId: string): Promise<Verification> {\n  // 1. Get all sessions for this page\n  const sessions = await db\n    .from('presentation_sessions')\n    .select('*')\n    .eq('page_id', pageId)\n    .eq('capture_type', 'background');\n  \n  if (sessions.length === 0) {\n    return { confidence_score: 0, message: 'No session data' };\n  }\n  \n  // 2. Extract events\n  const allEvents = sessions.flatMap(s => s.events || []);\n  const strokes = allEvents.filter(e => e.event_type === 'ink_stroke');\n  const typing = allEvents.filter(e => e.event_type === 'typing');\n  const corrections = allEvents.filter(e => \n    e.event_type === 'backspace' || e.event_type === 'undo'\n  );\n  \n  // 3. Calculate metrics\n  const strokeDurations = strokes.map(s => s.duration_ms || 0);\n  const strokeVariance = calculateStdDev(strokeDurations);\n  \n  const idleGaps = calculateIdleGaps(typing);\n  const longPauses = idleGaps.filter(gap => gap > 5000).length;\n  \n  const correctionRate = corrections.length / Math.max(typing.length, 1);\n  \n  // 4. Score 0-100\n  let confidence = 50;\n  \n  // Human stroke variance (200-800ms)\n  if (strokeVariance >= 200 && strokeVariance <= 800) confidence += 20;\n  if (strokeVariance < 50) confidence -= 30;  // Too perfect = suspicious\n  \n  // Thinking pauses\n  if (longPauses >= 3) confidence += 15;\n  \n  // Human error rate\n  if (correctionRate >= 0.05 && correctionRate <= 0.20) confidence += 15;\n  \n  confidence = Math.max(0, Math.min(100, confidence));\n  \n  // 5. Generate hash\n  const hash = sha256(JSON.stringify(allEvents));\n  \n  return {\n    fingerprint_hash: hash,\n    confidence_score: confidence,\n    metrics: {\n      stroke_count: strokes.length,\n      revision_count: corrections.length,\n      total_active_ms: sessions.reduce((sum, s) => sum + s.active_duration_ms, 0),\n      session_count: sessions.length,\n      temporal_markers: { idle_gaps: idleGaps },\n      behavioral_signals: { stroke_variance: strokeVariance, correction_rate: correctionRate }\n    }\n  };\n}\n\nfunction calculateStdDev(values: number[]): number {\n  const mean = values.reduce((a, b) => a + b, 0) / values.length;\n  const variance = values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / values.length;\n  return Math.sqrt(variance);\n}\n\nfunction calculateIdleGaps(events: Event[]): number[] {\n  const gaps = [];\n  for (let i = 1; i < events.length; i++) {\n    const gap = events[i].timestamp_ms - events[i-1].timestamp_ms;\n    if (gap > 1000) gaps.push(gap);  // Only gaps > 1s\n  }\n  return gaps;\n}\n```\n\n### When to Calculate\n\n**Option A: On-demand (simpler)**\n```typescript\n// When user clicks \"Share\"\nPOST /api/verification/calculate/{pageId}\n```\n\n**Option B: Background job (better UX)**\n```typescript\n// Every time page is updated\nawait queueJob('calculate-fingerprint', { pageId });\n```\n\n**Recommendation:** Start with Option A, move to Option B after MVP works\n\n---\n\n## Week 2: Verification Details Modal\n\n### What Teachers See\n\n```tsx\n<VerificationDetailsModal verification={verification}>\n  {/* Header */}\n  <div className=\"modal-header\">\n    <h2>Verification Details</h2>\n    <Badge score={verification.confidence_score} />\n  </div>\n  \n  {/* Metrics */}\n  <dl className=\"metrics\">\n    <dt>Time spent</dt>\n    <dd>{formatDuration(verification.metrics.total_active_ms)}</dd>\n    \n    <dt>Stroke count</dt>\n    <dd>{verification.metrics.stroke_count}</dd>\n    \n    <dt>Revisions</dt>\n    <dd>{verification.metrics.revision_count}</dd>\n    \n    <dt>Sessions</dt>\n    <dd>{verification.metrics.session_count}</dd>\n  </dl>\n  \n  {/* Fingerprint */}\n  <details>\n    <summary>Cryptographic proof</summary>\n    <code>{verification.fingerprint_hash}</code>\n  </details>\n  \n  {/* Action */}\n  {!isOwner && (\n    <Button onClick={handleRequestAccess}>\n      Request full history\n    </Button>\n  )}\n</VerificationDetailsModal>\n```\n\n---\n\n## Week 3: Access Requests\n\n### Database\n\n```sql\nCREATE TABLE verification_access_requests (\n  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n  page_id UUID REFERENCES pages(id) ON DELETE CASCADE,\n  requester_id UUID REFERENCES auth.users(id),\n  owner_id UUID REFERENCES auth.users(id),\n  message TEXT,\n  status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'declined')),\n  expires_at TIMESTAMPTZ,\n  created_at TIMESTAMPTZ DEFAULT NOW()\n);\n```\n\n### Flow\n\n#### 1. Teacher Requests\n```typescript\nPOST /api/verification/request\n{\n  page_id: \"page-123\",\n  message: \"I'd like to see how you approached this essay\"\n}\n\n// Server creates request + notifies owner\n```\n\n#### 2. Student Approves\n```tsx\n<AccessRequestNotification request={request}>\n  <p>\n    <strong>{request.requester.name}</strong> wants to see \n    how you created \"{request.page.title}\"\n  </p>\n  \n  {request.message && (\n    <blockquote>{request.message}</blockquote>\n  )}\n  \n  <ButtonGroup>\n    <Button onClick={() => approve(request.id, '7days')}>\n      Approve (7 days)\n    </Button>\n    <Button onClick={() => decline(request.id)}>\n      Decline\n    </Button>\n  </ButtonGroup>\n</AccessRequestNotification>\n```\n\n#### 3. Teacher Views History\n```typescript\n// Check if approved\nconst hasAccess = await db\n  .from('verification_access_requests')\n  .select('*')\n  .eq('page_id', pageId)\n  .eq('requester_id', userId)\n  .eq('status', 'approved')\n  .gt('expires_at', new Date())\n  .single();\n\nif (hasAccess) {\n  redirect(`/w/p/${pageId}`);\n}\n```\n\n---\n\n## Week 4: Walkthrough Viewer\n\n### Single Session (`/w/s/{sessionId}`)\n\n```tsx\n<WalkthroughPlayer session={session}>\n  {/* Canvas shows replay */}\n  <Canvas events={session.events} currentTime={currentTime} />\n  \n  {/* Timeline scrubber */}\n  <Timeline\n    duration={session.active_duration_ms}\n    currentTime={currentTime}\n    onSeek={setCurrentTime}\n    moments={detectMoments(session.events)}\n  />\n  \n  {/* Controls */}\n  <Controls>\n    <Button onClick={togglePlay}>{playing ? 'Pause' : 'Play'}</Button>\n    <SpeedControl speed={playbackSpeed} onChange={setPlaybackSpeed} />\n  </Controls>\n</WalkthroughPlayer>\n```\n\n### Aggregated History (`/w/p/{pageId}`)\n\n```tsx\n<AggregatedViewer sessions={sessions}>\n  {/* Left sidebar: session list */}\n  <SessionList>\n    {sessions.map(session => (\n      <SessionCard\n        key={session.id}\n        session={session}\n        active={session.id === currentSession}\n        onClick={() => setCurrentSession(session.id)}\n      />\n    ))}\n  </SessionList>\n  \n  {/* Main: canvas */}\n  <Canvas events={currentEvents} currentTime={currentTime} />\n  \n  {/* Bottom: timeline */}\n  <Timeline\n    duration={totalDuration}\n    currentTime={currentTime}\n    onSeek={setCurrentTime}\n    sessions={sessions}  // Show session boundaries\n  />\n</AggregatedViewer>\n```\n\n---\n\n## Privacy Rules\n\n| Share Type | Default Visibility | Default Audio | Who Can Access |\n|------------|-------------------|---------------|----------------|\n| Page | Private | N/A | Owner only |\n| Single session | Private | Off (background) | Owner only |\n| Full history | Private | Inherited | Owner + approved |\n\n**Key principle:** Everything defaults to private. User must explicitly share.\n\n---\n\n## Testing Checklist\n\n### Week 1\n- [ ] Public page loads at `/p/{pageId}`\n- [ ] Private page returns 404 for non-owner\n- [ ] Fingerprint calculates correctly\n- [ ] Badge shows when confidence >= 70\n- [ ] Badge hides when confidence < 70\n\n### Week 2\n- [ ] Modal shows metrics on badge click\n- [ ] Fingerprint hash is displayed\n- [ ] \"Request access\" button works\n- [ ] Request notification sent to owner\n\n### Week 3\n- [ ] Student can approve/decline requests\n- [ ] Approved requests grant access\n- [ ] Expired requests are blocked\n- [ ] Declined requests can't be retried\n\n### Week 4\n- [ ] Single session plays at `/w/s/{id}`\n- [ ] Timeline scrubbing works\n- [ ] Playback speed control works\n- [ ] Aggregated viewer stitches sessions correctly\n- [ ] Can jump between sessions\n\n---\n\n## Success Metrics\n\nYou've succeeded when:\n\n1. ✅ Student shares essay → teacher sees badge\n2. ✅ Teacher clicks badge → sees metrics\n3. ✅ Teacher requests history → student approves\n4. ✅ Teacher watches full creation timeline\n5. ✅ Badge cannot be faked (fingerprint algorithm works)\n\n---\n\n## What We're NOT Building (Yet)\n\n### ❌ Export to `.cursive` archives\nMVP doesn't need this. Add in Week 5+.\n\n### ❌ Live streaming\nFocus on recorded walkthroughs first.\n\n### ❌ Multiple session types\nAll sessions are \"background\" for MVP. Add \"intent\" and \"live\" later.\n\n### ❌ Sprint clipping\nToo complex for MVP. Full history or nothing.\n\n### ❌ Audio recording\nBackground sessions have no audio. Add audio for \"intent\" sessions later.\n\n---\n\n## Implementation Order (Strict)\n\n```\nWeek 1 Day 1-2: Database migrations\nWeek 1 Day 3-4: SharePageDialog + visibility logic\nWeek 1 Day 5:   PublicPageView route + access control\n\nWeek 2 Day 1-2: Fingerprint calculation function\nWeek 2 Day 3-4: VerificationBadge + DetailsModal\nWeek 2 Day 5:   Testing + polish\n\nWeek 3 Day 1-2: Access request API + database\nWeek 3 Day 3-4: Notification system\nWeek 3 Day 5:   Approval flow UI\n\nWeek 4 Day 1-3: WalkthroughPlayer component\nWeek 4 Day 4-5: Aggregated viewer + session stitching\n```\n\n**Ship after Week 2.** Weeks 3-4 are enhancements.\n\n---\n\n**This is the MVP. Build this first. Everything else is scope creep.**\n",
              "description": "Creating streamlined share and verify spec focusing on the MVP they're actually building"
            },
            "message": "Creating streamlined share and verify spec focusing on the MVP they're actually building",
            "integration_name": null,
            "integration_icon_url": null,
            "context": null,
            "display_content": {
              "type": "json_block",
              "json_block": "{\"language\": \"markdown\", \"code\": \"# Share + Verify: MVP Specification\\n\\n**Status:** Active Implementation  \\n**Target:** 3-4 weeks  \\n**Purpose:** Students share work + teachers verify authenticity\\n\\n---\\n\\n## The Core Problem\\n\\n**Students need to:** Share finished work with proof it's human-made  \\n**Teachers need to:** View work + optionally see creation process  \\n**Platform needs to:** Generate unfakeable proof-of-human badges\\n\\n---\\n\\n## Three Share Types (Priority Order)\\n\\n### 1. Share Page (Week 1)\\n**URL:** `/p/{pageId}`  \\n**Shows:** Finished work + verification badge (if confident)  \\n**Access:** Public / Unlisted / Private\\n\\n### 2. Share Walkthrough - Single Session (Week 2)  \\n**URL:** `/w/s/{sessionId}`  \\n**Shows:** Replay of one recording session  \\n**Access:** Link-only by default\\n\\n### 3. Share Walkthrough - Full History (Week 3)\\n**URL:** `/w/p/{pageId}`  \\n**Shows:** All sessions stitched together  \\n**Access:** Requires approval from owner\\n\\n---\\n\\n## Week 1: Share Page + Badge\\n\\n### Database Changes\\n\\n```sql\\n-- 1. Add page visibility\\nALTER TABLE pages\\nADD COLUMN visibility TEXT DEFAULT 'private' \\n  CHECK (visibility IN ('public', 'unlisted', 'private'));\\n\\n-- 2. Create verifications table\\nCREATE TABLE page_verifications (\\n  page_id UUID PRIMARY KEY REFERENCES pages(id) ON DELETE CASCADE,\\n  fingerprint_hash TEXT NOT NULL,\\n  confidence_score INTEGER CHECK (confidence_score BETWEEN 0 AND 100),\\n  badge_visibility TEXT DEFAULT 'auto',\\n  metrics JSONB,\\n  updated_at TIMESTAMPTZ DEFAULT NOW()\\n);\\n\\n-- 3. Update sessions for sharing\\nALTER TABLE presentation_sessions \\nADD COLUMN capture_type TEXT DEFAULT 'background',\\nADD COLUMN public BOOLEAN DEFAULT false,\\nADD COLUMN include_audio BOOLEAN DEFAULT false;\\n```\\n\\n### API Routes\\n\\n```typescript\\nGET  /api/pages/{id}/public      // Public page view\\nPUT  /api/pages/{id}/visibility   // Update visibility\\nPOST /api/verification/calculate/{pageId}  // Generate fingerprint\\nGET  /api/pages/{id}/verification  // Get verification data\\n```\\n\\n### Components\\n\\n#### SharePageDialog\\n```tsx\\n<SharePageDialog page={page}>\\n  <RadioGroup label=\\\"Who can view\\\">\\n    <Radio value=\\\"private\\\">Only me</Radio>\\n    <Radio value=\\\"unlisted\\\">Anyone with link</Radio>\\n    <Radio value=\\\"public\\\">Everyone</Radio>\\n  </RadioGroup>\\n  \\n  <Checkbox>Show verification badge</Checkbox>\\n  \\n  <CopyButton url={`/p/${page.id}`} />\\n</SharePageDialog>\\n```\\n\\n#### PublicPageView (`/p/[pageId]/page.tsx`)\\n```tsx\\n// 1. Check visibility\\nif (page.visibility === 'private' && !isOwner) {\\n  return <NotFound />\\n}\\n\\n// 2. Render page content\\n<TipTapRenderer content={page.content} />\\n\\n// 3. Show badge if confident\\n{verification?.confidence_score >= 70 && (\\n  <VerificationBadge \\n    verification={verification}\\n    onClick={() => setShowModal(true)}\\n  />\\n)}\\n```\\n\\n#### VerificationBadge\\n```tsx\\n<div className=\\\"verification-badge\\\" onClick={onClick}>\\n  <CheckIcon />\\n  <span>Human-made</span>\\n  <span className=\\\"confidence\\\">{score}% confidence</span>\\n</div>\\n```\\n\\n---\\n\\n## The Fingerprint Algorithm\\n\\n### What Makes Content Human?\\n\\n**Humans have patterns AI cannot fake:**\\n\\n1. **Stroke timing variance:** 200-800ms per stroke (hand wobble)\\n2. **Idle gaps:** Multiple 5+ second pauses (thinking)\\n3. **Correction rate:** 5-20% of actions are edits/undos (mistakes)\\n4. **Temporal inconsistency:** Speed varies throughout session\\n\\n**AI/paste has:**\\n- <50ms variance (too perfect)\\n- No idle gaps (no thinking)\\n- <1% corrections (no mistakes)\\n- Constant speed (robotic)\\n\\n### Implementation\\n\\n```typescript\\nasync function calculateFingerprint(pageId: string): Promise<Verification> {\\n  // 1. Get all sessions for this page\\n  const sessions = await db\\n    .from('presentation_sessions')\\n    .select('*')\\n    .eq('page_id', pageId)\\n    .eq('capture_type', 'background');\\n  \\n  if (sessions.length === 0) {\\n    return { confidence_score: 0, message: 'No session data' };\\n  }\\n  \\n  // 2. Extract events\\n  const allEvents = sessions.flatMap(s => s.events || []);\\n  const strokes = allEvents.filter(e => e.event_type === 'ink_stroke');\\n  const typing = allEvents.filter(e => e.event_type === 'typing');\\n  const corrections = allEvents.filter(e => \\n    e.event_type === 'backspace' || e.event_type === 'undo'\\n  );\\n  \\n  // 3. Calculate metrics\\n  const strokeDurations = strokes.map(s => s.duration_ms || 0);\\n  const strokeVariance = calculateStdDev(strokeDurations);\\n  \\n  const idleGaps = calculateIdleGaps(typing);\\n  const longPauses = idleGaps.filter(gap => gap > 5000).length;\\n  \\n  const correctionRate = corrections.length / Math.max(typing.length, 1);\\n  \\n  // 4. Score 0-100\\n  let confidence = 50;\\n  \\n  // Human stroke variance (200-800ms)\\n  if (strokeVariance >= 200 && strokeVariance <= 800) confidence += 20;\\n  if (strokeVariance < 50) confidence -= 30;  // Too perfect = suspicious\\n  \\n  // Thinking pauses\\n  if (longPauses >= 3) confidence += 15;\\n  \\n  // Human error rate\\n  if (correctionRate >= 0.05 && correctionRate <= 0.20) confidence += 15;\\n  \\n  confidence = Math.max(0, Math.min(100, confidence));\\n  \\n  // 5. Generate hash\\n  const hash = sha256(JSON.stringify(allEvents));\\n  \\n  return {\\n    fingerprint_hash: hash,\\n    confidence_score: confidence,\\n    metrics: {\\n      stroke_count: strokes.length,\\n      revision_count: corrections.length,\\n      total_active_ms: sessions.reduce((sum, s) => sum + s.active_duration_ms, 0),\\n      session_count: sessions.length,\\n      temporal_markers: { idle_gaps: idleGaps },\\n      behavioral_signals: { stroke_variance: strokeVariance, correction_rate: correctionRate }\\n    }\\n  };\\n}\\n\\nfunction calculateStdDev(values: number[]): number {\\n  const mean = values.reduce((a, b) => a + b, 0) / values.length;\\n  const variance = values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / values.length;\\n  return Math.sqrt(variance);\\n}\\n\\nfunction calculateIdleGaps(events: Event[]): number[] {\\n  const gaps = [];\\n  for (let i = 1; i < events.length; i++) {\\n    const gap = events[i].timestamp_ms - events[i-1].timestamp_ms;\\n    if (gap > 1000) gaps.push(gap);  // Only gaps > 1s\\n  }\\n  return gaps;\\n}\\n```\\n\\n### When to Calculate\\n\\n**Option A: On-demand (simpler)**\\n```typescript\\n// When user clicks \\\"Share\\\"\\nPOST /api/verification/calculate/{pageId}\\n```\\n\\n**Option B: Background job (better UX)**\\n```typescript\\n// Every time page is updated\\nawait queueJob('calculate-fingerprint', { pageId });\\n```\\n\\n**Recommendation:** Start with Option A, move to Option B after MVP works\\n\\n---\\n\\n## Week 2: Verification Details Modal\\n\\n### What Teachers See\\n\\n```tsx\\n<VerificationDetailsModal verification={verification}>\\n  {/* Header */}\\n  <div className=\\\"modal-header\\\">\\n    <h2>Verification Details</h2>\\n    <Badge score={verification.confidence_score} />\\n  </div>\\n  \\n  {/* Metrics */}\\n  <dl className=\\\"metrics\\\">\\n    <dt>Time spent</dt>\\n    <dd>{formatDuration(verification.metrics.total_active_ms)}</dd>\\n    \\n    <dt>Stroke count</dt>\\n    <dd>{verification.metrics.stroke_count}</dd>\\n    \\n    <dt>Revisions</dt>\\n    <dd>{verification.metrics.revision_count}</dd>\\n    \\n    <dt>Sessions</dt>\\n    <dd>{verification.metrics.session_count}</dd>\\n  </dl>\\n  \\n  {/* Fingerprint */}\\n  <details>\\n    <summary>Cryptographic proof</summary>\\n    <code>{verification.fingerprint_hash}</code>\\n  </details>\\n  \\n  {/* Action */}\\n  {!isOwner && (\\n    <Button onClick={handleRequestAccess}>\\n      Request full history\\n    </Button>\\n  )}\\n</VerificationDetailsModal>\\n```\\n\\n---\\n\\n## Week 3: Access Requests\\n\\n### Database\\n\\n```sql\\nCREATE TABLE verification_access_requests (\\n  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\\n  page_id UUID REFERENCES pages(id) ON DELETE CASCADE,\\n  requester_id UUID REFERENCES auth.users(id),\\n  owner_id UUID REFERENCES auth.users(id),\\n  message TEXT,\\n  status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'declined')),\\n  expires_at TIMESTAMPTZ,\\n  created_at TIMESTAMPTZ DEFAULT NOW()\\n);\\n```\\n\\n### Flow\\n\\n#### 1. Teacher Requests\\n```typescript\\nPOST /api/verification/request\\n{\\n  page_id: \\\"page-123\\\",\\n  message: \\\"I'd like to see how you approached this essay\\\"\\n}\\n\\n// Server creates request + notifies owner\\n```\\n\\n#### 2. Student Approves\\n```tsx\\n<AccessRequestNotification request={request}>\\n  <p>\\n    <strong>{request.requester.name}</strong> wants to see \\n    how you created \\\"{request.page.title}\\\"\\n  </p>\\n  \\n  {request.message && (\\n    <blockquote>{request.message}</blockquote>\\n  )}\\n  \\n  <ButtonGroup>\\n    <Button onClick={() => approve(request.id, '7days')}>\\n      Approve (7 days)\\n    </Button>\\n    <Button onClick={() => decline(request.id)}>\\n      Decline\\n    </Button>\\n  </ButtonGroup>\\n</AccessRequestNotification>\\n```\\n\\n#### 3. Teacher Views History\\n```typescript\\n// Check if approved\\nconst hasAccess = await db\\n  .from('verification_access_requests')\\n  .select('*')\\n  .eq('page_id', pageId)\\n  .eq('requester_id', userId)\\n  .eq('status', 'approved')\\n  .gt('expires_at', new Date())\\n  .single();\\n\\nif (hasAccess) {\\n  redirect(`/w/p/${pageId}`);\\n}\\n```\\n\\n---\\n\\n## Week 4: Walkthrough Viewer\\n\\n### Single Session (`/w/s/{sessionId}`)\\n\\n```tsx\\n<WalkthroughPlayer session={session}>\\n  {/* Canvas shows replay */}\\n  <Canvas events={session.events} currentTime={currentTime} />\\n  \\n  {/* Timeline scrubber */}\\n  <Timeline\\n    duration={session.active_duration_ms}\\n    currentTime={currentTime}\\n    onSeek={setCurrentTime}\\n    moments={detectMoments(session.events)}\\n  />\\n  \\n  {/* Controls */}\\n  <Controls>\\n    <Button onClick={togglePlay}>{playing ? 'Pause' : 'Play'}</Button>\\n    <SpeedControl speed={playbackSpeed} onChange={setPlaybackSpeed} />\\n  </Controls>\\n</WalkthroughPlayer>\\n```\\n\\n### Aggregated History (`/w/p/{pageId}`)\\n\\n```tsx\\n<AggregatedViewer sessions={sessions}>\\n  {/* Left sidebar: session list */}\\n  <SessionList>\\n    {sessions.map(session => (\\n      <SessionCard\\n        key={session.id}\\n        session={session}\\n        active={session.id === currentSession}\\n        onClick={() => setCurrentSession(session.id)}\\n      />\\n    ))}\\n  </SessionList>\\n  \\n  {/* Main: canvas */}\\n  <Canvas events={currentEvents} currentTime={currentTime} />\\n  \\n  {/* Bottom: timeline */}\\n  <Timeline\\n    duration={totalDuration}\\n    currentTime={currentTime}\\n    onSeek={setCurrentTime}\\n    sessions={sessions}  // Show session boundaries\\n  />\\n</AggregatedViewer>\\n```\\n\\n---\\n\\n## Privacy Rules\\n\\n| Share Type | Default Visibility | Default Audio | Who Can Access |\\n|------------|-------------------|---------------|----------------|\\n| Page | Private | N/A | Owner only |\\n| Single session | Private | Off (background) | Owner only |\\n| Full history | Private | Inherited | Owner + approved |\\n\\n**Key principle:** Everything defaults to private. User must explicitly share.\\n\\n---\\n\\n## Testing Checklist\\n\\n### Week 1\\n- [ ] Public page loads at `/p/{pageId}`\\n- [ ] Private page returns 404 for non-owner\\n- [ ] Fingerprint calculates correctly\\n- [ ] Badge shows when confidence >= 70\\n- [ ] Badge hides when confidence < 70\\n\\n### Week 2\\n- [ ] Modal shows metrics on badge click\\n- [ ] Fingerprint hash is displayed\\n- [ ] \\\"Request access\\\" button works\\n- [ ] Request notification sent to owner\\n\\n### Week 3\\n- [ ] Student can approve/decline requests\\n- [ ] Approved requests grant access\\n- [ ] Expired requests are blocked\\n- [ ] Declined requests can't be retried\\n\\n### Week 4\\n- [ ] Single session plays at `/w/s/{id}`\\n- [ ] Timeline scrubbing works\\n- [ ] Playback speed control works\\n- [ ] Aggregated viewer stitches sessions correctly\\n- [ ] Can jump between sessions\\n\\n---\\n\\n## Success Metrics\\n\\nYou've succeeded when:\\n\\n1. \\u2705 Student shares essay \\u2192 teacher sees badge\\n2. \\u2705 Teacher clicks badge \\u2192 sees metrics\\n3. \\u2705 Teacher requests history \\u2192 student approves\\n4. \\u2705 Teacher watches full creation timeline\\n5. \\u2705 Badge cannot be faked (fingerprint algorithm works)\\n\\n---\\n\\n## What We're NOT Building (Yet)\\n\\n### \\u274c Export to `.cursive` archives\\nMVP doesn't need this. Add in Week 5+.\\n\\n### \\u274c Live streaming\\nFocus on recorded walkthroughs first.\\n\\n### \\u274c Multiple session types\\nAll sessions are \\\"background\\\" for MVP. Add \\\"intent\\\" and \\\"live\\\" later.\\n\\n### \\u274c Sprint clipping\\nToo complex for MVP. Full history or nothing.\\n\\n### \\u274c Audio recording\\nBackground sessions have no audio. Add audio for \\\"intent\\\" sessions later.\\n\\n---\\n\\n## Implementation Order (Strict)\\n\\n```\\nWeek 1 Day 1-2: Database migrations\\nWeek 1 Day 3-4: SharePageDialog + visibility logic\\nWeek 1 Day 5:   PublicPageView route + access control\\n\\nWeek 2 Day 1-2: Fingerprint calculation function\\nWeek 2 Day 3-4: VerificationBadge + DetailsModal\\nWeek 2 Day 5:   Testing + polish\\n\\nWeek 3 Day 1-2: Access request API + database\\nWeek 3 Day 3-4: Notification system\\nWeek 3 Day 5:   Approval flow UI\\n\\nWeek 4 Day 1-3: WalkthroughPlayer component\\nWeek 4 Day 4-5: Aggregated viewer + session stitching\\n```\\n\\n**Ship after Week 2.** Weeks 3-4 are enhancements.\\n\\n---\\n\\n**This is the MVP. Build this first. Everything else is scope creep.**\\n\", \"filename\": \"/mnt/user-data/outputs/SHARE_AND_VERIFY.md\"}"
            },
            "approval_options": null,
            "approval_key": null
          },
          {
            "start_timestamp": null,
            "stop_timestamp": null,
            "flags": null,
            "type": "tool_result",
            "name": "create_file",
            "content": [
              {
                "type": "text",
                "text": "File created successfully: /mnt/user-data/outputs/SHARE_AND_VERIFY.md",
                "uuid": "7b280c4a-893f-4bc4-854a-09344f4b17ab"
              }
            ],
            "is_error": false,
            "message": null,
            "integration_name": null,
            "integration_icon_url": null,
            "display_content": {
              "type": "text",
              "text": "File created successfully: /mnt/user-data/outputs/SHARE_AND_VERIFY.md"
            }
          },
          {
            "start_timestamp": null,
            "stop_timestamp": null,
            "flags": null,
            "type": "token_budget"
          },
          {
            "start_timestamp": "2025-11-06T12:00:40.702465Z",
            "stop_timestamp": "2025-11-06T12:00:42.565794Z",
            "flags": null,
            "type": "thinking",
            "thinking": "Good. Now I need to create a simplified schema reality check document that clarifies what actually exists vs what needs to be built/cleaned up. This should incorporate the decisions from SCHEMA_CLEANUP_PLAN but make it more actionable.",
            "summaries": [
              {
                "summary": "Synthesized cleanup decisions into actionable documentation framework."
              }
            ],
            "cut_off": false
          },
          {
            "start_timestamp": "2025-11-06T12:00:43.061713Z",
            "stop_timestamp": "2025-11-06T12:01:50.699787Z",
            "flags": null,
            "type": "tool_use",
            "name": "create_file",
            "input": {
              "path": "/mnt/user-data/outputs/DATABASE_REALITY.md",
              "file_text": "# Database Schema: Current Reality\n\n**Last Updated:** November 6, 2025  \n**Purpose:** What exists, what's contradictory, what to fix  \n**Philosophy:** Fix contradictions, keep capabilities that serve values\n\n---\n\n## Current State Summary\n\n**Total tables:** ~30  \n**Contradictions:** 5 major issues  \n**Unused tables:** ~3-4 (need data check)  \n**Overall verdict:** Mostly good, needs surgical cleanup\n\n---\n\n## The 5 Real Problems\n\n### 1. Double Kind Column ❌\n\n```sql\n-- CURRENT (contradictory)\ncollections.kind              -- TEXT enum\ncollections.collection_kind   -- CUSTOM enum type (duplicate!)\n\n-- FIX\nALTER TABLE collections DROP COLUMN collection_kind;\n-- Keep TEXT with CHECK constraint\n```\n\n**Impact:** Confusing, but doesn't break anything  \n**Fix time:** 5 minutes  \n**Risk:** Low\n\n---\n\n### 2. Triple Parent Path ❌\n\n```sql\n-- CURRENT (three ways to parent!)\npages.section_id     -- FK to sections (0 pages use this)\npages.folder_id      -- FK to folders (all 11 pages use this)\npages.collection_id  -- FK to collections (too direct!)\n\n-- FIX\nALTER TABLE pages DROP COLUMN collection_id;\n-- Navigate via: page → folder → collection\n\nALTER TABLE pages ADD CONSTRAINT page_parent_exclusive\n  CHECK (\n    (section_id IS NOT NULL AND folder_id IS NULL) OR\n    (section_id IS NULL AND folder_id IS NOT NULL)\n  );\n```\n\n**Why:** \n- Direct collection_id breaks folder abstraction\n- Section vs folder should be either/or, not both\n- Sections needed for daily page grouping + assignment metadata\n\n**Impact:** High - touches core navigation  \n**Fix time:** 30 minutes  \n**Risk:** Medium (update all queries)\n\n---\n\n### 3. Guide Pages vs Pages ❌\n\n```sql\n-- CURRENT\nguide_pages  -- 0 records, 18 code references\npages        -- 11 records, 59 code references\n\n-- QUESTION: Are guide_pages templates and pages instances?\n```\n\n**Decision needed:** Do we drop guide_pages entirely?\n\n**Option A: Drop it (simpler)**\n```sql\nDROP TABLE guide_pages CASCADE;\nALTER TABLE pages ADD COLUMN page_type TEXT\n  CHECK (page_type IN ('daily', 'template', 'response', 'custom'));\n```\n\n**Option B: Keep as template source**\n```sql\nALTER TABLE pages ADD COLUMN source_guide_page_id uuid\n  REFERENCES guide_pages(id);\n-- guide_pages = template library\n-- pages = instances from templates\n```\n\n**Recommendation:** Option A unless you actively use guide_pages as templates\n\n**Impact:** Medium - 18 code references to update  \n**Fix time:** 1-2 hours  \n**Risk:** Medium (code changes)\n\n---\n\n### 4. Terminology Drift ❌\n\n```sql\n-- LEGACY NAMES\nnotebooks              -- deprecated, use collections\nreleased_prompts       -- should be \"invitations\"\nnotebookId in code     -- should be collectionId\n\n-- FIX\nALTER TABLE released_prompts RENAME TO invitations;\nALTER TABLE responses RENAME COLUMN released_id TO invitation_id;\n\n-- Code migration\n// Find/replace: notebookId → collectionId\n// Update imports: released_prompts → invitations\n```\n\n**Why:** \"Invitation\" is clearer than \"released_prompts\"\n\n**Impact:** High - touches many files  \n**Fix time:** 2-3 hours  \n**Risk:** Low (mostly naming)\n\n---\n\n### 5. Mail Types Unclear ❌\n\n```sql\n-- CURRENT (broken constraint!)\nmail_items.type CHECK IN ('invitation', 'notification', 'share', 'gift')\n-- But code creates 'letter' (not in constraint!) ❌\n-- Mixing human mail with system alerts ❌\n\n-- FIX\n-- Split system alerts from human correspondence\nCREATE TABLE notifications (\n  id uuid PRIMARY KEY,\n  recipient_id uuid REFERENCES auth.users(id),\n  notification_type TEXT CHECK (notification_type IN\n    ('comment', 'due_date', 'release', 'mention', 'system')),\n  subject_type TEXT CHECK (subject_type IN\n    ('page', 'comment', 'invitation', 'response')),\n  subject_id uuid NOT NULL,\n  title TEXT NOT NULL,\n  message TEXT,\n  action_url TEXT,\n  read_at timestamptz,\n  created_at timestamptz DEFAULT now()\n);\n\n-- Update mail_items constraint\nALTER TABLE mail_items DROP CONSTRAINT mail_items_type_check;\nALTER TABLE mail_items ADD CONSTRAINT mail_items_type_check\n  CHECK (type IN ('invitation', 'letter', 'share', 'gift'));\n```\n\n**Why:** System alerts ≠ human correspondence\n\n**Impact:** Medium - notification code must migrate  \n**Fix time:** 2-3 hours  \n**Risk:** Medium (split existing data)\n\n---\n\n## Tables We're Keeping (All ~30)\n\n### Core Content (5) ✅\n```sql\nprofiles              -- User accounts\norganizations         -- Institutional accounts\ncollections           -- Journals, guides, templates\nfolders               -- Organization within collections\npages                 -- Sacred human documents\n```\n\n### Cohorts & Groups (5) ✅\n```sql\ngroups                -- Cohorts/classes\ngroup_members         -- Enrollment\ninvitations           -- Timed prompts (renamed from released_prompts)\nresponses             -- Student submissions\nanswers               -- Extracted assessment data\n```\n\n### Communication (2) ✅\n```sql\nmail_items            -- Human correspondence (letters, shares, gifts)\nnotifications         -- System alerts (NEW, split from mail_items)\n```\n\n### Assessment (3) ✅\n```sql\nquestions             -- Reusable assessment registry\nanswers               -- Responses with extraction + confidence\npages.action          -- Conditional navigation (metadata column)\n```\n\n### Analysis (3) ✅\n```sql\naggregations          -- Cohort insights\nlenses                -- Analysis definitions\nlens_results          -- Cached analysis with evidence\n```\n\n### Tools (5) ✅\n```sql\ntool_plugins          -- Registered tools\ntool_runs             -- Invocation log\ntool_cards            -- Suggestion outputs\nuser_tool_settings    -- Personal configs\ngroup_tool_settings   -- Cohort configs\n```\n\n### Views (2) ✅\n```sql\nviews                 -- Display configurations\nsaved_views           -- User/group view presets\n```\n\n### Verification (4) ✅\n```sql\npage_verifications              -- Proof-of-human badges\nverification_access_requests    -- Share permissions\nink_strokes                     -- Handwriting data\npresentation_sessions           -- Walkthrough recordings\n```\n\n### History (1) ✅\n```sql\npage_history          -- Audit trail\n```\n\n**Total: 30 tables serving clear purposes**\n\n---\n\n## Tables to Check (Possibly Drop)\n\nRun these queries to see if they're actually used:\n\n```sql\n-- Check which tables are empty/unused\nSELECT\n  'collection_usage_stats' as table_name,\n  COUNT(*) as rows,\n  CASE \n    WHEN COUNT(*) = 0 THEN '❌ DROP'\n    ELSE '✅ KEEP'\n  END as verdict\nFROM collection_usage_stats\n\nUNION ALL SELECT 'collection_ratings', COUNT(*),\n  CASE WHEN COUNT(*) = 0 THEN '❌ DROP' ELSE '✅ KEEP' END\nFROM collection_ratings\n\nUNION ALL SELECT 'personal_schedules', COUNT(*),\n  CASE WHEN COUNT(*) = 0 THEN '❌ DROP' ELSE '✅ KEEP' END\nFROM personal_schedules\n\nUNION ALL SELECT 'snapshots', COUNT(*),\n  CASE WHEN COUNT(*) = 0 THEN '❌ DROP' ELSE '✅ KEEP' END\nFROM snapshots\n\nUNION ALL SELECT 'writing_sessions', COUNT(*),\n  CASE WHEN COUNT(*) = 0 THEN '❌ DROP' ELSE '✅ KEEP' END\nFROM writing_sessions;\n```\n\n**If 0 rows:** Safe to drop  \n**If >0 rows:** Keep and document purpose\n\n---\n\n## Migration Script (The Fixes)\n\n```sql\n-- Migration: 20251106_schema_cleanup.sql\n-- Purpose: Fix the 5 contradictions\n\nBEGIN;\n\n-- 1. Fix double kind column\nALTER TABLE collections DROP COLUMN IF EXISTS collection_kind;\nALTER TABLE collections ALTER COLUMN kind TYPE TEXT;\nALTER TABLE collections ADD CONSTRAINT collections_kind_check \n  CHECK (kind IN ('workspace', 'template', 'shared'));\n\n-- 2. Fix triple parent path\nALTER TABLE pages DROP COLUMN IF EXISTS collection_id;\nALTER TABLE pages ADD CONSTRAINT page_parent_exclusive\n  CHECK (\n    (section_id IS NOT NULL AND folder_id IS NULL) OR\n    (section_id IS NULL AND folder_id IS NOT NULL)\n  );\n\n-- 3. Clarify guide_pages (CHOOSE ONE)\n\n-- Option A: Drop guide_pages\n-- DROP TABLE IF EXISTS guide_pages CASCADE;\n-- ALTER TABLE pages ADD COLUMN page_type TEXT\n--   CHECK (page_type IN ('daily', 'template', 'response', 'custom'));\n\n-- Option B: Keep as template source\n-- ALTER TABLE pages ADD COLUMN source_guide_page_id uuid\n--   REFERENCES guide_pages(id);\n\n-- 4. Rename for clarity\nALTER TABLE released_prompts RENAME TO invitations;\nALTER TABLE responses RENAME COLUMN released_id TO invitation_id;\n\n-- 5. Split mail from notifications\nCREATE TABLE IF NOT EXISTS notifications (\n  id uuid PRIMARY KEY DEFAULT uuid_generate_v4(),\n  recipient_id uuid REFERENCES auth.users(id) ON DELETE CASCADE,\n  notification_type TEXT NOT NULL CHECK (notification_type IN\n    ('comment', 'due_date', 'release', 'mention', 'system')),\n  subject_type TEXT NOT NULL CHECK (subject_type IN\n    ('page', 'comment', 'invitation', 'response')),\n  subject_id uuid NOT NULL,\n  title TEXT NOT NULL,\n  message TEXT,\n  action_url TEXT,\n  payload jsonb DEFAULT '{}',\n  read_at timestamptz,\n  created_at timestamptz DEFAULT now()\n);\n\n-- Migrate notification-type mail_items\nINSERT INTO notifications (recipient_id, notification_type, subject_type, subject_id, title, message, created_at)\nSELECT \n  recipient_id,\n  'system' as notification_type,\n  'page' as subject_type,  -- adjust based on your data\n  id as subject_id,\n  subject as title,\n  body as message,\n  created_at\nFROM mail_items\nWHERE type = 'notification';\n\n-- Remove migrated rows\nDELETE FROM mail_items WHERE type = 'notification';\n\n-- Fix mail_items constraint\nALTER TABLE mail_items DROP CONSTRAINT IF EXISTS mail_items_type_check;\nALTER TABLE mail_items ADD CONSTRAINT mail_items_type_check\n  CHECK (type IN ('invitation', 'letter', 'share', 'gift'));\n\nCOMMIT;\n```\n\n---\n\n## Code Migration Checklist\n\nAfter running migration, update code:\n\n### Week 1: Terminology\n- [ ] Find/replace `notebookId` → `collectionId`\n- [ ] Find/replace `released_prompts` → `invitations`\n- [ ] Find/replace `released_id` → `invitation_id`\n- [ ] Update imports: `from 'released_prompts'` → `from 'invitations'`\n\n### Week 2: Schema Changes\n- [ ] Remove `pages.collection_id` from queries\n- [ ] Update navigation: `page → folder → collection`\n- [ ] Update notification code to use new `notifications` table\n- [ ] Test mail sending (ensure letters/shares still work)\n\n### Week 3: Decision on guide_pages\n- [ ] Decide: Drop or keep as templates?\n- [ ] If drop: Update 18 code references to use `pages.page_type`\n- [ ] If keep: Add `source_guide_page_id` to page creation logic\n\n---\n\n## Testing After Migration\n\n```sql\n-- 1. Verify no duplicate kind columns\nSELECT column_name \nFROM information_schema.columns \nWHERE table_name = 'collections' AND column_name LIKE '%kind%';\n-- Should return only: \"kind\"\n\n-- 2. Verify page navigation works\nSELECT p.id, f.name as folder, c.title as collection\nFROM pages p\nJOIN folders f ON p.folder_id = f.id\nJOIN collections c ON f.collection_id = c.id\nLIMIT 5;\n-- Should work without pages.collection_id\n\n-- 3. Verify mail vs notifications split\nSELECT type, COUNT(*) \nFROM mail_items \nGROUP BY type;\n-- Should only show: invitation, letter, share, gift\n\nSELECT notification_type, COUNT(*) \nFROM notifications \nGROUP BY notification_type;\n-- Should show: comment, due_date, release, mention, system\n\n-- 4. Verify renamed tables\nSELECT COUNT(*) FROM invitations;\n-- Should work (formerly released_prompts)\n```\n\n---\n\n## Success Criteria\n\n✅ All contradictions resolved (5 problems fixed)  \n✅ All value-serving capabilities preserved  \n✅ Zero data loss  \n✅ Tests pass  \n✅ Code updated to match schema\n\n---\n\n## What This Is NOT\n\n### ❌ Minimization Exercise\nWe're keeping all ~30 tables that serve our values.\n\n### ❌ Protocol Definition\nThis is our database schema, not an interchange format.\n\n### ❌ Premature Optimization\nWe're fixing contradictions, not redesigning from scratch.\n\n---\n\n## Protocol vs Database (Important Distinction)\n\n**Database (this doc):** Our implementation with ~30 tables  \n**Protocol (export format):** What users get when they export\n\nWhen someone exports their work:\n```\nmy-work.cursive/  (ZIP)\n├─ manifest.json\n├─ pages/\n├─ sessions/\n└─ fingerprints/\n```\n\n**That's the protocol.** The database is just how we store it internally.\n\n---\n\n## Next Steps\n\n1. **Review this plan** with team\n2. **Run check queries** to see what's empty\n3. **Decide on guide_pages**: Drop or keep?\n4. **Run migration** on staging\n5. **Update code** (3 week checklist)\n6. **Test thoroughly**\n7. **Run on production** when confident\n\n---\n\n**This is surgical cleanup, not demolition. Fix contradictions, keep capabilities.**\n",
              "description": "Creating actionable schema document that shows current reality and immediate cleanup needed"
            },
            "message": "Creating actionable schema document that shows current reality and immediate cleanup needed",
            "integration_name": null,
            "integration_icon_url": null,
            "context": null,
            "display_content": {
              "type": "json_block",
              "json_block": "{\"language\": \"markdown\", \"code\": \"# Database Schema: Current Reality\\n\\n**Last Updated:** November 6, 2025  \\n**Purpose:** What exists, what's contradictory, what to fix  \\n**Philosophy:** Fix contradictions, keep capabilities that serve values\\n\\n---\\n\\n## Current State Summary\\n\\n**Total tables:** ~30  \\n**Contradictions:** 5 major issues  \\n**Unused tables:** ~3-4 (need data check)  \\n**Overall verdict:** Mostly good, needs surgical cleanup\\n\\n---\\n\\n## The 5 Real Problems\\n\\n### 1. Double Kind Column \\u274c\\n\\n```sql\\n-- CURRENT (contradictory)\\ncollections.kind              -- TEXT enum\\ncollections.collection_kind   -- CUSTOM enum type (duplicate!)\\n\\n-- FIX\\nALTER TABLE collections DROP COLUMN collection_kind;\\n-- Keep TEXT with CHECK constraint\\n```\\n\\n**Impact:** Confusing, but doesn't break anything  \\n**Fix time:** 5 minutes  \\n**Risk:** Low\\n\\n---\\n\\n### 2. Triple Parent Path \\u274c\\n\\n```sql\\n-- CURRENT (three ways to parent!)\\npages.section_id     -- FK to sections (0 pages use this)\\npages.folder_id      -- FK to folders (all 11 pages use this)\\npages.collection_id  -- FK to collections (too direct!)\\n\\n-- FIX\\nALTER TABLE pages DROP COLUMN collection_id;\\n-- Navigate via: page \\u2192 folder \\u2192 collection\\n\\nALTER TABLE pages ADD CONSTRAINT page_parent_exclusive\\n  CHECK (\\n    (section_id IS NOT NULL AND folder_id IS NULL) OR\\n    (section_id IS NULL AND folder_id IS NOT NULL)\\n  );\\n```\\n\\n**Why:** \\n- Direct collection_id breaks folder abstraction\\n- Section vs folder should be either/or, not both\\n- Sections needed for daily page grouping + assignment metadata\\n\\n**Impact:** High - touches core navigation  \\n**Fix time:** 30 minutes  \\n**Risk:** Medium (update all queries)\\n\\n---\\n\\n### 3. Guide Pages vs Pages \\u274c\\n\\n```sql\\n-- CURRENT\\nguide_pages  -- 0 records, 18 code references\\npages        -- 11 records, 59 code references\\n\\n-- QUESTION: Are guide_pages templates and pages instances?\\n```\\n\\n**Decision needed:** Do we drop guide_pages entirely?\\n\\n**Option A: Drop it (simpler)**\\n```sql\\nDROP TABLE guide_pages CASCADE;\\nALTER TABLE pages ADD COLUMN page_type TEXT\\n  CHECK (page_type IN ('daily', 'template', 'response', 'custom'));\\n```\\n\\n**Option B: Keep as template source**\\n```sql\\nALTER TABLE pages ADD COLUMN source_guide_page_id uuid\\n  REFERENCES guide_pages(id);\\n-- guide_pages = template library\\n-- pages = instances from templates\\n```\\n\\n**Recommendation:** Option A unless you actively use guide_pages as templates\\n\\n**Impact:** Medium - 18 code references to update  \\n**Fix time:** 1-2 hours  \\n**Risk:** Medium (code changes)\\n\\n---\\n\\n### 4. Terminology Drift \\u274c\\n\\n```sql\\n-- LEGACY NAMES\\nnotebooks              -- deprecated, use collections\\nreleased_prompts       -- should be \\\"invitations\\\"\\nnotebookId in code     -- should be collectionId\\n\\n-- FIX\\nALTER TABLE released_prompts RENAME TO invitations;\\nALTER TABLE responses RENAME COLUMN released_id TO invitation_id;\\n\\n-- Code migration\\n// Find/replace: notebookId \\u2192 collectionId\\n// Update imports: released_prompts \\u2192 invitations\\n```\\n\\n**Why:** \\\"Invitation\\\" is clearer than \\\"released_prompts\\\"\\n\\n**Impact:** High - touches many files  \\n**Fix time:** 2-3 hours  \\n**Risk:** Low (mostly naming)\\n\\n---\\n\\n### 5. Mail Types Unclear \\u274c\\n\\n```sql\\n-- CURRENT (broken constraint!)\\nmail_items.type CHECK IN ('invitation', 'notification', 'share', 'gift')\\n-- But code creates 'letter' (not in constraint!) \\u274c\\n-- Mixing human mail with system alerts \\u274c\\n\\n-- FIX\\n-- Split system alerts from human correspondence\\nCREATE TABLE notifications (\\n  id uuid PRIMARY KEY,\\n  recipient_id uuid REFERENCES auth.users(id),\\n  notification_type TEXT CHECK (notification_type IN\\n    ('comment', 'due_date', 'release', 'mention', 'system')),\\n  subject_type TEXT CHECK (subject_type IN\\n    ('page', 'comment', 'invitation', 'response')),\\n  subject_id uuid NOT NULL,\\n  title TEXT NOT NULL,\\n  message TEXT,\\n  action_url TEXT,\\n  read_at timestamptz,\\n  created_at timestamptz DEFAULT now()\\n);\\n\\n-- Update mail_items constraint\\nALTER TABLE mail_items DROP CONSTRAINT mail_items_type_check;\\nALTER TABLE mail_items ADD CONSTRAINT mail_items_type_check\\n  CHECK (type IN ('invitation', 'letter', 'share', 'gift'));\\n```\\n\\n**Why:** System alerts \\u2260 human correspondence\\n\\n**Impact:** Medium - notification code must migrate  \\n**Fix time:** 2-3 hours  \\n**Risk:** Medium (split existing data)\\n\\n---\\n\\n## Tables We're Keeping (All ~30)\\n\\n### Core Content (5) \\u2705\\n```sql\\nprofiles              -- User accounts\\norganizations         -- Institutional accounts\\ncollections           -- Journals, guides, templates\\nfolders               -- Organization within collections\\npages                 -- Sacred human documents\\n```\\n\\n### Cohorts & Groups (5) \\u2705\\n```sql\\ngroups                -- Cohorts/classes\\ngroup_members         -- Enrollment\\ninvitations           -- Timed prompts (renamed from released_prompts)\\nresponses             -- Student submissions\\nanswers               -- Extracted assessment data\\n```\\n\\n### Communication (2) \\u2705\\n```sql\\nmail_items            -- Human correspondence (letters, shares, gifts)\\nnotifications         -- System alerts (NEW, split from mail_items)\\n```\\n\\n### Assessment (3) \\u2705\\n```sql\\nquestions             -- Reusable assessment registry\\nanswers               -- Responses with extraction + confidence\\npages.action          -- Conditional navigation (metadata column)\\n```\\n\\n### Analysis (3) \\u2705\\n```sql\\naggregations          -- Cohort insights\\nlenses                -- Analysis definitions\\nlens_results          -- Cached analysis with evidence\\n```\\n\\n### Tools (5) \\u2705\\n```sql\\ntool_plugins          -- Registered tools\\ntool_runs             -- Invocation log\\ntool_cards            -- Suggestion outputs\\nuser_tool_settings    -- Personal configs\\ngroup_tool_settings   -- Cohort configs\\n```\\n\\n### Views (2) \\u2705\\n```sql\\nviews                 -- Display configurations\\nsaved_views           -- User/group view presets\\n```\\n\\n### Verification (4) \\u2705\\n```sql\\npage_verifications              -- Proof-of-human badges\\nverification_access_requests    -- Share permissions\\nink_strokes                     -- Handwriting data\\npresentation_sessions           -- Walkthrough recordings\\n```\\n\\n### History (1) \\u2705\\n```sql\\npage_history          -- Audit trail\\n```\\n\\n**Total: 30 tables serving clear purposes**\\n\\n---\\n\\n## Tables to Check (Possibly Drop)\\n\\nRun these queries to see if they're actually used:\\n\\n```sql\\n-- Check which tables are empty/unused\\nSELECT\\n  'collection_usage_stats' as table_name,\\n  COUNT(*) as rows,\\n  CASE \\n    WHEN COUNT(*) = 0 THEN '\\u274c DROP'\\n    ELSE '\\u2705 KEEP'\\n  END as verdict\\nFROM collection_usage_stats\\n\\nUNION ALL SELECT 'collection_ratings', COUNT(*),\\n  CASE WHEN COUNT(*) = 0 THEN '\\u274c DROP' ELSE '\\u2705 KEEP' END\\nFROM collection_ratings\\n\\nUNION ALL SELECT 'personal_schedules', COUNT(*),\\n  CASE WHEN COUNT(*) = 0 THEN '\\u274c DROP' ELSE '\\u2705 KEEP' END\\nFROM personal_schedules\\n\\nUNION ALL SELECT 'snapshots', COUNT(*),\\n  CASE WHEN COUNT(*) = 0 THEN '\\u274c DROP' ELSE '\\u2705 KEEP' END\\nFROM snapshots\\n\\nUNION ALL SELECT 'writing_sessions', COUNT(*),\\n  CASE WHEN COUNT(*) = 0 THEN '\\u274c DROP' ELSE '\\u2705 KEEP' END\\nFROM writing_sessions;\\n```\\n\\n**If 0 rows:** Safe to drop  \\n**If >0 rows:** Keep and document purpose\\n\\n---\\n\\n## Migration Script (The Fixes)\\n\\n```sql\\n-- Migration: 20251106_schema_cleanup.sql\\n-- Purpose: Fix the 5 contradictions\\n\\nBEGIN;\\n\\n-- 1. Fix double kind column\\nALTER TABLE collections DROP COLUMN IF EXISTS collection_kind;\\nALTER TABLE collections ALTER COLUMN kind TYPE TEXT;\\nALTER TABLE collections ADD CONSTRAINT collections_kind_check \\n  CHECK (kind IN ('workspace', 'template', 'shared'));\\n\\n-- 2. Fix triple parent path\\nALTER TABLE pages DROP COLUMN IF EXISTS collection_id;\\nALTER TABLE pages ADD CONSTRAINT page_parent_exclusive\\n  CHECK (\\n    (section_id IS NOT NULL AND folder_id IS NULL) OR\\n    (section_id IS NULL AND folder_id IS NOT NULL)\\n  );\\n\\n-- 3. Clarify guide_pages (CHOOSE ONE)\\n\\n-- Option A: Drop guide_pages\\n-- DROP TABLE IF EXISTS guide_pages CASCADE;\\n-- ALTER TABLE pages ADD COLUMN page_type TEXT\\n--   CHECK (page_type IN ('daily', 'template', 'response', 'custom'));\\n\\n-- Option B: Keep as template source\\n-- ALTER TABLE pages ADD COLUMN source_guide_page_id uuid\\n--   REFERENCES guide_pages(id);\\n\\n-- 4. Rename for clarity\\nALTER TABLE released_prompts RENAME TO invitations;\\nALTER TABLE responses RENAME COLUMN released_id TO invitation_id;\\n\\n-- 5. Split mail from notifications\\nCREATE TABLE IF NOT EXISTS notifications (\\n  id uuid PRIMARY KEY DEFAULT uuid_generate_v4(),\\n  recipient_id uuid REFERENCES auth.users(id) ON DELETE CASCADE,\\n  notification_type TEXT NOT NULL CHECK (notification_type IN\\n    ('comment', 'due_date', 'release', 'mention', 'system')),\\n  subject_type TEXT NOT NULL CHECK (subject_type IN\\n    ('page', 'comment', 'invitation', 'response')),\\n  subject_id uuid NOT NULL,\\n  title TEXT NOT NULL,\\n  message TEXT,\\n  action_url TEXT,\\n  payload jsonb DEFAULT '{}',\\n  read_at timestamptz,\\n  created_at timestamptz DEFAULT now()\\n);\\n\\n-- Migrate notification-type mail_items\\nINSERT INTO notifications (recipient_id, notification_type, subject_type, subject_id, title, message, created_at)\\nSELECT \\n  recipient_id,\\n  'system' as notification_type,\\n  'page' as subject_type,  -- adjust based on your data\\n  id as subject_id,\\n  subject as title,\\n  body as message,\\n  created_at\\nFROM mail_items\\nWHERE type = 'notification';\\n\\n-- Remove migrated rows\\nDELETE FROM mail_items WHERE type = 'notification';\\n\\n-- Fix mail_items constraint\\nALTER TABLE mail_items DROP CONSTRAINT IF EXISTS mail_items_type_check;\\nALTER TABLE mail_items ADD CONSTRAINT mail_items_type_check\\n  CHECK (type IN ('invitation', 'letter', 'share', 'gift'));\\n\\nCOMMIT;\\n```\\n\\n---\\n\\n## Code Migration Checklist\\n\\nAfter running migration, update code:\\n\\n### Week 1: Terminology\\n- [ ] Find/replace `notebookId` \\u2192 `collectionId`\\n- [ ] Find/replace `released_prompts` \\u2192 `invitations`\\n- [ ] Find/replace `released_id` \\u2192 `invitation_id`\\n- [ ] Update imports: `from 'released_prompts'` \\u2192 `from 'invitations'`\\n\\n### Week 2: Schema Changes\\n- [ ] Remove `pages.collection_id` from queries\\n- [ ] Update navigation: `page \\u2192 folder \\u2192 collection`\\n- [ ] Update notification code to use new `notifications` table\\n- [ ] Test mail sending (ensure letters/shares still work)\\n\\n### Week 3: Decision on guide_pages\\n- [ ] Decide: Drop or keep as templates?\\n- [ ] If drop: Update 18 code references to use `pages.page_type`\\n- [ ] If keep: Add `source_guide_page_id` to page creation logic\\n\\n---\\n\\n## Testing After Migration\\n\\n```sql\\n-- 1. Verify no duplicate kind columns\\nSELECT column_name \\nFROM information_schema.columns \\nWHERE table_name = 'collections' AND column_name LIKE '%kind%';\\n-- Should return only: \\\"kind\\\"\\n\\n-- 2. Verify page navigation works\\nSELECT p.id, f.name as folder, c.title as collection\\nFROM pages p\\nJOIN folders f ON p.folder_id = f.id\\nJOIN collections c ON f.collection_id = c.id\\nLIMIT 5;\\n-- Should work without pages.collection_id\\n\\n-- 3. Verify mail vs notifications split\\nSELECT type, COUNT(*) \\nFROM mail_items \\nGROUP BY type;\\n-- Should only show: invitation, letter, share, gift\\n\\nSELECT notification_type, COUNT(*) \\nFROM notifications \\nGROUP BY notification_type;\\n-- Should show: comment, due_date, release, mention, system\\n\\n-- 4. Verify renamed tables\\nSELECT COUNT(*) FROM invitations;\\n-- Should work (formerly released_prompts)\\n```\\n\\n---\\n\\n## Success Criteria\\n\\n\\u2705 All contradictions resolved (5 problems fixed)  \\n\\u2705 All value-serving capabilities preserved  \\n\\u2705 Zero data loss  \\n\\u2705 Tests pass  \\n\\u2705 Code updated to match schema\\n\\n---\\n\\n## What This Is NOT\\n\\n### \\u274c Minimization Exercise\\nWe're keeping all ~30 tables that serve our values.\\n\\n### \\u274c Protocol Definition\\nThis is our database schema, not an interchange format.\\n\\n### \\u274c Premature Optimization\\nWe're fixing contradictions, not redesigning from scratch.\\n\\n---\\n\\n## Protocol vs Database (Important Distinction)\\n\\n**Database (this doc):** Our implementation with ~30 tables  \\n**Protocol (export format):** What users get when they export\\n\\nWhen someone exports their work:\\n```\\nmy-work.cursive/  (ZIP)\\n\\u251c\\u2500 manifest.json\\n\\u251c\\u2500 pages/\\n\\u251c\\u2500 sessions/\\n\\u2514\\u2500 fingerprints/\\n```\\n\\n**That's the protocol.** The database is just how we store it internally.\\n\\n---\\n\\n## Next Steps\\n\\n1. **Review this plan** with team\\n2. **Run check queries** to see what's empty\\n3. **Decide on guide_pages**: Drop or keep?\\n4. **Run migration** on staging\\n5. **Update code** (3 week checklist)\\n6. **Test thoroughly**\\n7. **Run on production** when confident\\n\\n---\\n\\n**This is surgical cleanup, not demolition. Fix contradictions, keep capabilities.**\\n\", \"filename\": \"/mnt/user-data/outputs/DATABASE_REALITY.md\"}"
            },
            "approval_options": null,
            "approval_key": null
          },
          {
            "start_timestamp": null,
            "stop_timestamp": null,
            "flags": null,
            "type": "tool_result",
            "name": "create_file",
            "content": [
              {
                "type": "text",
                "text": "File created successfully: /mnt/user-data/outputs/DATABASE_REALITY.md",
                "uuid": "54f05ea9-72c3-4cf2-b843-8949df31a395"
              }
            ],
            "is_error": false,
            "message": null,
            "integration_name": null,
            "integration_icon_url": null,
            "display_content": {
              "type": "text",
              "text": "File created successfully: /mnt/user-data/outputs/DATABASE_REALITY.md"
            }
          },
          {
            "start_timestamp": null,
            "stop_timestamp": null,
            "flags": null,
            "type": "token_budget"
          },
          {
            "start_timestamp": "2025-11-06T12:01:54.956648Z",
            "stop_timestamp": "2025-11-06T12:01:55.908300Z",
            "flags": null,
            "type": "thinking",
            "thinking": "Good. Now I need to create one final document that's a simple README/implementation guide that ties everything together. This should be the \"start here\" document.",
            "summaries": [
              {
                "summary": "Orchestrated foundational documentation framework as unified starting point."
              }
            ],
            "cut_off": false
          },
          {
            "start_timestamp": "2025-11-06T12:01:56.247301Z",
            "stop_timestamp": "2025-11-06T12:02:58.890816Z",
            "flags": null,
            "type": "tool_use",
            "name": "create_file",
            "input": {
              "path": "/mnt/user-data/outputs/START_HERE.md",
              "file_text": "# Implementation Guide: Start Here\n\n**Last Updated:** November 6, 2025  \n**For:** Developers implementing the Cursive platform  \n**Status:** Active development\n\n---\n\n## Read These 4 Docs (In Order)\n\n1. **[VALUES.md](VALUES.md)** - Why we exist (15 min read)\n2. **[CORE_PRIMITIVES.md](CORE_PRIMITIVES.md)** - What exists + what we're building (20 min)\n3. **[SHARE_AND_VERIFY.md](SHARE_AND_VERIFY.md)** - Current priority MVP (30 min)\n4. **[DATABASE_REALITY.md](DATABASE_REALITY.md)** - Schema cleanup needed (20 min)\n\n**Total time:** 90 minutes to understand the full system\n\n---\n\n## Quick Context\n\n### What is Cursive?\n\nA platform for human-authored work with proof-of-humanity.\n\n**For students:** Write essays, solve problems, create art - with proof it's yours  \n**For teachers:** Assign work, verify authenticity, see creation process  \n**For everyone:** Own your work, export everything, keep your humanity\n\n### Core Principles (From VALUES.md)\n\n1. **Pages are sacred** - Only humans write content\n2. **Process is proof** - Background recording generates unfakeable fingerprints\n3. **Humans guide** - Hosts schedule invitations, software reminds but doesn't replace\n4. **Everything exports** - You own your work, take it anywhere\n5. **Craft over convenience** - Deliberate, calm, embodied experiences\n\n---\n\n## Current Architecture\n\n### Tech Stack\n```\nFrontend:  Next.js + React + TipTap (rich text)\nBackend:   Supabase (Postgres + Auth + Realtime)\nDrawing:   Konva.js (canvas + ink strokes)\nHosting:   Vercel (app) + Supabase (db)\n```\n\n### Key Tables (Simplified)\n```sql\n-- Content\ncollections  -- Top-level containers (journals, guides)\nfolders      -- Organization within collections\npages        -- Sacred human documents\n\n-- Cohorts\ngroups          -- Classes/cohorts\ninvitations     -- Timed prompts (formerly released_prompts)\nresponses       -- Student submissions\n\n-- Verification\npresentation_sessions    -- Background recording\npage_verifications      -- Proof-of-human badges\nink_strokes             -- Handwriting data\n\n-- Communication\nmail_items       -- Human correspondence\nnotifications    -- System alerts (NEW)\n```\n\n---\n\n## What We're Building Right Now\n\n### Milestone: Share + Verify (3-4 weeks)\n\n**Week 1:** Share pages publicly with `/p/{pageId}` URLs  \n**Week 2:** Calculate fingerprints, show verification badges  \n**Week 3:** Access requests (teachers ask to see creation process)  \n**Week 4:** Walkthrough viewer (replay session recordings)\n\n**See [SHARE_AND_VERIFY.md](SHARE_AND_VERIFY.md) for full spec**\n\n---\n\n## Setup Guide\n\n### 1. Clone & Install\n```bash\ngit clone <repo>\ncd reference-app\nnpm install\n```\n\n### 2. Environment Variables\n```bash\n# .env.local\nNEXT_PUBLIC_SUPABASE_URL=<your-project-url>\nNEXT_PUBLIC_SUPABASE_ANON_KEY=<your-anon-key>\nSUPABASE_SERVICE_ROLE_KEY=<your-service-key>\n```\n\n### 3. Database Setup\n```bash\n# Run migrations\nnpm run db:migrate\n\n# Or manually in Supabase SQL editor:\n# Copy from DATABASE_REALITY.md → \"Migration Script\"\n```\n\n### 4. Run Development Server\n```bash\nnpm run dev\n# Open http://localhost:3000\n```\n\n---\n\n## File Structure\n\n```\nreference-app/\n├─ src/\n│  ├─ app/                    # Next.js app router\n│  │  ├─ p/[pageId]/         # Public pages\n│  │  ├─ w/                  # Walkthroughs\n│  │  └─ api/                # API routes\n│  │\n│  ├─ components/\n│  │  ├─ editor/             # TipTap editor\n│  │  ├─ canvas/             # Konva drawing\n│  │  └─ ui/                 # Shared components\n│  │\n│  ├─ lib/\n│  │  ├─ supabase.ts         # Database client\n│  │  ├─ fingerprint.ts      # Proof-of-human algorithm\n│  │  └─ session-recorder.ts # Background recording\n│  │\n│  └─ types/\n│     └─ supabase.ts         # Generated types\n│\n├─ supabase/\n│  ├─ migrations/            # Database migrations\n│  └─ seed.sql              # Test data\n│\n└─ docs/                     # YOU ARE HERE\n   ├─ VALUES.md\n   ├─ CORE_PRIMITIVES.md\n   ├─ SHARE_AND_VERIFY.md\n   └─ DATABASE_REALITY.md\n```\n\n---\n\n## Key Files to Know\n\n### Core Logic\n\n**`src/lib/fingerprint.ts`** - Proof-of-human algorithm\n```typescript\n// Calculates confidence score (0-100) from session events\nexport async function calculateFingerprint(pageId: string)\n\n// Human patterns: 200-800ms stroke variance, 5s+ pauses, 5-20% corrections\n// AI patterns: <50ms variance, no pauses, <1% corrections\n```\n\n**`src/lib/session-recorder.ts`** - Background recording\n```typescript\n// Starts automatically when page opens\nexport function startBackgroundSession(pageId: string)\n\n// Records: typing, drawing, scroll, idle gaps\n// Stops on blur/close\n```\n\n### Components\n\n**`src/components/editor/PageEditor.tsx`** - Main editor\n- TipTap for text\n- Konva canvas for drawing\n- Background session always recording\n\n**`src/components/share/SharePageDialog.tsx`** - Share dialog (Week 1)\n- Set visibility (private/unlisted/public)\n- Copy `/p/{pageId}` link\n- Toggle badge visibility\n\n**`src/components/verify/VerificationBadge.tsx`** - Badge (Week 2)\n- Shows \"✓ Human-made\" if confidence >= 70\n- Click opens details modal\n\n### API Routes\n\n**`src/app/api/pages/[id]/public/route.ts`** - Public page endpoint\n```typescript\nGET /api/pages/:id/public\n// Returns page if visibility allows\n// Includes verification if exists\n```\n\n**`src/app/api/verification/calculate/[pageId]/route.ts`** - Fingerprint calc\n```typescript\nPOST /api/verification/calculate/:pageId\n// Gets all sessions for page\n// Calculates metrics\n// Stores in page_verifications table\n```\n\n---\n\n## Development Workflow\n\n### 1. Feature Branches\n```bash\ngit checkout -b feature/share-page-dialog\n# Work on feature\ngit push origin feature/share-page-dialog\n# Open PR\n```\n\n### 2. Database Changes\n```bash\n# Create migration\nnpm run db:migration create_page_verifications\n\n# Edit: supabase/migrations/<timestamp>_create_page_verifications.sql\n\n# Run migration\nnpm run db:migrate\n\n# Regenerate types\nnpm run db:types\n```\n\n### 3. Testing\n```bash\n# Run tests\nnpm test\n\n# Run type checks\nnpm run type-check\n\n# Run linter\nnpm run lint\n```\n\n---\n\n## Common Tasks\n\n### Add a New Page Type\n```sql\n-- 1. Update enum in database\nALTER TABLE pages ADD CONSTRAINT page_type_check\n  CHECK (page_type IN ('daily', 'template', 'response', 'custom', 'NEW_TYPE'));\n\n-- 2. Regenerate types\nnpm run db:types\n\n-- 3. Update UI\n// src/components/pages/PageTypeSelector.tsx\n```\n\n### Add a New API Endpoint\n```typescript\n// src/app/api/your-endpoint/route.ts\nimport { createClient } from '@/lib/supabase/server';\n\nexport async function GET(request: Request) {\n  const supabase = createClient();\n  \n  // Your logic here\n  \n  return Response.json({ data });\n}\n```\n\n### Add a New Component\n```typescript\n// src/components/your-feature/YourComponent.tsx\nimport React from 'react';\n\nexport function YourComponent({ prop }: Props) {\n  return (\n    <div>\n      {/* Your UI */}\n    </div>\n  );\n}\n```\n\n---\n\n## Debugging Tips\n\n### Database Queries\n```typescript\n// In any API route or server component\nimport { createClient } from '@/lib/supabase/server';\n\nconst supabase = createClient();\n\n// Enable query logging\nconst { data, error } = await supabase\n  .from('pages')\n  .select('*')\n  .eq('id', pageId)\n  .single();\n\nconsole.log({ data, error });\n```\n\n### Session Recording\n```typescript\n// Check if recording is active\nconst session = sessionRecorder.getCurrentSession();\nconsole.log('Active session:', session);\n\n// View recorded events\nconst events = session?.events || [];\nconsole.log('Events recorded:', events.length);\n```\n\n### Fingerprint Calculation\n```typescript\n// Test fingerprint on a page\nconst result = await calculateFingerprint(pageId);\nconsole.log('Confidence:', result.confidence_score);\nconsole.log('Metrics:', result.metrics);\n```\n\n---\n\n## Git Workflow\n\n### Commit Messages\n```bash\n# Format: <type>: <description>\n\nfeat: add share page dialog\nfix: fingerprint calculation for empty sessions\ndocs: update implementation guide\ntest: add verification badge tests\nchore: update dependencies\n```\n\n### Branch Naming\n```bash\nfeature/share-page-dialog\nfix/fingerprint-edge-case\ndocs/update-readme\n```\n\n---\n\n## Deployment\n\n### Staging\n```bash\n# Automatic on push to `staging` branch\ngit push origin staging\n\n# Preview: https://staging.cursive.com\n```\n\n### Production\n```bash\n# Automatic on push to `main` branch\ngit push origin main\n\n# Live: https://cursive.com\n```\n\n### Database Migrations\n```bash\n# Always run on staging first\nnpm run db:migrate -- --environment staging\n\n# Verify it works\n# Then run on production\nnpm run db:migrate -- --environment production\n```\n\n---\n\n## Getting Help\n\n### Documentation\n1. Check [CORE_PRIMITIVES.md](CORE_PRIMITIVES.md) for data model\n2. Check [SHARE_AND_VERIFY.md](SHARE_AND_VERIFY.md) for current feature\n3. Check [DATABASE_REALITY.md](DATABASE_REALITY.md) for schema questions\n\n### Code Examples\n- Look at existing components in `src/components/`\n- Check existing API routes in `src/app/api/`\n- Read tests in `__tests__/`\n\n### Team\n- Ask in Slack #cursive-dev\n- Tag reviewers on GitHub PRs\n- Schedule pair programming sessions\n\n---\n\n## Testing Checklist (Before PR)\n\n- [ ] Code compiles (`npm run build`)\n- [ ] Types check (`npm run type-check`)\n- [ ] Tests pass (`npm test`)\n- [ ] Linter passes (`npm run lint`)\n- [ ] Manual testing on localhost\n- [ ] Database migration tested (if applicable)\n- [ ] Documentation updated (if applicable)\n\n---\n\n## Current Priorities (November 2025)\n\n### In Progress\n- [ ] Share page dialog (Week 1)\n- [ ] Public page route (Week 1)\n- [ ] Fingerprint calculation (Week 2)\n- [ ] Verification badge (Week 2)\n\n### Next Up\n- [ ] Access requests (Week 3)\n- [ ] Walkthrough viewer (Week 4)\n\n### Blocked\n- Nothing blocked right now\n\n---\n\n## Important Constraints\n\n### Never Violate These Rules\n\n1. **No AI writes to pages.content** - Only humans or user-ratified suggestions\n2. **No auto-sharing** - Everything defaults to private, user must explicitly share\n3. **No faking fingerprints** - Algorithm must detect human patterns, not just check for sessions\n4. **No hiding process** - Users can always see their own session recordings\n5. **No vendor lock-in** - Everything must be exportable\n\n### Performance Budgets\n\n- Page load: < 2s on 3G\n- Editor input lag: < 50ms\n- Session recording overhead: < 5% CPU\n- Database query time: < 100ms\n\n---\n\n## Quick Wins (Easy Contributions)\n\nGood first issues:\n\n1. **Add loading states** - Many components lack spinners\n2. **Improve error messages** - Make them more helpful\n3. **Add keyboard shortcuts** - Editor needs more shortcuts\n4. **Polish UI details** - Spacing, colors, hover states\n5. **Write tests** - Coverage is low, add tests for core functions\n\n---\n\n## Questions to Ask Before Building\n\n1. **Does this honor human agency?** (From VALUES.md)\n2. **Can it be exported?** (Sovereignty)\n3. **Does it preserve provenance?** (Transparency)\n4. **Is it the simplest solution?** (Avoid over-engineering)\n5. **Does it serve our users' hearts?** (Qualitative perception)\n\nIf answer is \"no\" to any, redesign or don't build.\n\n---\n\n## Success Looks Like\n\n- Students can share work with proof of authorship\n- Teachers can verify authenticity without hassle\n- Platform feels calm, deliberate, craft-focused\n- Everyone owns their data completely\n- AI assists, never replaces human effort\n\n---\n\n**Welcome to Cursive. Build with intention. Ship with pride. Serve human hearts.**\n",
              "description": "Creating the start-here implementation guide that ties everything together"
            },
            "message": "Creating the start-here implementation guide that ties everything together",
            "integration_name": null,
            "integration_icon_url": null,
            "context": null,
            "display_content": {
              "type": "json_block",
              "json_block": "{\"language\": \"markdown\", \"code\": \"# Implementation Guide: Start Here\\n\\n**Last Updated:** November 6, 2025  \\n**For:** Developers implementing the Cursive platform  \\n**Status:** Active development\\n\\n---\\n\\n## Read These 4 Docs (In Order)\\n\\n1. **[VALUES.md](VALUES.md)** - Why we exist (15 min read)\\n2. **[CORE_PRIMITIVES.md](CORE_PRIMITIVES.md)** - What exists + what we're building (20 min)\\n3. **[SHARE_AND_VERIFY.md](SHARE_AND_VERIFY.md)** - Current priority MVP (30 min)\\n4. **[DATABASE_REALITY.md](DATABASE_REALITY.md)** - Schema cleanup needed (20 min)\\n\\n**Total time:** 90 minutes to understand the full system\\n\\n---\\n\\n## Quick Context\\n\\n### What is Cursive?\\n\\nA platform for human-authored work with proof-of-humanity.\\n\\n**For students:** Write essays, solve problems, create art - with proof it's yours  \\n**For teachers:** Assign work, verify authenticity, see creation process  \\n**For everyone:** Own your work, export everything, keep your humanity\\n\\n### Core Principles (From VALUES.md)\\n\\n1. **Pages are sacred** - Only humans write content\\n2. **Process is proof** - Background recording generates unfakeable fingerprints\\n3. **Humans guide** - Hosts schedule invitations, software reminds but doesn't replace\\n4. **Everything exports** - You own your work, take it anywhere\\n5. **Craft over convenience** - Deliberate, calm, embodied experiences\\n\\n---\\n\\n## Current Architecture\\n\\n### Tech Stack\\n```\\nFrontend:  Next.js + React + TipTap (rich text)\\nBackend:   Supabase (Postgres + Auth + Realtime)\\nDrawing:   Konva.js (canvas + ink strokes)\\nHosting:   Vercel (app) + Supabase (db)\\n```\\n\\n### Key Tables (Simplified)\\n```sql\\n-- Content\\ncollections  -- Top-level containers (journals, guides)\\nfolders      -- Organization within collections\\npages        -- Sacred human documents\\n\\n-- Cohorts\\ngroups          -- Classes/cohorts\\ninvitations     -- Timed prompts (formerly released_prompts)\\nresponses       -- Student submissions\\n\\n-- Verification\\npresentation_sessions    -- Background recording\\npage_verifications      -- Proof-of-human badges\\nink_strokes             -- Handwriting data\\n\\n-- Communication\\nmail_items       -- Human correspondence\\nnotifications    -- System alerts (NEW)\\n```\\n\\n---\\n\\n## What We're Building Right Now\\n\\n### Milestone: Share + Verify (3-4 weeks)\\n\\n**Week 1:** Share pages publicly with `/p/{pageId}` URLs  \\n**Week 2:** Calculate fingerprints, show verification badges  \\n**Week 3:** Access requests (teachers ask to see creation process)  \\n**Week 4:** Walkthrough viewer (replay session recordings)\\n\\n**See [SHARE_AND_VERIFY.md](SHARE_AND_VERIFY.md) for full spec**\\n\\n---\\n\\n## Setup Guide\\n\\n### 1. Clone & Install\\n```bash\\ngit clone <repo>\\ncd reference-app\\nnpm install\\n```\\n\\n### 2. Environment Variables\\n```bash\\n# .env.local\\nNEXT_PUBLIC_SUPABASE_URL=<your-project-url>\\nNEXT_PUBLIC_SUPABASE_ANON_KEY=<your-anon-key>\\nSUPABASE_SERVICE_ROLE_KEY=<your-service-key>\\n```\\n\\n### 3. Database Setup\\n```bash\\n# Run migrations\\nnpm run db:migrate\\n\\n# Or manually in Supabase SQL editor:\\n# Copy from DATABASE_REALITY.md \\u2192 \\\"Migration Script\\\"\\n```\\n\\n### 4. Run Development Server\\n```bash\\nnpm run dev\\n# Open http://localhost:3000\\n```\\n\\n---\\n\\n## File Structure\\n\\n```\\nreference-app/\\n\\u251c\\u2500 src/\\n\\u2502  \\u251c\\u2500 app/                    # Next.js app router\\n\\u2502  \\u2502  \\u251c\\u2500 p/[pageId]/         # Public pages\\n\\u2502  \\u2502  \\u251c\\u2500 w/                  # Walkthroughs\\n\\u2502  \\u2502  \\u2514\\u2500 api/                # API routes\\n\\u2502  \\u2502\\n\\u2502  \\u251c\\u2500 components/\\n\\u2502  \\u2502  \\u251c\\u2500 editor/             # TipTap editor\\n\\u2502  \\u2502  \\u251c\\u2500 canvas/             # Konva drawing\\n\\u2502  \\u2502  \\u2514\\u2500 ui/                 # Shared components\\n\\u2502  \\u2502\\n\\u2502  \\u251c\\u2500 lib/\\n\\u2502  \\u2502  \\u251c\\u2500 supabase.ts         # Database client\\n\\u2502  \\u2502  \\u251c\\u2500 fingerprint.ts      # Proof-of-human algorithm\\n\\u2502  \\u2502  \\u2514\\u2500 session-recorder.ts # Background recording\\n\\u2502  \\u2502\\n\\u2502  \\u2514\\u2500 types/\\n\\u2502     \\u2514\\u2500 supabase.ts         # Generated types\\n\\u2502\\n\\u251c\\u2500 supabase/\\n\\u2502  \\u251c\\u2500 migrations/            # Database migrations\\n\\u2502  \\u2514\\u2500 seed.sql              # Test data\\n\\u2502\\n\\u2514\\u2500 docs/                     # YOU ARE HERE\\n   \\u251c\\u2500 VALUES.md\\n   \\u251c\\u2500 CORE_PRIMITIVES.md\\n   \\u251c\\u2500 SHARE_AND_VERIFY.md\\n   \\u2514\\u2500 DATABASE_REALITY.md\\n```\\n\\n---\\n\\n## Key Files to Know\\n\\n### Core Logic\\n\\n**`src/lib/fingerprint.ts`** - Proof-of-human algorithm\\n```typescript\\n// Calculates confidence score (0-100) from session events\\nexport async function calculateFingerprint(pageId: string)\\n\\n// Human patterns: 200-800ms stroke variance, 5s+ pauses, 5-20% corrections\\n// AI patterns: <50ms variance, no pauses, <1% corrections\\n```\\n\\n**`src/lib/session-recorder.ts`** - Background recording\\n```typescript\\n// Starts automatically when page opens\\nexport function startBackgroundSession(pageId: string)\\n\\n// Records: typing, drawing, scroll, idle gaps\\n// Stops on blur/close\\n```\\n\\n### Components\\n\\n**`src/components/editor/PageEditor.tsx`** - Main editor\\n- TipTap for text\\n- Konva canvas for drawing\\n- Background session always recording\\n\\n**`src/components/share/SharePageDialog.tsx`** - Share dialog (Week 1)\\n- Set visibility (private/unlisted/public)\\n- Copy `/p/{pageId}` link\\n- Toggle badge visibility\\n\\n**`src/components/verify/VerificationBadge.tsx`** - Badge (Week 2)\\n- Shows \\\"\\u2713 Human-made\\\" if confidence >= 70\\n- Click opens details modal\\n\\n### API Routes\\n\\n**`src/app/api/pages/[id]/public/route.ts`** - Public page endpoint\\n```typescript\\nGET /api/pages/:id/public\\n// Returns page if visibility allows\\n// Includes verification if exists\\n```\\n\\n**`src/app/api/verification/calculate/[pageId]/route.ts`** - Fingerprint calc\\n```typescript\\nPOST /api/verification/calculate/:pageId\\n// Gets all sessions for page\\n// Calculates metrics\\n// Stores in page_verifications table\\n```\\n\\n---\\n\\n## Development Workflow\\n\\n### 1. Feature Branches\\n```bash\\ngit checkout -b feature/share-page-dialog\\n# Work on feature\\ngit push origin feature/share-page-dialog\\n# Open PR\\n```\\n\\n### 2. Database Changes\\n```bash\\n# Create migration\\nnpm run db:migration create_page_verifications\\n\\n# Edit: supabase/migrations/<timestamp>_create_page_verifications.sql\\n\\n# Run migration\\nnpm run db:migrate\\n\\n# Regenerate types\\nnpm run db:types\\n```\\n\\n### 3. Testing\\n```bash\\n# Run tests\\nnpm test\\n\\n# Run type checks\\nnpm run type-check\\n\\n# Run linter\\nnpm run lint\\n```\\n\\n---\\n\\n## Common Tasks\\n\\n### Add a New Page Type\\n```sql\\n-- 1. Update enum in database\\nALTER TABLE pages ADD CONSTRAINT page_type_check\\n  CHECK (page_type IN ('daily', 'template', 'response', 'custom', 'NEW_TYPE'));\\n\\n-- 2. Regenerate types\\nnpm run db:types\\n\\n-- 3. Update UI\\n// src/components/pages/PageTypeSelector.tsx\\n```\\n\\n### Add a New API Endpoint\\n```typescript\\n// src/app/api/your-endpoint/route.ts\\nimport { createClient } from '@/lib/supabase/server';\\n\\nexport async function GET(request: Request) {\\n  const supabase = createClient();\\n  \\n  // Your logic here\\n  \\n  return Response.json({ data });\\n}\\n```\\n\\n### Add a New Component\\n```typescript\\n// src/components/your-feature/YourComponent.tsx\\nimport React from 'react';\\n\\nexport function YourComponent({ prop }: Props) {\\n  return (\\n    <div>\\n      {/* Your UI */}\\n    </div>\\n  );\\n}\\n```\\n\\n---\\n\\n## Debugging Tips\\n\\n### Database Queries\\n```typescript\\n// In any API route or server component\\nimport { createClient } from '@/lib/supabase/server';\\n\\nconst supabase = createClient();\\n\\n// Enable query logging\\nconst { data, error } = await supabase\\n  .from('pages')\\n  .select('*')\\n  .eq('id', pageId)\\n  .single();\\n\\nconsole.log({ data, error });\\n```\\n\\n### Session Recording\\n```typescript\\n// Check if recording is active\\nconst session = sessionRecorder.getCurrentSession();\\nconsole.log('Active session:', session);\\n\\n// View recorded events\\nconst events = session?.events || [];\\nconsole.log('Events recorded:', events.length);\\n```\\n\\n### Fingerprint Calculation\\n```typescript\\n// Test fingerprint on a page\\nconst result = await calculateFingerprint(pageId);\\nconsole.log('Confidence:', result.confidence_score);\\nconsole.log('Metrics:', result.metrics);\\n```\\n\\n---\\n\\n## Git Workflow\\n\\n### Commit Messages\\n```bash\\n# Format: <type>: <description>\\n\\nfeat: add share page dialog\\nfix: fingerprint calculation for empty sessions\\ndocs: update implementation guide\\ntest: add verification badge tests\\nchore: update dependencies\\n```\\n\\n### Branch Naming\\n```bash\\nfeature/share-page-dialog\\nfix/fingerprint-edge-case\\ndocs/update-readme\\n```\\n\\n---\\n\\n## Deployment\\n\\n### Staging\\n```bash\\n# Automatic on push to `staging` branch\\ngit push origin staging\\n\\n# Preview: https://staging.cursive.com\\n```\\n\\n### Production\\n```bash\\n# Automatic on push to `main` branch\\ngit push origin main\\n\\n# Live: https://cursive.com\\n```\\n\\n### Database Migrations\\n```bash\\n# Always run on staging first\\nnpm run db:migrate -- --environment staging\\n\\n# Verify it works\\n# Then run on production\\nnpm run db:migrate -- --environment production\\n```\\n\\n---\\n\\n## Getting Help\\n\\n### Documentation\\n1. Check [CORE_PRIMITIVES.md](CORE_PRIMITIVES.md) for data model\\n2. Check [SHARE_AND_VERIFY.md](SHARE_AND_VERIFY.md) for current feature\\n3. Check [DATABASE_REALITY.md](DATABASE_REALITY.md) for schema questions\\n\\n### Code Examples\\n- Look at existing components in `src/components/`\\n- Check existing API routes in `src/app/api/`\\n- Read tests in `__tests__/`\\n\\n### Team\\n- Ask in Slack #cursive-dev\\n- Tag reviewers on GitHub PRs\\n- Schedule pair programming sessions\\n\\n---\\n\\n## Testing Checklist (Before PR)\\n\\n- [ ] Code compiles (`npm run build`)\\n- [ ] Types check (`npm run type-check`)\\n- [ ] Tests pass (`npm test`)\\n- [ ] Linter passes (`npm run lint`)\\n- [ ] Manual testing on localhost\\n- [ ] Database migration tested (if applicable)\\n- [ ] Documentation updated (if applicable)\\n\\n---\\n\\n## Current Priorities (November 2025)\\n\\n### In Progress\\n- [ ] Share page dialog (Week 1)\\n- [ ] Public page route (Week 1)\\n- [ ] Fingerprint calculation (Week 2)\\n- [ ] Verification badge (Week 2)\\n\\n### Next Up\\n- [ ] Access requests (Week 3)\\n- [ ] Walkthrough viewer (Week 4)\\n\\n### Blocked\\n- Nothing blocked right now\\n\\n---\\n\\n## Important Constraints\\n\\n### Never Violate These Rules\\n\\n1. **No AI writes to pages.content** - Only humans or user-ratified suggestions\\n2. **No auto-sharing** - Everything defaults to private, user must explicitly share\\n3. **No faking fingerprints** - Algorithm must detect human patterns, not just check for sessions\\n4. **No hiding process** - Users can always see their own session recordings\\n5. **No vendor lock-in** - Everything must be exportable\\n\\n### Performance Budgets\\n\\n- Page load: < 2s on 3G\\n- Editor input lag: < 50ms\\n- Session recording overhead: < 5% CPU\\n- Database query time: < 100ms\\n\\n---\\n\\n## Quick Wins (Easy Contributions)\\n\\nGood first issues:\\n\\n1. **Add loading states** - Many components lack spinners\\n2. **Improve error messages** - Make them more helpful\\n3. **Add keyboard shortcuts** - Editor needs more shortcuts\\n4. **Polish UI details** - Spacing, colors, hover states\\n5. **Write tests** - Coverage is low, add tests for core functions\\n\\n---\\n\\n## Questions to Ask Before Building\\n\\n1. **Does this honor human agency?** (From VALUES.md)\\n2. **Can it be exported?** (Sovereignty)\\n3. **Does it preserve provenance?** (Transparency)\\n4. **Is it the simplest solution?** (Avoid over-engineering)\\n5. **Does it serve our users' hearts?** (Qualitative perception)\\n\\nIf answer is \\\"no\\\" to any, redesign or don't build.\\n\\n---\\n\\n## Success Looks Like\\n\\n- Students can share work with proof of authorship\\n- Teachers can verify authenticity without hassle\\n- Platform feels calm, deliberate, craft-focused\\n- Everyone owns their data completely\\n- AI assists, never replaces human effort\\n\\n---\\n\\n**Welcome to Cursive. Build with intention. Ship with pride. Serve human hearts.**\\n\", \"filename\": \"/mnt/user-data/outputs/START_HERE.md\"}"
            },
            "approval_options": null,
            "approval_key": null
          },
          {
            "start_timestamp": null,
            "stop_timestamp": null,
            "flags": null,
            "type": "tool_result",
            "name": "create_file",
            "content": [
              {
                "type": "text",
                "text": "File created successfully: /mnt/user-data/outputs/START_HERE.md",
                "uuid": "3e528e79-c707-484d-ab8f-16ecc84bc771"
              }
            ],
            "is_error": false,
            "message": null,
            "integration_name": null,
            "integration_icon_url": null,
            "display_content": {
              "type": "text",
              "text": "File created successfully: /mnt/user-data/outputs/START_HERE.md"
            }
          },
          {
            "start_timestamp": null,
            "stop_timestamp": null,
            "flags": null,
            "type": "token_budget"
          },
          {
            "start_timestamp": "2025-11-06T12:03:03.057624Z",
            "stop_timestamp": "2025-11-06T12:03:04.095367Z",
            "flags": null,
            "type": "thinking",
            "thinking": "Perfect. Now let me create a final summary document that explains what I kept, what I removed, and why - to help them understand the cleanup rationale.",
            "summaries": [
              {
                "summary": "Synthesized cleanup rationale into comprehensive documentation summary."
              }
            ],
            "cut_off": false
          },
          {
            "start_timestamp": "2025-11-06T12:03:04.498488Z",
            "stop_timestamp": "2025-11-06T12:04:10.189618Z",
            "flags": null,
            "type": "tool_use",
            "name": "create_file",
            "input": {
              "path": "/mnt/user-data/outputs/CLEANUP_SUMMARY.md",
              "file_text": "# Documentation Cleanup: What Changed and Why\n\n**Date:** November 6, 2025  \n**Purpose:** Explain the documentation overhaul\n\n---\n\n## The Problem\n\nYou had **15+ documents** with:\n- Brilliant philosophical thinking (VALUES.md)\n- Premature protocol abstraction (CP-1.0-CPL, CSA, CTP, etc.)\n- Good practical specs buried in noise (MVP_SHARE_SESSION_SPEC)\n- Contradictory schema decisions (SCHEMA_CLEANUP_PLAN)\n- Architectural explorations that never got implemented (ADR-001, ADR-002)\n\n**Result:** Hard to know what's real vs aspirational, what to build vs what to archive.\n\n---\n\n## The Solution: 4 Essential Documents\n\n### 1. **VALUES.md** ✅ Kept unchanged\n**Why:** Your philosophical foundation is solid. This is the \"why\" that guides everything.\n\n**What it does:**\n- Explains the 6 core values\n- Provides anti-patterns to avoid\n- Connects values to design principles\n\n**When to read:** Before making any major decision\n\n---\n\n### 2. **CORE_PRIMITIVES.md** 🆕 New (replaces DATA_DICTIONARY)\n**Why:** DATA_DICTIONARY mixed protocol dreams with database reality.\n\n**What it does:**\n- Shows what actually exists in your database\n- Clarifies what you're currently building (share + verify)\n- Distinguishes protocol (export format) from implementation (database)\n- Lists non-negotiable rules (human agency, provenance, export)\n\n**When to read:** When you need to understand the data model\n\n**What changed from DATA_DICTIONARY:**\n- Removed premature protocol thinking\n- Focused on current reality\n- Added \"what we're NOT building yet\" section\n- Simplified terminology (no more \"extension taxonomy\")\n\n---\n\n### 3. **SHARE_AND_VERIFY.md** 🆕 New (replaces MVP_SHARE_SESSION_SPEC)\n**Why:** Your original spec was good but buried in details.\n\n**What it does:**\n- Week-by-week implementation plan\n- Concrete code examples\n- The fingerprint algorithm explained clearly\n- Success metrics and testing checklist\n\n**When to read:** Every day during active development\n\n**What changed from MVP_SHARE_SESSION_SPEC:**\n- Stripped out \"export archives\" (not MVP)\n- Removed \"live streaming\" (not MVP)\n- Focused on 3 share types: page, single session, full history\n- Added actual code snippets instead of abstract schemas\n\n---\n\n### 4. **DATABASE_REALITY.md** 🆕 New (replaces SCHEMA_CLEANUP_PLAN)\n**Why:** SCHEMA_CLEANUP_PLAN was good analysis but needed action plan.\n\n**What it does:**\n- Lists the 5 real contradictions in your schema\n- Provides runnable SQL migration script\n- Shows code update checklist (3 weeks of work)\n- Clarifies what you're keeping (all ~30 tables)\n\n**When to read:** Before running any database migrations\n\n**What changed from SCHEMA_CLEANUP_PLAN:**\n- Made it surgical, not demolition\n- Added runnable SQL\n- Added testing queries\n- Removed abstract protocol vs app debate\n\n---\n\n### 5. **START_HERE.md** 🆕 New implementation guide\n**Why:** You needed a single entry point for developers.\n\n**What it does:**\n- Links to all 4 core docs\n- Setup guide\n- File structure map\n- Common tasks (add endpoint, add component, etc.)\n- Git workflow\n- Debugging tips\n\n**When to read:** First day on the project, or when stuck\n\n---\n\n## What Got Removed (and Why)\n\n### ❌ CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md\n**Why removed:** Too abstract, too early. You don't need CPL/CSA/CTP specs before you have a working product.\n\n**What was good:** The thinking about pages as core primitive.\n\n**Where it went:** Core concept captured in CORE_PRIMITIVES.md\n\n**When to revisit:** After you have 3+ successful implementations and need interoperability.\n\n---\n\n### ❌ CP-1.0-VIEW-SPEC.md\n**Why removed:** Premature protocol work. Views work fine without formal spec.\n\n**What was good:** Thinking about saved queries as protocol feature.\n\n**Where it went:** Not needed yet. Your current views work.\n\n**When to revisit:** If you want third-party tools to render Cursive views.\n\n---\n\n### ❌ ROUTE_ACTION_CONTRACT_V1_1.md\n**Why removed:** Over-engineered routing with transactions, compensations, etc.\n\n**What was good:** Thinking about atomic operations.\n\n**Where it went:** Simple routing works for now. SAREC handles assessment routing.\n\n**When to revisit:** When you have real complex routing needs (not hypothetical).\n\n---\n\n### ❌ ADR-001-TWO-PRIMITIVES.md\n**Why removed:** Good architectural thinking but too abstract for current needs.\n\n**What was good:** Pages + Routes as core primitives.\n\n**Where it went:** Concept captured in CORE_PRIMITIVES.md, without extension taxonomy.\n\n**When to revisit:** Never. The thinking was useful, but the document is archived.\n\n---\n\n### ❌ ADR-002-CONTEXT-ROLLUP-AGENCY.md\n**Why removed:** Overcomplicated the \"context timeline\" feature.\n\n**What was good:** User agency over AI-inferred traits.\n\n**Where it went:** Core principle in VALUES.md (agency). Implementation can be simpler.\n\n**When to revisit:** When you're actually building context rollup (not yet).\n\n---\n\n### ❌ GPS_TRUST_MATRIX.md\n**Why removed:** Feature spec, not foundational doc.\n\n**What was good:** Thinking about privacy levels and attestation.\n\n**Where it went:** Archived. Revisit when building GPS features.\n\n**When to revisit:** When you add location-based experiences.\n\n---\n\n### ❌ COLLABORATIVE-EDITING-SPEC.md\n**Why removed:** Feature spec, not foundational doc.\n\n**What was good:** Thinking about real-time editing patterns.\n\n**Where it went:** Archived. Revisit when building collaborative features.\n\n**When to revisit:** When you add hangman, shared docs, or live drawing.\n\n---\n\n### ❌ CONVIVIAL-DOMAIN-MODEL.md\n**Why removed:** Draft that never got finished.\n\n**What was good:** Conceptual thinking about layers.\n\n**Where it went:** Core concepts captured in CORE_PRIMITIVES.md.\n\n**When to revisit:** Never. It was exploratory thinking.\n\n---\n\n### ❌ 003-paginated-documents-with-session-recording.md\n**Why removed:** Solved problem - you're already doing pagination + sessions.\n\n**What was good:** The decision to combine pagination with session recording.\n\n**Where it went:** Implementation already exists. ADR captured the rationale.\n\n**When to revisit:** Never. Decision made and implemented.\n\n---\n\n## What Got Updated\n\n### DESIGN_PHILOSOPHY.md ✅ Kept unchanged\n**Why:** Still relevant. Japanese woodworking aesthetic, stone colors, deliberate friction.\n\n**Note:** This is implementation guidance, not protocol thinking. Keep it.\n\n---\n\n### sarec-integration-guide.md ✅ Kept unchanged\n**Why:** This is gold. Your SAREC thinking is practical and implementable.\n\n**Note:** This is your differentiator. Assessment authoring should feel native to content creation.\n\n---\n\n## New File Structure\n\n```\ndocs/\n├─ START_HERE.md              🆕 Read this first\n├─ VALUES.md                  ✅ Unchanged\n├─ CORE_PRIMITIVES.md         🆕 Replaces DATA_DICTIONARY\n├─ SHARE_AND_VERIFY.md        🆕 Replaces MVP_SHARE_SESSION_SPEC\n├─ DATABASE_REALITY.md        🆕 Replaces SCHEMA_CLEANUP_PLAN\n├─ DESIGN_PHILOSOPHY.md       ✅ Unchanged\n└─ sarec-integration-guide.md ✅ Unchanged\n\narchived/ (optional)\n├─ CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md\n├─ CP-1.0-VIEW-SPEC.md\n├─ ROUTE_ACTION_CONTRACT_V1_1.md\n├─ ADR-001-TWO-PRIMITIVES.md\n├─ ADR-002-CONTEXT-ROLLUP-AGENCY.md\n├─ GPS_TRUST_MATRIX.md\n├─ COLLABORATIVE-EDITING-SPEC.md\n└─ CONVIVIAL-DOMAIN-MODEL.md\n```\n\n---\n\n## Key Principles Behind Cleanup\n\n### 1. Reality Over Aspiration\n**Old:** \"Here's how the protocol COULD work across implementations\"  \n**New:** \"Here's what exists today and what we're building next\"\n\n### 2. Practical Over Abstract\n**Old:** \"CP-1.0-CPL defines page structure with compliance levels\"  \n**New:** \"Pages have TipTap content, here's the schema, here's the code\"\n\n### 3. Implementation Over Specification\n**Old:** \"Routes execute via CSA with sandboxed computation extensions\"  \n**New:** \"SAREC handles routing, here's how to add a condition\"\n\n### 4. Current Over Future\n**Old:** \"Federation via ActivityPub will enable cross-instance guides\"  \n**New:** \"Build single-instance excellence first, federation later\"\n\n---\n\n## Metaphor: Carpenter's Workbench\n\n**Old docs were like:** Architectural drawings for a city you haven't built yet.\n\n**New docs are like:** Tools laid out on a carpenter's bench:\n- **VALUES.md** = Your master's philosophy book\n- **CORE_PRIMITIVES.md** = Your lumber inventory (what wood you have)\n- **SHARE_AND_VERIFY.md** = Your current project blueprint (this week's chair)\n- **DATABASE_REALITY.md** = Your workshop cleanup list (fix that wobbly workbench)\n- **START_HERE.md** = Your apprentice's orientation guide\n\nYou can pick up any doc and immediately know what to do.\n\n---\n\n## What to Do With Archived Docs\n\n### Option A: Keep in `archived/` folder\nGood for historical reference, shows your thinking evolution.\n\n### Option B: Delete entirely\nClean slate, only keep what's actively used.\n\n### Option C: Keep in git history\nDelete from `main`, but always available via `git log`.\n\n**Recommendation:** Option A. Archive shows good thinking, just not current priority.\n\n---\n\n## How to Use the New Docs\n\n### Daily development:\nRead **SHARE_AND_VERIFY.md** - your current sprint\n\n### When stuck:\nRead **CORE_PRIMITIVES.md** - understand the data model\n\n### Before schema changes:\nRead **DATABASE_REALITY.md** - know what's contradictory\n\n### Before major decisions:\nRead **VALUES.md** - does this honor human agency?\n\n### New team member:\nRead **START_HERE.md** → then others in order\n\n---\n\n## Success Metrics\n\nYou'll know the cleanup worked when:\n\n1. ✅ New developers can onboard in 90 minutes (read 4 docs)\n2. ✅ No one asks \"what's the difference between guide_pages and pages?\"\n3. ✅ No one proposes \"federation\" before you have 3 implementations\n4. ✅ Everyone knows what you're building this week\n5. ✅ Schema contradictions are fixed within 1 month\n\n---\n\n## What Didn't Change\n\n### Your Core Ideas ✅\n- Pages are sacred\n- Process is proof\n- Humans guide, AI assists\n- Everything exports\n- Craft over convenience\n\n### Your Differentiator ✅\n- SAREC integration (assessment native to content creation)\n- Proof-of-human fingerprints (unfakeable verification)\n- Background recording (transparency without burden)\n\n### Your Values ✅\nAll 6 core values remain unchanged and guide every decision.\n\n---\n\n## Final Note: Protocol vs Product\n\n**Old thinking:** \"Protocol first, then implementations\"  \n**New thinking:** \"Product first, protocol emerges from reality\"\n\nThe \"protocol\" is simply:\n1. **Export format** - how users get their data out\n2. **Proof format** - how fingerprints work\n3. **That's it**\n\nEverything else is your reference implementation. When you have 3+ working implementations, THEN formalize interchange specs.\n\n---\n\n**You had great thinking. Now you have great docs that match your current reality.**\n",
              "description": "Creating summary document explaining the documentation cleanup rationale"
            },
            "message": "Creating summary document explaining the documentation cleanup rationale",
            "integration_name": null,
            "integration_icon_url": null,
            "context": null,
            "display_content": {
              "type": "json_block",
              "json_block": "{\"language\": \"markdown\", \"code\": \"# Documentation Cleanup: What Changed and Why\\n\\n**Date:** November 6, 2025  \\n**Purpose:** Explain the documentation overhaul\\n\\n---\\n\\n## The Problem\\n\\nYou had **15+ documents** with:\\n- Brilliant philosophical thinking (VALUES.md)\\n- Premature protocol abstraction (CP-1.0-CPL, CSA, CTP, etc.)\\n- Good practical specs buried in noise (MVP_SHARE_SESSION_SPEC)\\n- Contradictory schema decisions (SCHEMA_CLEANUP_PLAN)\\n- Architectural explorations that never got implemented (ADR-001, ADR-002)\\n\\n**Result:** Hard to know what's real vs aspirational, what to build vs what to archive.\\n\\n---\\n\\n## The Solution: 4 Essential Documents\\n\\n### 1. **VALUES.md** \\u2705 Kept unchanged\\n**Why:** Your philosophical foundation is solid. This is the \\\"why\\\" that guides everything.\\n\\n**What it does:**\\n- Explains the 6 core values\\n- Provides anti-patterns to avoid\\n- Connects values to design principles\\n\\n**When to read:** Before making any major decision\\n\\n---\\n\\n### 2. **CORE_PRIMITIVES.md** \\ud83c\\udd95 New (replaces DATA_DICTIONARY)\\n**Why:** DATA_DICTIONARY mixed protocol dreams with database reality.\\n\\n**What it does:**\\n- Shows what actually exists in your database\\n- Clarifies what you're currently building (share + verify)\\n- Distinguishes protocol (export format) from implementation (database)\\n- Lists non-negotiable rules (human agency, provenance, export)\\n\\n**When to read:** When you need to understand the data model\\n\\n**What changed from DATA_DICTIONARY:**\\n- Removed premature protocol thinking\\n- Focused on current reality\\n- Added \\\"what we're NOT building yet\\\" section\\n- Simplified terminology (no more \\\"extension taxonomy\\\")\\n\\n---\\n\\n### 3. **SHARE_AND_VERIFY.md** \\ud83c\\udd95 New (replaces MVP_SHARE_SESSION_SPEC)\\n**Why:** Your original spec was good but buried in details.\\n\\n**What it does:**\\n- Week-by-week implementation plan\\n- Concrete code examples\\n- The fingerprint algorithm explained clearly\\n- Success metrics and testing checklist\\n\\n**When to read:** Every day during active development\\n\\n**What changed from MVP_SHARE_SESSION_SPEC:**\\n- Stripped out \\\"export archives\\\" (not MVP)\\n- Removed \\\"live streaming\\\" (not MVP)\\n- Focused on 3 share types: page, single session, full history\\n- Added actual code snippets instead of abstract schemas\\n\\n---\\n\\n### 4. **DATABASE_REALITY.md** \\ud83c\\udd95 New (replaces SCHEMA_CLEANUP_PLAN)\\n**Why:** SCHEMA_CLEANUP_PLAN was good analysis but needed action plan.\\n\\n**What it does:**\\n- Lists the 5 real contradictions in your schema\\n- Provides runnable SQL migration script\\n- Shows code update checklist (3 weeks of work)\\n- Clarifies what you're keeping (all ~30 tables)\\n\\n**When to read:** Before running any database migrations\\n\\n**What changed from SCHEMA_CLEANUP_PLAN:**\\n- Made it surgical, not demolition\\n- Added runnable SQL\\n- Added testing queries\\n- Removed abstract protocol vs app debate\\n\\n---\\n\\n### 5. **START_HERE.md** \\ud83c\\udd95 New implementation guide\\n**Why:** You needed a single entry point for developers.\\n\\n**What it does:**\\n- Links to all 4 core docs\\n- Setup guide\\n- File structure map\\n- Common tasks (add endpoint, add component, etc.)\\n- Git workflow\\n- Debugging tips\\n\\n**When to read:** First day on the project, or when stuck\\n\\n---\\n\\n## What Got Removed (and Why)\\n\\n### \\u274c CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md\\n**Why removed:** Too abstract, too early. You don't need CPL/CSA/CTP specs before you have a working product.\\n\\n**What was good:** The thinking about pages as core primitive.\\n\\n**Where it went:** Core concept captured in CORE_PRIMITIVES.md\\n\\n**When to revisit:** After you have 3+ successful implementations and need interoperability.\\n\\n---\\n\\n### \\u274c CP-1.0-VIEW-SPEC.md\\n**Why removed:** Premature protocol work. Views work fine without formal spec.\\n\\n**What was good:** Thinking about saved queries as protocol feature.\\n\\n**Where it went:** Not needed yet. Your current views work.\\n\\n**When to revisit:** If you want third-party tools to render Cursive views.\\n\\n---\\n\\n### \\u274c ROUTE_ACTION_CONTRACT_V1_1.md\\n**Why removed:** Over-engineered routing with transactions, compensations, etc.\\n\\n**What was good:** Thinking about atomic operations.\\n\\n**Where it went:** Simple routing works for now. SAREC handles assessment routing.\\n\\n**When to revisit:** When you have real complex routing needs (not hypothetical).\\n\\n---\\n\\n### \\u274c ADR-001-TWO-PRIMITIVES.md\\n**Why removed:** Good architectural thinking but too abstract for current needs.\\n\\n**What was good:** Pages + Routes as core primitives.\\n\\n**Where it went:** Concept captured in CORE_PRIMITIVES.md, without extension taxonomy.\\n\\n**When to revisit:** Never. The thinking was useful, but the document is archived.\\n\\n---\\n\\n### \\u274c ADR-002-CONTEXT-ROLLUP-AGENCY.md\\n**Why removed:** Overcomplicated the \\\"context timeline\\\" feature.\\n\\n**What was good:** User agency over AI-inferred traits.\\n\\n**Where it went:** Core principle in VALUES.md (agency). Implementation can be simpler.\\n\\n**When to revisit:** When you're actually building context rollup (not yet).\\n\\n---\\n\\n### \\u274c GPS_TRUST_MATRIX.md\\n**Why removed:** Feature spec, not foundational doc.\\n\\n**What was good:** Thinking about privacy levels and attestation.\\n\\n**Where it went:** Archived. Revisit when building GPS features.\\n\\n**When to revisit:** When you add location-based experiences.\\n\\n---\\n\\n### \\u274c COLLABORATIVE-EDITING-SPEC.md\\n**Why removed:** Feature spec, not foundational doc.\\n\\n**What was good:** Thinking about real-time editing patterns.\\n\\n**Where it went:** Archived. Revisit when building collaborative features.\\n\\n**When to revisit:** When you add hangman, shared docs, or live drawing.\\n\\n---\\n\\n### \\u274c CONVIVIAL-DOMAIN-MODEL.md\\n**Why removed:** Draft that never got finished.\\n\\n**What was good:** Conceptual thinking about layers.\\n\\n**Where it went:** Core concepts captured in CORE_PRIMITIVES.md.\\n\\n**When to revisit:** Never. It was exploratory thinking.\\n\\n---\\n\\n### \\u274c 003-paginated-documents-with-session-recording.md\\n**Why removed:** Solved problem - you're already doing pagination + sessions.\\n\\n**What was good:** The decision to combine pagination with session recording.\\n\\n**Where it went:** Implementation already exists. ADR captured the rationale.\\n\\n**When to revisit:** Never. Decision made and implemented.\\n\\n---\\n\\n## What Got Updated\\n\\n### DESIGN_PHILOSOPHY.md \\u2705 Kept unchanged\\n**Why:** Still relevant. Japanese woodworking aesthetic, stone colors, deliberate friction.\\n\\n**Note:** This is implementation guidance, not protocol thinking. Keep it.\\n\\n---\\n\\n### sarec-integration-guide.md \\u2705 Kept unchanged\\n**Why:** This is gold. Your SAREC thinking is practical and implementable.\\n\\n**Note:** This is your differentiator. Assessment authoring should feel native to content creation.\\n\\n---\\n\\n## New File Structure\\n\\n```\\ndocs/\\n\\u251c\\u2500 START_HERE.md              \\ud83c\\udd95 Read this first\\n\\u251c\\u2500 VALUES.md                  \\u2705 Unchanged\\n\\u251c\\u2500 CORE_PRIMITIVES.md         \\ud83c\\udd95 Replaces DATA_DICTIONARY\\n\\u251c\\u2500 SHARE_AND_VERIFY.md        \\ud83c\\udd95 Replaces MVP_SHARE_SESSION_SPEC\\n\\u251c\\u2500 DATABASE_REALITY.md        \\ud83c\\udd95 Replaces SCHEMA_CLEANUP_PLAN\\n\\u251c\\u2500 DESIGN_PHILOSOPHY.md       \\u2705 Unchanged\\n\\u2514\\u2500 sarec-integration-guide.md \\u2705 Unchanged\\n\\narchived/ (optional)\\n\\u251c\\u2500 CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md\\n\\u251c\\u2500 CP-1.0-VIEW-SPEC.md\\n\\u251c\\u2500 ROUTE_ACTION_CONTRACT_V1_1.md\\n\\u251c\\u2500 ADR-001-TWO-PRIMITIVES.md\\n\\u251c\\u2500 ADR-002-CONTEXT-ROLLUP-AGENCY.md\\n\\u251c\\u2500 GPS_TRUST_MATRIX.md\\n\\u251c\\u2500 COLLABORATIVE-EDITING-SPEC.md\\n\\u2514\\u2500 CONVIVIAL-DOMAIN-MODEL.md\\n```\\n\\n---\\n\\n## Key Principles Behind Cleanup\\n\\n### 1. Reality Over Aspiration\\n**Old:** \\\"Here's how the protocol COULD work across implementations\\\"  \\n**New:** \\\"Here's what exists today and what we're building next\\\"\\n\\n### 2. Practical Over Abstract\\n**Old:** \\\"CP-1.0-CPL defines page structure with compliance levels\\\"  \\n**New:** \\\"Pages have TipTap content, here's the schema, here's the code\\\"\\n\\n### 3. Implementation Over Specification\\n**Old:** \\\"Routes execute via CSA with sandboxed computation extensions\\\"  \\n**New:** \\\"SAREC handles routing, here's how to add a condition\\\"\\n\\n### 4. Current Over Future\\n**Old:** \\\"Federation via ActivityPub will enable cross-instance guides\\\"  \\n**New:** \\\"Build single-instance excellence first, federation later\\\"\\n\\n---\\n\\n## Metaphor: Carpenter's Workbench\\n\\n**Old docs were like:** Architectural drawings for a city you haven't built yet.\\n\\n**New docs are like:** Tools laid out on a carpenter's bench:\\n- **VALUES.md** = Your master's philosophy book\\n- **CORE_PRIMITIVES.md** = Your lumber inventory (what wood you have)\\n- **SHARE_AND_VERIFY.md** = Your current project blueprint (this week's chair)\\n- **DATABASE_REALITY.md** = Your workshop cleanup list (fix that wobbly workbench)\\n- **START_HERE.md** = Your apprentice's orientation guide\\n\\nYou can pick up any doc and immediately know what to do.\\n\\n---\\n\\n## What to Do With Archived Docs\\n\\n### Option A: Keep in `archived/` folder\\nGood for historical reference, shows your thinking evolution.\\n\\n### Option B: Delete entirely\\nClean slate, only keep what's actively used.\\n\\n### Option C: Keep in git history\\nDelete from `main`, but always available via `git log`.\\n\\n**Recommendation:** Option A. Archive shows good thinking, just not current priority.\\n\\n---\\n\\n## How to Use the New Docs\\n\\n### Daily development:\\nRead **SHARE_AND_VERIFY.md** - your current sprint\\n\\n### When stuck:\\nRead **CORE_PRIMITIVES.md** - understand the data model\\n\\n### Before schema changes:\\nRead **DATABASE_REALITY.md** - know what's contradictory\\n\\n### Before major decisions:\\nRead **VALUES.md** - does this honor human agency?\\n\\n### New team member:\\nRead **START_HERE.md** \\u2192 then others in order\\n\\n---\\n\\n## Success Metrics\\n\\nYou'll know the cleanup worked when:\\n\\n1. \\u2705 New developers can onboard in 90 minutes (read 4 docs)\\n2. \\u2705 No one asks \\\"what's the difference between guide_pages and pages?\\\"\\n3. \\u2705 No one proposes \\\"federation\\\" before you have 3 implementations\\n4. \\u2705 Everyone knows what you're building this week\\n5. \\u2705 Schema contradictions are fixed within 1 month\\n\\n---\\n\\n## What Didn't Change\\n\\n### Your Core Ideas \\u2705\\n- Pages are sacred\\n- Process is proof\\n- Humans guide, AI assists\\n- Everything exports\\n- Craft over convenience\\n\\n### Your Differentiator \\u2705\\n- SAREC integration (assessment native to content creation)\\n- Proof-of-human fingerprints (unfakeable verification)\\n- Background recording (transparency without burden)\\n\\n### Your Values \\u2705\\nAll 6 core values remain unchanged and guide every decision.\\n\\n---\\n\\n## Final Note: Protocol vs Product\\n\\n**Old thinking:** \\\"Protocol first, then implementations\\\"  \\n**New thinking:** \\\"Product first, protocol emerges from reality\\\"\\n\\nThe \\\"protocol\\\" is simply:\\n1. **Export format** - how users get their data out\\n2. **Proof format** - how fingerprints work\\n3. **That's it**\\n\\nEverything else is your reference implementation. When you have 3+ working implementations, THEN formalize interchange specs.\\n\\n---\\n\\n**You had great thinking. Now you have great docs that match your current reality.**\\n\", \"filename\": \"/mnt/user-data/outputs/CLEANUP_SUMMARY.md\"}"
            },
            "approval_options": null,
            "approval_key": null
          },
          {
            "start_timestamp": null,
            "stop_timestamp": null,
            "flags": null,
            "type": "tool_result",
            "name": "create_file",
            "content": [
              {
                "type": "text",
                "text": "File created successfully: /mnt/user-data/outputs/CLEANUP_SUMMARY.md",
                "uuid": "ebf6985f-7433-40de-ac73-808d45194f5a"
              }
            ],
            "is_error": false,
            "message": null,
            "integration_name": null,
            "integration_icon_url": null,
            "display_content": {
              "type": "text",
              "text": "File created successfully: /mnt/user-data/outputs/CLEANUP_SUMMARY.md"
            }
          },
          {
            "start_timestamp": null,
            "stop_timestamp": null,
            "flags": null,
            "type": "token_budget"
          },
          {
            "start_timestamp": "2025-11-06T12:04:14.513168Z",
            "stop_timestamp": "2025-11-06T12:04:15.604152Z",
            "flags": null,
            "type": "thinking",
            "thinking": "Perfect. Now let me create one more document - a quick reference card that developers can print or keep open while coding.",
            "summaries": [
              {
                "summary": "Conceived a developer-friendly quick reference documentation card."
              }
            ],
            "cut_off": false
          },
          {
            "start_timestamp": "2025-11-06T12:04:15.807480Z",
            "stop_timestamp": "2025-11-06T12:04:58.081671Z",
            "flags": null,
            "type": "tool_use",
            "name": "create_file",
            "input": {
              "path": "/mnt/user-data/outputs/QUICK_REFERENCE.md",
              "file_text": "# Cursive Quick Reference Card\n\n**Print this. Keep it visible.**\n\n---\n\n## The 6 Non-Negotiable Rules\n\n1. ❌ **No AI writes to pages.content** - Only humans or ratified suggestions\n2. ❌ **No auto-sharing** - Everything defaults private, user must share\n3. ❌ **No faking fingerprints** - Detect human patterns, not just check existence\n4. ❌ **No hiding process** - Users always see their sessions\n5. ❌ **No vendor lock-in** - Everything must export cleanly\n6. ❌ **No dark patterns** - No infinite scroll, autoplay, or engagement metrics\n\n---\n\n## Core Data Model\n\n```\ncollections\n  â\"œâ\"€ folders\n  â\"‚   └─ pages\n  â\"‚       ├─ content (TipTap JSON)\n  â\"‚       ├─ ink_strokes\n  â\"‚       └─ presentation_sessions\n  â\"‚           └─ fingerprint\n  â\"œâ\"€ invitations\n  â\"\"â\"€ responses\n```\n\n---\n\n## Key Files\n\n### Logic\n- `lib/fingerprint.ts` - Proof-of-human algorithm\n- `lib/session-recorder.ts` - Background recording\n\n### Components\n- `components/editor/PageEditor.tsx` - Main editor\n- `components/share/SharePageDialog.tsx` - Share dialog\n- `components/verify/VerificationBadge.tsx` - Badge\n\n### API\n- `app/api/pages/[id]/public/route.ts` - Public pages\n- `app/api/verification/calculate/[pageId]/route.ts` - Fingerprints\n\n---\n\n## Fingerprint Algorithm (Cheat Sheet)\n\n### Human Patterns ✅\n- Stroke variance: **200-800ms**\n- Long pauses: **3+ gaps > 5s**\n- Correction rate: **5-20%**\n\n### AI Patterns ❌\n- Stroke variance: **<50ms** (too perfect)\n- Long pauses: **0** (no thinking)\n- Correction rate: **<1%** (no mistakes)\n\n### Confidence Scoring\n```\nBase: 50\n+ Stroke variance in human range: +20\n+ Has thinking pauses: +15\n+ Human error rate: +15\n- Too perfect variance: -30\n= 0-100 confidence score\n```\n\n**Show badge when:** `confidence >= 70`\n\n---\n\n## Database Commands\n\n### Quick Queries\n```sql\n-- See what exists\nSELECT COUNT(*) FROM pages;\nSELECT COUNT(*) FROM presentation_sessions;\nSELECT COUNT(*) FROM page_verifications;\n\n-- Check a page's sessions\nSELECT started_at, active_duration_ms, fingerprint\nFROM presentation_sessions\nWHERE page_id = 'your-page-id'\nORDER BY started_at;\n\n-- Check fingerprints\nSELECT page_id, confidence_score, metrics\nFROM page_verifications\nWHERE confidence_score >= 70;\n```\n\n### Regenerate Types\n```bash\nnpm run db:types\n# After any schema change\n```\n\n---\n\n## Git Workflow\n\n```bash\n# New feature\ngit checkout -b feature/your-feature\ngit commit -m \"feat: description\"\ngit push origin feature/your-feature\n\n# Database change\nnpm run db:migration create_your_migration\n# Edit: supabase/migrations/...sql\nnpm run db:migrate\nnpm run db:types\n```\n\n---\n\n## Testing Checklist\n\nBefore every PR:\n- [ ] `npm run build` (compiles)\n- [ ] `npm run type-check` (types valid)\n- [ ] `npm test` (tests pass)\n- [ ] `npm run lint` (code clean)\n- [ ] Manual testing on localhost\n- [ ] Docs updated (if needed)\n\n---\n\n## Debugging\n\n### Session not recording?\n```typescript\nconst session = sessionRecorder.getCurrentSession();\nconsole.log('Active:', session);\nconsole.log('Events:', session?.events?.length);\n```\n\n### Fingerprint low confidence?\n```typescript\nconst result = await calculateFingerprint(pageId);\nconsole.log('Score:', result.confidence_score);\nconsole.log('Metrics:', result.metrics);\n// Check: stroke_count, revision_count, temporal_markers\n```\n\n### Database query failing?\n```typescript\nconst { data, error } = await supabase.from('pages').select();\nconsole.log({ data, error });\n// Check error.message, error.code\n```\n\n---\n\n## Common Tasks\n\n### Add API endpoint\n```typescript\n// app/api/your-endpoint/route.ts\nimport { createClient } from '@/lib/supabase/server';\n\nexport async function GET(request: Request) {\n  const supabase = createClient();\n  const { data, error } = await supabase\n    .from('pages')\n    .select('*');\n  \n  return Response.json({ data });\n}\n```\n\n### Add React component\n```typescript\n// components/your-feature/YourComponent.tsx\nexport function YourComponent({ prop }: Props) {\n  return <div>{/* UI here */}</div>;\n}\n```\n\n### Add database table\n```sql\n-- supabase/migrations/your_migration.sql\nCREATE TABLE your_table (\n  id uuid PRIMARY KEY DEFAULT uuid_generate_v4(),\n  created_at timestamptz DEFAULT now()\n);\n\n-- Then run:\nnpm run db:migrate\nnpm run db:types\n```\n\n---\n\n## Questions to Ask Before Building\n\n1. Does this honor **human agency**?\n2. Can it be **exported**?\n3. Does it preserve **provenance**?\n4. Is it the **simplest** solution?\n5. Does it serve **human hearts**?\n\n**If \"no\" to any → redesign or don't build**\n\n---\n\n## Current Sprint (November 2025)\n\n**Week 1:** Share page dialog + `/p/{pageId}` route  \n**Week 2:** Fingerprint calculation + badge  \n**Week 3:** Access requests (teacher asks, student approves)  \n**Week 4:** Walkthrough viewer (replay sessions)\n\n**See:** [SHARE_AND_VERIFY.md](SHARE_AND_VERIFY.md) for details\n\n---\n\n## Documentation Map\n\n📖 **START_HERE.md** - New developer onboarding  \n💎 **VALUES.md** - Why we exist  \n🗄️ **CORE_PRIMITIVES.md** - Data model  \n🚀 **SHARE_AND_VERIFY.md** - Current feature spec  \n🔧 **DATABASE_REALITY.md** - Schema cleanup  \n🎨 **DESIGN_PHILOSOPHY.md** - UI/UX principles  \n📚 **sarec-integration-guide.md** - Assessment system\n\n---\n\n## Performance Budgets\n\n- Page load: **< 2s** on 3G\n- Editor lag: **< 50ms** input delay\n- Recording overhead: **< 5%** CPU\n- Database queries: **< 100ms** response\n\n---\n\n## Tech Stack\n\n- **Frontend:** Next.js + React + TypeScript\n- **Editor:** TipTap (rich text) + Konva (canvas)\n- **Database:** Supabase (Postgres + Auth + Realtime)\n- **Hosting:** Vercel (app) + Supabase (db)\n- **Styling:** Tailwind CSS + stone color palette\n\n---\n\n## Stone Color Palette (Design Philosophy)\n\n```css\n--stone-50: #fafaf9;   /* Backgrounds */\n--stone-200: #e7e5e4;  /* Borders */\n--stone-600: #57534e;  /* Secondary text */\n--stone-800: #292524;  /* Primary text */\n```\n\n**Aesthetic:** Japanese woodworking (precise, minimal, calm)  \n**No:** Bright colors, gradients, shadows, animations  \n**Yes:** Square corners (2px radius), stone colors, deliberate friction\n\n---\n\n## Getting Help\n\n1. Check [CORE_PRIMITIVES.md](CORE_PRIMITIVES.md) for data model\n2. Check [SHARE_AND_VERIFY.md](SHARE_AND_VERIFY.md) for current feature\n3. Ask in Slack #cursive-dev\n4. Tag reviewers on GitHub\n\n---\n\n## Common Errors & Fixes\n\n### \"Type 'X' is not assignable to type 'Y'\"\n→ Regenerate types: `npm run db:types`\n\n### \"RLS policy violation\"\n→ Check Supabase policies for the table\n\n### \"Session not found\"\n→ Background recording not started, check `startBackgroundSession()`\n\n### \"Fingerprint confidence is 0\"\n→ No session data exists, record some activity first\n\n---\n\n**Keep this card handy. Ship with intention. Serve human hearts.** ❤️\n",
              "description": "Creating a quick reference card for developers"
            },
            "message": "Creating a quick reference card for developers",
            "integration_name": null,
            "integration_icon_url": null,
            "context": null,
            "display_content": {
              "type": "json_block",
              "json_block": "{\"language\": \"markdown\", \"code\": \"# Cursive Quick Reference Card\\n\\n**Print this. Keep it visible.**\\n\\n---\\n\\n## The 6 Non-Negotiable Rules\\n\\n1. \\u274c **No AI writes to pages.content** - Only humans or ratified suggestions\\n2. \\u274c **No auto-sharing** - Everything defaults private, user must share\\n3. \\u274c **No faking fingerprints** - Detect human patterns, not just check existence\\n4. \\u274c **No hiding process** - Users always see their sessions\\n5. \\u274c **No vendor lock-in** - Everything must export cleanly\\n6. \\u274c **No dark patterns** - No infinite scroll, autoplay, or engagement metrics\\n\\n---\\n\\n## Core Data Model\\n\\n```\\ncollections\\n  \\u00e2\\\"\\u0153\\u00e2\\\"\\u20ac folders\\n  \\u00e2\\\"\\u201a   \\u2514\\u2500 pages\\n  \\u00e2\\\"\\u201a       \\u251c\\u2500 content (TipTap JSON)\\n  \\u00e2\\\"\\u201a       \\u251c\\u2500 ink_strokes\\n  \\u00e2\\\"\\u201a       \\u2514\\u2500 presentation_sessions\\n  \\u00e2\\\"\\u201a           \\u2514\\u2500 fingerprint\\n  \\u00e2\\\"\\u0153\\u00e2\\\"\\u20ac invitations\\n  \\u00e2\\\"\\\"\\u00e2\\\"\\u20ac responses\\n```\\n\\n---\\n\\n## Key Files\\n\\n### Logic\\n- `lib/fingerprint.ts` - Proof-of-human algorithm\\n- `lib/session-recorder.ts` - Background recording\\n\\n### Components\\n- `components/editor/PageEditor.tsx` - Main editor\\n- `components/share/SharePageDialog.tsx` - Share dialog\\n- `components/verify/VerificationBadge.tsx` - Badge\\n\\n### API\\n- `app/api/pages/[id]/public/route.ts` - Public pages\\n- `app/api/verification/calculate/[pageId]/route.ts` - Fingerprints\\n\\n---\\n\\n## Fingerprint Algorithm (Cheat Sheet)\\n\\n### Human Patterns \\u2705\\n- Stroke variance: **200-800ms**\\n- Long pauses: **3+ gaps > 5s**\\n- Correction rate: **5-20%**\\n\\n### AI Patterns \\u274c\\n- Stroke variance: **<50ms** (too perfect)\\n- Long pauses: **0** (no thinking)\\n- Correction rate: **<1%** (no mistakes)\\n\\n### Confidence Scoring\\n```\\nBase: 50\\n+ Stroke variance in human range: +20\\n+ Has thinking pauses: +15\\n+ Human error rate: +15\\n- Too perfect variance: -30\\n= 0-100 confidence score\\n```\\n\\n**Show badge when:** `confidence >= 70`\\n\\n---\\n\\n## Database Commands\\n\\n### Quick Queries\\n```sql\\n-- See what exists\\nSELECT COUNT(*) FROM pages;\\nSELECT COUNT(*) FROM presentation_sessions;\\nSELECT COUNT(*) FROM page_verifications;\\n\\n-- Check a page's sessions\\nSELECT started_at, active_duration_ms, fingerprint\\nFROM presentation_sessions\\nWHERE page_id = 'your-page-id'\\nORDER BY started_at;\\n\\n-- Check fingerprints\\nSELECT page_id, confidence_score, metrics\\nFROM page_verifications\\nWHERE confidence_score >= 70;\\n```\\n\\n### Regenerate Types\\n```bash\\nnpm run db:types\\n# After any schema change\\n```\\n\\n---\\n\\n## Git Workflow\\n\\n```bash\\n# New feature\\ngit checkout -b feature/your-feature\\ngit commit -m \\\"feat: description\\\"\\ngit push origin feature/your-feature\\n\\n# Database change\\nnpm run db:migration create_your_migration\\n# Edit: supabase/migrations/...sql\\nnpm run db:migrate\\nnpm run db:types\\n```\\n\\n---\\n\\n## Testing Checklist\\n\\nBefore every PR:\\n- [ ] `npm run build` (compiles)\\n- [ ] `npm run type-check` (types valid)\\n- [ ] `npm test` (tests pass)\\n- [ ] `npm run lint` (code clean)\\n- [ ] Manual testing on localhost\\n- [ ] Docs updated (if needed)\\n\\n---\\n\\n## Debugging\\n\\n### Session not recording?\\n```typescript\\nconst session = sessionRecorder.getCurrentSession();\\nconsole.log('Active:', session);\\nconsole.log('Events:', session?.events?.length);\\n```\\n\\n### Fingerprint low confidence?\\n```typescript\\nconst result = await calculateFingerprint(pageId);\\nconsole.log('Score:', result.confidence_score);\\nconsole.log('Metrics:', result.metrics);\\n// Check: stroke_count, revision_count, temporal_markers\\n```\\n\\n### Database query failing?\\n```typescript\\nconst { data, error } = await supabase.from('pages').select();\\nconsole.log({ data, error });\\n// Check error.message, error.code\\n```\\n\\n---\\n\\n## Common Tasks\\n\\n### Add API endpoint\\n```typescript\\n// app/api/your-endpoint/route.ts\\nimport { createClient } from '@/lib/supabase/server';\\n\\nexport async function GET(request: Request) {\\n  const supabase = createClient();\\n  const { data, error } = await supabase\\n    .from('pages')\\n    .select('*');\\n  \\n  return Response.json({ data });\\n}\\n```\\n\\n### Add React component\\n```typescript\\n// components/your-feature/YourComponent.tsx\\nexport function YourComponent({ prop }: Props) {\\n  return <div>{/* UI here */}</div>;\\n}\\n```\\n\\n### Add database table\\n```sql\\n-- supabase/migrations/your_migration.sql\\nCREATE TABLE your_table (\\n  id uuid PRIMARY KEY DEFAULT uuid_generate_v4(),\\n  created_at timestamptz DEFAULT now()\\n);\\n\\n-- Then run:\\nnpm run db:migrate\\nnpm run db:types\\n```\\n\\n---\\n\\n## Questions to Ask Before Building\\n\\n1. Does this honor **human agency**?\\n2. Can it be **exported**?\\n3. Does it preserve **provenance**?\\n4. Is it the **simplest** solution?\\n5. Does it serve **human hearts**?\\n\\n**If \\\"no\\\" to any \\u2192 redesign or don't build**\\n\\n---\\n\\n## Current Sprint (November 2025)\\n\\n**Week 1:** Share page dialog + `/p/{pageId}` route  \\n**Week 2:** Fingerprint calculation + badge  \\n**Week 3:** Access requests (teacher asks, student approves)  \\n**Week 4:** Walkthrough viewer (replay sessions)\\n\\n**See:** [SHARE_AND_VERIFY.md](SHARE_AND_VERIFY.md) for details\\n\\n---\\n\\n## Documentation Map\\n\\n\\ud83d\\udcd6 **START_HERE.md** - New developer onboarding  \\n\\ud83d\\udc8e **VALUES.md** - Why we exist  \\n\\ud83d\\uddc4\\ufe0f **CORE_PRIMITIVES.md** - Data model  \\n\\ud83d\\ude80 **SHARE_AND_VERIFY.md** - Current feature spec  \\n\\ud83d\\udd27 **DATABASE_REALITY.md** - Schema cleanup  \\n\\ud83c\\udfa8 **DESIGN_PHILOSOPHY.md** - UI/UX principles  \\n\\ud83d\\udcda **sarec-integration-guide.md** - Assessment system\\n\\n---\\n\\n## Performance Budgets\\n\\n- Page load: **< 2s** on 3G\\n- Editor lag: **< 50ms** input delay\\n- Recording overhead: **< 5%** CPU\\n- Database queries: **< 100ms** response\\n\\n---\\n\\n## Tech Stack\\n\\n- **Frontend:** Next.js + React + TypeScript\\n- **Editor:** TipTap (rich text) + Konva (canvas)\\n- **Database:** Supabase (Postgres + Auth + Realtime)\\n- **Hosting:** Vercel (app) + Supabase (db)\\n- **Styling:** Tailwind CSS + stone color palette\\n\\n---\\n\\n## Stone Color Palette (Design Philosophy)\\n\\n```css\\n--stone-50: #fafaf9;   /* Backgrounds */\\n--stone-200: #e7e5e4;  /* Borders */\\n--stone-600: #57534e;  /* Secondary text */\\n--stone-800: #292524;  /* Primary text */\\n```\\n\\n**Aesthetic:** Japanese woodworking (precise, minimal, calm)  \\n**No:** Bright colors, gradients, shadows, animations  \\n**Yes:** Square corners (2px radius), stone colors, deliberate friction\\n\\n---\\n\\n## Getting Help\\n\\n1. Check [CORE_PRIMITIVES.md](CORE_PRIMITIVES.md) for data model\\n2. Check [SHARE_AND_VERIFY.md](SHARE_AND_VERIFY.md) for current feature\\n3. Ask in Slack #cursive-dev\\n4. Tag reviewers on GitHub\\n\\n---\\n\\n## Common Errors & Fixes\\n\\n### \\\"Type 'X' is not assignable to type 'Y'\\\"\\n\\u2192 Regenerate types: `npm run db:types`\\n\\n### \\\"RLS policy violation\\\"\\n\\u2192 Check Supabase policies for the table\\n\\n### \\\"Session not found\\\"\\n\\u2192 Background recording not started, check `startBackgroundSession()`\\n\\n### \\\"Fingerprint confidence is 0\\\"\\n\\u2192 No session data exists, record some activity first\\n\\n---\\n\\n**Keep this card handy. Ship with intention. Serve human hearts.** \\u2764\\ufe0f\\n\", \"filename\": \"/mnt/user-data/outputs/QUICK_REFERENCE.md\"}"
            },
            "approval_options": null,
            "approval_key": null
          },
          {
            "start_timestamp": null,
            "stop_timestamp": null,
            "flags": null,
            "type": "tool_result",
            "name": "create_file",
            "content": [
              {
                "type": "text",
                "text": "File created successfully: /mnt/user-data/outputs/QUICK_REFERENCE.md",
                "uuid": "8c9cd537-e707-4577-8313-f03ad9289b72"
              }
            ],
            "is_error": false,
            "message": null,
            "integration_name": null,
            "integration_icon_url": null,
            "display_content": {
              "type": "text",
              "text": "File created successfully: /mnt/user-data/outputs/QUICK_REFERENCE.md"
            }
          },
          {
            "start_timestamp": null,
            "stop_timestamp": null,
            "flags": null,
            "type": "token_budget"
          },
          {
            "start_timestamp": "2025-11-06T12:05:01.603585Z",
            "stop_timestamp": "2025-11-06T12:05:02.447046Z",
            "flags": null,
            "type": "thinking",
            "thinking": "Perfect! Now let me create a final document that lists all the files I've created and provides a recommendation for what to do with the old files.",
            "summaries": [
              {
                "summary": "Synthesized documentation decisions and curated foundational reference materials."
              }
            ],
            "cut_off": false
          },
          {
            "start_timestamp": "2025-11-06T12:05:02.671762Z",
            "stop_timestamp": "2025-11-06T12:05:52.846324Z",
            "flags": null,
            "type": "tool_use",
            "name": "create_file",
            "input": {
              "path": "/mnt/user-data/outputs/MIGRATION_PLAN.md",
              "file_text": "# Documentation Migration Plan\n\n**Date:** November 6, 2025  \n**Action Required:** Reorganize your docs folder\n\n---\n\n## New Essential Documentation (7 files)\n\n### 📂 Keep in Root `/docs/`\n\n1. **START_HERE.md** 🆕\n   - Entry point for all developers\n   - Links to other docs\n   - Setup guide, file structure, common tasks\n\n2. **VALUES.md** ✅ (unchanged)\n   - Philosophical foundation\n   - The \"why\" behind everything\n\n3. **CORE_PRIMITIVES.md** 🆕 (replaces DATA_DICTIONARY.md)\n   - What exists today\n   - What you're building\n   - Database schema reality\n\n4. **SHARE_AND_VERIFY.md** 🆕 (replaces MVP_SHARE_SESSION_SPEC.md)\n   - Week-by-week implementation plan\n   - Current priority feature\n\n5. **DATABASE_REALITY.md** 🆕 (replaces SCHEMA_CLEANUP_PLAN.md)\n   - Schema contradictions\n   - SQL migration script\n   - Code update checklist\n\n6. **DESIGN_PHILOSOPHY.md** ✅ (unchanged)\n   - UI/UX principles\n   - Japanese woodworking aesthetic\n   - Component patterns\n\n7. **sarec-integration-guide.md** ✅ (unchanged)\n   - Assessment authoring\n   - Your differentiator\n\n### 📋 Optional But Helpful\n\n8. **QUICK_REFERENCE.md** 🆕\n   - Printable cheat sheet\n   - Keep visible while coding\n\n9. **CLEANUP_SUMMARY.md** 🆕\n   - Explains what changed and why\n   - Historical reference\n\n---\n\n## Old Documentation to Archive\n\n### 📦 Move to `/docs/archived/`\n\nThese had good thinking but are premature or solved:\n\n1. **CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md**\n   - Too abstract, too early\n   - Revisit after 3+ implementations\n\n2. **CP-1.0-VIEW-SPEC.md**\n   - Premature protocol work\n   - Current views work fine\n\n3. **ROUTE_ACTION_CONTRACT_V1_1.md**\n   - Over-engineered routing\n   - Simple routing works for now\n\n4. **ADR-001-TWO-PRIMITIVES.md**\n   - Good thinking, captured in CORE_PRIMITIVES.md\n   - Don't need full extension taxonomy\n\n5. **ADR-002-CONTEXT-ROLLUP-AGENCY.md**\n   - Overcomplicated feature\n   - Build simpler when needed\n\n6. **GPS_TRUST_MATRIX.md**\n   - Feature spec, not foundational\n   - Revisit when building GPS features\n\n7. **COLLABORATIVE-EDITING-SPEC.md**\n   - Feature spec, not foundational\n   - Revisit when building collaborative features\n\n8. **CONVIVIAL-DOMAIN-MODEL.md**\n   - Draft that never finished\n   - Core concepts captured elsewhere\n\n9. **003-paginated-documents-with-session-recording.md**\n   - Solved problem, already implemented\n   - Keep as historical ADR\n\n10. **MVP_SHARE_SESSION_SPEC.md** (original)\n    - Replaced by SHARE_AND_VERIFY.md\n    - Archive as reference\n\n11. **DATA_DICTIONARY.md** (original)\n    - Replaced by CORE_PRIMITIVES.md\n    - Archive as reference\n\n12. **SCHEMA_CLEANUP_PLAN.md** (original)\n    - Replaced by DATABASE_REALITY.md\n    - Archive as reference\n\n---\n\n## Proposed File Structure\n\n```\ndocs/\n│\n├─ START_HERE.md                    🆕 Read first\n├─ VALUES.md                        ✅ Foundation\n├─ CORE_PRIMITIVES.md               🆕 Data model\n├─ SHARE_AND_VERIFY.md              🆕 Current sprint\n├─ DATABASE_REALITY.md              🆕 Schema cleanup\n├─ DESIGN_PHILOSOPHY.md             ✅ UI/UX guide\n├─ sarec-integration-guide.md       ✅ Assessment\n│\n├─ QUICK_REFERENCE.md               📋 Cheat sheet\n├─ CLEANUP_SUMMARY.md               📋 What changed\n│\n└─ archived/\n   ├─ README.md                     (explain why archived)\n   │\n   ├─ protocol-exploration/\n   │  ├─ CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md\n   │  ├─ CP-1.0-VIEW-SPEC.md\n   │  └─ ROUTE_ACTION_CONTRACT_V1_1.md\n   │\n   ├─ architectural-decisions/\n   │  ├─ ADR-001-TWO-PRIMITIVES.md\n   │  ├─ ADR-002-CONTEXT-ROLLUP-AGENCY.md\n   │  └─ 003-paginated-documents-with-session-recording.md\n   │\n   ├─ feature-specs/\n   │  ├─ GPS_TRUST_MATRIX.md\n   │  └─ COLLABORATIVE-EDITING-SPEC.md\n   │\n   └─ replaced/\n      ├─ MVP_SHARE_SESSION_SPEC.md\n      ├─ DATA_DICTIONARY.md\n      ├─ SCHEMA_CLEANUP_PLAN.md\n      └─ CONVIVIAL-DOMAIN-MODEL.md\n```\n\n---\n\n## Migration Commands\n\n### Option A: Keep Archives Organized\n```bash\n# Create archive structure\nmkdir -p docs/archived/{protocol-exploration,architectural-decisions,feature-specs,replaced}\n\n# Move protocol exploration\nmv docs/CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md docs/archived/protocol-exploration/\nmv docs/CP-1.0-VIEW-SPEC.md docs/archived/protocol-exploration/\nmv docs/ROUTE_ACTION_CONTRACT_V1_1.md docs/archived/protocol-exploration/\n\n# Move ADRs\nmv docs/ADR-001-TWO-PRIMITIVES.md docs/archived/architectural-decisions/\nmv docs/ADR-002-CONTEXT-ROLLUP-AGENCY.md docs/archived/architectural-decisions/\nmv docs/003-paginated-documents-with-session-recording.md docs/archived/architectural-decisions/\n\n# Move feature specs\nmv docs/GPS_TRUST_MATRIX.md docs/archived/feature-specs/\nmv docs/COLLABORATIVE-EDITING-SPEC.md docs/archived/feature-specs/\n\n# Move replaced docs\nmv docs/MVP_SHARE_SESSION_SPEC.md docs/archived/replaced/\nmv docs/DATA_DICTIONARY.md docs/archived/replaced/\nmv docs/SCHEMA_CLEANUP_PLAN.md docs/archived/replaced/\nmv docs/CONVIVIAL-DOMAIN-MODEL.md docs/archived/replaced/\n\n# Add new docs (from /mnt/user-data/outputs/)\ncp /mnt/user-data/outputs/*.md docs/\n\n# Create archive README\ncat > docs/archived/README.md << 'EOF'\n# Archived Documentation\n\nThese documents contain good thinking but are not currently actionable:\n\n- **protocol-exploration/** - Premature protocol specs (revisit after 3+ implementations)\n- **architectural-decisions/** - ADRs for historical reference\n- **feature-specs/** - Feature ideas not yet implemented\n- **replaced/** - Superseded by newer, better docs\n\nSee `../CLEANUP_SUMMARY.md` for why each doc was archived.\nEOF\n```\n\n### Option B: Simple Archive\n```bash\n# Just move everything to archived/\nmkdir -p docs/archived\nmv docs/CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md docs/archived/\nmv docs/CP-1.0-VIEW-SPEC.md docs/archived/\n# ... etc for all archived docs\n\n# Add new docs\ncp /mnt/user-data/outputs/*.md docs/\n```\n\n### Option C: Delete Old Docs\n```bash\n# Remove archived docs entirely (still in git history)\nrm docs/CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md\nrm docs/CP-1.0-VIEW-SPEC.md\n# ... etc\n\n# Add new docs\ncp /mnt/user-data/outputs/*.md docs/\n\n# Note: Old docs still accessible via git:\n# git show HEAD~1:docs/CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md\n```\n\n---\n\n## Recommendation\n\n**Use Option A** (organized archives)\n\n**Why:**\n- Shows your thinking evolution\n- Easy to find when needed\n- Clear organization by type\n- Doesn't clutter main docs folder\n\n---\n\n## Update Links\n\nAfter migration, update any links in:\n\n### README.md (root)\n```markdown\n## Documentation\n\nStart here: [docs/START_HERE.md](docs/START_HERE.md)\n\nCore docs:\n- [Values](docs/VALUES.md) - Why we exist\n- [Core Primitives](docs/CORE_PRIMITIVES.md) - Data model\n- [Share & Verify](docs/SHARE_AND_VERIFY.md) - Current sprint\n- [Database Reality](docs/DATABASE_REALITY.md) - Schema cleanup\n\nReference:\n- [Design Philosophy](docs/DESIGN_PHILOSOPHY.md) - UI/UX\n- [SAREC Integration](docs/sarec-integration-guide.md) - Assessment\n- [Quick Reference](docs/QUICK_REFERENCE.md) - Cheat sheet\n```\n\n### Project Wiki (if exists)\nUpdate any links to old docs\n\n### Team Slack (if exists)\nPost update about new doc structure\n\n---\n\n## Communication Template\n\n```markdown\n## 📚 Documentation Overhaul\n\nWe've cleaned up our docs! Here's what changed:\n\n### New Structure (7 essential docs)\n1. **START_HERE.md** - New developer onboarding\n2. **VALUES.md** - Our foundation (unchanged)\n3. **CORE_PRIMITIVES.md** - Data model simplified\n4. **SHARE_AND_VERIFY.md** - Current sprint plan\n5. **DATABASE_REALITY.md** - Schema cleanup guide\n6. **DESIGN_PHILOSOPHY.md** - UI/UX principles (unchanged)\n7. **sarec-integration-guide.md** - Assessment system (unchanged)\n\n### What Got Archived\n- Protocol specs (too early)\n- Over-engineered routing specs\n- Feature specs not yet implemented\n- Replaced docs (superseded by better versions)\n\nSee `docs/CLEANUP_SUMMARY.md` for full rationale.\n\n### For New Developers\nRead `docs/START_HERE.md` first → 90 minute onboarding\n\n### For Current Team\n- Old bookmarks may be broken (check `docs/archived/`)\n- New docs are more practical and implementable\n- Less protocol theory, more \"here's what to build\"\n\nQuestions? Ask in #cursive-dev\n```\n\n---\n\n## Verification Checklist\n\nAfter migration:\n\n- [ ] All 7 essential docs in `/docs/`\n- [ ] Archived docs in `/docs/archived/` (or deleted)\n- [ ] Links in README.md updated\n- [ ] Team notified of changes\n- [ ] Old bookmarks redirected or updated\n- [ ] Wiki pages updated (if applicable)\n\n---\n\n## Benefits of This Cleanup\n\n### Before\n- 15+ documents\n- Hard to know what's real vs aspirational\n- Mixed protocol dreams with database reality\n- New developers overwhelmed\n\n### After\n- 7 essential documents\n- Clear current priorities\n- Practical implementation focus\n- New developers onboard in 90 minutes\n\n---\n\n## Timeline\n\n**Week 1:**\n- [ ] Day 1: Run migration commands\n- [ ] Day 2: Update README.md links\n- [ ] Day 3: Post team announcement\n- [ ] Day 4: Update Wiki/bookmarks\n- [ ] Day 5: Verify everything works\n\n---\n\n## Success Metrics\n\nYou'll know it worked when:\n\n1. ✅ New dev reads START_HERE → understands system in 90 min\n2. ✅ Team references SHARE_AND_VERIFY for current work\n3. ✅ No one asks \"what's the difference between X and Y?\"\n4. ✅ Schema cleanup happens within 1 month\n5. ✅ No one proposes \"federation\" before you have 3+ implementations\n\n---\n\n## Questions?\n\n- Read `docs/CLEANUP_SUMMARY.md` for full rationale\n- Ask in Slack #cursive-dev\n- Open GitHub issue with \"docs\" label\n\n---\n\n**Ready to migrate? Run the commands above and ship cleaner docs!** 🚀\n",
              "description": "Creating a migration guide for organizing the old and new documentation"
            },
            "message": "Creating a migration guide for organizing the old and new documentation",
            "integration_name": null,
            "integration_icon_url": null,
            "context": null,
            "display_content": {
              "type": "json_block",
              "json_block": "{\"language\": \"markdown\", \"code\": \"# Documentation Migration Plan\\n\\n**Date:** November 6, 2025  \\n**Action Required:** Reorganize your docs folder\\n\\n---\\n\\n## New Essential Documentation (7 files)\\n\\n### \\ud83d\\udcc2 Keep in Root `/docs/`\\n\\n1. **START_HERE.md** \\ud83c\\udd95\\n   - Entry point for all developers\\n   - Links to other docs\\n   - Setup guide, file structure, common tasks\\n\\n2. **VALUES.md** \\u2705 (unchanged)\\n   - Philosophical foundation\\n   - The \\\"why\\\" behind everything\\n\\n3. **CORE_PRIMITIVES.md** \\ud83c\\udd95 (replaces DATA_DICTIONARY.md)\\n   - What exists today\\n   - What you're building\\n   - Database schema reality\\n\\n4. **SHARE_AND_VERIFY.md** \\ud83c\\udd95 (replaces MVP_SHARE_SESSION_SPEC.md)\\n   - Week-by-week implementation plan\\n   - Current priority feature\\n\\n5. **DATABASE_REALITY.md** \\ud83c\\udd95 (replaces SCHEMA_CLEANUP_PLAN.md)\\n   - Schema contradictions\\n   - SQL migration script\\n   - Code update checklist\\n\\n6. **DESIGN_PHILOSOPHY.md** \\u2705 (unchanged)\\n   - UI/UX principles\\n   - Japanese woodworking aesthetic\\n   - Component patterns\\n\\n7. **sarec-integration-guide.md** \\u2705 (unchanged)\\n   - Assessment authoring\\n   - Your differentiator\\n\\n### \\ud83d\\udccb Optional But Helpful\\n\\n8. **QUICK_REFERENCE.md** \\ud83c\\udd95\\n   - Printable cheat sheet\\n   - Keep visible while coding\\n\\n9. **CLEANUP_SUMMARY.md** \\ud83c\\udd95\\n   - Explains what changed and why\\n   - Historical reference\\n\\n---\\n\\n## Old Documentation to Archive\\n\\n### \\ud83d\\udce6 Move to `/docs/archived/`\\n\\nThese had good thinking but are premature or solved:\\n\\n1. **CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md**\\n   - Too abstract, too early\\n   - Revisit after 3+ implementations\\n\\n2. **CP-1.0-VIEW-SPEC.md**\\n   - Premature protocol work\\n   - Current views work fine\\n\\n3. **ROUTE_ACTION_CONTRACT_V1_1.md**\\n   - Over-engineered routing\\n   - Simple routing works for now\\n\\n4. **ADR-001-TWO-PRIMITIVES.md**\\n   - Good thinking, captured in CORE_PRIMITIVES.md\\n   - Don't need full extension taxonomy\\n\\n5. **ADR-002-CONTEXT-ROLLUP-AGENCY.md**\\n   - Overcomplicated feature\\n   - Build simpler when needed\\n\\n6. **GPS_TRUST_MATRIX.md**\\n   - Feature spec, not foundational\\n   - Revisit when building GPS features\\n\\n7. **COLLABORATIVE-EDITING-SPEC.md**\\n   - Feature spec, not foundational\\n   - Revisit when building collaborative features\\n\\n8. **CONVIVIAL-DOMAIN-MODEL.md**\\n   - Draft that never finished\\n   - Core concepts captured elsewhere\\n\\n9. **003-paginated-documents-with-session-recording.md**\\n   - Solved problem, already implemented\\n   - Keep as historical ADR\\n\\n10. **MVP_SHARE_SESSION_SPEC.md** (original)\\n    - Replaced by SHARE_AND_VERIFY.md\\n    - Archive as reference\\n\\n11. **DATA_DICTIONARY.md** (original)\\n    - Replaced by CORE_PRIMITIVES.md\\n    - Archive as reference\\n\\n12. **SCHEMA_CLEANUP_PLAN.md** (original)\\n    - Replaced by DATABASE_REALITY.md\\n    - Archive as reference\\n\\n---\\n\\n## Proposed File Structure\\n\\n```\\ndocs/\\n\\u2502\\n\\u251c\\u2500 START_HERE.md                    \\ud83c\\udd95 Read first\\n\\u251c\\u2500 VALUES.md                        \\u2705 Foundation\\n\\u251c\\u2500 CORE_PRIMITIVES.md               \\ud83c\\udd95 Data model\\n\\u251c\\u2500 SHARE_AND_VERIFY.md              \\ud83c\\udd95 Current sprint\\n\\u251c\\u2500 DATABASE_REALITY.md              \\ud83c\\udd95 Schema cleanup\\n\\u251c\\u2500 DESIGN_PHILOSOPHY.md             \\u2705 UI/UX guide\\n\\u251c\\u2500 sarec-integration-guide.md       \\u2705 Assessment\\n\\u2502\\n\\u251c\\u2500 QUICK_REFERENCE.md               \\ud83d\\udccb Cheat sheet\\n\\u251c\\u2500 CLEANUP_SUMMARY.md               \\ud83d\\udccb What changed\\n\\u2502\\n\\u2514\\u2500 archived/\\n   \\u251c\\u2500 README.md                     (explain why archived)\\n   \\u2502\\n   \\u251c\\u2500 protocol-exploration/\\n   \\u2502  \\u251c\\u2500 CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md\\n   \\u2502  \\u251c\\u2500 CP-1.0-VIEW-SPEC.md\\n   \\u2502  \\u2514\\u2500 ROUTE_ACTION_CONTRACT_V1_1.md\\n   \\u2502\\n   \\u251c\\u2500 architectural-decisions/\\n   \\u2502  \\u251c\\u2500 ADR-001-TWO-PRIMITIVES.md\\n   \\u2502  \\u251c\\u2500 ADR-002-CONTEXT-ROLLUP-AGENCY.md\\n   \\u2502  \\u2514\\u2500 003-paginated-documents-with-session-recording.md\\n   \\u2502\\n   \\u251c\\u2500 feature-specs/\\n   \\u2502  \\u251c\\u2500 GPS_TRUST_MATRIX.md\\n   \\u2502  \\u2514\\u2500 COLLABORATIVE-EDITING-SPEC.md\\n   \\u2502\\n   \\u2514\\u2500 replaced/\\n      \\u251c\\u2500 MVP_SHARE_SESSION_SPEC.md\\n      \\u251c\\u2500 DATA_DICTIONARY.md\\n      \\u251c\\u2500 SCHEMA_CLEANUP_PLAN.md\\n      \\u2514\\u2500 CONVIVIAL-DOMAIN-MODEL.md\\n```\\n\\n---\\n\\n## Migration Commands\\n\\n### Option A: Keep Archives Organized\\n```bash\\n# Create archive structure\\nmkdir -p docs/archived/{protocol-exploration,architectural-decisions,feature-specs,replaced}\\n\\n# Move protocol exploration\\nmv docs/CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md docs/archived/protocol-exploration/\\nmv docs/CP-1.0-VIEW-SPEC.md docs/archived/protocol-exploration/\\nmv docs/ROUTE_ACTION_CONTRACT_V1_1.md docs/archived/protocol-exploration/\\n\\n# Move ADRs\\nmv docs/ADR-001-TWO-PRIMITIVES.md docs/archived/architectural-decisions/\\nmv docs/ADR-002-CONTEXT-ROLLUP-AGENCY.md docs/archived/architectural-decisions/\\nmv docs/003-paginated-documents-with-session-recording.md docs/archived/architectural-decisions/\\n\\n# Move feature specs\\nmv docs/GPS_TRUST_MATRIX.md docs/archived/feature-specs/\\nmv docs/COLLABORATIVE-EDITING-SPEC.md docs/archived/feature-specs/\\n\\n# Move replaced docs\\nmv docs/MVP_SHARE_SESSION_SPEC.md docs/archived/replaced/\\nmv docs/DATA_DICTIONARY.md docs/archived/replaced/\\nmv docs/SCHEMA_CLEANUP_PLAN.md docs/archived/replaced/\\nmv docs/CONVIVIAL-DOMAIN-MODEL.md docs/archived/replaced/\\n\\n# Add new docs (from /mnt/user-data/outputs/)\\ncp /mnt/user-data/outputs/*.md docs/\\n\\n# Create archive README\\ncat > docs/archived/README.md << 'EOF'\\n# Archived Documentation\\n\\nThese documents contain good thinking but are not currently actionable:\\n\\n- **protocol-exploration/** - Premature protocol specs (revisit after 3+ implementations)\\n- **architectural-decisions/** - ADRs for historical reference\\n- **feature-specs/** - Feature ideas not yet implemented\\n- **replaced/** - Superseded by newer, better docs\\n\\nSee `../CLEANUP_SUMMARY.md` for why each doc was archived.\\nEOF\\n```\\n\\n### Option B: Simple Archive\\n```bash\\n# Just move everything to archived/\\nmkdir -p docs/archived\\nmv docs/CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md docs/archived/\\nmv docs/CP-1.0-VIEW-SPEC.md docs/archived/\\n# ... etc for all archived docs\\n\\n# Add new docs\\ncp /mnt/user-data/outputs/*.md docs/\\n```\\n\\n### Option C: Delete Old Docs\\n```bash\\n# Remove archived docs entirely (still in git history)\\nrm docs/CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md\\nrm docs/CP-1.0-VIEW-SPEC.md\\n# ... etc\\n\\n# Add new docs\\ncp /mnt/user-data/outputs/*.md docs/\\n\\n# Note: Old docs still accessible via git:\\n# git show HEAD~1:docs/CURSIVE_PROTOCOL_SPECIFICATION_OUTLINE.md\\n```\\n\\n---\\n\\n## Recommendation\\n\\n**Use Option A** (organized archives)\\n\\n**Why:**\\n- Shows your thinking evolution\\n- Easy to find when needed\\n- Clear organization by type\\n- Doesn't clutter main docs folder\\n\\n---\\n\\n## Update Links\\n\\nAfter migration, update any links in:\\n\\n### README.md (root)\\n```markdown\\n## Documentation\\n\\nStart here: [docs/START_HERE.md](docs/START_HERE.md)\\n\\nCore docs:\\n- [Values](docs/VALUES.md) - Why we exist\\n- [Core Primitives](docs/CORE_PRIMITIVES.md) - Data model\\n- [Share & Verify](docs/SHARE_AND_VERIFY.md) - Current sprint\\n- [Database Reality](docs/DATABASE_REALITY.md) - Schema cleanup\\n\\nReference:\\n- [Design Philosophy](docs/DESIGN_PHILOSOPHY.md) - UI/UX\\n- [SAREC Integration](docs/sarec-integration-guide.md) - Assessment\\n- [Quick Reference](docs/QUICK_REFERENCE.md) - Cheat sheet\\n```\\n\\n### Project Wiki (if exists)\\nUpdate any links to old docs\\n\\n### Team Slack (if exists)\\nPost update about new doc structure\\n\\n---\\n\\n## Communication Template\\n\\n```markdown\\n## \\ud83d\\udcda Documentation Overhaul\\n\\nWe've cleaned up our docs! Here's what changed:\\n\\n### New Structure (7 essential docs)\\n1. **START_HERE.md** - New developer onboarding\\n2. **VALUES.md** - Our foundation (unchanged)\\n3. **CORE_PRIMITIVES.md** - Data model simplified\\n4. **SHARE_AND_VERIFY.md** - Current sprint plan\\n5. **DATABASE_REALITY.md** - Schema cleanup guide\\n6. **DESIGN_PHILOSOPHY.md** - UI/UX principles (unchanged)\\n7. **sarec-integration-guide.md** - Assessment system (unchanged)\\n\\n### What Got Archived\\n- Protocol specs (too early)\\n- Over-engineered routing specs\\n- Feature specs not yet implemented\\n- Replaced docs (superseded by better versions)\\n\\nSee `docs/CLEANUP_SUMMARY.md` for full rationale.\\n\\n### For New Developers\\nRead `docs/START_HERE.md` first \\u2192 90 minute onboarding\\n\\n### For Current Team\\n- Old bookmarks may be broken (check `docs/archived/`)\\n- New docs are more practical and implementable\\n- Less protocol theory, more \\\"here's what to build\\\"\\n\\nQuestions? Ask in #cursive-dev\\n```\\n\\n---\\n\\n## Verification Checklist\\n\\nAfter migration:\\n\\n- [ ] All 7 essential docs in `/docs/`\\n- [ ] Archived docs in `/docs/archived/` (or deleted)\\n- [ ] Links in README.md updated\\n- [ ] Team notified of changes\\n- [ ] Old bookmarks redirected or updated\\n- [ ] Wiki pages updated (if applicable)\\n\\n---\\n\\n## Benefits of This Cleanup\\n\\n### Before\\n- 15+ documents\\n- Hard to know what's real vs aspirational\\n- Mixed protocol dreams with database reality\\n- New developers overwhelmed\\n\\n### After\\n- 7 essential documents\\n- Clear current priorities\\n- Practical implementation focus\\n- New developers onboard in 90 minutes\\n\\n---\\n\\n## Timeline\\n\\n**Week 1:**\\n- [ ] Day 1: Run migration commands\\n- [ ] Day 2: Update README.md links\\n- [ ] Day 3: Post team announcement\\n- [ ] Day 4: Update Wiki/bookmarks\\n- [ ] Day 5: Verify everything works\\n\\n---\\n\\n## Success Metrics\\n\\nYou'll know it worked when:\\n\\n1. \\u2705 New dev reads START_HERE \\u2192 understands system in 90 min\\n2. \\u2705 Team references SHARE_AND_VERIFY for current work\\n3. \\u2705 No one asks \\\"what's the difference between X and Y?\\\"\\n4. \\u2705 Schema cleanup happens within 1 month\\n5. \\u2705 No one proposes \\\"federation\\\" before you have 3+ implementations\\n\\n---\\n\\n## Questions?\\n\\n- Read `docs/CLEANUP_SUMMARY.md` for full rationale\\n- Ask in Slack #cursive-dev\\n- Open GitHub issue with \\\"docs\\\" label\\n\\n---\\n\\n**Ready to migrate? Run the commands above and ship cleaner docs!** \\ud83d\\ude80\\n\", \"filename\": \"/mnt/user-data/outputs/MIGRATION_PLAN.md\"}"
            },
            "approval_options": null,
            "approval_key": null
          },
          {
            "start_timestamp": null,
            "stop_timestamp": null,
            "flags": null,
            "type": "tool_result",
            "name": "create_file",
            "content": [
              {
                "type": "text",
                "text": "File created successfully: /mnt/user-data/outputs/MIGRATION_PLAN.md",
                "uuid": "d20a00a7-ec2a-4e1f-8d9a-a0619511f7c7"
              }
            ],
            "is_error": false,
            "message": null,
            "integration_name": null,
            "integration_icon_url": null,
            "display_content": {
              "type": "text",
              "text": "File created successfully: /mnt/user-data/outputs/MIGRATION_PLAN.md"
            }
          },
          {
            "start_timestamp": null,
            "stop_timestamp": null,
            "flags": null,
            "type": "token_budget"
          },
          {
            "start_timestamp": "2025-11-06T12:05:56.363316Z",
            "stop_timestamp": "2025-11-06T12:05:56.896497Z",
            "flags": null,
            "type": "thinking",
            "thinking": "Perfect! Now let me create a final summary view of what I've delivered and provide links to all the documents.",
            "summaries": [
              {
                "summary": "Synthesized documentation strategy for protocol and reference app."
              }
            ],
            "cut_off": false
          },
          {
            "start_timestamp": "2025-11-06T12:05:56.952246Z",
            "stop_timestamp": "2025-11-06T12:06:12.957772Z",
            "flags": null,
            "type": "text",
            "text": "Perfect! I've completely reorganized your documentation. Here's what you now have:\n\n## 📦 Your New Documentation (7 Essential Files)\n\n### [START_HERE.md](computer:///mnt/user-data/outputs/START_HERE.md)\n**Your new entry point.** 90-minute onboarding guide with setup instructions, file structure, common tasks, and links to everything else.\n\n### [CORE_PRIMITIVES.md](computer:///mnt/user-data/outputs/CORE_PRIMITIVES.md)\n**Replaces DATA_DICTIONARY.** Shows what actually exists in your database today, what you're building right now, and what you're NOT building yet. No protocol fantasies - just reality.\n\n### [SHARE_AND_VERIFY.md](computer:///mnt/user-data/outputs/SHARE_AND_VERIFY.md)\n**Replaces MVP_SHARE_SESSION_SPEC.** Your 4-week implementation plan with actual code examples, the fingerprint algorithm explained clearly, and concrete testing checklists.\n\n### [DATABASE_REALITY.md](computer:///mnt/user-data/outputs/DATABASE_REALITY.md)\n**Replaces SCHEMA_CLEANUP_PLAN.** The 5 real contradictions in your schema, runnable SQL to fix them, and a 3-week code migration checklist. Surgical, not demolition.\n\n### [QUICK_REFERENCE.md](computer:///mnt/user-data/outputs/QUICK_REFERENCE.md)\n**Bonus cheat sheet.** Print this, keep it visible while coding. All the key patterns, commands, and rules on one page.\n\n### Plus Documentation Guides\n\n**[CLEANUP_SUMMARY.md](computer:///mnt/user-data/outputs/CLEANUP_SUMMARY.md)** - Explains what changed and why\n\n**[MIGRATION_PLAN.md](computer:///mnt/user-data/outputs/MIGRATION_PLAN.md)** - Step-by-step commands to reorganize your docs folder\n\n---\n\n## What I Kept Unchanged ✅\n\n- **VALUES.md** - Your philosophical foundation is solid\n- **DESIGN_PHILOSOPHY.md** - Japanese woodworking aesthetic, still relevant\n- **sarec-integration-guide.md** - Your differentiator, pure gold\n\n---\n\n## What I Removed ❌\n\n**12 documents** that were either:\n- Premature protocol abstraction (CP-1.0-CPL, CSA, CTP, etc.)\n- Over-engineered features (Route Action Contract v1.1)\n- Solved problems (ADR-003 pagination)\n- Unfinished drafts (Convivial Domain Model)\n\nAll the good thinking is captured in the new docs - just without the noise.\n\n---\n\n## Key Improvements\n\n**Before:** \"Here's how the protocol COULD work across implementations\"  \n**After:** \"Here's what exists today and what we're building this week\"\n\n**Before:** 15+ documents, hard to know what's real  \n**After:** 7 documents, clear current priorities\n\n**Before:** New developers overwhelmed  \n**After:** 90-minute onboarding via START_HERE.md\n\n---\n\n## Next Steps\n\n1. Read [MIGRATION_PLAN.md](computer:///mnt/user-data/outputs/MIGRATION_PLAN.md) for commands to reorganize your docs folder\n2. Archive or delete the 12 old documents (your choice)\n3. Update README.md to link to START_HERE.md\n4. Start implementing [SHARE_AND_VERIFY.md](computer:///mnt/user-data/outputs/SHARE_AND_VERIFY.md) - your Week 1 begins with SharePageDialog\n\n**No more protocol theory. No more premature abstraction. Just clear, practical docs for what you're building right now.**",
            "citations": []
          }
        ],
        "updated_at": "2025-11-06T12:06:13.282647Z",
        "attachments": [],
        "files": []
      }
    },
    {
      "id": "019a591d-2e54-77d0-bf39-412a9fcc9820",
      "role": "human",
      "content": "what about this? Done. I reset everything into a single crisp doc: “Cursive v0 Core — Protocol & Reference App (Reset Edition)” on the canvas.\nHighlights:\n* Hard line between Protocol (CP-0.1) and Reference App.\n* No sections, no guide_pages, no notebooks. Just Collection → Folder → Page.\n* CPL (page JSON) + CHL (mail/invitation/letter/share JSON) as the only protocol artifacts; notifications are implementation detail.\n* Minimal Postgres schema + REST surface you can ship today.\n* ADRs that lock the decisions we just made.\nIf you want, I can now:\n* Generate a fresh SQL file from that schema,\n* Stub the /api/ routes,\n* Or add a tiny conformance test pack.\nWhich one should I knock out first? - can we get a version that's just the documentation for the protocol rather than the reference implementaiton? I sort of am imagining this is the next thing for the internet after https and html and css and javascript and then something about context and curation (html structure, css look, js interactivity, our thing... meaning/axiology/purpose/context,etc?)",
      "created_at": "2025-11-06T12:21:16.019620Z",
      "sequence_order": 2,
      "metadata": {
        "content": [
          {
            "start_timestamp": "2025-11-06T12:21:15.989571Z",
            "stop_timestamp": "2025-11-06T12:21:15.989571Z",
            "flags": null,
            "type": "text",
            "text": "what about this? Done. I reset everything into a single crisp doc: “Cursive v0 Core — Protocol & Reference App (Reset Edition)” on the canvas.\nHighlights:\n* Hard line between Protocol (CP-0.1) and Reference App.\n* No sections, no guide_pages, no notebooks. Just Collection → Folder → Page.\n* CPL (page JSON) + CHL (mail/invitation/letter/share JSON) as the only protocol artifacts; notifications are implementation detail.\n* Minimal Postgres schema + REST surface you can ship today.\n* ADRs that lock the decisions we just made.\nIf you want, I can now:\n* Generate a fresh SQL file from that schema,\n* Stub the /api/ routes,\n* Or add a tiny conformance test pack.\nWhich one should I knock out first? - can we get a version that's just the documentation for the protocol rather than the reference implementaiton? I sort of am imagining this is the next thing for the internet after https and html and css and javascript and then something about context and curation (html structure, css look, js interactivity, our thing... meaning/axiology/purpose/context,etc?)",
            "citations": []
          }
        ],
        "updated_at": "2025-11-06T12:21:16.019620Z",
        "attachments": [],
        "files": []
      }
    },
    {
      "id": "019a591d-2e54-77d0-bf39-412bc10cb30f",
      "role": "assistant",
      "content": "Oh, this is interesting. The user has created a \"reset\" document that draws a hard line between Protocol (CP-0.1) and Reference App. They want to extract just the protocol part - not the reference implementation.\n\nThey're thinking about this as a fundamental internet protocol - like HTTP, HTML, CSS, JS are layers of the web stack. They see Cursive Protocol as the next layer: meaning/axiology/purpose/context.\n\nThat's actually quite profound. They want:\n- Just the protocol spec (what must be standardized)\n- Separate from how they happen to implement it\n- Think of it as a standard like HTTP/HTML\n\nSo I should create a clean protocol-only document that:\n1. Defines the data formats (CPL for pages, CHL for correspondence)\n2. Defines the minimal contracts for interoperability\n3. Says nothing about Supabase, Next.js, etc.\n4. Is implementation-agnostic\n5. Could be implemented in any language/framework\n\nThis is different from my cleanup which was \"here's what exists in YOUR reference app.\" They want \"here's the protocol that ANYONE could implement.\"\n\nLet me create that. It should feel like reading the HTTP spec or the HTML5 spec.Ah, I see what you're after. You want the **protocol specification** separate from \"here's how we implement it in Supabase/Next.js.\"\n\nYou're thinking of Cursive Protocol as a fundamental layer - like HTTP is transport, HTML is structure, CSS is presentation, JS is behavior... and **Cursive Protocol is context/meaning/provenance/humanity**.\n\nLet me extract just the protocol - the contracts any implementation must honor:\n```\nThis block is not supported on your current device yet.\n```\n\n",
      "created_at": "2025-11-06T12:22:57.952014Z",
      "sequence_order": 3,
      "metadata": {
        "content": [
          {
            "start_timestamp": "2025-11-06T12:21:20.513062Z",
            "stop_timestamp": "2025-11-06T12:21:27.729879Z",
            "flags": null,
            "type": "thinking",
            "thinking": "Oh, this is interesting. The user has created a \"reset\" document that draws a hard line between Protocol (CP-0.1) and Reference App. They want to extract just the protocol part - not the reference implementation.\n\nThey're thinking about this as a fundamental internet protocol - like HTTP, HTML, CSS, JS are layers of the web stack. They see Cursive Protocol as the next layer: meaning/axiology/purpose/context.\n\nThat's actually quite profound. They want:\n- Just the protocol spec (what must be standardized)\n- Separate from how they happen to implement it\n- Think of it as a standard like HTTP/HTML\n\nSo I should create a clean protocol-only document that:\n1. Defines the data formats (CPL for pages, CHL for correspondence)\n2. Defines the minimal contracts for interoperability\n3. Says nothing about Supabase, Next.js, etc.\n4. Is implementation-agnostic\n5. Could be implemented in any language/framework\n\nThis is different from my cleanup which was \"here's what exists in YOUR reference app.\" They want \"here's the protocol that ANYONE could implement.\"\n\nLet me create that. It should feel like reading the HTTP spec or the HTML5 spec.",
            "summaries": [
              {
                "summary": "Thinking about separating protocol documentation from reference implementation and positioning it as foundational internet infrastructure."
              },
              {
                "summary": "Parsing protocol extraction from reference implementation architecture."
              },
              {
                "summary": "Recognized protocol-as-standard vision, distinguished specification from implementation."
              }
            ],
            "cut_off": false
          },
          {
            "start_timestamp": "2025-11-06T12:21:27.749849Z",
            "stop_timestamp": "2025-11-06T12:21:30.501132Z",
            "flags": null,
            "type": "text",
            "text": "Ah, I see what you're after. You want the **protocol specification** separate from \"here's how we implement it in Supabase/Next.js.\"\n\nYou're thinking of Cursive Protocol as a fundamental layer - like HTTP is transport, HTML is structure, CSS is presentation, JS is behavior... and **Cursive Protocol is context/meaning/provenance/humanity**.\n\nLet me extract just the protocol - the contracts any implementation must honor:",
            "citations": []
          },
          {
            "start_timestamp": "2025-11-06T12:21:30.723892Z",
            "stop_timestamp": "2025-11-06T12:22:53.514007Z",
            "flags": null,
            "type": "tool_use",
            "name": "create_file",
            "input": {
              "path": "/mnt/user-data/outputs/CURSIVE_PROTOCOL_v0.1.md",
              "file_text": "# Cursive Protocol v0.1\n\n**Status:** Draft Specification  \n**Date:** November 6, 2025  \n**Purpose:** Define the minimal contracts for human-authored content systems\n\n---\n\n## Abstract\n\nCursive Protocol (CP) is an open standard for systems that prioritize human authorship, verifiable craft, and semantic context over engagement metrics. It defines two core data formats (CPL and CHL) and a minimal set of contracts that enable interoperability between implementations.\n\n**Core principle:** If content cannot prove its human origin, it should be clearly marked as synthetic.\n\n---\n\n## Design Philosophy\n\n### What Cursive Protocol Is\n\nA **specification layer** for the internet that adds:\n- **Provenance:** Who made this, when, how?\n- **Context:** What does this mean, where does it belong?\n- **Humanity:** Is this human-authored or AI-generated?\n- **Sovereignty:** Can the author export and move their work?\n\n### The Stack Metaphor\n\n```\nHTTP       → Transport (how bits move)\nHTML       → Structure (what elements exist)\nCSS        → Presentation (how it looks)\nJavaScript → Behavior (what it does)\n───────────────────────────────────────\nCursive    → Context (what it means, who made it, why it matters)\n```\n\n### What Cursive Protocol Is Not\n\n- ❌ A database schema (implementations choose their own storage)\n- ❌ A UI framework (implementations design their own interfaces)\n- ❌ A specific tech stack (can be built in any language)\n- ❌ A centralized platform (federated, exportable, sovereign)\n\n---\n\n## Core Primitives\n\n### 1. Collection\nA **container for pages** representing a journal, workspace, or guide.\n\n**Metaphor:** A bound notebook or filing cabinet\n\n**Minimum required:**\n- Unique identifier\n- Owner identifier\n- Title\n\n### 2. Folder\n**Optional organization** within a collection.\n\n**Metaphor:** Divider tabs in a notebook\n\n**Minimum required:**\n- Unique identifier\n- Parent collection identifier\n- Can nest (optional)\n\n### 3. Page\nThe **sacred primitive** - human-authored document.\n\n**Metaphor:** A sheet of paper\n\n**Minimum required:**\n- Unique identifier\n- Content (see CPL format below)\n- Authorship provenance\n- Parent folder/collection identifier\n\n---\n\n## CPL: Cursive Page Language\n\n**Version:** 0.1  \n**Format:** JSON  \n**Purpose:** Represent human-authored pages with provenance\n\n### Minimal Valid Page\n\n```json\n{\n  \"cursive\": \"0.1\",\n  \"type\": \"page\",\n  \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"content\": {\n    \"type\": \"doc\",\n    \"content\": []\n  },\n  \"provenance\": {\n    \"author\": \"user@example.com\",\n    \"created_at\": \"2025-11-06T10:00:00Z\",\n    \"origin\": \"human\"\n  }\n}\n```\n\n### Content Format\n\n**Base:** TipTap-compatible JSON (ProseMirror schema)\n\n**Standard blocks:**\n- `paragraph`\n- `heading` (levels 1-6)\n- `blockquote`\n- `code_block`\n- `bullet_list` / `ordered_list`\n- `image` (with source attribution)\n\n**Cursive-specific blocks:**\n- `drawing` - Ink strokes (vector paths)\n- `transclude` - Reference to another page\n\n### Provenance (Required)\n\n```json\n{\n  \"provenance\": {\n    \"author\": \"user@example.com\",        // REQUIRED\n    \"created_at\": \"2025-11-06T10:00:00Z\", // REQUIRED\n    \"updated_at\": \"2025-11-06T11:30:00Z\", // If edited\n    \"origin\": \"human\",                    // \"human\" | \"ai-assisted\" | \"synthetic\"\n    \n    // Optional process fingerprint\n    \"fingerprint\": {\n      \"hash\": \"sha256:abc123...\",\n      \"confidence\": 94,                   // 0-100 score\n      \"evidence\": {\n        \"stroke_count\": 312,\n        \"revision_count\": 23,\n        \"active_duration_ms\": 2820000,\n        \"temporal_markers\": [...]\n      }\n    }\n  }\n}\n```\n\n**Key contract:** \n- `origin: \"human\"` requires `fingerprint` with `confidence >= 70`\n- `origin: \"ai-assisted\"` must include `ai_tool_id` and `ratified_at`\n- `origin: \"synthetic\"` must clearly mark AI-generated content\n\n### Drawing Block\n\n```json\n{\n  \"type\": \"drawing\",\n  \"attrs\": {\n    \"strokes\": [\n      {\n        \"points\": [[x, y, pressure], ...],\n        \"color\": \"#000000\",\n        \"width\": 2,\n        \"timestamp_ms\": 1234\n      }\n    ],\n    \"width\": 800,\n    \"height\": 600\n  }\n}\n```\n\n**Why strokes include timestamps:** Enables stroke variance analysis for human verification.\n\n### Transclusion Block\n\n```json\n{\n  \"type\": \"transclude\",\n  \"attrs\": {\n    \"source\": \"page:550e8400-e29b-41d4-a716-446655440001\",\n    \"excerpt\": true,          // Show preview vs full content\n    \"editable\": false         // Can viewer edit inline?\n  }\n}\n```\n\n---\n\n## CHL: Cursive Hospitality Language\n\n**Version:** 0.1  \n**Format:** JSON  \n**Purpose:** Represent correspondence, invitations, and shares\n\n### Types of Hospitality Actions\n\n1. **Letter** - Human-to-human correspondence\n2. **Invitation** - Timed prompt to engage with content\n3. **Share** - Grant access to a page/collection\n4. **Gift** - Transfer ownership of content\n\n### Minimal Valid Invitation\n\n```json\n{\n  \"cursive\": \"0.1\",\n  \"type\": \"invitation\",\n  \"id\": \"660e8400-e29b-41d4-a716-446655440000\",\n  \n  \"from\": \"host@example.com\",\n  \"to\": [\"participant1@example.com\", \"participant2@example.com\"],\n  \n  \"content\": {\n    \"title\": \"Week 1: Introduction\",\n    \"body\": \"Welcome to the course. Please complete...\",\n    \"target\": \"page:550e8400-e29b-41d4-a716-446655440002\"\n  },\n  \n  \"timing\": {\n    \"scheduled_for\": \"2025-11-08T09:00:00Z\",\n    \"expires_at\": \"2025-11-15T23:59:59Z\"\n  },\n  \n  \"provenance\": {\n    \"author\": \"host@example.com\",\n    \"created_at\": \"2025-11-06T10:00:00Z\",\n    \"origin\": \"human\"\n  }\n}\n```\n\n**Key contracts:**\n- All hospitality actions require `provenance.origin = \"human\"`\n- Invitations cannot be auto-sent without explicit host action\n- Recipients can always decline/unsubscribe\n\n---\n\n## Export Format\n\n**File extension:** `.cursive`  \n**Structure:** ZIP archive\n\n### Manifest\n\n```json\n{\n  \"cursive\": \"0.1\",\n  \"export_type\": \"collection\",\n  \"exported_at\": \"2025-11-06T12:00:00Z\",\n  \"exported_by\": \"user@example.com\",\n  \n  \"contents\": {\n    \"collection\": \"collection.json\",\n    \"pages\": [\"pages/page-1.json\", \"pages/page-2.json\"],\n    \"fingerprints\": [\"proofs/page-1-proof.json\"]\n  }\n}\n```\n\n### Directory Structure\n\n```\nmy-work.cursive/  (ZIP)\n├─ manifest.json\n├─ collection.json\n├─ pages/\n│  ├─ page-1.json\n│  └─ page-2.json\n└─ proofs/\n   └─ page-1-proof.json\n```\n\n**Contract:** Any CP-compliant system can import this archive and reconstruct the collection with full provenance.\n\n---\n\n## Verification Protocol\n\n### Human Fingerprint Algorithm\n\n**Purpose:** Distinguish human-created content from AI-generated or pasted content.\n\n**Signals used:**\n1. **Stroke timing variance** (200-800ms = human, <50ms = synthetic)\n2. **Idle gaps** (5+ second pauses = thinking, none = robotic)\n3. **Revision patterns** (5-20% corrections = human, <1% = too perfect)\n4. **Temporal inconsistency** (speed varies = human, constant = synthetic)\n\n**Output:** Confidence score 0-100\n\n**Contract:**\n```json\n{\n  \"fingerprint\": {\n    \"hash\": \"sha256:...\",           // Hash of all events\n    \"confidence\": 94,               // 0-100\n    \"algorithm\": \"cp-fingerprint-v1\",\n    \"evidence\": {\n      \"stroke_count\": 312,\n      \"stroke_variance_ms\": 450,    // Within human range\n      \"long_pauses\": 7,             // 7 thinking pauses\n      \"correction_rate\": 0.074      // 7.4% revision rate\n    }\n  }\n}\n```\n\n**Badge display rule:** Show \"✓ Human-made\" badge when `confidence >= 70`\n\n---\n\n## REST API Surface (Minimal)\n\n### Collections\n\n```\nGET    /api/collections/{id}           # Retrieve collection metadata\nPOST   /api/collections                # Create new collection\nDELETE /api/collections/{id}           # Archive collection\nGET    /api/collections/{id}/export    # Export as .cursive archive\n```\n\n### Pages\n\n```\nGET    /api/pages/{id}                 # Retrieve page (CPL format)\nPOST   /api/pages                      # Create new page\nPUT    /api/pages/{id}                 # Update page content\nDELETE /api/pages/{id}                 # Archive page\nGET    /api/pages/{id}/fingerprint     # Get verification proof\n```\n\n### Hospitality\n\n```\nGET    /api/invitations/{id}           # Retrieve invitation (CHL format)\nPOST   /api/invitations                # Create invitation (requires human auth)\nGET    /api/invitations/{id}/responses # Get responses\n```\n\n**Authentication contract:** All write operations require authenticated human user. No automated writes to pages.\n\n---\n\n## Federation Protocol (Future)\n\n### Canonical Identifiers\n\nUsers have global identifiers: `username@instance.com`\n\nPages have URIs: `cursive://instance.com/collections/{id}/pages/{id}`\n\n### Cross-Instance References\n\n```json\n{\n  \"type\": \"transclude\",\n  \"attrs\": {\n    \"source\": \"cursive://university.edu/collections/abc/pages/123\",\n    \"author\": \"professor@university.edu\",\n    \"consent_given\": true\n  }\n}\n```\n\n**Contract:** Host instance must verify consent before rendering cross-instance transclusions.\n\n---\n\n## Compliance Levels\n\n### Level 1: Core (MUST)\n- ✅ Support CPL page format\n- ✅ Preserve provenance metadata\n- ✅ Export to `.cursive` archives\n- ✅ Display origin badges (human vs AI)\n\n### Level 2: Hospitality (SHOULD)\n- ✅ Support CHL invitation format\n- ✅ Require human action for sending\n- ✅ Allow recipient unsubscribe\n\n### Level 3: Verification (SHOULD)\n- ✅ Calculate human fingerprints\n- ✅ Display confidence scores\n- ✅ Store process evidence\n\n### Level 4: Federation (MAY)\n- ✅ Support cross-instance transclusions\n- ✅ Canonical user identifiers\n- ✅ Consent verification\n\n---\n\n## Design Constraints\n\n### Non-Negotiable Rules\n\n1. **Human Agency**\n   - No AI writes directly to page content\n   - Suggestions must be explicitly ratified by humans\n   - Users can always see what was suggested vs what they wrote\n\n2. **Provenance Preservation**\n   - Every page includes `provenance.origin`\n   - Fingerprints cannot be faked (timestamped events)\n   - Process evidence travels with exports\n\n3. **Sovereign Ownership**\n   - Users can export everything they create\n   - Exports include full provenance\n   - No vendor lock-in (portable to any CP system)\n\n4. **Hospitality Over Automation**\n   - Invitations require explicit host action\n   - No algorithmic feeds or auto-posting\n   - Recipients can always decline\n\n5. **Transparent Verification**\n   - Fingerprint algorithms are open\n   - Confidence scores are always shown\n   - Users can contest AI-generated labels\n\n---\n\n## Reference Implementations\n\n### Compliant Systems\n\nA system is **CP-0.1 compliant** if it:\n1. Can import/export `.cursive` archives\n2. Preserves `provenance` metadata\n3. Displays origin badges correctly\n4. Requires human action for content creation\n\n### Test Suite (Future)\n\n```bash\ncursive-protocol-test --level core ./my-implementation\ncursive-protocol-test --level hospitality ./my-implementation\n```\n\n---\n\n## Versioning\n\n### Current: v0.1 (Draft)\n- CPL page format\n- CHL invitation format\n- Export manifest\n- Fingerprint algorithm\n\n### Planned: v0.2\n- Federation protocol\n- Cross-instance consent\n- Canonical identifiers\n\n### Planned: v1.0\n- Finalized specs\n- Compliance test suite\n- Multiple reference implementations\n\n---\n\n## Governance\n\n### Specification Process\n\n1. **Proposal** - GitHub issue or RFC\n2. **Discussion** - Community feedback\n3. **Draft** - Specification document\n4. **Implementation** - Reference implementation\n5. **Finalized** - Version number assigned\n\n### Backwards Compatibility\n\n- Breaking changes require major version bump\n- Implementations should support N-1 versions\n- Export format includes version number\n\n---\n\n## Security Considerations\n\n### Fingerprint Spoofing\n\n**Attack:** Generate synthetic content with fake timestamps\n\n**Mitigation:**\n- Use cryptographic signatures\n- Require device attestation (optional)\n- Cross-reference multiple sessions\n- Human verification as fallback\n\n### Cross-Site Transclusion\n\n**Attack:** Embed malicious content via transclusion\n\n**Mitigation:**\n- Require explicit consent\n- Sandbox transcluded content\n- Show clear attribution\n- Allow blocking by domain\n\n### Privacy\n\n**Concern:** Process fingerprints reveal too much\n\n**Mitigation:**\n- User controls fingerprint visibility\n- Can share page without process data\n- Coarse timestamps (minute-level, not millisecond)\n- Aggregated metrics only\n\n---\n\n## Philosophical Foundation\n\n### Why This Protocol Exists\n\nIn an age of:\n- Effortless AI content generation\n- Engagement-optimized platforms\n- Algorithmic feeds and dark patterns\n- Unclear authorship and provenance\n\nWe need a protocol that:\n- Proves human authorship\n- Preserves process and craft\n- Respects user sovereignty\n- Prioritizes meaning over metrics\n\n### Core Values\n\n1. **Qualitative over Quantitative** - Experience > engagement metrics\n2. **Embodied over Abstract** - Bodies, places, hands matter\n3. **Competence over Automation** - Tools scaffold skill, don't replace it\n4. **Hospitality over Hostility** - Human hosts, not algorithms\n5. **Craft over Convenience** - Process as proof, effort as value\n6. **Sovereignty over Captivity** - Export everything, move anywhere\n\n---\n\n## FAQ\n\n### Q: Why not use ActivityPub?\n**A:** ActivityPub is for social networking. Cursive Protocol is for human-authored content with verifiable provenance. Different concerns.\n\n### Q: Why not blockchain/web3?\n**A:** Cursive works with or without blockchain. Provenance is cryptographic but doesn't require distributed ledger. Can add later.\n\n### Q: Can AI use Cursive Protocol?\n**A:** Yes, but AI-generated content must be marked `origin: \"synthetic\"`. The protocol is neutral but transparent.\n\n### Q: Is this anti-AI?\n**A:** No. It's pro-human. AI can assist (marked `ai-assisted`), but cannot autonomously author pages marked `human`.\n\n### Q: Who owns this protocol?\n**A:** It's open. Like HTTP or HTML, anyone can implement. Specification is MIT licensed.\n\n---\n\n## Conformance Statement\n\nAn implementation claiming **Cursive Protocol v0.1 compliance** MUST:\n\n1. Support CPL page format (JSON)\n2. Include provenance metadata on all pages\n3. Export to `.cursive` archive format\n4. Display origin badges (human/ai-assisted/synthetic)\n5. Require human authentication for page creation\n6. Preserve fingerprint evidence (if Level 3)\n\nAn implementation MAY additionally:\n- Support CHL hospitality format\n- Calculate human fingerprints\n- Enable federation (future)\n- Add custom block types (namespaced)\n\n---\n\n## License\n\nCursive Protocol Specification: **CC0 1.0 Universal (Public Domain)**\n\nReference implementations may use any license.\n\n---\n\n## Contact\n\n- **Specification:** github.com/cursive-protocol/spec\n- **Discussion:** github.com/cursive-protocol/spec/discussions\n- **Reference App:** (separate repository)\n\n---\n\n**This is Cursive Protocol v0.1. A protocol for humanity on the internet.**\n",
              "description": "Creating pure protocol specification document - implementation-agnostic"
            },
            "message": "Creating pure protocol specification document - implementation-agnostic",
            "integration_name": null,
            "integration_icon_url": null,
            "context": null,
            "display_content": {
              "type": "json_block",
              "json_block": "{\"language\": \"markdown\", \"code\": \"# Cursive Protocol v0.1\\n\\n**Status:** Draft Specification  \\n**Date:** November 6, 2025  \\n**Purpose:** Define the minimal contracts for human-authored content systems\\n\\n---\\n\\n## Abstract\\n\\nCursive Protocol (CP) is an open standard for systems that prioritize human authorship, verifiable craft, and semantic context over engagement metrics. It defines two core data formats (CPL and CHL) and a minimal set of contracts that enable interoperability between implementations.\\n\\n**Core principle:** If content cannot prove its human origin, it should be clearly marked as synthetic.\\n\\n---\\n\\n## Design Philosophy\\n\\n### What Cursive Protocol Is\\n\\nA **specification layer** for the internet that adds:\\n- **Provenance:** Who made this, when, how?\\n- **Context:** What does this mean, where does it belong?\\n- **Humanity:** Is this human-authored or AI-generated?\\n- **Sovereignty:** Can the author export and move their work?\\n\\n### The Stack Metaphor\\n\\n```\\nHTTP       \\u2192 Transport (how bits move)\\nHTML       \\u2192 Structure (what elements exist)\\nCSS        \\u2192 Presentation (how it looks)\\nJavaScript \\u2192 Behavior (what it does)\\n\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\nCursive    \\u2192 Context (what it means, who made it, why it matters)\\n```\\n\\n### What Cursive Protocol Is Not\\n\\n- \\u274c A database schema (implementations choose their own storage)\\n- \\u274c A UI framework (implementations design their own interfaces)\\n- \\u274c A specific tech stack (can be built in any language)\\n- \\u274c A centralized platform (federated, exportable, sovereign)\\n\\n---\\n\\n## Core Primitives\\n\\n### 1. Collection\\nA **container for pages** representing a journal, workspace, or guide.\\n\\n**Metaphor:** A bound notebook or filing cabinet\\n\\n**Minimum required:**\\n- Unique identifier\\n- Owner identifier\\n- Title\\n\\n### 2. Folder\\n**Optional organization** within a collection.\\n\\n**Metaphor:** Divider tabs in a notebook\\n\\n**Minimum required:**\\n- Unique identifier\\n- Parent collection identifier\\n- Can nest (optional)\\n\\n### 3. Page\\nThe **sacred primitive** - human-authored document.\\n\\n**Metaphor:** A sheet of paper\\n\\n**Minimum required:**\\n- Unique identifier\\n- Content (see CPL format below)\\n- Authorship provenance\\n- Parent folder/collection identifier\\n\\n---\\n\\n## CPL: Cursive Page Language\\n\\n**Version:** 0.1  \\n**Format:** JSON  \\n**Purpose:** Represent human-authored pages with provenance\\n\\n### Minimal Valid Page\\n\\n```json\\n{\\n  \\\"cursive\\\": \\\"0.1\\\",\\n  \\\"type\\\": \\\"page\\\",\\n  \\\"id\\\": \\\"550e8400-e29b-41d4-a716-446655440000\\\",\\n  \\\"content\\\": {\\n    \\\"type\\\": \\\"doc\\\",\\n    \\\"content\\\": []\\n  },\\n  \\\"provenance\\\": {\\n    \\\"author\\\": \\\"user@example.com\\\",\\n    \\\"created_at\\\": \\\"2025-11-06T10:00:00Z\\\",\\n    \\\"origin\\\": \\\"human\\\"\\n  }\\n}\\n```\\n\\n### Content Format\\n\\n**Base:** TipTap-compatible JSON (ProseMirror schema)\\n\\n**Standard blocks:**\\n- `paragraph`\\n- `heading` (levels 1-6)\\n- `blockquote`\\n- `code_block`\\n- `bullet_list` / `ordered_list`\\n- `image` (with source attribution)\\n\\n**Cursive-specific blocks:**\\n- `drawing` - Ink strokes (vector paths)\\n- `transclude` - Reference to another page\\n\\n### Provenance (Required)\\n\\n```json\\n{\\n  \\\"provenance\\\": {\\n    \\\"author\\\": \\\"user@example.com\\\",        // REQUIRED\\n    \\\"created_at\\\": \\\"2025-11-06T10:00:00Z\\\", // REQUIRED\\n    \\\"updated_at\\\": \\\"2025-11-06T11:30:00Z\\\", // If edited\\n    \\\"origin\\\": \\\"human\\\",                    // \\\"human\\\" | \\\"ai-assisted\\\" | \\\"synthetic\\\"\\n    \\n    // Optional process fingerprint\\n    \\\"fingerprint\\\": {\\n      \\\"hash\\\": \\\"sha256:abc123...\\\",\\n      \\\"confidence\\\": 94,                   // 0-100 score\\n      \\\"evidence\\\": {\\n        \\\"stroke_count\\\": 312,\\n        \\\"revision_count\\\": 23,\\n        \\\"active_duration_ms\\\": 2820000,\\n        \\\"temporal_markers\\\": [...]\\n      }\\n    }\\n  }\\n}\\n```\\n\\n**Key contract:** \\n- `origin: \\\"human\\\"` requires `fingerprint` with `confidence >= 70`\\n- `origin: \\\"ai-assisted\\\"` must include `ai_tool_id` and `ratified_at`\\n- `origin: \\\"synthetic\\\"` must clearly mark AI-generated content\\n\\n### Drawing Block\\n\\n```json\\n{\\n  \\\"type\\\": \\\"drawing\\\",\\n  \\\"attrs\\\": {\\n    \\\"strokes\\\": [\\n      {\\n        \\\"points\\\": [[x, y, pressure], ...],\\n        \\\"color\\\": \\\"#000000\\\",\\n        \\\"width\\\": 2,\\n        \\\"timestamp_ms\\\": 1234\\n      }\\n    ],\\n    \\\"width\\\": 800,\\n    \\\"height\\\": 600\\n  }\\n}\\n```\\n\\n**Why strokes include timestamps:** Enables stroke variance analysis for human verification.\\n\\n### Transclusion Block\\n\\n```json\\n{\\n  \\\"type\\\": \\\"transclude\\\",\\n  \\\"attrs\\\": {\\n    \\\"source\\\": \\\"page:550e8400-e29b-41d4-a716-446655440001\\\",\\n    \\\"excerpt\\\": true,          // Show preview vs full content\\n    \\\"editable\\\": false         // Can viewer edit inline?\\n  }\\n}\\n```\\n\\n---\\n\\n## CHL: Cursive Hospitality Language\\n\\n**Version:** 0.1  \\n**Format:** JSON  \\n**Purpose:** Represent correspondence, invitations, and shares\\n\\n### Types of Hospitality Actions\\n\\n1. **Letter** - Human-to-human correspondence\\n2. **Invitation** - Timed prompt to engage with content\\n3. **Share** - Grant access to a page/collection\\n4. **Gift** - Transfer ownership of content\\n\\n### Minimal Valid Invitation\\n\\n```json\\n{\\n  \\\"cursive\\\": \\\"0.1\\\",\\n  \\\"type\\\": \\\"invitation\\\",\\n  \\\"id\\\": \\\"660e8400-e29b-41d4-a716-446655440000\\\",\\n  \\n  \\\"from\\\": \\\"host@example.com\\\",\\n  \\\"to\\\": [\\\"participant1@example.com\\\", \\\"participant2@example.com\\\"],\\n  \\n  \\\"content\\\": {\\n    \\\"title\\\": \\\"Week 1: Introduction\\\",\\n    \\\"body\\\": \\\"Welcome to the course. Please complete...\\\",\\n    \\\"target\\\": \\\"page:550e8400-e29b-41d4-a716-446655440002\\\"\\n  },\\n  \\n  \\\"timing\\\": {\\n    \\\"scheduled_for\\\": \\\"2025-11-08T09:00:00Z\\\",\\n    \\\"expires_at\\\": \\\"2025-11-15T23:59:59Z\\\"\\n  },\\n  \\n  \\\"provenance\\\": {\\n    \\\"author\\\": \\\"host@example.com\\\",\\n    \\\"created_at\\\": \\\"2025-11-06T10:00:00Z\\\",\\n    \\\"origin\\\": \\\"human\\\"\\n  }\\n}\\n```\\n\\n**Key contracts:**\\n- All hospitality actions require `provenance.origin = \\\"human\\\"`\\n- Invitations cannot be auto-sent without explicit host action\\n- Recipients can always decline/unsubscribe\\n\\n---\\n\\n## Export Format\\n\\n**File extension:** `.cursive`  \\n**Structure:** ZIP archive\\n\\n### Manifest\\n\\n```json\\n{\\n  \\\"cursive\\\": \\\"0.1\\\",\\n  \\\"export_type\\\": \\\"collection\\\",\\n  \\\"exported_at\\\": \\\"2025-11-06T12:00:00Z\\\",\\n  \\\"exported_by\\\": \\\"user@example.com\\\",\\n  \\n  \\\"contents\\\": {\\n    \\\"collection\\\": \\\"collection.json\\\",\\n    \\\"pages\\\": [\\\"pages/page-1.json\\\", \\\"pages/page-2.json\\\"],\\n    \\\"fingerprints\\\": [\\\"proofs/page-1-proof.json\\\"]\\n  }\\n}\\n```\\n\\n### Directory Structure\\n\\n```\\nmy-work.cursive/  (ZIP)\\n\\u251c\\u2500 manifest.json\\n\\u251c\\u2500 collection.json\\n\\u251c\\u2500 pages/\\n\\u2502  \\u251c\\u2500 page-1.json\\n\\u2502  \\u2514\\u2500 page-2.json\\n\\u2514\\u2500 proofs/\\n   \\u2514\\u2500 page-1-proof.json\\n```\\n\\n**Contract:** Any CP-compliant system can import this archive and reconstruct the collection with full provenance.\\n\\n---\\n\\n## Verification Protocol\\n\\n### Human Fingerprint Algorithm\\n\\n**Purpose:** Distinguish human-created content from AI-generated or pasted content.\\n\\n**Signals used:**\\n1. **Stroke timing variance** (200-800ms = human, <50ms = synthetic)\\n2. **Idle gaps** (5+ second pauses = thinking, none = robotic)\\n3. **Revision patterns** (5-20% corrections = human, <1% = too perfect)\\n4. **Temporal inconsistency** (speed varies = human, constant = synthetic)\\n\\n**Output:** Confidence score 0-100\\n\\n**Contract:**\\n```json\\n{\\n  \\\"fingerprint\\\": {\\n    \\\"hash\\\": \\\"sha256:...\\\",           // Hash of all events\\n    \\\"confidence\\\": 94,               // 0-100\\n    \\\"algorithm\\\": \\\"cp-fingerprint-v1\\\",\\n    \\\"evidence\\\": {\\n      \\\"stroke_count\\\": 312,\\n      \\\"stroke_variance_ms\\\": 450,    // Within human range\\n      \\\"long_pauses\\\": 7,             // 7 thinking pauses\\n      \\\"correction_rate\\\": 0.074      // 7.4% revision rate\\n    }\\n  }\\n}\\n```\\n\\n**Badge display rule:** Show \\\"\\u2713 Human-made\\\" badge when `confidence >= 70`\\n\\n---\\n\\n## REST API Surface (Minimal)\\n\\n### Collections\\n\\n```\\nGET    /api/collections/{id}           # Retrieve collection metadata\\nPOST   /api/collections                # Create new collection\\nDELETE /api/collections/{id}           # Archive collection\\nGET    /api/collections/{id}/export    # Export as .cursive archive\\n```\\n\\n### Pages\\n\\n```\\nGET    /api/pages/{id}                 # Retrieve page (CPL format)\\nPOST   /api/pages                      # Create new page\\nPUT    /api/pages/{id}                 # Update page content\\nDELETE /api/pages/{id}                 # Archive page\\nGET    /api/pages/{id}/fingerprint     # Get verification proof\\n```\\n\\n### Hospitality\\n\\n```\\nGET    /api/invitations/{id}           # Retrieve invitation (CHL format)\\nPOST   /api/invitations                # Create invitation (requires human auth)\\nGET    /api/invitations/{id}/responses # Get responses\\n```\\n\\n**Authentication contract:** All write operations require authenticated human user. No automated writes to pages.\\n\\n---\\n\\n## Federation Protocol (Future)\\n\\n### Canonical Identifiers\\n\\nUsers have global identifiers: `username@instance.com`\\n\\nPages have URIs: `cursive://instance.com/collections/{id}/pages/{id}`\\n\\n### Cross-Instance References\\n\\n```json\\n{\\n  \\\"type\\\": \\\"transclude\\\",\\n  \\\"attrs\\\": {\\n    \\\"source\\\": \\\"cursive://university.edu/collections/abc/pages/123\\\",\\n    \\\"author\\\": \\\"professor@university.edu\\\",\\n    \\\"consent_given\\\": true\\n  }\\n}\\n```\\n\\n**Contract:** Host instance must verify consent before rendering cross-instance transclusions.\\n\\n---\\n\\n## Compliance Levels\\n\\n### Level 1: Core (MUST)\\n- \\u2705 Support CPL page format\\n- \\u2705 Preserve provenance metadata\\n- \\u2705 Export to `.cursive` archives\\n- \\u2705 Display origin badges (human vs AI)\\n\\n### Level 2: Hospitality (SHOULD)\\n- \\u2705 Support CHL invitation format\\n- \\u2705 Require human action for sending\\n- \\u2705 Allow recipient unsubscribe\\n\\n### Level 3: Verification (SHOULD)\\n- \\u2705 Calculate human fingerprints\\n- \\u2705 Display confidence scores\\n- \\u2705 Store process evidence\\n\\n### Level 4: Federation (MAY)\\n- \\u2705 Support cross-instance transclusions\\n- \\u2705 Canonical user identifiers\\n- \\u2705 Consent verification\\n\\n---\\n\\n## Design Constraints\\n\\n### Non-Negotiable Rules\\n\\n1. **Human Agency**\\n   - No AI writes directly to page content\\n   - Suggestions must be explicitly ratified by humans\\n   - Users can always see what was suggested vs what they wrote\\n\\n2. **Provenance Preservation**\\n   - Every page includes `provenance.origin`\\n   - Fingerprints cannot be faked (timestamped events)\\n   - Process evidence travels with exports\\n\\n3. **Sovereign Ownership**\\n   - Users can export everything they create\\n   - Exports include full provenance\\n   - No vendor lock-in (portable to any CP system)\\n\\n4. **Hospitality Over Automation**\\n   - Invitations require explicit host action\\n   - No algorithmic feeds or auto-posting\\n   - Recipients can always decline\\n\\n5. **Transparent Verification**\\n   - Fingerprint algorithms are open\\n   - Confidence scores are always shown\\n   - Users can contest AI-generated labels\\n\\n---\\n\\n## Reference Implementations\\n\\n### Compliant Systems\\n\\nA system is **CP-0.1 compliant** if it:\\n1. Can import/export `.cursive` archives\\n2. Preserves `provenance` metadata\\n3. Displays origin badges correctly\\n4. Requires human action for content creation\\n\\n### Test Suite (Future)\\n\\n```bash\\ncursive-protocol-test --level core ./my-implementation\\ncursive-protocol-test --level hospitality ./my-implementation\\n```\\n\\n---\\n\\n## Versioning\\n\\n### Current: v0.1 (Draft)\\n- CPL page format\\n- CHL invitation format\\n- Export manifest\\n- Fingerprint algorithm\\n\\n### Planned: v0.2\\n- Federation protocol\\n- Cross-instance consent\\n- Canonical identifiers\\n\\n### Planned: v1.0\\n- Finalized specs\\n- Compliance test suite\\n- Multiple reference implementations\\n\\n---\\n\\n## Governance\\n\\n### Specification Process\\n\\n1. **Proposal** - GitHub issue or RFC\\n2. **Discussion** - Community feedback\\n3. **Draft** - Specification document\\n4. **Implementation** - Reference implementation\\n5. **Finalized** - Version number assigned\\n\\n### Backwards Compatibility\\n\\n- Breaking changes require major version bump\\n- Implementations should support N-1 versions\\n- Export format includes version number\\n\\n---\\n\\n## Security Considerations\\n\\n### Fingerprint Spoofing\\n\\n**Attack:** Generate synthetic content with fake timestamps\\n\\n**Mitigation:**\\n- Use cryptographic signatures\\n- Require device attestation (optional)\\n- Cross-reference multiple sessions\\n- Human verification as fallback\\n\\n### Cross-Site Transclusion\\n\\n**Attack:** Embed malicious content via transclusion\\n\\n**Mitigation:**\\n- Require explicit consent\\n- Sandbox transcluded content\\n- Show clear attribution\\n- Allow blocking by domain\\n\\n### Privacy\\n\\n**Concern:** Process fingerprints reveal too much\\n\\n**Mitigation:**\\n- User controls fingerprint visibility\\n- Can share page without process data\\n- Coarse timestamps (minute-level, not millisecond)\\n- Aggregated metrics only\\n\\n---\\n\\n## Philosophical Foundation\\n\\n### Why This Protocol Exists\\n\\nIn an age of:\\n- Effortless AI content generation\\n- Engagement-optimized platforms\\n- Algorithmic feeds and dark patterns\\n- Unclear authorship and provenance\\n\\nWe need a protocol that:\\n- Proves human authorship\\n- Preserves process and craft\\n- Respects user sovereignty\\n- Prioritizes meaning over metrics\\n\\n### Core Values\\n\\n1. **Qualitative over Quantitative** - Experience > engagement metrics\\n2. **Embodied over Abstract** - Bodies, places, hands matter\\n3. **Competence over Automation** - Tools scaffold skill, don't replace it\\n4. **Hospitality over Hostility** - Human hosts, not algorithms\\n5. **Craft over Convenience** - Process as proof, effort as value\\n6. **Sovereignty over Captivity** - Export everything, move anywhere\\n\\n---\\n\\n## FAQ\\n\\n### Q: Why not use ActivityPub?\\n**A:** ActivityPub is for social networking. Cursive Protocol is for human-authored content with verifiable provenance. Different concerns.\\n\\n### Q: Why not blockchain/web3?\\n**A:** Cursive works with or without blockchain. Provenance is cryptographic but doesn't require distributed ledger. Can add later.\\n\\n### Q: Can AI use Cursive Protocol?\\n**A:** Yes, but AI-generated content must be marked `origin: \\\"synthetic\\\"`. The protocol is neutral but transparent.\\n\\n### Q: Is this anti-AI?\\n**A:** No. It's pro-human. AI can assist (marked `ai-assisted`), but cannot autonomously author pages marked `human`.\\n\\n### Q: Who owns this protocol?\\n**A:** It's open. Like HTTP or HTML, anyone can implement. Specification is MIT licensed.\\n\\n---\\n\\n## Conformance Statement\\n\\nAn implementation claiming **Cursive Protocol v0.1 compliance** MUST:\\n\\n1. Support CPL page format (JSON)\\n2. Include provenance metadata on all pages\\n3. Export to `.cursive` archive format\\n4. Display origin badges (human/ai-assisted/synthetic)\\n5. Require human authentication for page creation\\n6. Preserve fingerprint evidence (if Level 3)\\n\\nAn implementation MAY additionally:\\n- Support CHL hospitality format\\n- Calculate human fingerprints\\n- Enable federation (future)\\n- Add custom block types (namespaced)\\n\\n---\\n\\n## License\\n\\nCursive Protocol Specification: **CC0 1.0 Universal (Public Domain)**\\n\\nReference implementations may use any license.\\n\\n---\\n\\n## Contact\\n\\n- **Specification:** github.com/cursive-protocol/spec\\n- **Discussion:** github.com/cursive-protocol/spec/discussions\\n- **Reference App:** (separate repository)\\n\\n---\\n\\n**This is Cursive Protocol v0.1. A protocol for humanity on the internet.**\\n\", \"filename\": \"/mnt/user-data/outputs/CURSIVE_PROTOCOL_v0.1.md\"}"
            },
            "approval_options": null,
            "approval_key": null
          },
          {
            "start_timestamp": null,
            "stop_timestamp": null,
            "flags": null,
            "type": "tool_result",
            "name": "create_file",
            "content": [
              {
                "type": "text",
                "text": "File created successfully: /mnt/user-data/outputs/CURSIVE_PROTOCOL_v0.1.md",
                "uuid": "43f8a9b4-0cab-4139-a358-6ebccb5ca601"
              }
            ],
            "is_error": false,
            "message": null,
            "integration_name": null,
            "integration_icon_url": null,
            "display_content": {
              "type": "text",
              "text": "File created successfully: /mnt/user-data/outputs/CURSIVE_PROTOCOL_v0.1.md"
            }
          },
          {
            "start_timestamp": null,
            "stop_timestamp": null,
            "flags": null,
            "type": "token_budget"
          },
          {
            "start_timestamp": "2025-11-06T12:22:57.857504Z",
            "stop_timestamp": "2025-11-06T12:22:57.857504Z",
            "flags": null,
            "type": "text",
            "text": "",
            "citations": []
          }
        ],
        "updated_at": "2025-11-06T12:22:57.952014Z",
        "attachments": [],
        "files": []
      }
    }
  ]
}